(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{1556:function(e,t,a){"use strict";a.d(t,"a",(function(){return P}));var n=a(1),i=a(12),r=a(832),l=a.n(r),s=a(34),o=a.n(s),c=a(119),d=a(563),p=a(448),m=a(181),u=a(452);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function y(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function g(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function E(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(h,e);var t,a,i,r,s=(t=h,function(){var e,a=v(t);if(E()){var n=v(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return b(this,e)});function h(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,h),(t=s.call(this,e)).saveSwitch=function(e){t.rcSwitch=e},t.renderSwitch=function(e){var a,i=e.getPrefixCls,r=t.props,s=r.prefixCls,m=r.size,u=r.loading,h=r.className,g=void 0===h?"":h,b=r.disabled,E=i("switch",s),v=o()(g,(y(a={},"".concat(E,"-small"),"small"===m),y(a,"".concat(E,"-loading"),u),a)),_=u?n.createElement(p.a,{type:"loading",className:"".concat(E,"-loading-icon")}):null;return n.createElement(d.a,{insertExtraNode:!0},n.createElement(l.a,f({},Object(c.default)(t.props,["loading"]),{prefixCls:E,className:v,disabled:b||u,ref:t.saveSwitch,loadingIcon:_})))},Object(u.a)("checked"in e||!("value"in e),"Switch","`value` is not validate prop, do you mean `checked`?"),t}return a=h,(i=[{key:"focus",value:function(){this.rcSwitch.focus()}},{key:"blur",value:function(){this.rcSwitch.blur()}},{key:"render",value:function(){return n.createElement(m.a,null,this.renderSwitch)}}])&&g(a.prototype,i),r&&g(a,r),h}(n.Component);P.__ANT_SWITCH=!0,P.propTypes={prefixCls:i.string,size:i.oneOf(["small","default","large"]),className:i.string}},1557:function(e,t,a){var n=a(549),i=a(708),r=a(477);e.exports=function(e,t){var a={};return t=r(t,3),i(e,(function(e,i,r){n(a,t(e,i,r),e)})),a}},1558:function(e,t,a){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i,r=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var t=o();if(t&&t.has(e))return t.get(e);var a={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var l=i?Object.getOwnPropertyDescriptor(e,r):null;l&&(l.get||l.set)?Object.defineProperty(a,r,l):a[r]=e[r]}a.default=e,t&&t.set(e,a);return a}(a(1)),l=(i=a(34))&&i.__esModule?i:{default:i},s=a(559);function o(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var d=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(a[n[i]]=e[n[i]])}return a},p=function(e){return r.createElement(s.ConfigConsumer,null,(function(t){var a=t.getPrefixCls,n=e.prefixCls,i=e.className,s=e.avatar,o=e.title,p=e.description,m=d(e,["prefixCls","className","avatar","title","description"]),u=a("card",n),h=(0,l.default)("".concat(u,"-meta"),i),f=s?r.createElement("div",{className:"".concat(u,"-meta-avatar")},s):null,y=o?r.createElement("div",{className:"".concat(u,"-meta-title")},o):null,g=p?r.createElement("div",{className:"".concat(u,"-meta-description")},p):null,b=y||g?r.createElement("div",{className:"".concat(u,"-meta-detail")},y,g):null;return r.createElement("div",c({},m,{className:h}),f,b)}))};t.default=p},1571:function(e,t,a){"use strict";var n=a(1),i=a(34),r=a.n(i),l=a(119),s=a(181);function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function c(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var d=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(a[n[i]]=e[n[i]])}return a},p=function(e){return n.createElement(s.a,null,(function(t){var a,i,s=t.getPrefixCls,p=e.prefixCls,m=e.className,u=e.color,h=void 0===u?"":u,f=e.children,y=e.pending,g=e.dot,b=d(e,["prefixCls","className","color","children","pending","dot"]),E=s("timeline",p),v=r()((c(a={},"".concat(E,"-item"),!0),c(a,"".concat(E,"-item-pending"),y),a),m),_=r()((c(i={},"".concat(E,"-item-head"),!0),c(i,"".concat(E,"-item-head-custom"),g),c(i,"".concat(E,"-item-head-").concat(h),!0),i));return n.createElement("li",o({},Object(l.default)(b,["position"]),{className:v}),n.createElement("div",{className:"".concat(E,"-item-tail")}),n.createElement("div",{className:_,style:{borderColor:/blue|red|green|gray/.test(h)?void 0:h}},g),n.createElement("div",{className:"".concat(E,"-item-content")},f))}))};p.defaultProps={color:"blue",pending:!1,position:""};var m=p,u=a(448);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function y(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return g(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(a);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return g(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function b(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var C=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(a[n[i]]=e[n[i]])}return a},S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(c,e);var t,a,i,l,o=(t=c,function(){var e,a=k(t);if(P()){var n=k(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return _(this,e)});function c(){var e;return E(this,c),(e=o.apply(this,arguments)).renderTimeline=function(t){var a,i=t.getPrefixCls,l=e.props,s=l.prefixCls,o=l.pending,c=void 0===o?null:o,d=l.pendingDot,p=l.children,h=l.className,g=l.reverse,E=l.mode,v=C(l,["prefixCls","pending","pendingDot","children","className","reverse","mode"]),_=i("timeline",s),P="boolean"==typeof c?null:c,k=r()(_,(b(a={},"".concat(_,"-pending"),!!c),b(a,"".concat(_,"-reverse"),!!g),b(a,"".concat(_,"-").concat(E),!!E),a),h),O=c?n.createElement(m,{pending:!!c,dot:d||n.createElement(u.a,{type:"loading"})},P):null,S=g?[O].concat(y(n.Children.toArray(p).reverse())):[].concat(y(n.Children.toArray(p)),[O]),I=function(e,t){return"alternate"===E?"right"===e.props.position?"".concat(_,"-item-right"):"left"===e.props.position?"".concat(_,"-item-left"):"".concat(_,t%2==0?"-item-left":"-item-right"):"left"===E?"".concat(_,"-item-left"):"right"===E||"right"===e.props.position?"".concat(_,"-item-right"):""},x=S.filter((function(e){return!!e})),D=n.Children.count(x),j="".concat(_,"-item-last"),w=n.Children.map(x,(function(e,t){var a=t===D-2?j:"",i=t===D-1?j:"";return n.cloneElement(e,{className:r()([e.props.className,!g&&c?a:i,I(e,t)])})}));return n.createElement("ul",f({},v,{className:k}),w)},e}return a=c,(i=[{key:"render",value:function(){return n.createElement(s.a,null,this.renderTimeline)}}])&&v(a.prototype,i),l&&v(a,l),c}(n.Component);S.Item=m,S.defaultProps={reverse:!1,mode:""};t.a=S},1584:function(e,t,a){"use strict";a.r(t);var n=a(1),i=a.n(n),r=a(1577),l=a(433),s=a(1602),o=a(503),c=a(18),d=a(115),p=a(763),m=a(1593),u=a(1608),h=a(1567),f=a(1578),y=a(1105),g=a(1183),b=a(1580),E=a(448),v=a(836),_=a(1028),P=a(1579),k=a(732),O=a(1572),C=a(1596),S=a(1568),I=a(436),x=a.n(I),D=a(1587),j=a(1029),w=a(1600),M=a(1004),T=a.n(M),F=a(1557),A=a.n(F),N=a(435),V=a(434),L=a(442),R=a(439),B=a(437),z=a(440);class Y extends i.a.Component{constructor(e){var t,a,n;super(e),n=()=>{const e=this;Object(N.c)(Object(N.g)(V.md,[this.props.active_practiceId]),(function(t){e.setState({patientGroup:t,loading:!1})}),(function(){e.setState({loading:!1})}))},(a="getPatientGroup")in(t=this)?Object.defineProperty(t,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[a]=n,this.state={patientGroup:[],loading:!0}}componentDidMount(){this.getPatientGroup()}deleteObject(e){const t=this,a=e;a.is_active=!1;Object(N.k)(Object(N.g)(V.md,[this.props.active_practiceId]),a,(function(){t.getPatientGroup()}),(function(){}))}render(){const e=this,t=[{title:"Group Name",dataIndex:"name",key:"name"},{title:"Patient Count",dataIndex:"patient_count",key:"patient_count"},{title:"Action",key:"id",dataIndex:"id",render:(t,a)=>i.a.createElement(k.a,{title:"Are you sure delete this prescription?",onConfirm:()=>e.deleteObject(a),okText:"Yes",cancelText:"No"},i.a.createElement("a",null,"Delete"))}],a=[{label:"Group Name",key:"name",required:!0,type:B.db}],n={successFn(t){console.log(t),Object(N.a)(B.sc,"Group created successfully!!"),e.getPatientGroup()},errorFn(){},action:Object(N.g)(V.md,[this.props.active_practiceId]),method:"post"},r=m.a.create()(z.a);return i.a.createElement(y.a,null,i.a.createElement(r,{formProp:n,title:"Patient Groups",fields:a}),i.a.createElement(P.a,null),i.a.createElement(R.a,{dataSource:this.state.patientGroup,loading:this.state.loading,columns:t}))}}var q=a(460),W=a(441),G=a(459);function H(){return(H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function U(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function K(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?U(Object(a),!0).forEach((function(t){Q(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):U(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Q(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Z=u.a.Meta,X=S.a.Search,J=D.a.MonthPicker;let $=1;class ee extends i.a.Component{constructor(e){super(e),Q(this,"togglePatientGroupEditing",e=>{this.setState({showPatientGroupModal:!!e}),e||this.getPatientGroup()}),Q(this,"changeSelectedPatientGroup",e=>{const t=this;this.setState({selectedPatientGroup:e.target.value,currentPage:null},(function(){t.getMorePatient()}))}),Q(this,"addNewOptionField",()=>{const e=this.props.form,t=e.getFieldValue("keys").concat($++);e.setFieldsValue({keys:t})}),Q(this,"removeNewOptionField",e=>{const t=this.props.form,a=t.getFieldValue("keys");1!==a.length&&t.setFieldsValue({keys:a.filter(t=>t!==e)})}),Q(this,"handleChangeOption",(e,t,a)=>{this.setState((function(t){return{selectedOption:K(K({},t.selectedOption),{},{[e]:a}),custm_col:a?12:8}}))}),Q(this,"AdvanceSearchPatient",e=>{const t=this;e.preventDefault();let a={};this.props.form.validateFields((e,t)=>{e||(a=K(K({},t),{},{dob:t.dob?x()(t.dob).format("YYYY-MM-DD"):null,dob_gte:t.dob_gte?x()(t.dob_gte).format("YYYY-MM-DD"):null,dob_lte:t.dob_lte?x()(t.dob_lte).format("YYYY-MM-DD"):null,dob_month:t.dob_month?x()(t.dob_month).format("MM"):null}))}),delete a.keys,t.setState({patientData:a},(function(){t.loadAdvanceSearchPatient()}))}),Q(this,"loadAdvanceSearchPatient",(e=1)=>{const t=this,a=t.state.patientData;t.setState({advancedSearch:!0,advanceLoading:!0,morePatients:null});a.page=e;const n=this.props.showAllClinic?K({},a):K(K({},a),{},{perm_practice:this.props.active_practiceId});Object(N.c)(V.e,(function(e){t.setState((function(t){return e.current>1?{patientListData:[...t.patientListData,...e.results],morePatientList:e.next,currentPage:e.current,advanceLoading:!1}:{patientListData:[...e.results],morePatientList:e.next,currentPage:e.current,advanceLoading:!1}}))}),(function(){t.setState({advanceLoading:!1})}),n)}),this.state={patientListData:[],patientGroup:[],morePatients:null,loading:!0,selectedPatientGroup:"all",advanced_option:W.b,selectedOption:{},sourceList:[],custm_col:8,advanceLoading:!1},this.getPatientListData=this.getPatientListData.bind(this),this.searchPatient=this.searchPatient.bind(this),this.getMorePatient=this.getMorePatient.bind(this),this.getSources=this.getSources.bind(this)}componentDidMount(){this.getPatientListData(),this.getPatientGroup(),this.getSources()}getSources(){const e=this;Object(N.c)(V.He,(function(t){e.setState({sourceList:t})}),(function(){}))}getPatientGroup(){const e=this;Object(N.c)(Object(N.g)(V.md,[this.props.active_practiceId]),(function(t){const a=t.sort((function(e,t){return t.patient_count-e.patient_count}));e.setState({patientGroup:a})}),(function(){e.setState({})}))}getPatientListData(){const e=this,t=this.props.showAllClinic?{}:{perm_practice:this.props.active_practiceId};Object(N.c)(V.cd,(function(t){e.setState({patientListData:t.results,morePatients:t.next,currentPage:t.current,totalPatients:t.count,loading:!1})}),(function(){e.setState({loading:!1})}),t)}searchPatient(e,t=1){const a=this;a.setState({searchvalue:!0,searchString:e});const n=function(t){a.setState((function(a){if(a.searchString==e)return t.current>1?{patientListData:[...a.patientListData,...t.results],morePatients:t.next,currentPage:t.current}:{patientListData:[...t.results],morePatients:t.next,currentPage:t.current,loading:!1}}))},i=function(){},r={page:t,page_size:20},l=this.props.showAllClinic?K({},r):K(K({},r),{},{perm_practice:this.props.active_practiceId});e?Object(N.c)(Object(N.g)(V.ce,[e]),n,i,l):this.getPatientListData()}getMorePatient(){const e=this,t=this.state.currentPage,a=this.props.showAllClinic?{}:{perm_practice:this.props.active_practiceId};t?a.page=parseInt(t)+1:this.setState({loading:!0});const n=this.state.selectedPatientGroup;if("all"!=n)if("smart_a"==n||"smart_b"==n||"smart_c"==n||"smart_d"==n||"smart_e"==n||"smart_f"==n)switch(n){case"smart_a":a.gender="male";break;case"smart_b":a.gender="female";break;case"smart_c":a.gender="female",a.age=30,a.type="gt";break;case"smart_d":a.gender="female",a.age=30,a.type="lt";break;case"smart_e":a.gender="male",a.age=30,a.type="gt";break;case"smart_f":a.gender="male",a.age=30,a.type="lt"}else a.group=this.state.selectedPatientGroup;Object(N.c)(V.cd,(function(a){a.current==t+1&&e.setState((function(e){return a.current>1?{patientListData:[...e.patientListData,...a.results],morePatients:a.next,currentPage:a.current}:{patientListData:[...a.results],morePatients:a.next,currentPage:a.current,loading:!1}}))}),(function(){}),K({},a))}advancedOption(e){const t=this;this.getPatientListData(),this.setState({advancedOptionShow:!e,selectedOption:""}),e&&t.props.form.setFieldsValue({keys:[0]})}render(){const e=this,t=this.props.form,a=t.getFieldDecorator,n=t.getFieldValue,r=this.state,s=r.searchString,c=r.morePatients;a("keys",{initialValue:[0]});const d=n("keys"),u=K({},A()(this.state.selectedOption,(function(e){return e}))),h=d.map((t,a)=>i.a.createElement(y.a,{gutter:12,key:t},i.a.createElement(g.a,{span:10},i.a.createElement(p.a,{style:{width:"200px"},defaultValue:B.B,key:t,size:"small",onChange:e=>this.handleChangeOption(t,"type",e)},i.a.createElement(p.a.Option,{value:""},B.B),T()(this.state.advanced_option,(function(a){return e.state.selectedOption[t]==a.value||!u[a.value]})).map(e=>i.a.createElement(p.a.Option,{value:e.value,key:t},e.label)))),this.state.selectedOption?i.a.createElement(i.a.Fragment,null,i.a.createElement(g.a,{span:8},i.a.createElement(ne,{k:t,selectedOption:this.state.selectedOption,form:this.props.form,sourceList:this.state.sourceList})),i.a.createElement(g.a,{span:4},a?i.a.createElement(o.a,{onClick:()=>this.removeNewOptionField(t),size:"small",style:{margin:5}},i.a.createElement(E.a,{className:"dynamic-delete-button",type:"minus-circle-o",style:{color:"red"}})):null,a==d.length-1&&e.state.selectedOption[t]?i.a.createElement(o.a,{onClick:this.addNewOptionField,size:"small",style:{margin:5}},i.a.createElement(E.a,{className:"dynamic-delete-button",type:"plus-circle-o"})):null)):null));return e.props.activePracticePermissions.ViewPatient?i.a.createElement("div",null,i.a.createElement(y.a,{gutter:16},this.state.advancedOptionShow?i.a.createElement(m.a,{onSubmit:this.AdvanceSearchPatient,layout:"inline"},i.a.createElement(y.a,{gutter:16},i.a.createElement(g.a,{span:16},h),i.a.createElement(g.a,{span:4,style:{display:"flex"}},i.a.createElement(m.a.Item,null,i.a.createElement(o.a,{icon:"search",htmlType:"submit",onSubmit:this.AdvanceSearchPatient,type:"primary",style:{margin:5}},"Search")),i.a.createElement(m.a.Item,null,i.a.createElement(o.a,{style:{margin:5},onClick:e=>this.advancedOption(!0),size:"small"},"Basic Search"))))):i.a.createElement(i.a.Fragment,null,i.a.createElement(g.a,{span:12},i.a.createElement(X,{style:{margin:5},placeholder:"Search Patient By Name / ID / Mobile No / Aadhar No",size:"small",onChange:e=>this.searchPatient(e.target.value),enterButton:!0})),i.a.createElement(g.a,{span:12,style:{textAlign:"center"}},i.a.createElement(o.a,{style:{margin:5},onClick:e=>this.advancedOption(!1),size:"small"},"Advance Search"))),i.a.createElement(P.a,{style:{margin:0}})),i.a.createElement(y.a,{gutter:16},i.a.createElement(g.a,{span:5,style:{height:"calc(100% - 55px)",overflow:"auto",padding:"10px"}},i.a.createElement(j.a.Group,{buttonStyle:"solid",defaultValue:this.state.selectedPatientGroup,onChange:this.changeSelectedPatientGroup},i.a.createElement("h2",null,"Patients"),i.a.createElement(j.a.Button,{key:"all",style:{width:"100%",backgroundColor:"transparent",border:"0px"},value:"all"},"All Patients",i.a.createElement(O.a,{color:"#87d068",style:{float:"right",margin:4}},this.state.totalPatients?this.state.totalPatients:0)),i.a.createElement("p",null,i.a.createElement("br",null)),i.a.createElement("h2",null,"Groups"),i.a.createElement("p",null,i.a.createElement("b",null,"My Groups"),i.a.createElement("a",{style:{float:"right"},onClick:()=>this.togglePatientGroupEditing(!0)},"Manage")),this.state.patientGroup.map(t=>i.a.createElement(j.a.Button,{key:t.id,style:{width:"100%",backgroundColor:"transparent",border:"0px"},value:t.id},t.name,i.a.createElement(O.a,{color:"#87d068",style:{float:"right",margin:4}},t.practice_count["practice_".concat(e.props.active_practiceId)]))),i.a.createElement("p",null,i.a.createElement("br",null)),i.a.createElement("p",null,i.a.createElement("b",null,"Smart Groups")),i.a.createElement(j.a.Button,{style:{width:"100%",backgroundColor:"transparent",border:"0px"},key:"smart_a",value:"smart_a"},"All Male"),i.a.createElement(j.a.Button,{style:{width:"100%",backgroundColor:"transparent",border:"0px"},key:"smart_b",value:"smart_b"},"All Female"),i.a.createElement(j.a.Button,{style:{width:"100%",backgroundColor:"transparent",border:"0px"},key:"smart_e",value:"smart_e"},"Male Over 30"),i.a.createElement(j.a.Button,{style:{width:"100%",backgroundColor:"transparent",border:"0px"},key:"smart_c",value:"smart_c"},"Female Over 30"),i.a.createElement(j.a.Button,{style:{width:"100%",backgroundColor:"transparent",border:"0px"},key:"smart_f",value:"smart_f"},"Male Under 30"),i.a.createElement(j.a.Button,{style:{width:"100%",backgroundColor:"transparent",border:"0px"},key:"smart_d",value:"smart_d"},"Female Under 30"),i.a.createElement("p",null,i.a.createElement("br",null)))),i.a.createElement(g.a,{span:19,style:{overflow:"scroll",borderLeft:"1px solid #ccc"}},i.a.createElement(l.a,{spinning:this.state.loading},i.a.createElement(y.a,null,this.state.patientListData.length?this.state.patientListData.map(t=>i.a.createElement(ae,H({},t,{key:t.id,showMobile:e.props.activePracticePermissions.PatientPhoneNumber,showEmail:e.props.activePracticePermissions.PatientEmailId,setCurrentPatient:e.props.setCurrentPatient}))):i.a.createElement("p",{style:{textAlign:"center"}},"No Data Found"))),this.state.searchvalue?i.a.createElement(L.a,{loaderFunction:()=>this.searchPatient(s,c),loading:this.state.loading,hidden:!this.state.morePatients}):this.state.advancedSearch?i.a.createElement(L.a,{loading:this.state.advanceLoading,loaderFunction:()=>this.loadAdvanceSearchPatient(e.state.morePatientList),hidden:!this.state.morePatientList}):i.a.createElement(L.a,{loaderFunction:this.getMorePatient,loading:this.state.loading,hidden:!this.state.morePatients})),i.a.createElement(C.a,{visible:this.state.showPatientGroupModal,footer:null,onCancel:()=>this.togglePatientGroupEditing(!1)},i.a.createElement(Y,this.props)))):i.a.createElement(G.a,null)}}var te=m.a.create()(ee);function ae(e){return i.a.createElement(g.a,{xs:24,sm:24,md:12,lg:8,xl:8,xxl:6},i.a.createElement(u.a,{onClick:()=>e.setCurrentPatient(e),style:{margin:"3px",paddingBottom:"8px"}},i.a.createElement(Z,{avatar:e.image?i.a.createElement(b.a,{src:Object(N.h)(e.image),size:50}):i.a.createElement(b.a,{style:{backgroundColor:"#87d068"},size:50},e.user.first_name?e.user.first_name.charAt(0):i.a.createElement(E.a,{type:"user"})),title:(e.is_dead?"(Late) ":"")+e.user.first_name,description:i.a.createElement("span",null,e.showMobile?e.user.mobile:Object(q.b)(e.user.mobile),i.a.createElement("br",null),e.showEmail?e.user.email:Object(q.a)(e.user.email),i.a.createElement("br",null),i.a.createElement("span",{className:"patientIdHighlight"},"#",e.custom_id?e.custom_id:e.id,e.gender?",".concat(e.gender.charAt(0).toUpperCase()):null))})))}function ne(e){return i.a.createElement(i.a.Fragment,null,"name"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,{key:e.key,label:"contains"},e.form.getFieldDecorator("name")(i.a.createElement(S.a,{placeholder:"patient Name",size:"small"}))):null,"phone"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,{key:e.key,label:"contains"},e.form.getFieldDecorator("phone")(i.a.createElement(S.a,{placeholder:"Contact Number",size:"small"}))):null,"age"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,{key:e.key},e.form.getFieldDecorator("age")(i.a.createElement(w.a,{placeholder:"Patient Age",size:"small"}))):null,"age_gte"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,{key:e.key},e.form.getFieldDecorator("age_gte")(i.a.createElement(w.a,{placeholder:"Age more than",size:"small"}))):null,"age_lte"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,{key:e.key},e.form.getFieldDecorator("age_lte")(i.a.createElement(w.a,{placeholder:"Age Less than",size:"small"}))):null,"has_age"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,null,e.form.getFieldDecorator("has_age")(i.a.createElement(p.a,{style:{width:100},size:"small"},W.db.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label," "))))):null,"dob"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,{key:e.key,label:"is"},e.form.getFieldDecorator("dob")(i.a.createElement(D.a,{placeholder:"Date of Birth",size:"small"}))):null,"dob_gte"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,{key:e.key},e.form.getFieldDecorator("dob_gte")(i.a.createElement(D.a,{size:"small"}))):null,"dob_lte"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,{key:e.key},e.form.getFieldDecorator("dob_lte")(i.a.createElement(D.a,{size:"small"}))):null,"dob_month"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,{key:e.key},e.form.getFieldDecorator("dob_month")(i.a.createElement(J,{size:"small"}))):null,"has_dob"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,null,e.form.getFieldDecorator("has_dob")(i.a.createElement(p.a,{style:{width:100},size:"small"},W.eb.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label," "))))):null,"patient_id"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,{key:e.key,label:"contains"},e.form.getFieldDecorator("patient_id")(i.a.createElement(S.a,{placeholder:"Patient Id",size:"small"}))):null,"has_aadhar"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,null,e.form.getFieldDecorator("has_aadhar")(i.a.createElement(p.a,{style:{width:100},size:"small"},W.cb.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label))))):null,"aadhar"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,{key:e.key,label:"contains"},e.form.getFieldDecorator("aadhar")(i.a.createElement(S.a,{placeholder:"Aadhar Id",size:"small"}))):null,"email"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,{key:e.key,label:"contains"},e.form.getFieldDecorator("email")(i.a.createElement(S.a,{placeholder:"Email Id",size:"small"}))):null,"has_email"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,null,e.form.getFieldDecorator("has_email")(i.a.createElement(p.a,{style:{width:100},size:"small"},W.fb.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label," "))))):null,"gender"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,{key:e.key,label:"is"},e.form.getFieldDecorator("gender")(i.a.createElement(p.a,{style:{width:100},size:"small"},W.ab.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label))))):null,"has_gender"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,null,e.form.getFieldDecorator("has_gender")(i.a.createElement(p.a,{style:{width:100},size:"small"},W.gb.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label))))):null,"pincode"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,{key:e.key,label:"contains"},e.form.getFieldDecorator("pincode")(i.a.createElement(S.a,{placeholder:"PINCODE",size:"small"}))):null,"has_pincode"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,null,e.form.getFieldDecorator("has_pincode")(i.a.createElement(p.a,{style:{width:100},size:"small"},W.hb.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label))))):null,"has_street"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,null,e.form.getFieldDecorator("has_street")(i.a.createElement(p.a,{style:{width:100},size:"small"},W.ib.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label))))):null,"street"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,{key:e.key,label:"contains"},e.form.getFieldDecorator("street")(i.a.createElement(S.a,{placeholder:"Street Address",size:"small"}))):null,"blood_group"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,{key:e.key,label:"is"},e.form.getFieldDecorator("blood_group")(i.a.createElement(p.a,{style:{width:100},size:"small"},W.q.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.name))))):null,"source"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,null,e.form.getFieldDecorator("source")(i.a.createElement(p.a,{style:{width:100},size:"small"},e.sourceList.map(e=>i.a.createElement(p.a.Option,{value:e.id},e.name))))):null,"agent_referal"==e.selectedOption[e.k]?i.a.createElement(m.a.Item,null,e.form.getFieldDecorator("agent_referal")(i.a.createElement(p.a,{style:{width:100},size:"small"},W.Pb.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label))))):null)}var ie=a(1025),re=a(1605),le=a(438);function se(){return(se=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function oe(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ce(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(a),!0).forEach((function(t){de(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):oe(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function de(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const pe=p.a.Option;class me extends n.Component{constructor(e){super(e),de(this,"loadPatientCallNotes",(e,t=5)=>{const a=this;a.setState({loading:!0});const n={patient:this.props.patientId,page:e,page_size:t};Object(N.c)(V.id,(function(e){a.setState((function(t){return{callNotes:[...e.results],currentCallNotes:e.current,totalCallNotes:e.count,loading:!1}}))}),(function(e){a.setState({loading:!1})}),n)}),de(this,"onVisibleModal",(e=null)=>{let t=this.state.visibleModal;this.setState({visibleModal:!t,editCallNote:e})}),de(this,"handleSubmit",e=>{const t=this;e.preventDefault();const a=this.state.editCallNote;this.props.form.validateFields((e,n)=>{if(!e){const e=ce(ce({},n),{},{patient:t.props.patientId,practice:t.props.active_practiceId,practice_staff:t.props.user.staff.id});t.setState({loading:!0});const i=function(e){t.props.form.resetFields(),t.onVisibleModal(),Object(N.a)(B.sc,"Call Note Successfully ".concat(a?"edided":"Created")),t.loadPatientCallNotes(),t.setState({loading:!1})},r=function(e){t.setState({loading:!1})};a?(e.id=a.id,Object(N.k)(V.id,e,i,r)):Object(N.k)(V.id,e,i,r)}})}),de(this,"deleteCallNote",e=>{const t=this,a={id:e.id,is_active:!1,patient:t.props.patientId};Object(N.k)(V.id,a,(function(e){t.setState({loading:!1}),t.loadPatientCallNotes()}),(function(){t.setState({loading:!1})}))}),this.state={loading:!1,callNotes:[],editCallNote:null,visibleModal:!1}}componentDidMount(){this.loadPatientCallNotes()}render(){let e=this,t=e.state,a=t.visibleModal,n=t.editCallNote,r=t.loading,l=e.props,s=l.activePracticePermissions,c=l.config_call_types,d=l.config_call_response;const u=this.props.form.getFieldDecorator,h={labelCol:{span:6},wrapperCol:{span:18}},f=t=>{const a=[];return s.DeletePatientNotes&&a.push(i.a.createElement(k.a,{title:"Are you sure delete this item?",onConfirm:()=>e.deleteCallNote(t),okText:"Yes",cancelText:"No"},i.a.createElement("a",null,i.a.createElement(E.a,{type:"delete",style:{color:"red"}})))),s.DeletePatientNotes&&a.push(i.a.createElement("a",{key:"list-loadmore-edit",onClick:()=>this.onVisibleModal(t)}," ",i.a.createElement(E.a,{type:"edit"})," ")),a};return i.a.createElement("div",null,i.a.createElement("h2",null," Voice Call Notes",i.a.createElement(o.a,{type:"primary",style:{float:"right"},onClick:()=>this.onVisibleModal()},i.a.createElement(E.a,{type:"plus"}))),i.a.createElement(y.a,null,i.a.createElement(ie.a,{disabled:r,current:this.state.currentCallNotes,size:"small",total:this.state.totalCallNotes,pageSize:5,onChange:this.loadPatientCallNotes,style:{float:"right"}})),this.state.callNotes.length?i.a.createElement(re.a,{size:"small",loading:r,dataSource:this.state.callNotes,renderItem:e=>i.a.createElement(re.a.Item,{actions:f(e)},i.a.createElement(re.a.Item.Meta,{title:e.remarks,description:"by ".concat(e.practice_staff?e.practice_staff.user.first_name:"--","  on ").concat(x()(e.created_at).format("lll"))}))}):null,i.a.createElement(y.a,null,i.a.createElement(ie.a,{disabled:r,current:this.state.currentCallNotes,size:"small",total:this.state.totalCallNotes,pageSize:5,onChange:this.loadPatientCallNotes,style:{float:"right"}})),i.a.createElement(C.a,{visible:a,onCancel:()=>this.onVisibleModal(),footer:null,title:n?"Edit Patient Call Notes":"Add Patient Call Notes"},i.a.createElement(m.a,{onSubmit:this.handleSubmit},i.a.createElement(m.a.Item,se({key:"calltype",label:"Call Type"},h),u("calltype",{initialValue:n?n.type:null,rules:[{required:!0}]})(i.a.createElement(p.a,{placeholder:"Please Select the call type"},c&&c.map(e=>i.a.createElement(pe,{value:e},e))))),i.a.createElement(m.a.Item,se({key:"response",label:"Call Status"},h),u("response",{initialValue:n?n.response:null,rules:[{required:!0}]})(i.a.createElement(p.a,{placeholder:"Please Select the Status type",rows:5},d&&d.map(e=>i.a.createElement(pe,{value:e},e))))),i.a.createElement(m.a.Item,se({key:"remarks",label:"Call Note"},h),u("remarks",{initialValue:n?n.remarks:null})(i.a.createElement(S.a.TextArea,{rows:5}))),i.a.createElement(m.a.Item,h,i.a.createElement(o.a,{type:"primary",htmlType:"submit",style:{marginLeft:200},loading:this.state.loading},"Submit")))))}}var ue=m.a.create()(me);function he(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}p.a.Option;class fe extends i.a.Component{constructor(e){super(e),he(this,"loadPatientNotes",(e,t=5)=>{const a=this;a.setState({loading:!0});const n={page:e,page_size:t};Object(N.c)(Object(N.g)(V.qd,[this.props.patientId,this.props.showAllClinic?"":this.props.active_practiceId]),(function(e){a.setState((function(t){return{notes:[...e.results],totalNotes:e.count,currentNotes:e.current,loading:!1}}))}),(function(){a.setState({loading:!1})}),n)}),he(this,"loadPatientCallNotes",(e,t=5)=>{const a=this;a.setState({callNotesLoading:!0});const n={patient:this.props.patientId,page:e,page_size:t};Object(N.c)(V.id,(function(e){a.setState((function(t){return{callNotes:[...e.results],currentCallNotes:e.current,totalCallNotes:e.count,callNotesLoading:!1}}))}),(function(e){a.setState({callNotesLoading:!1})}),n)}),he(this,"showNotesModal",e=>{this.setState({notesModalVisible:!0,editPatientNote:e})}),he(this,"ShowCallNotesModal",()=>{console.log("Add"),this.setState({EditcallNoteModalVisible:!0,editCallNote:null})}),he(this,"ShowEditCallNotesModal",e=>{console.log(e),this.setState({EditcallNoteModalVisible:!0,editCallNote:e})}),he(this,"handleCancel",e=>{this.setState({notesModalVisible:!1})}),he(this,"deleteNote",e=>{const t=this,a={id:e.id,is_active:!1};Object(N.k)(Object(N.g)(V.qd,[this.props.patientId,this.props.active_practiceId]),a,(function(e){t.setState({loading:!1}),t.loadPatientNotes()}),(function(){t.setState({loading:!1})}))}),this.state={notes:[],loading:!0,notesModalVisible:!1}}componentDidMount(){this.loadPatientNotes(),this.loadPatientCallNotes(),Object(le.d)(this,[W.t,W.s])}render(){const e=this,t=this.props.activePracticePermissions,a=[{key:"name",required:!0,type:B.db,label:"Note"}],n=[{key:"name",required:!0,type:B.db,label:"Note",initialValue:e.state.editPatientNote?e.state.editPatientNote.name:""}],r={successFn(t){Object(N.a)(B.sc,"Patient Note Added"),e.loadPatientNotes(),e.setState({notesModalVisible:!1})},errorFn(){e.setState({notesModalVisible:!0})},action:Object(N.g)(V.qd,[this.props.patientId,this.props.active_practiceId]),method:"post",beforeSubmit(e){}},l={successFn(t){Object(N.a)(B.sc,"Patient Note Update"),e.loadPatientNotes(),e.setState({notesModalVisible:!1})},errorFn(){e.setState({notesModalVisible:!0})},action:Object(N.g)(V.qd,[this.props.patientId,this.props.active_practiceId]),method:"post",beforeSubmit(e){}},s=[{key:"patient",value:this.props.patientId},{key:"practice",value:this.props.active_practiceId}],o=[{key:"patient",value:this.props.patientId},{key:"practice",value:this.props.active_practiceId},{key:"id",value:e.state.editPatientNote&&e.state.editPatientNote.id}],c=m.a.create()(z.a),d=a=>{const n=[];return t.DeletePatientNotes&&n.push(i.a.createElement(k.a,{title:"Are you sure delete this item?",onConfirm:()=>e.deleteNote(a),okText:"Yes",cancelText:"No"},i.a.createElement("a",null,i.a.createElement(E.a,{type:"delete",style:{color:"red"}})))),t.EditPatientNotes&&n.push(i.a.createElement("a",{key:"list-loadmore-edit",onClick:()=>this.showNotesModal(a)}," ",i.a.createElement(E.a,{type:"edit"})," ")),n};return i.a.createElement("div",null,i.a.createElement(ue,{key:this.props.patientId,patientId:this.props.patientId,activePracticePermissions:t,config_call_response:this.state.config_call_response,config_call_types:this.state.config_call_types,user:this.props.user}),i.a.createElement(P.a,null),i.a.createElement("h2",null,"Patient Notes"),i.a.createElement(c,{formProp:r,defaultValues:s,fields:a}),i.a.createElement(y.a,null,i.a.createElement(ie.a,{disabled:this.state.loading,current:this.state.currentNotes,size:"small",total:this.state.totalNotes,pageSize:5,onChange:this.loadPatientNotes,style:{float:"right"}})),this.state.notes.length?i.a.createElement(re.a,{size:"small",loading:this.state.loading,dataSource:this.state.notes,renderItem:t=>i.a.createElement(re.a.Item,{actions:d(t)},i.a.createElement(re.a.Item.Meta,{title:t.name,description:i.a.createElement("span",null,"by ",t.staff?t.staff.user.first_name:"--","  on ",x()(t.created_at).format("lll")," ",i.a.createElement("br",null),e.props.showAllClinic?i.a.createElement(O.a,null,t.practice.name):null)}))}):null,i.a.createElement(y.a,null,i.a.createElement(ie.a,{disabled:this.state.loading,current:this.state.currentNotes,size:"small",total:this.state.totalNotes,pageSize:5,onChange:this.loadPatientNotes,style:{float:"right"}})),i.a.createElement(C.a,{title:"Patient Notes",visible:this.state.notesModalVisible,footer:null,onCancel:this.handleCancel},i.a.createElement(c,{formProp:l,defaultValues:o,fields:n})))}}var ye=fe;class ge extends i.a.Component{constructor(e){super(e),this.state={redirect:!1,currentPatient:this.props.currentPatient,Membership:[]},this.loadMembership=this.loadMembership.bind(this)}componentDidMount(){this.loadMembership()}loadMembership(){const e=this,t=function(t){e.setState({Membership:t,loading:!1})},a=function(){e.setState({loading:!1})};e.state.currentPatient&&Object(N.c)(Object(N.g)(V.Fc,[e.props.active_practiceId]),t,a)}render(){const e=this;console.log("form state",this.state);const t=[{label:"Type",key:"medical_membership",type:B.mc,width:270,options:this.state.Membership.map(e=>({label:e.name,value:e.id}))},{label:"Start Date",key:"medical_from",initialValue:x()(),type:B.N,format:"YYYY-MM-DD"},{label:"Document",key:"membership_upload",type:B.oc}],a={successFn(t){Object(N.a)(B.sc,"Medical Membership added"),e.props.loadProfile(),e.props.loadMedicalMembership(),e.props.formChange()},errorFn(){},action:Object(N.g)(V.dd,[this.props.patientId]),method:"post"},n=m.a.create()(z.a),r=[{key:"patient",value:this.props.patientId},{key:"practice",value:this.props.active_practiceId}];return i.a.createElement(n,{formProp:a,defaultValues:r,fields:t})}}class be extends i.a.Component{constructor(e){super(e),this.state={redirect:!1,currentPatient:this.props.currentPatient,agentRoles:[]},this.loadAgentRoles=this.loadAgentRoles.bind(this)}componentDidMount(){this.loadAgentRoles()}loadAgentRoles(){const e=this;Object(N.c)(V.f,(function(t){e.setState({agentRoles:t,loading:!1})}),(function(){e.setState({loading:!1})}))}render(){const e=this,t=[{label:"Role Type",key:"role",type:B.mc,options:this.state.agentRoles.map(e=>({label:e.name,value:e.id}))},{label:"Document Upload",key:"aadhar_upload",type:B.oc,required:!0}],a={successFn(t){Object(N.a)(B.sc,"Agent Role added"),e.props.loadProfile()},errorFn(){},action:Object(N.g)(V.td,[this.props.patientId]),method:"put"},n=m.a.create()(z.a);return i.a.createElement(n,{formProp:a,defaultValues:[{key:"is_agent",value:!0}],fields:t})}}var Ee=a(809),ve=a(837);function _e(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Pe extends i.a.Component{constructor(e){super(e),_e(this,"toggleManageModal",e=>{this.setState({showManageModal:!!e})}),_e(this,"onSelectPractice",e=>{this.setState({selectedPractices:e})}),_e(this,"savePracticeAccessData",()=>{const e=this.state,t=e.patientData,a=e.selectedPractices,n=e.availablePractices,i=this,r=[];a.forEach((function(e){n[e]?r.push(n[e]):r.push({practice:e,pd_doctor:null})})),this.setState({formLoading:!0});Object(N.m)(Object(N.g)(V.td,[t.id]),{practices:r},(function(){Object(N.a)(B.sc,"Practices Assigned Successfully!!"),i.toggleManageModal(!1),i.props.loadData&&i.props.loadData(),i.setState({formLoading:!1})}),(function(){i.setState({formLoading:!1}),Object(N.a)(B.T,"Practices Assigning Failed!!")}))}),this.state={formLoading:!1,showManageModal:!1,practicesList:[],patientData:null,availablePractices:{},selectedPractices:[]}}componentDidMount(){if(this.props.patientData){const e={};this.props.patientData.practices.forEach((function(t){e[t.practice]=t})),this.setState({availablePractices:e,patientData:this.props.patientData})}this.loadPracticeList()}loadPracticeList(){const e=this;Object(N.c)(V.l,(function(t){e.setState({practicesList:t})}),(function(){}))}render(){const e=this.state,t=e.showManageModal,a=e.practicesList,n=e.availablePractices,r=e.formLoading,s=a.map(e=>({label:e.name,value:e.id}));if(!this.state.patientData)return i.a.createElement(l.a,{size:"large"});const c=Object.keys(n);return(i.a.createElement("div",null,i.a.createElement(P.a,null),i.a.createElement(o.a,{onClick:()=>this.toggleManageModal(!0),type:"primary",block:!0},"Manage Practices"),i.a.createElement(l.a,{spinning:r},i.a.createElement(C.a,{visible:t,footer:null,title:"Assign Practices to Patient",onCancel:()=>this.toggleManageModal(!1)},i.a.createElement(f.a,{type:"info",message:"If you remove the current practice access. You will not be able to access the patient.",showIcon:!0,banner:!0}),i.a.createElement(P.a,null),i.a.createElement(ve.a.Group,{options:s,defaultValue:c.map(e=>parseInt(e)),onChange:this.onSelectPractice}),i.a.createElement(y.a,{style:{marginTop:15}},i.a.createElement(g.a,{span:24},i.a.createElement(o.a,{style:{margin:5},type:"primary",onClick:()=>this.savePracticeAccessData()},"Save"),i.a.createElement(o.a,{style:{margin:5},onClick:()=>this.toggleManageModal(!1)},"Cancel")))))))}}var ke=a(804),Oe=a(456);class Ce extends n.Component{constructor(e){var t,a,n;super(e),n=()=>{const e=this;Object(N.c)(V.Td,(function(t){e.setState({registrationFeesData:t})}),(function(){}))},(a="loadRegistrationFees")in(t=this)?Object.defineProperty(t,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[a]=n,this.state={addFees:!1,loading:!1,registrationFeesData:[],patientRegistration:null}}componentDidMount(){this.loadRegistrationFees(),this.loadData()}loadData(){const e=this;e.setState({loading:!0});Object(N.c)(V.ud,(function(t){e.setState({patientRegistration:t[t.length-1],loading:!1})}),(function(){e.setState({loading:!1})}),{patient:this.props.patientId})}onClickHandler(){let e=this.state.addFees;this.setState({addFees:!e})}deleteObject(e){const t=this,a={id:e,is_active:!1};Object(N.k)(Object(N.g)(V.vd,[t.props.currentPatient.id]),a,(function(e){Object(N.a)(B.sc,"Patient Registration Fees Cancelled Successfully"),t.loadData()}),(function(){}))}render(){let e=this,t=e.state.patientRegistration;console.log(t);const a=[{label:"Type",key:"registration",type:B.mc,width:270,options:this.state.registrationFeesData.map(e=>({label:e.name,value:e.id}))},{label:"Start Date",key:"registration_from",initilValue:x()(),type:B.N,format:"YYYY-MM-DD"},{label:"Document",key:"registration_upload",type:B.oc}],n={successFn(t){Object(N.a)(B.sc,"Patient Registration Fees added"),e.loadData(),e.onClickHandler()},errorFn(){},action:Object(N.g)(V.ud,[this.props.patientId]),method:"post"},r=m.a.create()(z.a),l=[{key:"patient",value:this.props.patientId},{key:"practice",value:this.props.active_practiceId}];return i.a.createElement(y.a,null,this.state.addFees?i.a.createElement("div",null,i.a.createElement("h1",{style:{fontSize:"18px"}},"Registration Fees",i.a.createElement("a",{href:"#",onClick:()=>this.onClickHandler()}," Cancel ")),i.a.createElement(r,{formProp:n,defaultValues:l,fields:a})):i.a.createElement("div",{style:{padding:"0px"}},t?i.a.createElement(u.a,{headStyle:{color:x()(t.registration_to)<x()()?"red":null},bodyStyle:{color:x()(t.registration_to)<x()()?"red":null},Registration:!0,size:"small",title:x()(t.registration_to)<x()()?"Registration Expired":"Registration",extra:i.a.createElement(k.a,{title:"Are you sure delete this item?",onConfirm:()=>e.deleteObject(t.id),okText:"Yes",cancelText:"No"},i.a.createElement(o.a,{icon:"close",type:"danger",shape:"circle",size:"small",disabled:!this.props.activePracticePermissions.CancelPatientRegistration})),style:{textAlign:"center"}},i.a.createElement("div",{style:{textAlign:"left"}},i.a.createElement("p",null,i.a.createElement("strong",null,"Name : "),i.a.createElement("span",null,t.registration?t.registration.name:null)),i.a.createElement("p",null,i.a.createElement("strong",null,"Start Date : "),i.a.createElement("span",null,t.registration_from)),i.a.createElement("p",null,i.a.createElement("strong",null,"Valid Till : "),i.a.createElement("span",null,t.registration_to)),i.a.createElement("p",null,i.a.createElement("strong",null,"Document : "),i.a.createElement("span",null,t.registration_upload?i.a.createElement("a",{target:"_blank",href:Object(N.h)(t.registration_upload)},"Document"):"--")),x()(t.registration_to)<x()()?i.a.createElement(o.a,{block:!0,type:"primary",onClick:()=>this.onClickHandler(),disabled:!this.props.activePracticePermissions.AddPatientRegistration},"Add New Registration"):null)):i.a.createElement("h1",{style:{fontSize:"18px",textAlign:"center"}},"Registration Fees",i.a.createElement("a",{href:"#",onClick:()=>this.onClickHandler(),disabled:!this.props.activePracticePermissions.AddPatientRegistration}," Add"))))}}var Se=Ce;function Ie(){return(Ie=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function xe(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}p.a.Option;class De extends i.a.Component{constructor(e){super(e),xe(this,"formChange",e=>{this.setState({add:e})}),xe(this,"updateValues",(e,t)=>{this.setState({[e]:t})}),xe(this,"addAgent",()=>{this.setState({agentModalVisible:!0})}),xe(this,"addAgentModalClosed",()=>{this.setState({agentModalVisible:!1})}),xe(this,"toggleAddressTicket",e=>{this.setState({addressTicketVisible:!!e})}),xe(this,"handleSubmit",e=>{e.preventDefault()}),xe(this,"printPatientForm",()=>{console.log("value");let e=this.state.addPrintPatientFormModal;this.setState({addPrintPatientFormModal:!e})}),xe(this,"toggleDeathDeclarationModal",e=>{this.setState({deathDeclareModal:!!e})}),xe(this,"declareDead",()=>{let e=this,t={is_dead:!0,dead_by:e.props.user.staff.id};Object(N.m)(Object(N.g)(V.td,[e.props.currentPatient.id]),t,(function(){Object(N.a)(B.sc,"Patient declared dead successfully!"),e.loadProfile(),e.toggleDeathDeclarationModal(!1)}),(function(){}))}),this.state={patientProfile:null,currentPatient:this.props.currentPatient,medicalHistory:{},loading:!0,add:"",MedicalMembership:null,hide:!1,agentModalVisible:!1,availablePractices:{},addressTicketVisible:!1,addPrintPatientFormModal:!1,[W.r]:[],[W.Y]:[],[W.Z]:[]},this.loadProfile=this.loadProfile.bind(this),this.loadMedicalMembership=this.loadMedicalMembership.bind(this),this.handleSubmit=this.handleSubmit.bind(this)}componentDidMount(){this.state.currentPatient&&(this.loadProfile(!1),this.loadMedicalMembership()),Object(le.d)(this,[W.r,W.Y,W.Z])}componentWillReceiveProps(e){const t=this;e.currentPatient&&e.currentPatient!=this.state.currentPatient&&this.setState({currentPatient:e.currentPatient},(function(){t.loadProfile(!1)}))}loadProfile(e=!0){const t=this,a=this.props.activePracticePermissions.ViewAllClinics?{}:{perm_practice:this.props.active_practiceId};t.state.currentPatient&&Object(N.c)(Object(N.g)(V.td,[t.state.currentPatient.id]),(function(a){const n={};a.practices_data.forEach((function(e){n[e.practice]=e})),t.setState({availablePractices:n,patientProfile:a,loading:!1}),t.props.refreshWallet&&e&&t.props.refreshWallet()}),(function(){t.setState({loading:!1})}),a)}loadMedicalMembership(){const e=this;Object(N.c)(Object(N.g)(V.dd,[e.props.currentPatient.id]),(function(t){e.setState({MedicalMembership:t[t.length-1],loading:!1})}),(function(){e.setState({loading:!1})}))}onClickHandler(e){const t=this;this.state.MedicalMembership?(Object(N.a)(B.T,"Membership Already Exist!!"),t.setState({add:!1})):this.setState({add:e})}deleteMembership(e){const t=this,a={id:e,is_active:!1};Object(N.k)(Object(N.g)(V.yc,[t.props.currentPatient.id]),a,(function(e){t.loadProfile(),t.loadMedicalMembership(),t.props.refreshWallet&&t.props.refreshWallet()}),(function(){}))}render(){const e=this,t=this.state.patientProfile,a=this.props.activePracticeData,n=[],r=m.a.create()(z.a),l=this.state,c=l.availablePractices,p=l.addPrintPatientFormModal;if(this.props.currentPatient){if(!t)return i.a.createElement(u.a,{loading:this.state.loading});if(!t.is_active)return i.a.createElement("div",null,i.a.createElement(s.a,{status:403,title:"Permission Denied",subTitle:"You don't have permission to access this patient",extra:i.a.createElement(d.b,{to:"/patients/"},i.a.createElement(o.a,{type:"primary"},"Go to All Patient"))}));const l=[{label:"Practice Name",key:"name",placeholder:"Practice Name",required:!0,initialValue:a.name?a.name:"",type:B.db},{label:"Practice Address Line 1",key:"address1",required:!0,placeholder:"Practice Address",initialValue:a.address?a.address:"",type:B.db},{label:"Practice Address Line 2",key:"address2",placeholder:"Practice Address",initialValue:"",type:B.db},{label:"Extra",key:"extra",required:!1,placeholder:"City, State, Country",initialValue:"".concat(a.city,", ").concat(a.state,", ").concat(a.pincode),type:B.db},{label:"Practice Mobile",key:"contact",required:!0,placeholder:"Practice Mobile",initialValue:a.contact?a.contact:"",type:B.db}],m={successFn(t){e.toggleAddressTicket(!1),t.report&&window.open(Oe.a+t.report)},errorFn(){},action:Object(N.g)(V.d,[this.props.currentPatient.id]),method:"get"},I=i.a.createElement(h.a,null,i.a.createElement(h.a.Item,{key:"death",onClick:()=>this.toggleDeathDeclarationModal(!0),disabled:t.is_dead},"Declare Dead"));return i.a.createElement(u.a,{loading:this.state.loading,title:"Patient Profile",extra:i.a.createElement(i.a.Fragment,null,i.a.createElement(ke.a,Ie({visibleModal:p,onCancelModal:e.printPatientForm,currentPatient:e.state.currentPatient,activePracticeData:a},this.props)),i.a.createElement(d.b,{onClick:()=>this.printPatientForm()},"Print Patient Form"),i.a.createElement(o.a,{type:"primary",style:{marginLeft:10},onClick:()=>this.toggleAddressTicket(!0)},"Address Ticket"))},t.is_dead?i.a.createElement(f.a,{type:"error",message:"The patient has been marked dead.",banner:!0,style:{marginBottom:8}}):null,i.a.createElement(y.a,{gutter:16},i.a.createElement(g.a,{span:6,style:{textAlign:"center"}},t.image?i.a.createElement("img",{src:Object(N.h)(t.image),style:{width:"100%"}}):i.a.createElement(b.a,{size:200,shape:"square",style:{backgroundColor:"#87d068",width:"100%"}},t.user.first_name?t.user.first_name:i.a.createElement(E.a,{type:"user"})),t.is_agent&&t.is_approved?i.a.createElement(v.a,{title:"Referral Code",value:t.user.referer_code}):null,e.props.activePracticePermissions.EditPatient?i.a.createElement(_.a.Button,{type:"primary",style:{marginTop:10},onClick:()=>this.props.history.push("/patient/".concat(this.state.currentPatient.id,"/profile/edit")),overlay:I},i.a.createElement(E.a,{type:"edit"}),"Edit Patient Profile"):null,e.props.activePracticePermissions.ManagePatientPractice?i.a.createElement(Pe,{patientData:this.state.patientProfile,loadData:this.loadProfile}):null,i.a.createElement(g.a,null,i.a.createElement(P.a,null),this.state.add?i.a.createElement("div",null,i.a.createElement("h1",{style:{fontSize:"18px"}},"Medical Membership"," ",i.a.createElement(o.a,{type:"link",onClick:()=>this.onClickHandler(!1)},"Cancel")),i.a.createElement(ge,Ie({},this.props,this.state,{patientId:t.id,loadMedicalMembership:e.loadMedicalMembership,formChange:e.formChange,loadProfile:e.loadProfile}))):i.a.createElement("div",{style:{padding:"0px"}},i.a.createElement("h1",{style:{fontSize:"18px",textAlign:"center"}},"Medical Membership ",i.a.createElement("a",{href:"#",onClick:()=>this.onClickHandler(!0)},this.state.MedicalMembership?"Renew":"Add")),this.state.MedicalMembership?i.a.createElement(u.a,{size:"small",title:"Membership",extra:i.a.createElement(k.a,{title:"Are you sure delete this Membership?",onConfirm:()=>e.deleteMembership(this.state.MedicalMembership.id),okText:"Yes",cancelText:"No"},i.a.createElement(o.a,{icon:"close",type:"danger",shape:"circle",size:"small"})),style:{textAlign:"center"}},i.a.createElement("div",{style:{textAlign:"left"}},i.a.createElement("p",null,i.a.createElement("strong",null,"Membership : "),i.a.createElement("span",null,this.state.MedicalMembership.medical_membership?this.state.MedicalMembership.medical_membership.name:null)),i.a.createElement("p",null,i.a.createElement("strong",null,"Membership Code : "),i.a.createElement("span",null,this.state.MedicalMembership.membership_code)),i.a.createElement("p",null,i.a.createElement("strong",null,"Start Date : "),i.a.createElement("span",null,this.state.MedicalMembership.medical_from)),i.a.createElement("p",null,i.a.createElement("strong",null,"Valid Till : "),i.a.createElement("span",null,this.state.MedicalMembership.medical_to)),i.a.createElement("p",null,i.a.createElement("strong",null,"Document : "),i.a.createElement("span",null,this.state.MedicalMembership.membership_upload?i.a.createElement("a",{target:"_blank",href:Object(N.h)(this.state.MedicalMembership.membership_upload)},"Document"):"--")))):null),i.a.createElement(P.a,null),i.a.createElement(Se,Ie({},this.state,{active_practiceId:e.props.active_practiceId,loadProfile:e.loadProfile,patientId:t.id},this.props)))),i.a.createElement(g.a,{span:11},i.a.createElement(we,{label:"Patient Name",value:(t.is_dead?"(Late) ":"")+t.user.first_name}),i.a.createElement(we,{label:"Patient ID",value:t.custom_id?t.custom_id:t.id}),i.a.createElement(we,{label:"Created On",value:t.created_at?x()(t.created_at).format("LL"):null}),t&&t.role?i.a.createElement(we,{label:"Advisor Role",value:t.role_data.name}):null,i.a.createElement(we,{label:"Gender",value:t.gender}),t.is_age?i.a.createElement(we,{label:"Age",value:t.dob?x()().diff(this.props.currentPatient.dob,"years"):null}):i.a.createElement(we,{label:"Date of Birth",value:t.dob}),i.a.createElement(we,{label:"Religion",value:t.religion_data?t.religion_data.value:null}),i.a.createElement(we,{label:"On Dialysis?",value:t.on_dialysis?"Yes":"No"}),i.a.createElement(we,{label:"Referer",value:t.user.referer_data.referer?i.a.createElement(d.b,{to:"/patient/".concat(t.user.referer_data.patient,"/profile")},t.user.referer_data.referer.first_name):"--"}),i.a.createElement(we,{label:"Create By ",value:t.self_register?t.user.first_name:t.created_by?t.creator:"--"}),i.a.createElement(we,{label:"Patient Source",value:t.source?t.source_name:"--"}),i.a.createElement(we,{label:"PD Doctor",value:c[this.props.active_practiceId]?c[this.props.active_practiceId].pd_doctor_name:null}),i.a.createElement(P.a,null),i.a.createElement("h2",null,"Contact Details"),i.a.createElement(we,{label:"Email",value:e.props.activePracticePermissions.PatientEmailId?t.user.email:Object(q.a)(t.user.email)}),i.a.createElement(we,{label:"Primary Mobile",value:e.props.activePracticePermissions.PatientPhoneNumber?t.user.mobile:Object(q.b)(t.user.mobile)}),i.a.createElement(we,{label:"Secondary Mobile",value:e.props.activePracticePermissions.PatientPhoneNumber?t.secondary_mobile_no:Object(q.b)(t.secondary_mobile_no)}),i.a.createElement(we,{label:"Landline No",value:t.landline_no}),i.a.createElement(we,{label:"Address",value:e.props.activePracticePermissions.ViewPatientAddress?t.address:"--"}),i.a.createElement(we,{label:"Locality",value:t.locality}),i.a.createElement(we,{label:"City",value:t.city_data?t.city_data.name:null}),i.a.createElement(we,{label:"State",value:t.state_data?t.state_data.name:null}),i.a.createElement(we,{label:"Country",value:t.country_data?t.country_data.name:null}),i.a.createElement(we,{label:"Pincode",value:t.pincode}),i.a.createElement(P.a,null),i.a.createElement("h2",null,"Relative Details"),i.a.createElement(we,{label:"Relative 1",value:t.attendee1||t.attendee1_mobile_no?"".concat(t.attendee1," (").concat(t.family_relation1,") [").concat(e.props.activePracticePermissions.RelativePhoneNumber?t.attendee1_mobile_no:Object(q.b)(t.attendee1_mobile_no),"]"):"--"}),i.a.createElement(we,{label:"Relative 2",value:t.attendee2||t.attendee2_mobile_no?"".concat(t.attendee2," (").concat(t.family_relation2,") [").concat(e.props.activePracticePermissions.RelativePhoneNumber?t.attendee2_mobile_no:Object(q.b)(t.attendee2_mobile_no),"]"):"--"})),i.a.createElement(g.a,{span:7,style:{borderLeft:"1 px solid #ccc"}},i.a.createElement("h2",null,"Medical History"),t.medical_history_data?t.medical_history_data.map((e,t)=>i.a.createElement(O.a,{color:"#".concat(Object(le.b)(Object(le.a)(e.name)))},e.name)):null,i.a.createElement(P.a,null),i.a.createElement("h2",null,"Groups"),t.patient_group_data?t.patient_group_data.map(e=>i.a.createElement(O.a,null,e.name)):null,i.a.createElement(P.a,null),i.a.createElement(ye,Ie({},this.props,{patientId:t.id}))),i.a.createElement(C.a,{title:"Add Agent",visible:this.state.agentModalVisible,onOk:null,footer:null,onCancel:this.addAgentModalClosed},i.a.createElement(be,Ie({patientId:t.id},this.state))),i.a.createElement(C.a,{title:"Address Ticket",visible:this.state.addressTicketVisible,onOk:null,footer:null,width:700,onCancel:()=>this.toggleAddressTicket(!1)},i.a.createElement(r,{defaultValues:n,formProp:m,fields:l})),i.a.createElement(C.a,{title:"Declare Dead",visible:this.state.deathDeclareModal,onOk:this.declareDead,okText:"Declare Dead",okButtonProps:{type:"danger",disabled:t.custom_id!=this.state.deadDeclarationPatientID},onCancel:()=>this.toggleDeathDeclarationModal(!1)},i.a.createElement(f.a,{type:"warning",message:"Declaring a patient dead is a irreversible process. Kindly use it with precautions.",banner:!0,showIcon:!0}),i.a.createElement(f.a,{style:{width:"100%",marginTop:8},type:"error",message:"Enter the Patient ID ".concat(t.custom_id," in the input to declare the patient dead")}),i.a.createElement(S.a,{style:{width:"100%",marginTop:8},placeholder:"Patient ID",onCopyCapture:e=>{e.preventDefault()},onChange:e=>this.updateValues("deadDeclarationPatientID",e.target.value)}))))}return(i.a.createElement(te,this.props))}}var je=m.a.create()(De);function we(e){return i.a.createElement(y.a,{gutter:16,style:{marginBottom:"5px"}},i.a.createElement(g.a,{span:8,style:{textAlign:"right"}},e.label,":"),i.a.createElement(g.a,{span:16},i.a.createElement("strong",null,e.value)))}var Me=a(1575),Te=a(1581),Fe=a(1591),Ae=a(716);function Ne(){return(Ne=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Ve(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Le(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(a),!0).forEach((function(t){Re(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ve(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Re(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Be=C.a.confirm,ze=e=>e?{rules:[{required:!0,message:"This field is required!"}]}:{};class Ye extends i.a.Component{constructor(e){super(e),Re(this,"loadMedicalHistory",()=>{const e=this;Object(N.c)(Object(N.g)(V.wc,[this.props.active_practiceId]),(function(t){e.setState({history:t})}),(function(){}))}),Re(this,"setFormParams",(e,t)=>{this.setState({[e]:t})}),Re(this,"getPatientGroup",()=>{const e=this;Object(N.c)(Object(N.g)(V.md,[this.props.active_practiceId]),(function(t){e.setState({patientGroup:t,loading:!1})}),(function(){e.setState({loading:!1})}))}),Re(this,"handleSubmit",e=>{const t=this;e.preventDefault(),this.props.form.validateFields((e,a)=>{if(!e){console.log(a);let e=Le(Le({},a),{},{file_enable:!!a.file_enable,file_count:a.file_count?a.file_count:this.state.file_count,on_dialysis:!!t.state.on_dialysis,medical_history:a.medical_history,patient_group:a.patient_group,user:{first_name:a.first_name?a.first_name:"",mobile:a.mobile,email:a.email}});a.anniversary&&(e.anniversary=x()(a.anniversary).format("YYYY-MM-DD")),a.dob&&(e.dob=x()(a.dob).format("YYYY-MM-DD")),a.age&&(e.is_age=!0,e.dob=x()().subtract(a.age,"years").format("YYYY-MM-DD")),a.custom_id?e.custom_id=a.custom_id_pre+a.custom_id:e.custom_id=null,this.props.currentPatient?e.practices=t.props.currentPatient.practices:e.practices=[{practice:t.props.active_practiceId}];const n="image";e[n]&&e[n].file&&e[n].file.response&&(e[n]=e[n].file.response.image_path),delete e.first_name,delete e.email,delete e.referer_code,delete e.mobile,delete e.age,delete e.custom_id_pre,t.setState({loading:!0});const i=function(e){Object(N.a)("Patient Saved Successfully!!"),t.setState({loading:!1}),t.props.history.replace("/patient/".concat(e.id,"/profile"))},r=function(){t.setState({loading:!1})};e=Object(N.n)(e),e=Le(Le({},e),{},{file_enable:!!a.file_enable,on_dialysis:!!a.on_dialysis,is_dead:!!a.is_dead}),t.props.currentPatient?Object(N.m)(Object(N.g)(V.td,[t.props.currentPatient.id]),e,i,r):Object(N.k)(Object(N.g)(V.cd,[t.props.match.params.id]),e,i,r)}})}),Re(this,"toggleWebCam",(e,t)=>{this.setState((function(a){return{webCamState:Le(Le({},a.webCamState),{},{[e]:t})}}))}),Re(this,"getImageandUpload",(e,t)=>{const a=this,n=new FormData;n.append("image",t),n.append("name","file");Object(N.k)(V.Mb,n,(function(t){a.props.form.setFieldsValue({[e]:{file:{response:t}}}),Object(N.a)(B.sc,"Image Captured and processed."),a.setState((function(t){return{webCamState:Le(Le({},t.webCamState),{},{[e]:!1})}}))}),(function(){}),{"content-type":"multipart/form-data"})}),Re(this,"onChangeValue",(e,t)=>{const a=this,n=this.props.form.setFieldsValue;a.setState({[e]:t},(function(){"country"==e&&(n({state:null,city:null}),a.getState()),"state"==e&&(n({city:null}),a.getCity())}))}),Re(this,"setFormParams",(e,t)=>{this.setState({[e]:t})}),Re(this,"onChangeCheckbox",()=>{this.setState({on_dialysis:!this.state.on_dialysis})}),Re(this,"changeFormType",e=>{this.setState({selectedFormType:e.target.value})}),Re(this,"handleRelation",e=>{e?this.setState({relation_text:!1}):this.setState({relation_text:!0})}),Re(this,"handleNumberChange",e=>{this.setState({number:Le(Le({},We(e)),{},{value:e})})}),this.state={redirect:!1,history:[],patientGroup:[],membership:[],webCamState:{},countrylist:[],stateList:[],cityList:[],sourceList:[],hrsetting:[],country:this.props.currentPatient&&this.props.currentPatient.country_data?this.props.currentPatient.country:null,state:this.props.currentPatient&&this.props.currentPatient.state_data?this.props.currentPatient.state:null,selectedFormType:"DOB",file_count:10,file_enable:!0,relation_text:!0,loading:!1,[W.r]:[],[W.Eb]:[],[W.Vb]:[],[W.Y]:[],[W.Z]:[],number:{},practiceDoctors:[],availablePractices:{}},this.changeRedirect=this.changeRedirect.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.getCountry=this.getCountry.bind(this),this.getState=this.getState.bind(this),this.getCity=this.getCity.bind(this),this.getSources=this.getSources.bind(this),this.getRelgion=this.getRelgion.bind(this),this.loadPatientData=this.loadPatientData.bind(this)}componentDidMount(){Object(le.c)(this),this.loadMedicalHistory(),this.getPatientGroup(),this.getPatientMembership(),this.getSources(),this.getCountry(),this.getRelgion(),this.state.country&&this.getState(),this.state.state&&this.getCity(),this.props.currentPatient&&this.loadPatientData(this.props.currentPatient.id),Object(le.d)(this,[W.r,W.Eb,W.Vb,W.Y,W.Z])}getCountry(){const e=this;Object(N.c)(V.lb,(function(t){e.setState({countrylist:t})}),(function(){}))}getRelgion(){const e=this;Object(N.c)(V.Rb,(function(t){e.setState({hrsetting:t})}),(function(){}),{name:"Religion"})}getSources(){const e=this;Object(N.c)(V.He,(function(t){e.setState({sourceList:t})}),(function(){}))}getState(){const e=this;Object(N.c)(V.Ke,(function(t){e.setState({stateList:t})}),(function(){}),{country:this.state.country})}getCity(){const e=this;Object(N.c)(V.Z,(function(t){e.setState({cityList:t})}),(function(){}),{state:this.state.state})}getPatientMembership(){const e=this;Object(N.c)(Object(N.g)(V.Fc,[this.props.active_practiceId]),(function(t){e.setState({membership:t})}),(function(){}))}loadPatientData(e){const t=this;Object(N.c)(Object(N.g)(V.td,[e]),(function(e){const a={};e.practices.forEach((function(e){a[e.practice]=e})),t.setState({availablePractices:a,patientDetails:e,loading:!1})}),(function(){t.setState({loading:!1})}))}changeRedirect(){const e=this.state.redirect;this.setState({redirect:!e})}onDeletePatient(){const e=this;Be({title:"Are you sure delete this patient?",okText:"Yes",okType:"danger",cancelText:"No",onOk(){e.patientDelete()}})}patientDelete(){const e=this,t=e.state.patientDetails.id,a={id:t,is_active:!1};Object(N.m)(Object(N.g)(V.td,[t]),a,(function(){e.setState({loading:!1}),Object(N.a)("Patient Deleted!!"),e.props.history.push("/patients/profile")}),(function(){}))}render(){const e=this,t=this.props.form.getFieldDecorator,a=this.state.practiceDoctors,n={labelCol:{span:6},wrapperCol:{span:14}},r=[];this.state.history&&this.state.history.forEach((function(e){r.push({label:e.name,value:e.id})}));const l=[];this.state.patientGroup&&this.state.patientGroup.forEach((function(e){l.push({label:e.name,value:e.id})}));const s=[];this.state.membership&&this.state.membership.forEach((function(e){s.push({label:e.name,value:e.id})}));const c={name:"image",data:{name:"hello"},action:Object(N.i)(V.Lb),headers:{authorization:"authorization-text"},onChange(e){e.file.status,"done"===e.file.status?Me.a.success("".concat(e.file.name," file uploaded successfully")):"error"===e.file.status&&Me.a.error("".concat(e.file.name," file upload failed."))}};return i.a.createElement(m.a,{onSubmit:e.handleSubmit},i.a.createElement(u.a,{title:i.a.createElement("span",null,e.props.currentPatient?"Edit Profile":"Add Patient","  ",i.a.createElement(d.b,{to:"/patients/patientprintform"},"Print Patient Form")),extra:i.a.createElement("div",null,i.a.createElement(o.a,{style:{margin:5},type:"primary",htmlType:"submit"},"Save"),e.props.history?i.a.createElement(o.a,{style:{margin:5},onClick:()=>e.props.history.goBack()},"Cancel"):null,e.props.currentPatient?i.a.createElement(i.a.Fragment,null,this.state.patientDetails&&this.state.patientDetails.is_approved?i.a.createElement(Te.a,{placement:"leftBottom",trigger:"hover",content:"An Agent is associated. Patient can not be deleted."},i.a.createElement(o.a,{style:{margin:5},type:"danger",disabled:!0},"Delete")):e.props.activePracticePermissions.DeletePatient||e.props.allowAllPermissions?i.a.createElement(o.a,{style:{margin:5},onClick:()=>e.onDeletePatient(),type:"danger",disabled:!this.state.patientDetails},"Delete"):null):null)},i.a.createElement(m.a.Item,Ne({key:"image"},n,{label:"Patient Image"}),t("image",{valuePropName:"image"})(i.a.createElement(Fe.a,c,i.a.createElement(o.a,null,i.a.createElement(E.a,{type:"upload"})," Select File"),this.state.patientDetails&&this.state.patientDetails.image?i.a.createElement("img",{src:Object(N.h)(this.state.patientDetails?this.state.patientDetails.image:null),style:{maxWidth:"100%"}}):null)),i.a.createElement("span",{className:"ant-form-text"},i.a.createElement("a",{onClick:()=>e.toggleWebCam("image",Math.random())},"Open Webcam")),i.a.createElement(C.a,{footer:null,onCancel:()=>e.toggleWebCam("image",!1),visible:!!e.state.webCamState.image,width:680,key:e.state.webCamState.image},i.a.createElement(Ae.a,{getScreenShot:t=>e.getImageandUpload("image",t)}))),i.a.createElement(m.a.Item,Ne({label:"Patient Name"},n),t("first_name",{rules:[{required:!0,message:"Input Patient Name!"}],initialValue:this.state.patientDetails?this.state.patientDetails.user.first_name:""})(i.a.createElement(S.a,{placeholder:"Patient Name"}))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:8},i.a.createElement(m.a.Item,{label:"Patient Id",labelCol:{span:18},wrapperCol:{span:6}},t("custom_id_pre",{initialValue:this.state.patientDetails&&this.state.patientDetails.is_agent?"AD":"BK"})(i.a.createElement(p.a,null,i.a.createElement(p.a.Option,{value:"BK"},"BK"),i.a.createElement(p.a.Option,{value:"AD"},"AD"))))),i.a.createElement(g.a,{span:16},i.a.createElement(m.a.Item,{labelCol:{span:0},wrapperCol:{span:18},validateStatus:this.state.number.validateStatus,help:this.state.number.errorMsg||"Only numbers are allowed."},t("custom_id",{initialValue:this.state.patientDetails?this.state.patientDetails.custom_id.replace(/\D/g,""):""})(i.a.createElement(w.a,{style:{width:"100%"},placeholder:"Patient Id",onChange:this.handleNumberChange}))))),this.state.source&&this.state.source==B.db?i.a.createElement(m.a.Item,Ne({key:"source_extra",label:"Source"},n),t("source_extra",{initialValue:""})(i.a.createElement(S.a,{placeholder:"Source"})),i.a.createElement("a",{onClick:()=>e.setFormParams("source",B.mc)},"Choose Source")):i.a.createElement(m.a.Item,Ne({label:"Source"},n),t("source",{initialValue:this.state.patientDetails?this.state.patientDetails.source:null})(i.a.createElement(p.a,{placeholder:"Select Source",showSearch:!0,optionFilterProp:"children"},this.state.sourceList.map(e=>i.a.createElement(p.a.Option,{value:e.id},e.name)))),this.props.user.is_superuser?i.a.createElement("a",{onClick:()=>e.setFormParams("source",B.db)},"Enter New Source"):null),i.a.createElement(m.a.Item,Ne({label:"Religion"},n),t("religion",{initialValue:this.state.patentDetails?this.state.patientDetails.religion:null})(i.a.createElement(p.a,{placeholder:"Religion",showSearch:!0,optionFilterProp:"children"},this.state.hrsetting.map(e=>i.a.createElement(p.a.Option,{value:e.id},e.value))))),i.a.createElement(m.a.Item,Ne({label:"Referral Code"},n),t("referal",{initialValue:e.state.patientDetails&&e.state.patientDetails.user.referer_data.referer?e.state.patientDetails.user.referer_data.referer.referer_code:""})(i.a.createElement(S.a,{placeholder:"Referral Code"}))),i.a.createElement(m.a.Item,Ne({label:"SMS Language"},n),t("language",{initialValue:this.state.patientDetails&&this.state.patientDetails.language?this.state.patientDetails.language:this.props.activePracticeData.language})(i.a.createElement(p.a,null,this.state[W.Vb].map(e=>i.a.createElement(p.a.Option,{value:e},e))))),i.a.createElement(m.a.Item,Ne({label:"Aadhar ID"},n),t("aadhar_id",{initialValue:this.state.patientDetails?this.state.patientDetails.aadhar_id:""})(i.a.createElement(S.a,{placeholder:"Patient Aadhar Number"}))),i.a.createElement(m.a.Item,Ne({label:"Gender"},n),t("gender",{initialValue:this.state.patientDetails?this.state.patientDetails.gender:null})(i.a.createElement(p.a,{placeholder:"Select Gender"},this.state[W.Z].map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label))))),i.a.createElement(m.a.Item,Ne({label:" "},n,{colon:!1}),i.a.createElement(j.a.Group,{buttonStyle:"solid",size:"small",onChange:this.changeFormType,defaultValue:this.state.selectedFormType},W.Cb.map(e=>i.a.createElement(j.a,{value:e.value},e.label)))),"DOB"==this.state.selectedFormType?i.a.createElement(m.a.Item,Ne({label:"DOB"},n),t("dob",{initialValue:this.state.patientDetails&&this.state.patientDetails.dob?x()(this.state.patientDetails.dob):""})(i.a.createElement(D.a,null))):i.a.createElement(m.a.Item,Ne({label:"Age"},n),t("age",{initialValue:this.state.patientDetails&&this.state.patientDetails.dob?x()().diff(this.state.patientDetails.dob,"years"):null})(i.a.createElement(w.a,{min:0,max:120,placeholder:"00"})),i.a.createElement("span",{className:"ant-form-text"},"Years")),i.a.createElement(m.a.Item,Ne({label:"Anniversary"},n),t("anniversary",{initialValue:this.state.patientDetails&&this.state.patientDetails.anniversary?x()(this.state.patientDetails.anniversary):null})(i.a.createElement(D.a,null))),i.a.createElement(m.a.Item,Ne({label:"Blood Group"},n),t("blood_group",{initialValue:this.state.patientDetails?this.state.patientDetails.blood_group:""})(i.a.createElement(p.a,{placeholder:"Blood Group"},this.state[W.r].map(e=>i.a.createElement(p.a.Option,{value:e},e))))),i.a.createElement(m.a.Item,Ne({label:"Family"},n),i.a.createElement(m.a.Item,{style:{display:"inline-block",width:"calc(30% - 12px)"}},t("family_relation1",{initialValue:this.state.patientDetails&&null!=this.state.patientDetails.family_relation1?this.state.patientDetails.family_relation1:B.Zb})(i.a.createElement(p.a,{onChange:e=>this.handleRelation(e)},i.a.createElement(p.a.Option,{value:""},B.Zb),this.state[W.Y].map(e=>i.a.createElement(p.a.Option,{value:e.value},e.name))))),i.a.createElement("span",{style:{display:"inline-block",width:"14px",textAlign:"center"}}),i.a.createElement(m.a.Item,{style:{display:"inline-block",width:"calc(50% - 12px)"}},t("attendee1",{initialValue:this.state.patientDetails?this.state.patientDetails.attendee1:""})(i.a.createElement(S.a,{placeholder:"Family Member 1 Name",disabled:(!this.state.patientDetails||!this.state.patientDetails.attendee1)&&this.state.relation_text}))),i.a.createElement(m.a.Item,{style:{display:"inline-block",width:"calc(50% - 12px)"}},t("attendee1_mobile_no",{initialValue:this.state.patientDetails?this.state.patientDetails.attendee1_mobile_no:""})(i.a.createElement(S.a,{placeholder:"Family Member 1 Mobile No",disabled:(!this.state.patientDetails||!this.state.patientDetails.attendee1_mobile_no)&&this.state.relation_text})))),i.a.createElement(m.a.Item,Ne({label:"Family"},n),i.a.createElement(m.a.Item,{style:{display:"inline-block",width:"calc(30% - 12px)"}},t("family_relation2",{initialValue:this.state.patientDetails&&null!=this.state.patientDetails.family_relation2?this.state.patientDetails.family_relation2:B.Zb})(i.a.createElement(p.a,{onChange:e=>this.handleRelation(e)},i.a.createElement(p.a.Option,{value:""},B.Zb),this.state[W.Y].map(e=>i.a.createElement(p.a.Option,{value:e.value},e.name))))),i.a.createElement("span",{style:{display:"inline-block",width:"14px",textAlign:"center"}}),i.a.createElement(m.a.Item,{style:{display:"inline-block",width:"calc(50% - 12px)"}},t("attendee2",{initialValue:this.state.patientDetails?this.state.patientDetails.attendee2:""})(i.a.createElement(S.a,{placeholder:"Family Member 2 Name",disabled:(!this.state.patientDetails||!this.state.patientDetails.attendee2)&&this.state.relation_text}))),i.a.createElement(m.a.Item,{style:{display:"inline-block",width:"calc(50% - 12px)"}},t("attendee2_mobile_no",{initialValue:this.state.patientDetails?this.state.patientDetails.attendee2_mobile_no:""})(i.a.createElement(S.a,{placeholder:"Family Member 2 Mobile No",disabled:(!this.state.patientDetails||!this.state.patientDetails.attendee2_mobile_no)&&this.state.relation_text})))),i.a.createElement(m.a.Item,Ne({label:"Mobile (Primary)"},n),t("mobile",{initialValue:this.state.patientDetails?this.state.patientDetails.user.mobile:null,rules:[{required:!0,message:"Input Mobile Number"}]})(i.a.createElement(S.a,{placeholder:"Patient Mobile Number (Primary)"}))),i.a.createElement(m.a.Item,Ne({label:"Mobile (Secondary)"},n),t("secondary_mobile_no",{initialValue:this.state.patientDetails?this.state.patientDetails.secondary_mobile_no:""})(i.a.createElement(S.a,{placeholder:"Patient Mobile Number (Secondary)"}))),i.a.createElement(m.a.Item,Ne({label:"Landline"},n),t("landline_no",{initialValue:this.state.patientDetails?this.state.patientDetails.landline_no:""})(i.a.createElement(S.a,{placeholder:"Patient Landline Number"}))),i.a.createElement(m.a.Item,Ne({label:"Address"},n),t("address",{initialValue:this.state.patientDetails?this.state.patientDetails.address:""})(i.a.createElement(S.a,{placeholder:"Patient Address"}))),i.a.createElement(m.a.Item,Ne({label:"Locality"},n),t("locality",{initialValue:this.state.patientDetails?this.state.patientDetails.locality:""})(i.a.createElement(S.a,{placeholder:"Patient Locality"}))),this.state.country&&this.state.country==B.db?i.a.createElement(m.a.Item,Ne({key:"country_extra",label:"Country"},n),t("country_extra",Le(Le({},ze(this.state.country&&this.state.country==B.db)),{},{initialValue:""}))(i.a.createElement(S.a,{placeholder:"Country"})),this.props.user.is_superuser?i.a.createElement("a",{onClick:()=>e.setFormParams("country",B.mc)},"Choose Country"):null):i.a.createElement(m.a.Item,Ne({key:"country"},n,{label:"Country"}),t("country",Le(Le({},ze(!(this.state.country&&this.state.country==B.db))),{},{initialValue:this.state.patientDetails&&this.state.patientDetails.country_data?this.state.patientDetails.country_data.id:""}))(i.a.createElement(p.a,{placeholder:"Select Country",onChange:e=>this.onChangeValue("country",e),showSearch:!0,optionFilterProp:"children"},this.state.countrylist.map(e=>i.a.createElement(p.a.Option,{value:e.id},e.name)))),this.props.user.is_superuser?i.a.createElement("a",{onClick:()=>e.setFormParams("country",B.db)},"Add New Country"):null),this.state.country==B.db||this.state.state&&this.state.state==B.db?i.a.createElement(m.a.Item,Ne({key:"state_extra",label:"State"},n),t("state_extra",Le(Le({},ze(this.state.country==B.db||this.state.state&&this.state.state==B.db)),{},{initialValue:""}))(i.a.createElement(S.a,{placeholder:"State"})),i.a.createElement("a",{onClick:()=>e.setFormParams("state",B.mc)},"Choose State")):i.a.createElement(m.a.Item,Ne({key:"state"},n,{label:"State"}),t("state",Le(Le({},ze(!(this.state.country==B.db||this.state.state&&this.state.state==B.db))),{},{initialValue:this.state.patientDetails&&this.state.patientDetails.state_data?this.state.patientDetails.state_data.id:""}))(i.a.createElement(p.a,{placeholder:"Select State",onChange:e=>this.onChangeValue("state",e),showSearch:!0,optionFilterProp:"children"},this.state.stateList.map(e=>i.a.createElement(p.a.Option,{value:e.id},e.name)))),this.props.user.is_superuser?i.a.createElement("a",{onClick:()=>e.setFormParams("state",B.db)},"Add New state"):null),this.state.country==B.db||this.state.state==B.db||this.state.city&&this.state.city==B.db?i.a.createElement(m.a.Item,Ne({key:"city_extra",label:"City"},n),t("city_extra",Le(Le({},ze(this.state.country==B.db||this.state.state==B.db||this.state.city&&this.state.city==B.db)),{},{initialValue:""}))(i.a.createElement(S.a,{placeholder:"City"})),i.a.createElement("a",{onClick:()=>e.setFormParams("city",B.mc)},"Choose City")):i.a.createElement(m.a.Item,Ne({key:"City"},n,{label:"City"}),t("city",Le(Le({},ze(!(this.state.country==B.db||this.state.state==B.db||this.state.city&&this.state.city==B.db))),{},{initialValue:this.state.patientDetails&&this.state.patientDetails.city_data?this.state.patientDetails.city_data.id:""}))(i.a.createElement(p.a,{showSearch:!0,optionFilterProp:"children",placeholder:"Select City"},this.state.cityList.map(e=>i.a.createElement(p.a.Option,{value:e.id},e.name)))),this.props.user.is_superuser?i.a.createElement("a",{onClick:()=>e.setFormParams("city",B.db)},"Add New City"):null),i.a.createElement(m.a.Item,Ne({label:"Pincode"},n),t("pincode",{initialValue:this.state.patientDetails?this.state.patientDetails.pincode:""})(i.a.createElement(S.a,{placeholder:"Patient PINCODE"}))),i.a.createElement(m.a.Item,Ne({label:"Email"},n),t("email",{initialValue:this.state.patientDetails?this.state.patientDetails.user.email:null})(i.a.createElement(S.a,{placeholder:"Patient Email"}))),i.a.createElement(m.a.Item,Ne({label:"PD Doctor"},n),t("pd_doctor",{initialValue:!!this.state.patientDetails&&this.state.patientDetails.pd_doctor})(i.a.createElement(p.a,{placeholder:"PD Doctor"},a.map(e=>i.a.createElement(p.a.Option,{value:e.id},e.user.first_name))))),i.a.createElement(m.a.Item,Ne({label:"Medical History"},n),t("medical_history",{initialValue:this.state.patientDetails?this.state.patientDetails.medical_history:[]})(i.a.createElement(p.a,{placeholder:"Medical History",mode:"multiple",optionFilterProp:"children"},r.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label))))),i.a.createElement(m.a.Item,Ne({label:"Patient Group"},n),t("patient_group",{initialValue:this.state.patientDetails?this.state.patientDetails.patient_group:[]})(i.a.createElement(p.a,{placeholder:"Patient Group",mode:"multiple",optionFilterProp:"children"},l.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label))))),i.a.createElement(m.a.Item,Ne({label:"On Dialysis"},n),t("on_dialysis",{initialValue:!!this.state.patientDetails&&this.state.patientDetails.on_dialysis,valuePropName:"checked"})(i.a.createElement(ve.a,{onChange:e=>this.onChangeCheckbox(e),style:{paddingTop:"4px"}}))),i.a.createElement(m.a.Item,Ne({label:"Allow File Upload"},n),t("file_enable",{initialValue:!this.state.patientDetails||this.state.patientDetails.file_enable,valuePropName:"checked"})(i.a.createElement(ve.a,{style:{paddingTop:"4px"},defaultChecked:!0}))),i.a.createElement(m.a.Item,Ne({label:"Max Uploads Allowed"},n),t("file_count",{initialValue:this.state.patientDetails?this.state.patientDetails.file_count:10})(i.a.createElement(w.a,{min:0}))),this.props.user.is_superuser?i.a.createElement(m.a.Item,Ne({label:"Patient is Dead ?"},n),t("is_dead",{initialValue:!!this.state.patientDetails&&this.state.patientDetails.is_dead,valuePropName:"checked"})(i.a.createElement(ve.a,{style:{paddingTop:"4px"}}))):null,i.a.createElement(m.a.Item,null,e.props.history?i.a.createElement(o.a,{style:{margin:5},onClick:()=>e.props.history.goBack()},"Cancel"):null,i.a.createElement(o.a,{style:{margin:5},type:"primary",htmlType:"submit",loading:this.state.loading},"Save"))))}}var qe=m.a.create()(Ye);function We(e){return isNaN(e)?{validateStatus:"error",errorMsg:"Patient ID can only be numerical value."}:{validateStatus:"success",errorMsg:null}}var Ge=a(1589);class He extends i.a.Component{constructor(e){super(e),this.state={redirect:!1,appointments:null,practice_doctors:[],procedure_category:null,treatmentNotes:null,practice_staff:[],loading:!1},this.changeRedirect=this.changeRedirect.bind(this),this.editAppointment=this.editAppointment.bind(this),this.deleteAppointment=this.deleteAppointment.bind(this),this.loadProcedureCategory=this.loadProcedureCategory.bind(this),this.loadDoctors=this.loadDoctors.bind(this)}componentDidMount(){this.loadDoctors(),this.loadTreatmentNotes(),this.props.match.params.appointmentid?this.loadAppointment(this.props.match.params.appointmentid):this.loadAllAppointments()}loadAppointment(e){const t=this;this.setState({loading:!0});Object(N.c)(Object(N.g)(V.r,[e]),(function(e){t.setState({appointments:[e],loading:!1})}),(function(){t.setState({loading:!1})}))}loadAllAppointments(e=1){const t=this;this.setState({loading:!0});const a={practice:this.props.active_practiceId,pagination:!0,page:e};this.props.match.params.id&&(a.patient=this.props.match.params.id),Object(N.c)(V.i,(function(e){1==e.current?t.setState({appointments:e.results,total:e.count,loadMoreAppointment:e.next,loading:!1}):t.setState((function(t){return{total:e.count,appointments:[...t.appointments,...e.results],loading:!1,loadMoreAppointment:e.next}}))}),(function(){t.setState({loading:!1})}),a)}loadProcedureCategory(){const e=this;Object(N.c)(Object(N.g)(V.Kd,[this.props.active_practiceId]),(function(t){e.setState({procedure_category:t})}),(function(){}))}loadDoctors(){const e=this;Object(N.c)(Object(N.g)(V.Dd,[this.props.active_practiceId]),(function(t){t.staff.forEach((function(t){if(t.role==B.Q){const a=e.state.practice_doctors;a.push(t),e.setState({practice_doctors:a})}else{const a=e.state.practice_staff;a.push(t),e.setState({practice_staff:a})}}))}),(function(){}))}loadTreatmentNotes(){const e=this;Object(N.c)(Object(N.g)(V.Db,[this.props.active_practiceId]),(function(t){e.setState({treatmentNotes:t})}),(function(){e.setState({})}))}changeRedirect(){const e=this.state.redirect;this.setState({redirect:!e})}editAppointment(e){const t=e.id;this.props.history.push("/calendar/".concat(t,"/edit-appointment"))}deleteAppointment(e){const t=this;t.setState({loading:!0});Object(N.m)(Object(N.g)(V.r,[e.id]),{is_active:!1,status:"Cancelled"},(function(e){t.loadAllAppointments(),t.setState({loading:!1})}),(function(){t.setState({loading:!1})}))}render(){const e=this,t=[];this.state.practice_doctors.length&&this.state.practice_doctors.forEach((function(e){t[e.id]=e.user.first_name}));const a=[];this.state.treatmentNotes&&this.state.treatmentNotes.forEach((function(e){a[e.id]=e.name}));const n=[{title:"Schedule Time",key:"name",render:(e,t)=>i.a.createElement("span",null,x()(t.schedule_at).format("LLL"),",",t.slot,"mins")},{title:"Patient ID",key:"id",render:(e,t)=>i.a.createElement("span",null,t.patient.custom_id?t.patient.custom_id:t.patient.id),exports:(e,t)=>t.patient.custom_id?t.patient.custom_id:t.patient.id},{title:"Patient Name",dataIndex:"patient.user.first_name",key:"patient_name"},{title:"Patient Mobile",dataIndex:"patient.user.mobile",key:"patient_mobile",render:t=>e.props.activePracticePermissions.PatientPhoneNumber?t:Object(q.b)(t)},{title:"Email",dataIndex:"patient.user.email",key:"email",render:t=>e.props.activePracticePermissions.PatientEmailId?t:Object(q.a)(t)},{title:"Doctor",key:"doctor",render:(e,a)=>i.a.createElement("span",null," ",t[a.doctor])},{title:"First Appointment",key:"first_appointment",dataIndex:"first_appointment",render:e=>e?"Yes":"No"},{title:"Created By",key:"created_by",dataIndex:"created_by",render:(e,t)=>t.created_by?t.creator:"--"},{title:"Procedure",key:"procedure"},{title:"Treatment Notes",key:"notes",render:(e,t)=>i.a.createElement("span",null," ",a[t.notes])},{title:"Category",key:"category",render:(e,t)=>i.a.createElement("span",null," ",t.category?t.category_data.name:"--")},{title:"NotifyByEmail",key:"notify_via_email",render:(e,t)=>i.a.createElement(ve.a,{disabled:!0,checked:t.notify_via_email})},{title:"NotifyBySMS",key:"notify_via_sms",render:(e,t)=>i.a.createElement(ve.a,{disabled:!0,checked:t.notify_via_sms})},{title:"Action",key:"action",render:(t,a)=>i.a.createElement("span",null,i.a.createElement("a",{onClick:()=>this.editAppointment(a),disabled:!e.props.activePracticePermissions.EditAppointment},"Edit"),i.a.createElement(P.a,{type:"vertical"}),i.a.createElement(k.a,{title:"Are you sure delete this item?",onConfirm:()=>this.deleteAppointment(a),okText:"Yes",cancelText:"No"},i.a.createElement("a",{disabled:!e.props.activePracticePermissions.EditAppointment},"Delete")))}];m.a.create()(z.a);return this.props.match.params.id?i.a.createElement(u.a,{extra:e.props.activePracticePermissions.AddAppointment||e.props.allowAllPermissions?i.a.createElement(d.b,{to:"/calendar/create-appointment?patient=".concat(this.props.match.params.id)},i.a.createElement(o.a,{type:"primary"},i.a.createElement(E.a,{type:"plus"})," Add Appointment")):null},i.a.createElement(Ge.a,{loading:this.state.loading,columns:n,scroll:{x:1300},pagination:!1,dataSource:this.state.appointments}),i.a.createElement(L.a,{loaderFunction:()=>this.loadAllAppointments(this.state.loadMoreAppointment),loading:this.state.loading,hidden:!this.state.loadMoreAppointment})):i.a.createElement(u.a,{extra:e.props.activePracticePermissions.AddAppointment||e.props.allowAllPermissions?i.a.createElement(d.b,{to:"/calendar/create-appointment"},i.a.createElement(o.a,{type:"primary"},i.a.createElement(E.a,{type:"plus"})," Add Appointment")):null},i.a.createElement(Ge.a,{loading:this.state.loading,columns:n,scroll:{x:1300},pagination:!1,dataSource:this.state.appointments}),i.a.createElement(L.a,{loaderFunction:()=>this.loadAllAppointments(this.state.loadMoreAppointment),loading:this.state.loading,hidden:!this.state.loadMoreAppointment}))}}var Ue=He,Ke=a(1027);const Qe=r.a.Sider;class Ze extends i.a.Component{constructor(e){super(e),this.state={},this.onHotKeyInner=this.onHotKeyInner.bind(this)}onHotKeyInner(e){switch(e){case"alt+f":return this.props.currentPatient?this.props.history.push("/patient/".concat(this.props.currentPatient.id,"/profile")):this.props.history.push("/patients/profile");case"alt+a":return this.props.currentPatient?this.props.history.push("/patient/".concat(this.props.currentPatient.id,"/appointments")):this.props.history.push("/patients/appointments");case"alt+o":return this.props.currentPatient?this.props.history.push("/patient/".concat(this.props.currentPatient.id,"/communications")):this.props.history.push("/patients/communications");case"alt+k":return this.props.currentPatient?this.props.history.push("/patient/".concat(this.props.currentPatient.id,"/booking")):this.props.history.push("/patients/profile");case"alt+m":case"alt+n":return this.props.currentPatient?this.props.history.push("/patient/".concat(this.props.currentPatient.id,"/emr/vitalsigns")):this.props.history.push("/patients/emr/vitalsigns");case"alt+t":return this.props.currentPatient?this.props.history.push("/patient/".concat(this.props.currentPatient.id,"/emr/plans")):this.props.history.push("/patients/emr/plans");case"alt+l":return this.props.currentPatient?this.props.history.push("/patient/".concat(this.props.currentPatient.id,"/emr/files")):this.props.history.push("/patients/emr/files");case"alt+i":return this.props.currentPatient?this.props.history.push("/patient/".concat(this.props.currentPatient.id,"/billing/invoices")):this.props.history.push("/patients/billing/invoices");case"alt+e":return this.props.currentPatient?this.props.history.push("/patient/".concat(this.props.currentPatient.id,"/billing/return/invoices")):this.props.history.push("/patients/billing/return/invoices");case"alt+y":return this.props.currentPatient?this.props.history.push("/patient/".concat(this.props.currentPatient.id,"/billing/payments")):this.props.history.push("/patients/billing/payments");case"alt+u":return this.props.currentPatient?this.props.history.push("/patient/".concat(this.props.currentPatient.id,"/emr/workdone")):this.props.history.push("/patients/emr/workdone");case"alt+s":return this.props.currentPatient?this.props.history.push("/patient/".concat(this.props.currentPatient.id,"/emr/prescriptions")):this.props.history.push("/patients/emr/prescriptions");case"alt+g":return this.props.currentPatient?this.props.history.push("/patient/".concat(this.props.currentPatient.id,"/billing/ledger")):this.props.history.push("/patients/profile");case"alt+w":return this.props.currentPatient?this.props.history.push("/patient/".concat(this.props.currentPatient.id,"/emr/timeline")):this.props.history.push("/patients/profile")}}render(){return i.a.createElement(Ke.a,{keyName:W.mb,onKeyDown:e=>this.onHotKeyInner(e)},i.a.createElement(Qe,{trigger:null,collapsible:!0,collapsed:this.props.hideSidePanel,style:{overflow:"auto",minHeight:"calc(100vh - 64px)",background:"#fff"}},i.a.createElement(h.a,{mode:"inline"},i.a.createElement(h.a.ItemGroup,{key:"g1",title:i.a.createElement(P.a,{style:{margin:"0px"}},"Patient")},i.a.createElement(h.a.Item,{key:"17"},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/profile"):"/patients/profile"},i.a.createElement(E.a,{type:"user"}),i.a.createElement("span",{className:"nav-text"},"Pro",i.a.createElement("span",{className:"shortcutLetterHighlight"},"f"),"ile"))),this.props.activePracticePermissions.PatientAppointments||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"18"},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/appointments"):"/patients/appointments"},i.a.createElement(E.a,{type:"calendar"}),i.a.createElement("span",{className:"nav-text"},i.a.createElement("span",{className:"shortcutLetterHighlight"},"A"),"ppointments"))):null,this.props.activePracticePermissions.PatientCommunications||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"19"},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/communications"):"/patients/communications"},i.a.createElement(E.a,{type:"message"}),i.a.createElement("span",{className:"nav-text"},"C",i.a.createElement("span",{className:"shortcutLetterHighlight"},"o"),"mmunications"))):null,this.props.activePracticePermissions.PatientCommunications||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"allopath"},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/allopath"):"/patients/allopath"},i.a.createElement(E.a,{type:"audit"}),i.a.createElement("span",{className:"nav-text"},"Allopath History"))):null,this.props.activePracticePermissions.PatientBookings||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"booking",disabled:!this.props.currentPatient},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/booking"):"/patients/communications"},i.a.createElement(E.a,{type:"book"}),i.a.createElement("span",{className:"nav-text"},"Boo",i.a.createElement("span",{className:"shortcutLetterHighlight"},"k"),"ing"))):null),i.a.createElement(h.a.ItemGroup,{key:"g2",title:i.a.createElement(P.a,{style:{margin:"0px"}},"EMR")},this.props.activePracticePermissions.PatientVitalSigns||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"20"},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/emr/vitalsigns"):"/patients/emr/vitalsigns"},i.a.createElement(E.a,{type:"heart"}),i.a.createElement("span",{className:"nav-text"},"Report ",i.a.createElement("span",{className:"shortcutLetterHighlight"},"M"),"anual"))):null,this.props.activePracticePermissions.PatientClinicalNotes||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"21"},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/emr/clinicnotes"):"/patients/emr/clinicnotes"},i.a.createElement(E.a,{type:"solution"}),i.a.createElement("span",{className:"nav-text"},"Clinical ",i.a.createElement("span",{className:"shortcutLetterHighlight"},"N"),"otes"))):null,this.props.activePracticePermissions.PatientTreatmentPlans||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"30"},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/emr/plans"):"/patients/emr/plans"},i.a.createElement(E.a,{type:"read"}),i.a.createElement("span",{className:"nav-text"},i.a.createElement("span",{className:"shortcutLetterHighlight"},"T"),"reatment Plans"))):null,this.props.activePracticePermissions.PatientCompletedProcedure||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"22"},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/emr/workdone"):"/patients/emr/workdone"},i.a.createElement(E.a,{type:"check-circle"}),i.a.createElement("span",{className:"nav-text"},"Completed Proced",i.a.createElement("span",{className:"shortcutLetterHighlight"},"u"),"re"))):null,this.props.activePracticePermissions.PatientFiles||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"23"},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/emr/files"):"/patients/emr/files"},i.a.createElement(E.a,{type:"picture"}),i.a.createElement("span",{className:"nav-text"},"Fi",i.a.createElement("span",{className:"shortcutLetterHighlight"},"l"),"es"))):null,this.props.activePracticePermissions.PatientPrescriptions||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"24"},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/emr/prescriptions"):"/patients/emr/prescriptions"},i.a.createElement(E.a,{type:"solution"}),i.a.createElement("span",{className:"nav-text"},"Pre",i.a.createElement("span",{className:"shortcutLetterHighlight"},"s"),"criptions"))):null,this.props.activePracticePermissions.PatientTimeline||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"25",disabled:!this.props.currentPatient},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/emr/timeline"):"/patients/profile"},i.a.createElement(E.a,{type:"clock-circle"}),i.a.createElement("span",{className:"nav-text"},"Timeline ",i.a.createElement("span",{className:"shortcutLetterHighlight"},"w")))):null,this.props.activePracticePermissions.PatientLabOrders||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"26",disabled:!this.props.currentPatient||!0},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/emr/labtrackings"):"/patients/profile"},i.a.createElement(E.a,{type:"solution"}),i.a.createElement("span",{className:"nav-text"},"Lab Orders"))):null),i.a.createElement(h.a.ItemGroup,{key:"g3",title:i.a.createElement(P.a,{style:{margin:"0px"}},"Billing")},this.props.activePracticePermissions.PatientInvoices||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"27"},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/billing/invoices"):"/patients/billing/invoices"},i.a.createElement(E.a,{type:"audit"}),i.a.createElement("span",{className:"nav-text"},i.a.createElement("span",{className:"shortcutLetterHighlight"},"I"),"nvoices"))):null,this.props.activePracticePermissions.PatientInvoices||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"40"},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/proforma-invoice"):"/patients/proforma-invoice"},i.a.createElement(E.a,{type:"audit"}),i.a.createElement("span",{className:"nav-text"},"Proforma Invoices"))):null,this.props.activePracticePermissions.PatientReturns||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"31"},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/billing/return/invoices"):"/patients/billing/return/invoices"},i.a.createElement(E.a,{type:"redo"}),i.a.createElement("span",{className:"nav-text"},"Invoices R",i.a.createElement("span",{className:"shortcutLetterHighlight"},"e"),"turn"))):null,this.props.activePracticePermissions.PatientPayments||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"28"},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/billing/payments"):"/patients/billing/payments"},i.a.createElement(E.a,{type:"dollar"}),i.a.createElement("span",{className:"nav-text"},"Pa",i.a.createElement("span",{className:"shortcutLetterHighlight"},"y"),"ments"))):null,this.props.activePracticePermissions.PatientLedger||this.props.allowAllPermissions?i.a.createElement(h.a.Item,{key:"29",disabled:!this.props.currentPatient},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/billing/ledger"):"/patients/profile"},i.a.createElement(E.a,{type:"book"}),i.a.createElement("span",{className:"nav-text"},"Led",i.a.createElement("span",{className:"shortcutLetterHighlight"},"g"),"er"))):null,this.props.currentPatient&&this.props.currentPatient.is_agent&&(this.props.activePracticePermissions.PatientLedger||this.props.allowAllPermissions)?i.a.createElement(h.a.Item,{key:"32",disabled:!this.props.currentPatient},i.a.createElement(d.b,{to:this.props.currentPatient?"/patient/".concat(this.props.currentPatient.id,"/billing/wallet"):"/patients/profile"},i.a.createElement(E.a,{type:"wallet"}),i.a.createElement("span",{className:"nav-text"},"Wallet Ledger"))):null))))}}var Xe=Ze,Je=a(12),$e=a.n(Je),et=a(117),tt=a(34),at=a.n(tt),nt=a(127),it=a.n(nt);function rt(){if("undefined"!=typeof window&&window.document&&window.document.documentElement){var e=window.document.documentElement;return"flex"in e.style||"webkitFlex"in e.style||"Flex"in e.style||"msFlex"in e.style}return!1}function lt(){return(lt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function st(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ot(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function ct(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function dt(e){return(dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mt(e,t){return(mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ut(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var ht=function(e){function t(e){var a,n,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,i=dt(t).call(this,e),a=!i||"object"!=typeof i&&"function"!=typeof i?pt(n):i,ut(pt(a),"onStepClick",(function(e){var t=a.props,n=t.onChange,i=t.current;n&&i!==e&&n(e)})),ut(pt(a),"calcStepOffsetWidth",(function(){if(!rt()){var e=a.state.lastStepOffsetWidth,t=Object(et.findDOMNode)(pt(a));t.children.length>0&&(a.calcTimeout&&clearTimeout(a.calcTimeout),a.calcTimeout=setTimeout((function(){var n=(t.lastChild.offsetWidth||0)+1;e===n||Math.abs(e-n)<=3||a.setState({lastStepOffsetWidth:n})})))}})),a.state={flexSupported:!0,lastStepOffsetWidth:0},a.calcStepOffsetWidth=it()(a.calcStepOffsetWidth,150),a}var a,r,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mt(e,t)}(t,e),a=t,(r=[{key:"componentDidMount",value:function(){this.calcStepOffsetWidth(),rt()||this.setState({flexSupported:!1})}},{key:"componentDidUpdate",value:function(){this.calcStepOffsetWidth()}},{key:"componentWillUnmount",value:function(){this.calcTimeout&&clearTimeout(this.calcTimeout),this.calcStepOffsetWidth&&this.calcStepOffsetWidth.cancel&&this.calcStepOffsetWidth.cancel()}},{key:"render",value:function(){var e,t=this,a=this.props,r=a.prefixCls,l=a.style,s=void 0===l?{}:l,o=a.className,c=a.children,d=a.direction,p=a.type,m=a.labelPlacement,u=a.iconPrefix,h=a.status,f=a.size,y=a.current,g=a.progressDot,b=a.initial,E=a.icons,v=a.onChange,_=ot(a,["prefixCls","style","className","children","direction","type","labelPlacement","iconPrefix","status","size","current","progressDot","initial","icons","onChange"]),P="navigation"===p,k=this.state,O=k.lastStepOffsetWidth,C=k.flexSupported,S=i.a.Children.toArray(c).filter((function(e){return!!e})),I=S.length-1,x=g?"vertical":m,D=at()(r,"".concat(r,"-").concat(d),o,(ut(e={},"".concat(r,"-").concat(f),f),ut(e,"".concat(r,"-label-").concat(x),"horizontal"===d),ut(e,"".concat(r,"-dot"),!!g),ut(e,"".concat(r,"-navigation"),P),ut(e,"".concat(r,"-flex-not-supported"),!C),e));return i.a.createElement("div",lt({className:D,style:s},_),n.Children.map(S,(function(e,a){if(!e)return null;var i=b+a,l=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?st(a,!0).forEach((function(t){ut(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):st(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({stepNumber:"".concat(i+1),stepIndex:i,prefixCls:r,iconPrefix:u,wrapperStyle:s,progressDot:g,icons:E,onStepClick:v&&t.onStepClick},e.props);return C||"vertical"===d||(P?(l.itemWidth="".concat(100/(I+1),"%"),l.adjustMarginRight=0):a!==I&&(l.itemWidth="".concat(100/I,"%"),l.adjustMarginRight=-Math.round(O/I+1))),"error"===h&&a===y-1&&(l.className="".concat(r,"-next-error")),e.props.status||(l.status=i===y?h:i<y?"finish":"wait"),l.active=i===y,Object(n.cloneElement)(e,l)})))}}])&&ct(a.prototype,r),l&&ct(a,l),t}(n.Component);function ft(){return(ft=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function yt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function gt(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function bt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Et(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function vt(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?Pt(e):t}function _t(e){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kt(e,t){return(kt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ot(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Ct(e){return"string"==typeof e}ut(ht,"propTypes",{type:$e.a.string,prefixCls:$e.a.string,className:$e.a.string,iconPrefix:$e.a.string,direction:$e.a.string,labelPlacement:$e.a.string,children:$e.a.any,status:$e.a.string,size:$e.a.string,progressDot:$e.a.oneOfType([$e.a.bool,$e.a.func]),style:$e.a.object,initial:$e.a.number,current:$e.a.number,icons:$e.a.shape({finish:$e.a.node,error:$e.a.node}),onChange:$e.a.func}),ut(ht,"defaultProps",{type:"default",prefixCls:"rc-steps",iconPrefix:"rc",direction:"horizontal",labelPlacement:"horizontal",initial:0,current:0,status:"process",size:"",progressDot:!1});var St=function(e){function t(){var e,a;bt(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return Ot(Pt(a=vt(this,(e=_t(t)).call.apply(e,[this].concat(i)))),"onClick",(function(){var e=a.props,t=e.onClick,n=e.onStepClick,i=e.stepIndex;t&&t.apply(void 0,arguments),n(i)})),a}var a,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&kt(e,t)}(t,e),a=t,(n=[{key:"renderIconNode",value:function(){var e,t=this.props,a=t.prefixCls,n=t.progressDot,r=t.stepNumber,l=t.status,s=t.title,o=t.description,c=t.icon,d=t.iconPrefix,p=t.icons,m=at()("".concat(a,"-icon"),"".concat(d,"icon"),(Ot(e={},"".concat(d,"icon-").concat(c),c&&Ct(c)),Ot(e,"".concat(d,"icon-check"),!c&&"finish"===l&&p&&!p.finish),Ot(e,"".concat(d,"icon-close"),!c&&"error"===l&&p&&!p.error),e)),u=i.a.createElement("span",{className:"".concat(a,"-icon-dot")});return n?"function"==typeof n?i.a.createElement("span",{className:"".concat(a,"-icon")},n(u,{index:r-1,status:l,title:s,description:o})):i.a.createElement("span",{className:"".concat(a,"-icon")},u):c&&!Ct(c)?i.a.createElement("span",{className:"".concat(a,"-icon")},c):p&&p.finish&&"finish"===l?i.a.createElement("span",{className:"".concat(a,"-icon")},p.finish):p&&p.error&&"error"===l?i.a.createElement("span",{className:"".concat(a,"-icon")},p.error):c||"finish"===l||"error"===l?i.a.createElement("span",{className:m}):i.a.createElement("span",{className:"".concat(a,"-icon")},r)}},{key:"render",value:function(){var e,t=this.props,a=t.className,n=t.prefixCls,r=t.style,l=t.itemWidth,s=t.active,o=t.status,c=void 0===o?"wait":o,d=(t.iconPrefix,t.icon),p=(t.wrapperStyle,t.adjustMarginRight),m=(t.stepNumber,t.disabled),u=t.description,h=t.title,f=t.subTitle,y=(t.progressDot,t.tailContent),g=(t.icons,t.stepIndex,t.onStepClick),b=t.onClick,E=gt(t,["className","prefixCls","style","itemWidth","active","status","iconPrefix","icon","wrapperStyle","adjustMarginRight","stepNumber","disabled","description","title","subTitle","progressDot","tailContent","icons","stepIndex","onStepClick","onClick"]),v=at()("".concat(n,"-item"),"".concat(n,"-item-").concat(c),a,(Ot(e={},"".concat(n,"-item-custom"),d),Ot(e,"".concat(n,"-item-active"),s),Ot(e,"".concat(n,"-item-disabled"),!0===m),e)),_=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?yt(a,!0).forEach((function(t){Ot(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):yt(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},r);l&&(_.width=l),p&&(_.marginRight=p);var P={};return g&&!m&&(P.role="button",P.tabIndex=0,P.onClick=this.onClick),i.a.createElement("div",ft({},E,{className:v,style:_}),i.a.createElement("div",ft({onClick:b},P,{className:"".concat(n,"-item-container")}),i.a.createElement("div",{className:"".concat(n,"-item-tail")},y),i.a.createElement("div",{className:"".concat(n,"-item-icon")},this.renderIconNode()),i.a.createElement("div",{className:"".concat(n,"-item-content")},i.a.createElement("div",{className:"".concat(n,"-item-title")},h,f&&i.a.createElement("div",{title:f,className:"".concat(n,"-item-subtitle")},f)),u&&i.a.createElement("div",{className:"".concat(n,"-item-description")},u))))}}])&&Et(a.prototype,n),r&&Et(a,r),t}(i.a.Component);Ot(St,"propTypes",{className:$e.a.string,prefixCls:$e.a.string,style:$e.a.object,wrapperStyle:$e.a.object,itemWidth:$e.a.oneOfType([$e.a.number,$e.a.string]),active:$e.a.bool,disabled:$e.a.bool,status:$e.a.string,iconPrefix:$e.a.string,icon:$e.a.node,adjustMarginRight:$e.a.oneOfType([$e.a.number,$e.a.string]),stepNumber:$e.a.string,stepIndex:$e.a.number,description:$e.a.any,title:$e.a.any,subTitle:$e.a.any,progressDot:$e.a.oneOfType([$e.a.bool,$e.a.func]),tailContent:$e.a.any,icons:$e.a.shape({finish:$e.a.node,error:$e.a.node}),onClick:$e.a.func,onStepClick:$e.a.func}),ht.Step=St;var It=ht,xt=a(181);function Dt(e){return(Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function jt(){return(jt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function wt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Mt(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Tt(e,t){return!t||"object"!==Dt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ft(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function At(e){return(At=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Nt(e,t){return(Nt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Vt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nt(e,t)}(s,e);var t,a,i,r,l=(t=s,function(){var e,a=At(t);if(Ft()){var n=At(this).constructor;e=Reflect.construct(a,arguments,n)}else e=a.apply(this,arguments);return Tt(this,e)});function s(){var e;return wt(this,s),(e=l.apply(this,arguments)).renderSteps=function(t){var a=t.getPrefixCls,i=a("steps",e.props.prefixCls),r=a("",e.props.iconPrefix),l={finish:n.createElement(E.a,{type:"check",className:"".concat(i,"-finish-icon")}),error:n.createElement(E.a,{type:"close",className:"".concat(i,"-error-icon")})};return n.createElement(It,jt({icons:l},e.props,{prefixCls:i,iconPrefix:r}))},e}return a=s,(i=[{key:"render",value:function(){return n.createElement(xt.a,null,this.renderSteps)}}])&&Mt(a.prototype,i),r&&Mt(a,r),s}(n.Component);Vt.Step=It.Step,Vt.defaultProps={current:0},Vt.propTypes={prefixCls:Je.string,iconPrefix:Je.string,current:Je.number};var Lt=a(1606),Rt=a(1571),Bt=a(497),zt=a(450);function Yt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function qt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Yt(Object(a),!0).forEach((function(t){Wt(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Yt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Wt(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Vt.Step;const Gt=[{label:i.a.createElement("span",{style:{width:"100%"}},"Appointment"),value:"appointments"},{label:i.a.createElement("span",{style:{width:"100%"}},"Report Manual"),value:"vital_signs"},{label:i.a.createElement("span",{style:{width:"100%"}},"Clinic Notes"),value:"clinic_notes"},{label:i.a.createElement("span",{style:{width:"100%"}},"Treatment Plans"),value:"treatment_plans"},{label:i.a.createElement("span",{style:{width:"100%"}},"Procedures"),value:"procedures"},{label:i.a.createElement("span",{style:{width:"100%"}},"Files"),value:"files"},{label:i.a.createElement("span",{style:{width:"100%"}},"Prescriptions"),value:"prescriptions"},{label:i.a.createElement("span",{style:{width:"100%"}},"Invoices"),value:"invoices"},{label:i.a.createElement("span",{style:{width:"100%"}},"Payments"),value:"payments"}];class Ht extends i.a.Component{constructor(e){super(e),Wt(this,"changeFilters",e=>{const t=this;this.setState({filterParams:e,selectedFiltersIntermediate:!!e.length&&e.length<Gt.length,checkAllFilters:e.length===Gt.length},(function(){t.loadTimeline()}))}),Wt(this,"onCheckAllFiltersChange",e=>{const t=this;this.setState({filterParams:e.target.checked?Gt.map(e=>e.value):[],selectedFiltersIntermediate:!1,checkAllFilters:e.target.checked},(function(){t.loadTimeline()}))}),Wt(this,"loadTimeline",()=>{const e=this,t={practice_id:this.props.active_practiceId};e.setState({loading:!0}),this.state.filterParams.forEach((function(e){t[e]=1}));this.props.showAllClinic&&this.props.match.params.id&&delete t.practice_id,Object(N.c)(Object(N.g)(V.xd,[this.props.match.params.id]),(function(t){let a=x()().add(5,"year");e.setState((function(){const e=[],n={};return t.forEach((function(t){a.format("YMD")!=x()(t.sort_date).format("YMD")&&(a=x()(t.sort_date),e.push({type:"Time",date:t.sort_date})),e.push(t),"Appointments"!=t.type&&(n[t.type]?n[t.type][t.id]=!0:n[t.type]={[t.id]:!0})})),{timelineData:e,loading:!1,allCheckList:n}}))}),(function(){e.setState({loading:!1})}),t)}),Wt(this,"onCheckAllTimelineCard",e=>{this.setState((function(t){return{checkedTimelineCards:e.target.checked?qt({},t.allCheckList):{},indeterminate:!1,checkAll:e.target.checked}}))}),Wt(this,"toggleTimelineCheckbox",(e,t,a)=>{this.setState((function(n){const i={},r=n.checkedTimelineCards;if(r[e]?r[e][t]=!!a:r[e]={[t]:!!a},a){if(i.indeterminate=!0,Object.keys(n.allCheckList).length==Object.keys(r).length){const e=Object.keys(n.allCheckList);let t=!1;for(let a=0;a<e.length;a++)if(Object.keys(n.allCheckList[e[a]]).length!=Object.keys(r[e[a]]).length){t=!0,i.checkAll=!1;break}t||(i.indeterminate=!1,i.checkAll=!0)}}else i.checkAll=!1,i.indeterminate=!0,delete r[e][t],Object.keys(r[e]).length||(delete r[e],Object.keys(r).length||(i.indeterminate=!1));return i.checkedTimelineCards=r,i}))}),Wt(this,"printCaseSheet",()=>{const e=this,t=Object(N.p)("Starting print case sheet..."),a={practice:e.props.active_practiceId,timeline:[]};Object.keys(this.state.checkedTimelineCards).forEach((function(t){a.timeline.push({type:t,id:Object.keys(e.state.checkedTimelineCards[t])})}));Object(N.k)(Object(N.g)(V.yd,[this.props.match.params.id]),a,(function(e){Object(N.q)(t,B.sc,"Fetched report successfully!!"),window.open(Oe.a+e.report)}),(function(){Object(N.q)(t,B.T,"Case sheet printing failed!!")}))}),Wt(this,"updateFormValue",(e,t)=>{this.setState({[e]:t})}),Wt(this,"mailModalOpen",()=>{this.setState({visibleMail:!0})}),Wt(this,"mailModalClose",()=>{this.setState({visibleMail:!1})}),Wt(this,"sendCaseSheet",()=>{this.mailModalOpen(),this.setState({mail_to:zt.get(this.props.currentPatient,"user.email")})}),Wt(this,"sendMailToPatient",()=>{const e=this,t={mail_to:this.state.mail_to,practice:e.props.active_practiceId,timeline:[]};Object.keys(this.state.checkedTimelineCards).forEach((function(a){t.timeline.push({type:a,id:Object.keys(e.state.checkedTimelineCards[a])})}));Object(N.k)(Object(N.g)(V.yd,[this.props.match.params.id]),t,(function(e){}),(function(e){})),this.mailModalClose()}),this.state={filterParams:["appointments","vital_signs","clinic_notes","treatment_plans","procedures","files","prescriptions","invoices","payments"],checkAllFilters:!0,selectedFiltersIntermediate:!1,timelineData:[],checkedTimelineCards:[]}}componentDidMount(){this.loadTimeline()}render(){const e=this;this.state.timelineData;return i.a.createElement(u.a,{title:"Timeline",extra:i.a.createElement(o.a.Group,null,i.a.createElement(o.a,{onClick:()=>this.sendCaseSheet(this.state.timelineData)},i.a.createElement(E.a,{type:"mail"})," Case Sheet"),i.a.createElement(o.a,{type:"primary",onClick:()=>this.printCaseSheet()},"Print Case Sheet"))},i.a.createElement(l.a,{spinning:this.state.loading},i.a.createElement(y.a,null,i.a.createElement(g.a,{span:4},i.a.createElement(ve.a,{indeterminate:this.state.selectedFiltersIntermediate,onChange:this.onCheckAllFiltersChange,checked:this.state.checkAllFilters},i.a.createElement("b",null,"Select all")),i.a.createElement("br",null),i.a.createElement(ve.a.Group,{size:"large",value:this.state.filterParams,options:Gt,onChange:this.changeFilters})),i.a.createElement(g.a,{span:20},i.a.createElement(Lt.a,{top:10},i.a.createElement("h4",{style:{textAlign:"right",padding:"5px",backgroundImage:"linear-gradient(to left, white , transparent)"}},i.a.createElement(ve.a,{indeterminate:this.state.indeterminate,onChange:this.onCheckAllTimelineCard,checked:this.state.checkAll},"Select All"))),i.a.createElement(Rt.a,{progressDot:!0,current:1,direction:"vertical"},this.state.timelineData.map(t=>i.a.createElement(Rt.a.Item,{dot:"Time"==t.type?i.a.createElement(E.a,{type:"clock-circle-o",style:{fontSize:"25px"}}):null},function(e){switch(e.type){case"Clinical Notes":return function(e){return i.a.createElement(u.a,{hoverable:!0,bodyStyle:{backgroundColor:e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id]?"#B5EEFF":"initial"}},i.a.createElement("h2",null,i.a.createElement(E.a,{type:"solution"})," Clinical Note Added",i.a.createElement(ve.a,{size:"large",style:{float:"right"},checked:!!e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id],onChange:t=>e.toggleTimelineCheckbox(e.type,e.id,t.target.checked)}),e.practice?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,e.practice.name," "))):null),e.chief_complaints?i.a.createElement("p",null,"Chief Complaints",i.a.createElement("ul",null,e.chief_complaints.split(W.C).map(e=>e?i.a.createElement("li",null,e):null))):null,e.observations?i.a.createElement("p",null,"Observations",i.a.createElement("ul",null,e.observations.split(W.C).map(e=>e?i.a.createElement("li",null,e):null))):null,e.investigations?i.a.createElement("p",null,"Investigations",i.a.createElement("ul",null,e.investigations.split(W.C).map(e=>e?i.a.createElement("li",null,e):null))):null,e.diagnosis?i.a.createElement("p",null,"Diagnosis",i.a.createElement("ul",null,e.diagnosis.split(W.C).map(e=>e?i.a.createElement("li",null,e):null))):null,e.notes?i.a.createElement("p",null,"Notes",i.a.createElement("ul",null,e.notes.split(W.C).map(e=>e?i.a.createElement("li",null,e):null))):null)}(e);case"Appointments":return function(e){return i.a.createElement(u.a,{hoverable:!0,bodyStyle:{backgroundColor:e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id]?"#B5EEFF":"initial"}},i.a.createElement("h2",null,i.a.createElement(E.a,{type:"calendar"})," Appointment",e.practice_data?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,e.practice_data.name," "))):null),e.doctor_data?i.a.createElement("p",{style:{borderLeft:"5px solid ".concat(e.doctor_data.calendar_colour),paddingLeft:"5px"}},e.doctor_data.user.first_name):null,x()(e.schedule_at).format("hh:mm A")," to ",x()(e.schedule_at).add(e.slot,"mins").format("HH:mm A"))}(e);case"Files":return function(e){return i.a.createElement(u.a,{hoverable:!0,bodyStyle:{backgroundColor:e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id]?"#B5EEFF":"initial"}},i.a.createElement("h2",null,i.a.createElement(E.a,{type:"picture"})," File",i.a.createElement(ve.a,{size:"large",style:{float:"right"},checked:!!e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id],onChange:t=>e.toggleTimelineCheckbox(e.type,e.id,t.target.checked)}),e.practice_data?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,e.practice_data.name," "))):null),i.a.createElement("img",{src:Object(N.h)(e.file_type),alt:"",style:{height:100}}))}(e);case"Invoices":return function(e){return i.a.createElement(u.a,{hoverable:!0,bodyStyle:{backgroundColor:e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id]?"#B5EEFF":"initial"}},i.a.createElement("h2",null,i.a.createElement(E.a,{type:"audit"})," Invoice",i.a.createElement(ve.a,{size:"large",style:{float:"right"},checked:!!e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id],onChange:t=>e.toggleTimelineCheckbox(e.type,e.id,t.target.checked)}),e.practice_data?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,e.practice_data.name," "))):null),e.procedure.map(e=>i.a.createElement(O.a,null,e.name)),e.inventory.map(e=>i.a.createElement(O.a,null,e.name)),i.a.createElement("br",null),i.a.createElement("b",null,e.invoice_id),i.a.createElement("br",null),i.a.createElement("b",null,"Invoice Amount: INR ",e.total),i.a.createElement("br",null),i.a.createElement("b",null,"Paid Amount: INR ",e.payments_data),i.a.createElement("br",null),i.a.createElement("b",null,"Due Amount: INR ",e.total-e.payments_data))}(e);case"Vital Signs":return function(e){const t=[{title:"Time",dataIndex:"created_at",key:"name",render:e=>i.a.createElement("span",null,x()(e).format("hh:mm A"))},{title:"Temp(F)",key:"temperature",render:(e,t)=>i.a.createElement("span",null," ",t.temperature,i.a.createElement("br",null),",",t.temperature_part)},{title:"Pulse (BPM)",dataIndex:"pulse",key:"pulse"},{title:"RR breaths/min",dataIndex:"resp_rate",key:"resp_rate"},{title:"SYS/DIA mmhg",key:"address",render:(e,t)=>i.a.createElement(i.a.Fragment,null,t.blood_pressure_up?i.a.createElement("span",null," ",t.blood_pressure_up,"/",t.blood_pressure_down,i.a.createElement("br",null),",",t.position):null)},{title:"WEIGHT kg",dataIndex:"weight",key:"weight"},{title:"Creatinine Level",key:"creatinine",dataIndex:"creatinine"},{title:"Haemoglobin Level",key:"haemoglobin",dataIndex:"haemoglobin"},{title:"Urea Level",key:"urea",dataIndex:"urea"},{title:"Uric Acid Level",key:"uric_acid",dataIndex:"uric_acid"}];return(i.a.createElement(u.a,{hoverable:!0,bodyStyle:{backgroundColor:e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id]?"#B5EEFF":"initial"}},i.a.createElement("h2",null,i.a.createElement(E.a,{type:"heart"})," Report Manual Recorded",i.a.createElement(ve.a,{size:"large",style:{float:"right"},checked:!!e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id],onChange:t=>e.toggleTimelineCheckbox(e.type,e.id,t.target.checked)}),e.practice_data?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,e.practice_data.name," "))):null),e.doctor_data?i.a.createElement("p",{style:{borderLeft:"5px solid ".concat(e.doctor_data.calendar_colour),paddingLeft:"5px"}},e.doctor_data.user.first_name):null,i.a.createElement(Ge.a,{columns:t,size:"small",pagination:!1,dataSource:[e]})))}(e);case"Prescriptions":return function(e){return i.a.createElement(u.a,{hoverable:!0,bodyStyle:{backgroundColor:e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id]?"#B5EEFF":"initial"}},i.a.createElement("h2",null,i.a.createElement(E.a,{type:"solution"})," Prescription Added",i.a.createElement(ve.a,{size:"large",style:{float:"right"},checked:!!e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id],onChange:t=>e.toggleTimelineCheckbox(e.type,e.id,t.target.checked)}),e.practice?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,e.practice.name," "))):null),e.doctor?i.a.createElement("p",{style:{borderLeft:"5px solid ".concat(e.doctor.calendar_colour),paddingLeft:"5px"}},e.doctor.user.first_name):null,e.drugs.map(e=>i.a.createElement(O.a,null,e.name)))}(e);case"Payments":return function(e){return i.a.createElement(u.a,{hoverable:!0,bodyStyle:{backgroundColor:e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id]?"#B5EEFF":"initial"}},i.a.createElement("h2",null,i.a.createElement(E.a,{type:"dollar"})," Payment",i.a.createElement(ve.a,{size:"large",style:{float:"right"},checked:!!e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id],onChange:t=>e.toggleTimelineCheckbox(e.type,e.id,t.target.checked)}),e.practice_data?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,e.practice_data.name," "))):null),i.a.createElement("b",null,e.payment_id),i.a.createElement("br",null),i.a.createElement("b",null,"Amount Paid: INR ",e.total))}(e);case"Time":return function(e){return i.a.createElement("span",null,i.a.createElement(Lt.a,{top:20,offsetTop:30},i.a.createElement("h2",{style:{marginLeft:"10px",padding:"5px",backgroundImage:"linear-gradient(to right, #ddd , white)",borderRadius:"4px"}},x()(e.date).format("LL"))))}(e);case"Procedures":return function(e){return i.a.createElement(u.a,{hoverable:!0,bodyStyle:{backgroundColor:e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id]?"#B5EEFF":"initial"}},i.a.createElement("h2",null,"Procedure Performed",i.a.createElement(ve.a,{size:"large",style:{float:"right"},checked:!!e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id],onChange:t=>e.toggleTimelineCheckbox(e.type,e.id,t.target.checked)}),e.practice?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,e.practice.name," "))):null),e.doctor?i.a.createElement("p",{style:{borderLeft:"5px solid ".concat(e.doctor.calendar_colour),paddingLeft:"5px"}},e.doctor.user.first_name):null,e.treatment_plans.map(e=>i.a.createElement(O.a,null,e.procedure.name)))}(e);case"Treatment Plans":return function(e){return i.a.createElement(u.a,{hoverable:!0,bodyStyle:{backgroundColor:e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id]?"#B5EEFF":"initial"}},i.a.createElement("h2",null,"Treatment Plan ",i.a.createElement(ve.a,{size:"large",style:{float:"right"},checked:!!e.checkedTimelineCards[e.type]&&e.checkedTimelineCards[e.type][e.id],onChange:t=>e.toggleTimelineCheckbox(e.type,e.id,t.target.checked)}),e.practice?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,e.practice.name," "))):null),e.doctor?i.a.createElement("p",{style:{borderLeft:"5px solid ".concat(e.doctor.calendar_colour),paddingLeft:"5px"}},e.doctor.user.first_name):null,e.treatment_plans.map(e=>i.a.createElement(O.a,null,e.procedure.name)))}(e);default:return e.type}}(qt(qt({},t),{},{checkedTimelineCards:e.state.checkedTimelineCards,toggleTimelineCheckbox:e.toggleTimelineCheckbox}))))),i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send Timeline To ",zt.get(this.props.currentPatient,"user.first_name")," ?"),i.a.createElement(S.a,{value:this.state.mail_to,placeholder:"Email",onChange:t=>e.updateFormValue("mail_to",t.target.value)}))))))}}var Ut=Ht;var Kt=a(1558),Qt=a.n(Kt),Zt=a(835);function Xt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Jt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Xt(Object(a),!0).forEach((function(t){$t(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Xt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function $t(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ea extends i.a.Component{constructor(e){super(e),$t(this,"loadMailedFiles",(e=1)=>{const t=this,a={mailed:!0,page:e,practice:this.props.active_practiceId};this.props.currentPatient&&(a.patient=this.props.currentPatient.id),this.props.showAllClinic&&this.props.currentPatient&&delete a.practice,Object(N.c)(V.od,(function(e){t.setState((function(t){return 1==e.current?{files:[...e.results],total:e.count,loadMoreFiles:e.next,loading:!1}:{files:[...t.files,...e.results],loadMoreFiles:e.next,loading:!1}}))}),(function(){}),a)}),$t(this,"filterTags",e=>{const t=this;this.setState({filterSearchTag:e.target.value},(function(){t.loadData()}))}),$t(this,"showModal",e=>{this.setState((function(){return{visible:!0,filesData:Jt({},e)}}))}),$t(this,"handleCancel",()=>{this.setState({visible:!1})}),$t(this,"togglePDFModal",e=>{this.setState({showPDFFile:e})}),$t(this,"updateFormValue",(e,t)=>{this.setState({[e]:t})}),$t(this,"mailModalOpen",()=>{this.setState({visibleMail:!0})}),$t(this,"mailModalClose",()=>{this.setState({visibleMail:!1})}),$t(this,"sendFiles",()=>{this.mailModalOpen(),this.setState({mail_to:zt.get(this.props.currentPatient,"user.email")})}),$t(this,"handleVisibleChange",()=>{this.setState({visibleTag:!this.state.visibleTag})}),this.state={files:[],tags:[],showAddModal:!1,loading:!0,selectedFiles:{},selectedTags:{},filterSearchTag:null,showAddMedicalModel:!1,medicalCertificate:[],visible:!1,filesData:{},mailedfiles:[],visibleTag:!1},this.loadData=this.loadData.bind(this),this.loadMedicalCertificate=this.loadMedicalCertificate.bind(this)}componentWillMount(){this.loadData(),this.loadTags(),this.loadMedicalCertificate()}loadData(e=1){const t=this;this.setState({loading:!0});const a={page:e,practice:this.props.active_practiceId,page_size:10};this.props.match.params.id&&(a.patient=this.props.match.params.id),this.props.showAllClinic&&this.props.match.params.id&&delete a.practice,this.state.filterSearchTag?a.tag=this.state.filterSearchTag:""==this.state.filterSearchTag&&(a.notag=!0),Object(N.c)(V.ld,(function(e){t.setState((function(t){let a=null;if(1==e.current){return{files:e.results.map(e=>x()(e.created_at).format("YYYYMMDD")!=x()(a).format("YYYYMMDD")?(a=x()(e.created_at),Jt(Jt({},e),{},{newDate:!0})):Jt(Jt({},e),{},{newDate:!1})),total:e.count,loadMoreFiles:e.next,loading:!1}}const n=e.results.map(e=>x()(e.created_at).format("YYYYMMDD")!=x()(a).format("YYYYMMDD")?(a=x()(e.created_at),Jt(Jt({},e),{},{newDate:!0})):Jt(Jt({},e),{},{newDate:!1}));return{files:[...t.files,...n],loadMoreFiles:e.next,loading:!1}}))}),(function(){t.setState({loading:!1})}),a)}loadTags(){const e=this;Object(N.c)(Object(N.g)(V.yb,[this.props.active_practiceId]),(function(t){e.setState({tags:t,loading:!1})}),(function(){e.setState({loading:!1})}))}loadMedicalCertificate(e=1){const t=this;t.setState({loading:!0});const a=function(e){1==e.current?t.setState({total:e.count,medicalCertificate:e.results,loading:!1,loadMoreCertificate:e.next}):t.setState((function(t){return{total:e.count,medicalCertificate:[...t.medicalCertificate,...e.results],loading:!1,loadMoreCertificate:e.next}}))},n=function(){t.setState({loading:!1})};this.props.currentPatient&&Object(N.c)(Object(N.g)(V.uc,[this.props.active_practiceId,this.props.currentPatient.id,e]),a,n),this.props.showAllClinic&&this.props.currentPatient?Object(N.c)(Object(N.g)(V.j,[this.props.currentPatient.id,e]),a,n):Object(N.c)(Object(N.g)(V.j,[this.props.active_practiceId,e]),a,n)}triggerAddModal(e){this.setState({showAddModal:!!e})}triggerAddMedicalCertificateModal(e){this.setState({showAddMedicalModel:!!e})}filesCompleteToggle(e,t){this.setState((function(a){const n=Jt({},a.selectedFiles);return t?n[e]=!!t:delete n[e],{selectedFiles:Jt({},n)}}))}tagsCompleteToggle(e,t){this.setState((function(a){const n=Jt({},a.selectedTags);return t?n[e]=!!t:delete n[e],{selectedTags:Jt({},n)}}))}filesWithTags(){const e=this,t={id:Object.keys(this.state.selectedFiles),file_tags:Object.keys(this.state.selectedTags),patient:this.props.match.params.id};Object(N.k)(Object(N.g)(V.ld,[this.props.match.params.id]),t,(function(){e.setState({selectedFiles:{},visibleTag:!1}),e.loadData()}),(function(){}))}deleteMedicalCertificate(e){const t=this,a={is_active:!1,patient:e.patient,id:e.id};Object(N.k)(Object(N.g)(V.uc,[t.props.active_practiceId]),a,(function(e){t.loadData(),t.loadMedicalCertificate()}),(function(){}))}deleteFile(e){const t=this,a={id:e.id,patient:e.patient,is_active:!1};Object(N.k)(Object(N.g)(V.ld,[this.props.match.params.id]),a,(function(e){t.setState({showPDFFile:!1}),t.loadData()}),(function(){Object(N.a)(B.T,"Please Select Patient.")}))}loadPDF(e){Object(N.c)(Object(N.g)(V.vc,[e]),(function(e){e.report&&window.open(Oe.a+e.report)}),(function(){}))}render(){const e=this,t=m.a.create()(z.a),a=[{key:"files",label:"File",type:B.wb,required:!0},{key:"file_tags",label:"Tags",type:B.xb,options:this.state.tags.map(e=>({label:e.name,value:e.id}))}],n={method:"post",successFn(){e.triggerAddModal(!1),e.loadData()},errorFn(){},action:Object(N.g)(V.ld,[this.props.match.params.id])},r=i.a.createElement("div",{style:{boxShadow:"0 2px 4px #111",border:"1px solid #bbb",borderRadius:2,paddingBottom:"30px",backgroundColor:"white"}},i.a.createElement("ul",{style:{listStyle:"none",paddingInlineStart:0,paddingTop:10}},this.state.tags?i.a.createElement("div",null,this.state.tags.map(t=>i.a.createElement("li",{key:t.id},i.a.createElement(ve.a,{value:t.id,onChange:a=>e.tagsCompleteToggle(t.id,a.target.checked),checked:e.state.selectedTags[t.id]},t.name)))):null),i.a.createElement("span",null,i.a.createElement(o.a,{type:"primary",onClick:()=>this.filesWithTags(),style:{float:"right",borderStyle:"none"}},"Done"))),l=[{key:"is_active",value:!0},{key:"patient",value:this.props.currentPatient?this.props.currentPatient.id:null},{key:"practice",value:this.props.active_practiceId}];return i.a.createElement(u.a,{title:"Files",extra:this.props.match.params.id?i.a.createElement(o.a.Group,null,i.a.createElement(d.b,{to:"/patient/".concat(this.props.match.params.id,"/emr/create-medicalCertificate")},i.a.createElement(o.a,{type:"primary"},i.a.createElement(E.a,{type:"plus"})," Add Medical Certificate")),i.a.createElement(_.a,{overlay:r,trigger:["click"],placement:"bottomLeft",onVisibleChange:e.handleVisibleChange,visible:e.state.visibleTag},i.a.createElement(o.a,null,i.a.createElement(E.a,{type:"plus"}),"Add/Remove File Tags")),i.a.createElement(o.a,{onClick:()=>this.triggerAddModal(!0)},i.a.createElement(E.a,{type:"plus"}),"Add"),i.a.createElement(o.a,{style:{marginRight:"10px"},onClick:()=>e.sendFiles()},i.a.createElement(E.a,{type:"mail"}),"   Send to patient")):i.a.createElement(o.a.Group,null,i.a.createElement(o.a,{type:"primary",style:{marginRight:"10px"},onClick:()=>this.props.togglePatientListModal(!0)},i.a.createElement(E.a,{type:"plus"}),"  Add Medical Certificate"),i.a.createElement(_.a,{overlay:r,trigger:["click"],placement:"bottomLeft",onVisibleChange:e.handleVisibleChange,visible:e.state.visibleTag},i.a.createElement(o.a,null,i.a.createElement(E.a,{type:"plus"}),"Add/Remove File Tags")),i.a.createElement(o.a,{type:"primary",style:{marginRight:"10px"},onClick:()=>this.props.togglePatientListModal(!0)},i.a.createElement(E.a,{type:"plus"}),"   Add"))},i.a.createElement(y.a,{gutter:8},i.a.createElement(g.a,{span:6,style:{height:"calc(100vh - 55px)",overflow:"auto",paddingRight:"10px",borderRight:"1px solid #ccc"}},i.a.createElement(j.a.Group,{buttonStyle:"solid",defaultValue:"all",onChange:this.filterTags},i.a.createElement("h2",null,"Uploaded Files"),i.a.createElement(j.a.Button,{style:{width:"100%",backgroundColor:"transparent",border:"0px"},value:null},"All Files"),this.state.tags.map(e=>i.a.createElement(j.a.Button,{key:e.id,style:{width:"100%",backgroundColor:"transparent",border:"0px"},value:e.id},e.name)),i.a.createElement(j.a.Button,{style:{width:"100%",backgroundColor:"transparent",border:"0px"},value:""},"Untagged Files"),i.a.createElement("p",null,i.a.createElement("br",null))),i.a.createElement(j.a.Group,{buttonStyle:"solid",defaultValue:""},i.a.createElement("h2",null,"Generated Files"),i.a.createElement(j.a.Button,{key:"0",style:{width:"100%",backgroundColor:"transparent",border:"0px"},value:"a",onClick:()=>this.loadMailedFiles()},"Emailed Files"),i.a.createElement(j.a.Button,{key:"1",style:{width:"100%",backgroundColor:"transparent",border:"0px"},onClick:()=>this.loadMedicalCertificate()},"Medical Leave Certificate"))),i.a.createElement(g.a,{span:18},i.a.createElement(y.a,{gutter:16},this.state.files.map(t=>i.a.createElement(i.a.Fragment,null,t.newDate?i.a.createElement(g.a,{span:24},i.a.createElement(Lt.a,{top:20,offsetTop:30},i.a.createElement("h2",{style:{marginLeft:"10px",padding:"5px",backgroundImage:"linear-gradient(to right, #ddd , white)",borderRadius:"4px"}},x()(t.created_at).format("LL")))):null,i.a.createElement(g.a,{span:8},i.a.createElement("div",{style:{width:"100%",height:"150px",border:"1px solid #bbb",backgroundSize:"cover",padding:"auto",overflow:"hidden"}},i.a.createElement(ve.a,{key:t.id,disabled:t.practice!=this.props.active_practiceId,style:{margin:10,position:"absolute",top:5,left:5,boxShadow:"0 0px 5px #000 "},onChange:a=>e.filesCompleteToggle(t.id,a.target.checked),checked:e.state.selectedFiles[t.id]}),Object(N.b)(t.file_type)==W.Kb?i.a.createElement("div",{style:{textAlign:"center",paddingTop:30,height:"100%"},onClick:()=>this.togglePDFModal(t)},i.a.createElement(E.a,{type:"file-pdf",style:{fontSize:"56px",color:"#08c"}}),i.a.createElement("h4",null,"Preview Not Avaialable")):i.a.createElement(Zt.a,{style:{border:"3px solid red"},large:Object(N.h)(t.file_type),small:Object(N.h)(t.file_type),alt:i.a.createElement(o.a,{type:"danger",onClick:()=>this.deleteFile(t)},i.a.createElement(E.a,{type:"delete"}))})),i.a.createElement(u.a,{bodyStyle:{padding:3},style:{marginBottom:15}},i.a.createElement(d.b,{to:"/patient/".concat(t.patient_data.id,"/emr/files/")},i.a.createElement("h4",null,i.a.createElement("b",null,t.patient_data.user.first_name," (",t.patient_data.custom_id,")"))),i.a.createElement(O.a,null,i.a.createElement("b",null,t.practice_data?t.practice_data.name:"--"))))))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:24},i.a.createElement(L.a,{loaderFunction:()=>this.loadData(e.state.loadMoreFiles),loading:this.state.loading,hidden:!this.state.loadMoreFiles}))),i.a.createElement(u.a,{title:"Medical Certificate"},i.a.createElement(re.a,{loading:this.state.loading,grid:{gutter:16,column:3},dataSource:this.state.medicalCertificate,renderItem:e=>i.a.createElement(u.a,{style:{width:600},actions:[i.a.createElement("p",null,"Issued on : ".concat(e.date)),i.a.createElement("a",{onClick:()=>this.loadPDF(e.id)},i.a.createElement(E.a,{type:"printer"})),i.a.createElement(k.a,{title:"Are you sure delete this item?",onConfirm:()=>this.deleteMedicalCertificate(e),okText:"Yes",cancelText:"No"},i.a.createElement(E.a,{type:"delete"}))]},i.a.createElement(Qt.a,{title:"".concat("Medical Leave #").concat(e.id),description:"Excused From :".concat(e.excused_duty_from," till ").concat(e.excused_duty_to)}))}),i.a.createElement(L.a,{loaderFunction:()=>this.loadData(e.state.loadMoreCertificate),loading:this.state.loading,hidden:!this.state.loadMoreCertificate})))),i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send Timeline To ",zt.get(this.props.currentPatient,"user.first_name")," ?"),i.a.createElement(S.a,{value:this.state.mail_to,placeholder:"Email",onChange:t=>e.updateFormValue("mail_to",t.target.value)})),i.a.createElement(C.a,{visible:this.state.showAddModal,onCancel:()=>this.triggerAddModal(!1),footer:null},i.a.createElement(t,{title:"Add Files",fields:a,defaultValues:l,formProp:n})),i.a.createElement(C.a,{visible:this.state.showPDFFile,key:this.state.showPDFFile,centered:!0,width:1e3,onCancel:()=>this.togglePDFModal(!1),footer:null,style:{padding:0},title:i.a.createElement("h4",null,i.a.createElement("span",{style:{color:"red",textAlign:"right"},onClick:()=>this.deleteFile(this.state.showPDFFile)},"DELETE"))},this.state.showPDFFile?i.a.createElement("iframe",{src:Object(N.h)(this.state.showPDFFile.file_type),frameBorder:"0",style:{width:"100%",minHeight:"80vh"}}):null))}}var ta=ea;i.a.Component;var aa=a(1565);function na(){return(na=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function ia(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ra(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ia(Object(a),!0).forEach((function(t){la(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ia(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function la(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const sa=aa.a.TabPane,oa=["Complaints","Observations","Diagnoses","Investigations","Notes","Recent Medication"],ca={Complaints:V.wb,Observations:V.Bb,Diagnoses:V.xb,Investigations:V.zb,Notes:V.Db,"Recent Medication":V.Ab};let da=0;class pa extends i.a.Component{constructor(e){super(e),la(this,"setInitialData",()=>{const e=this,t=this.state.editClinicNotes;t.chief_complaints&&t.chief_complaints.split(W.C).forEach(t=>setTimeout((function(){t.length&&e.addValues("Complaints",t)}),500)),t.investigations&&t.investigations.split(W.C).forEach(t=>setTimeout((function(){t.length&&e.addValues("Investigations",t)}),500)),t.diagnosis&&t.diagnosis.split(W.C).forEach(t=>setTimeout((function(){t.length&&e.addValues("Diagnoses",t)}),500)),t.notes&&t.notes.split(W.C).forEach(t=>setTimeout((function(){t.length&&e.addValues("Notes",t)}),500)),t.observations&&t.observations.split(W.C).forEach(t=>setTimeout((function(){t.length&&e.addValues("Observations",t)}),500)),t.medication&&t.medication.split(W.C).forEach(t=>setTimeout((function(){t.length&&e.addValues("Recent Medication",t)}),500))}),la(this,"loadRequiredResources",(e,t)=>{const a=this;Object(N.c)(e,(function(e){a.setState((function(a){const n=ra(ra({},a.resourceList),{},{[t]:e});return{resourceList:n,filteredResourceList:n,filterStrings:{}}}))}),(function(){console.log("".concat(t," fetching error"))}))}),la(this,"add",e=>{const t=this.props.form,a=t.getFieldValue(e).concat(++da);t.setFieldsValue({[e]:a})}),la(this,"remove",(e,t)=>{const a=this.props.form,n=a.getFieldValue(e);1!==n.length&&a.setFieldsValue({[e]:n.filter(e=>e!==t)})}),la(this,"addValues",(e,t)=>{const a=this.props.form,n=a.getFieldValue(e),i=n.concat(++da);a.setFieldsValue({[e]:i,["field[".concat(n[n.length-1],"]")]:t})}),la(this,"changeValues",(e,t)=>{const a=this.props.form.getFieldValue(e);a.indexOf(t)==a.length-1&&this.add(e)}),la(this,"toggleModal",e=>{let t=null;const a=this;this.setState((function(a){return console.log(a.resourceAddModal),a.resourceAddModal&&(t=a.resourceAddModal),{resourceAddModal:e}}),(function(){t&&a.loadRequiredResources(Object(N.g)(ca[t],[a.props.active_practiceId]),t)}))}),la(this,"searchValues",(e,t)=>{const a=this;this.setState((function(a){const n=ra({},a.searchStrings);return n[e]=t,{searchStrings:n}}),(function(){a.filterValues(e)}))}),la(this,"filterValues",e=>{this.setState((function(t){let a=[];return t.resourceList[e]&&(t.searchStrings[e]?t.resourceList[e].forEach((function(n){n.name&&n.name.toString().toLowerCase().includes(t.searchStrings[e].toLowerCase())&&a.push(n)})):a=t.resourceList[e]),{filteredResourceList:ra(ra({},t.filteredResourceList),{},{[e]:a})}}))}),la(this,"handleSubmit",e=>{const t=this;e.preventDefault(),this.props.form.validateFieldsAndScroll((e,a)=>{if(!e){const e={};e.chief_complaints=a.Complaints.map(e=>a.field[e]).join(W.C),e.investigations=a.Investigations.map(e=>a.field[e]).join(W.C),e.diagnosis=a.Diagnoses.map(e=>a.field[e]).join(W.C),e.notes=a.Notes.map(e=>a.field[e]).join(W.C),e.observations=a.Observations.map(e=>a.field[e]).join(W.C),e.medication=a["Recent Medication"].map(e=>a.field[e]).join(W.C),e.patient=t.props.match.params.id,e.practice=t.props.active_practiceId,e.doctor=t.state.selectedDoctor&&t.state.selectedDoctor.id?t.state.selectedDoctor.id:t.state.selectedDoctor,e.date=t.state.selectedDate&&x()(t.state.selectedDate).isValid()?x()(t.state.selectedDate).format("YYYY-MM-DD"):null,t.state.editClinicNotes&&(e.id=t.state.editClinicNotes.id);const n=function(e){t.props.loadData&&t.props.loadData(),t.props.history&&t.props.history.replace("/patient/".concat(t.props.match.params.id,"/emr/clinicnotes/"))},i=function(){};Object(N.k)(Object(N.g)(V.jd,[this.props.match.params.id]),e,n,i)}})}),la(this,"changeTab",(e,t)=>{}),la(this,"selectDoctor",e=>{this.setState({selectedDoctor:e})}),la(this,"selectedDate",e=>{this.setState({selectedDate:e})}),this.state={resourceList:{},filteredResourceList:{},filterStrings:{},practiceDoctors:[],selectedDoctor:{},selectedDate:x()(),resourceAddModal:null,selectedTab:"Complaints",editClinicNotes:this.props.editClinicNotes?this.props.editClinicNotes:null}}componentDidMount(){Object(le.e)(this),this.loadRequiredResources(Object(N.g)(V.wb,[this.props.active_practiceId]),"Complaints"),this.loadRequiredResources(Object(N.g)(V.Bb,[this.props.active_practiceId]),"Observations"),this.loadRequiredResources(Object(N.g)(V.xb,[this.props.active_practiceId]),"Diagnoses"),this.loadRequiredResources(Object(N.g)(V.zb,[this.props.active_practiceId]),"Investigations"),this.loadRequiredResources(Object(N.g)(V.Db,[this.props.active_practiceId]),"Notes"),this.loadRequiredResources(Object(N.g)(V.Ab,[this.props.active_practiceId]),"Recent Medication"),this.state.editClinicNotes&&this.setInitialData()}render(){const e=this,t=this.props.form,a=t.getFieldDecorator,n=t.getFieldValue,r={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}},l={};oa.forEach((function(e){a(e,{initialValue:[++da]}),l[e]=n(e)}));const s=l,c=m.a.create()(z.a);return i.a.createElement(u.a,null,i.a.createElement(y.a,null,i.a.createElement(g.a,{span:18},i.a.createElement("h2",null,"Clinical Notes"),i.a.createElement(m.a,{onSubmit:this.handleSubmit},oa.map(t=>i.a.createElement("div",null,i.a.createElement(P.a,{style:{margin:5}},t),i.a.createElement("div",{style:{backgroundColor:t==e.state.selectedTab?"#ddd":"initial",padding:10}},s[t].map((n,l)=>i.a.createElement(m.a.Item,na({},r,{label:"".concat(t," ").concat(l+1),key:n}),a("field[".concat(n,"]"),{validateTrigger:["onChange","onBlur"],rules:[{whitespace:!0}]})(i.a.createElement(S.a,{placeholder:t,style:{width:"60%",marginRight:8},key:n,onFocus:a=>e.changeTab(a,t),onChange:()=>e.changeValues(t,n)})),s[t].length-1!=l?i.a.createElement(o.a,{shape:"circle",type:"danger",size:"small",icon:"delete",onClick:()=>this.remove(t,n)}):null))))),i.a.createElement(Lt.a,{offsetBottom:0},i.a.createElement(u.a,null,i.a.createElement(y.a,null,i.a.createElement("span",null,"by   "),i.a.createElement(_.a,{placement:"topCenter",overlay:i.a.createElement(h.a,null,this.state.practiceDoctors.map(e=>i.a.createElement(h.a.Item,{key:"0"},i.a.createElement("a",{onClick:()=>this.selectDoctor(e)},e.user.first_name)))),trigger:["click"]},i.a.createElement("a",{className:"ant-dropdown-link",href:"#"},i.a.createElement("b",null,this.state.selectedDoctor.user?this.state.selectedDoctor.user.first_name:"No DOCTORS Found"))),i.a.createElement("span",null,"   on  "),i.a.createElement(D.a,{value:this.state.selectedDate,allowClear:!1,onChange:e=>this.selectedDate(e),format:"DD-MM-YYYY"}),i.a.createElement(o.a,{type:"primary",htmlType:"submit",style:{float:"right",margin:5}},"Save"),e.props.history?i.a.createElement(o.a,{style:{margin:5,float:"right"},onClick:()=>e.props.history.goBack()},"Cancel"):null),i.a.createElement(y.a,null,"Next Follow up"))))),i.a.createElement(g.a,{span:6},i.a.createElement(aa.a,{type:"card"},oa.map(t=>i.a.createElement(sa,{tab:t,key:t},i.a.createElement("div",{style:{padding:5}},i.a.createElement(o.a,{type:"primary",block:!0,size:"small",onClick:()=>e.toggleModal(t)},i.a.createElement(E.a,{type:"plus"}),"Add ",t),i.a.createElement("div",{style:{backgroundColor:"#ddd",padding:8}},i.a.createElement(S.a.Search,{placeholder:"Search in ".concat(t," ..."),onChange:e=>this.searchValues(t,e.target.value)})),i.a.createElement(re.a,{key:t,size:"small",dataSource:e.state.filteredResourceList[t],renderItem:e=>i.a.createElement(re.a.Item,{key:e.id,onClick:()=>this.addValues(t,e.name)},e.name)})))))),i.a.createElement(C.a,{visible:!!this.state.resourceAddModal,onCancel:()=>e.toggleModal(null),title:"Add ".concat(this.state.resourceAddModal),footer:null},this.state.resourceAddModal?i.a.createElement(c,{fields:[{label:this.state.resourceAddModal,required:!0,type:B.db,key:"name"}],defaultValues:[{key:"practice",value:this.props.active_practiceId}],formProp:{method:"post",action:Object(N.g)(ca[this.state.resourceAddModal],[this.props.active_practiceId]),successFn(){e.toggleModal(null),Object(N.a)(B.sc,"".concat(e.state.resourceAddModal," added successfully!!"))},errorFn(e){console.log(e)}}}):null)))}}var ma=m.a.create()(pa);function ua(){return(ua=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function ha(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const fa=C.a.confirm;class ya extends i.a.Component{constructor(e){super(e),ha(this,"updateFormValue",(e,t)=>{this.setState({[e]:t})}),ha(this,"mailModalOpen",()=>{this.setState({visibleMail:!0})}),ha(this,"mailModalClose",()=>{this.setState({visibleMail:!1})}),ha(this,"sendPatientMail",e=>{this.mailModalOpen(),this.setState({patientName:zt.get(e,"patient.user.first_name"),clinicId:zt.get(e,"id"),mail_to:zt.get(e,"patient.user.email")})}),ha(this,"sendMailToPatient",()=>{const e=this.state,t=e.mail_to,a=e.clinicId,n={mail_to:t};Object(le.i)(Object(N.g)(V.ab,[a]),n),this.mailModalClose()}),this.state={currentPatient:this.props.currentPatient,active_practiceId:this.props.active_practiceId,clinicNotes:[],editClinicNotes:null,loading:!0,mail_to:null},this.loadClinicNotes=this.loadClinicNotes.bind(this),this.editClinicNotesData=this.editClinicNotesData.bind(this)}componentDidMount(){this.loadClinicNotes()}loadClinicNotes(e=1){const t=this,a={page:e,practice:this.props.active_practiceId};this.props.match.params.id&&(a.patient=this.props.match.params.id),this.props.showAllClinic&&this.props.match.params.id&&delete a.practice,Object(N.c)(V.jd,(function(e){t.setState((function(t){return 1==e.current?{clinicNotes:[...e.results],next:e.next,loading:!1}:{clinicNotes:[...t.clinicNotes,...e.results],next:e.next,loading:!1}}))}),(function(){t.setState({loading:!1})}),a)}editClinicNotesData(e){this.setState({editClinicNotes:e,loading:!1});const t=this.props.match.params.id;this.props.history.push("/patient/".concat(t,"/emr/clinicnotes/edit"))}deleteClinicNote(e){const t=this;fa({title:"Are you sure to delete this item?",okText:"Yes",okType:"danger",cancelText:"No",onOk(){const a={id:e.id,patient:e.patient,is_active:!1};Object(N.k)(Object(N.g)(V.jd,[t.props.match.params.id]),a,(function(e){t.loadClinicNotes()}),(function(){}))},onCancel(){console.log("Cancel")}})}loadPDF(e){Object(N.c)(Object(N.g)(V.ab,[e]),(function(e){e.report&&window.open(Oe.a+e.report)}),(function(){}))}render(){const e=this;return this.props.match.params.id?i.a.createElement("div",null,i.a.createElement(c.d,null,i.a.createElement(c.b,{exact:!0,path:"/patient/:id/emr/clinicnotes/add",render:e=>i.a.createElement(ma,ua({},e,this.props,{loadData:this.loadClinicNotes}))}),i.a.createElement(c.b,{exact:!0,path:"/patient/:id/emr/clinicnotes/edit",render:t=>this.state.editClinicNotes?i.a.createElement(ma,ua({},this.state,t,{loadData:this.loadClinicNotes})):i.a.createElement(c.a,{to:"/patient/".concat(e.props.match.params.id,"/emr/clinicnotes/")})}),i.a.createElement(c.b,null,i.a.createElement("div",null,i.a.createElement(u.a,{bodyStyle:{padding:0},title:this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," ClinicNotes"):"ClinicNotes",extra:i.a.createElement(o.a.Group,null,i.a.createElement(d.b,{to:"/patient/".concat(this.props.match.params.id,"/emr/clinicnotes/add")},i.a.createElement(o.a,{type:"primary"},i.a.createElement(E.a,{type:"plus"}),"Add")))}),this.state.clinicNotes.map(t=>i.a.createElement(u.a,{style:{marginTop:20},title:i.a.createElement("small",null,t.date?x()(t.date).format("ll"):null),extra:i.a.createElement(_.a.Button,{size:"small",style:{float:"right"},overlay:i.a.createElement(h.a,null,i.a.createElement(h.a.Item,{key:"1",onClick:()=>e.editClinicNotesData(t),disabled:t.practice&&t.practice.id!=this.props.active_practiceId},i.a.createElement(E.a,{type:"edit"}),"Edit"),i.a.createElement(h.a.Item,{key:"2",onClick:()=>e.deleteClinicNote(t),disabled:t.practice&&t.practice.id!=this.props.active_practiceId},i.a.createElement(E.a,{type:"delete"}),"Delete"),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"3"},i.a.createElement(d.b,{to:"/patient/".concat(t.patient,"/emr/timeline")},i.a.createElement(E.a,{type:"clock-circle"}),"  Patient Timeline")),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"4"},i.a.createElement("a",{onClick:()=>this.sendPatientMail(t)},i.a.createElement(E.a,{type:"mail"})," Send mail to patient")))},i.a.createElement("a",{onClick:()=>this.loadPDF(t.id)},i.a.createElement(E.a,{type:"printer"})))},i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send Clinical Notes To ",zt.get(t,"patient.user.first_name")," ?"),i.a.createElement(S.a,{value:this.state.mail_to,placeholder:"Email",onChange:t=>e.updateFormValue("mail_to",t.target.value)})),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement("h3",null,"Complaints")),i.a.createElement(g.a,{span:18,style:{borderLeft:"1px solid #ccc",padding:4}},i.a.createElement("div",{style:{minHeight:30}},t.chief_complaints?t.chief_complaints.split(W.C).map((e,t)=>i.a.createElement("span",null,t?i.a.createElement("br",null):null,e)):null),i.a.createElement(P.a,{style:{margin:0}}))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement("h3",null,"Observations")),i.a.createElement(g.a,{span:18,style:{borderLeft:"1px solid #ccc",padding:4}},i.a.createElement("div",{style:{minHeight:30}},t.observations?t.observations.split(W.C).map((e,t)=>i.a.createElement("span",null,t?i.a.createElement("br",null):null,e)):null),i.a.createElement(P.a,{style:{margin:0}}))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement("h3",null,"Investigations")),i.a.createElement(g.a,{span:18,style:{borderLeft:"1px solid #ccc",padding:4}},i.a.createElement("div",{style:{minHeight:30}},t.investigations?t.investigations.split(W.C).map((e,t)=>i.a.createElement("span",null,t?i.a.createElement("br",null):null,e)):null),i.a.createElement(P.a,{style:{margin:0}}))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement("h3",null,"Diagnoses")),i.a.createElement(g.a,{span:18,style:{borderLeft:"1px solid #ccc",padding:4}},i.a.createElement("div",{style:{minHeight:30}},t.diagnosis?t.diagnosis.split(W.C).map((e,t)=>i.a.createElement("span",null,t?i.a.createElement("br",null):null,e)):null),i.a.createElement(P.a,{style:{margin:0}}))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement("h3",null,"Notes")),i.a.createElement(g.a,{span:18,style:{borderLeft:"1px solid #ccc",padding:4}},i.a.createElement("div",{style:{minHeight:30}},t.notes?t.notes.split(W.C).map((e,t)=>i.a.createElement("span",null,t?i.a.createElement("br",null):null,e)):null),i.a.createElement(P.a,{style:{margin:0}}))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement("h3",null,"Recent Medications")),i.a.createElement(g.a,{span:18,style:{borderLeft:"1px solid #ccc",padding:4}},i.a.createElement("div",{style:{minHeight:30}},t.medication?t.medication.split(W.C).map((e,t)=>i.a.createElement("span",null,t?i.a.createElement("br",null):null,e)):null),i.a.createElement(P.a,{style:{margin:0}}))),i.a.createElement("div",null,t.doctor?i.a.createElement(O.a,{color:t.doctor?t.doctor.calendar_colour:null},i.a.createElement("b",null,"prescribed by  ".concat(t.doctor.user.first_name)," ")):null,t.practice?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,t.practice.name," "))):null))),i.a.createElement(l.a,{spinning:this.state.loading},i.a.createElement(y.a,null)),i.a.createElement(L.a,{loaderFunction:()=>this.loadClinicNotes(e.state.next),loading:this.state.loading,hidden:!this.state.next}))))):i.a.createElement("div",null,i.a.createElement(u.a,{bodyStyle:{padding:0},title:this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," Clinic Notes"):"Clinic Notes",extra:i.a.createElement(o.a.Group,null,i.a.createElement(o.a,{type:"primary",onClick:()=>this.props.togglePatientListModal(!0)},i.a.createElement(E.a,{type:"plus"}),"Add"))}),this.state.clinicNotes.map(t=>i.a.createElement(u.a,{style:{marginTop:10},key:t.id,extra:i.a.createElement(_.a.Button,{size:"small",overlay:i.a.createElement(h.a,null,i.a.createElement(h.a.Item,{key:"1",onClick:()=>e.editClinicNotesData(t),disabled:t.practice&&t.practice.id!=this.props.active_practiceId},i.a.createElement(E.a,{type:"edit"}),"Edit"),i.a.createElement(h.a.Item,{key:"2",onClick:()=>e.deleteClinicNote(t),disabled:t.practice&&t.practice.id!=this.props.active_practiceId},i.a.createElement(E.a,{type:"delete"}),"Delete"),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"3"},i.a.createElement(d.b,{to:"/patient/".concat(t.patient,"/emr/timeline")},i.a.createElement(E.a,{type:"clock-circle"}),"  Patient Timeline")),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"4"},i.a.createElement("a",{onClick:()=>this.sendPatientMail(t)},i.a.createElement(E.a,{type:"mail"})," Send mail to patient")))},i.a.createElement("a",{onClick:()=>this.loadPDF(t.id)},i.a.createElement(E.a,{type:"printer"}))),title:i.a.createElement("div",null,i.a.createElement("small",null,t.date?x()(t.date).format("ll"):null,i.a.createElement(d.b,{to:"/patient/".concat(t.patient.id,"/emr/clinicnotes")},"   ",t.patient.user?t.patient.user.first_name:null," (ID: ",t.patient.custom_id?t.patient.custom_id:t.patient.id,") "),i.a.createElement("span",null,", ",t.patient.gender)))},i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement("h3",null,"Complaints")),i.a.createElement(g.a,{span:18,style:{borderLeft:"1px solid #ccc",padding:4}},i.a.createElement("div",{style:{minHeight:30}},t.chief_complaints?t.chief_complaints.split(W.C).map((e,t)=>i.a.createElement("span",{key:e},t?i.a.createElement("br",null):null,e)):null),i.a.createElement(P.a,{style:{margin:0}}))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement("h3",null,"Observations")),i.a.createElement(g.a,{span:18,style:{borderLeft:"1px solid #ccc",padding:4}},i.a.createElement("div",{style:{minHeight:30}},t.observations?t.observations.split(W.C).map((e,t)=>i.a.createElement("span",{key:e},t?i.a.createElement("br",null):null,e)):null),i.a.createElement(P.a,{style:{margin:0}}))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement("h3",null,"Investigations")),i.a.createElement(g.a,{span:18,style:{borderLeft:"1px solid #ccc",padding:4}},i.a.createElement("div",{style:{minHeight:30}},t.investigations?t.investigations.split(W.C).map((e,t)=>i.a.createElement("span",{key:e},t?i.a.createElement("br",null):null,e)):null),i.a.createElement(P.a,{style:{margin:0}}))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement("h3",null,"Diagnoses")),i.a.createElement(g.a,{span:18,style:{borderLeft:"1px solid #ccc",padding:4}},i.a.createElement("div",{style:{minHeight:30}},t.diagnosis?t.diagnosis.split(W.C).map((e,t)=>i.a.createElement("span",{key:e},t?i.a.createElement("br",null):null,e)):null),i.a.createElement(P.a,{style:{margin:0}}))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement("h3",null,"Notes")),i.a.createElement(g.a,{span:18,style:{borderLeft:"1px solid #ccc",padding:4}},i.a.createElement("div",{style:{minHeight:30}},t.notes?t.notes.split(W.C).map((e,t)=>i.a.createElement("span",{key:e},t?i.a.createElement("br",null):null,e)):null),i.a.createElement(P.a,{style:{margin:0}}))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement("h3",null,"Recent Medications")),i.a.createElement(g.a,{span:18,style:{borderLeft:"1px solid #ccc",padding:4}},i.a.createElement("div",{style:{minHeight:30}},t.medication?t.medication.split(W.C).map((e,t)=>i.a.createElement("span",null,t?i.a.createElement("br",null):null,e)):null),i.a.createElement(P.a,{style:{margin:0}}))),i.a.createElement("div",null,t.doctor?i.a.createElement(O.a,{color:t.doctor?t.doctor.calendar_colour:null},i.a.createElement("b",null,"prescribed by  ".concat(t.doctor.user.first_name)," ")):null,t.practice?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,t.practice.name," "))):null))),i.a.createElement(l.a,{spinning:this.state.loading},i.a.createElement(y.a,null)),i.a.createElement(L.a,{loaderFunction:()=>this.loadClinicNotes(e.state.next),loading:this.state.loading,hidden:!this.state.next}),i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send Clinical Notes To ",e.state.patientName," ?"),i.a.createElement(S.a,{value:this.state.mail_to,placeholder:"Email",onChange:t=>e.updateFormValue("mail_to",t.target.value)})))}}var ga=ya,ba=a(1556);const Ea=r.a.Header;class va extends i.a.Component{constructor(e){super(e),this.state={}}componentDidMount(){const e=this;e.props.refreshWallet&&e.props.refreshWallet()}render(){const e=this;return(i.a.createElement(Ea,{className:"header",style:{background:"#e4e4e4",padding:"0px 20px"}},i.a.createElement("div",null,this.props.currentPatient?i.a.createElement("div",{style:{display:"inline"}},i.a.createElement("div",{style:{display:"inline",textSize:"15px"}},i.a.createElement(Bt.a,{title:"Switch Back to All Patients"},i.a.createElement(o.a,{onClick:()=>this.props.setCurrentPatient(null),type:"primary",ghost:!0},i.a.createElement(E.a,{type:"arrow-left"})))),i.a.createElement("a",{style:{padding:"8px",fontSize:"15px"},onClick:()=>this.props.togglePatientListModal(!0)},this.props.currentPatient.image?i.a.createElement(b.a,{src:Object(N.h)(this.props.currentPatient.image)}):i.a.createElement(b.a,{style:{backgroundColor:"#87d068"}},this.props.currentPatient.user.first_name?this.props.currentPatient.user.first_name.charAt(0):i.a.createElement(E.a,{type:"user"})),"  ",e.props.currentPatient.is_dead?"(Late) ":null,e.props.currentPatient.user.first_name.length<16?e.props.currentPatient.user.first_name:"".concat(e.props.currentPatient.user.first_name.slice(0,12),"..."),i.a.createElement("small",null,i.a.createElement("i",null,i.a.createElement("b",null," [ID: ",e.props.currentPatient.custom_id?e.props.currentPatient.custom_id:e.props.currentPatient.id,"]")))),this.props.MedicalMembership?i.a.createElement(Te.a,{placement:"rightTop",title:"Patient Membership",content:i.a.createElement("div",null,i.a.createElement("p",null,i.a.createElement("strong",null,"Membership : "),i.a.createElement("span",null,this.props.MedicalMembership.medical_membership?this.props.MedicalMembership.medical_membership.name:null)),i.a.createElement("p",null,i.a.createElement("strong",null,"Membership Code : "),i.a.createElement("span",null,this.props.MedicalMembership.membership_code)),i.a.createElement("p",null,i.a.createElement("strong",null,"Start Date : "),i.a.createElement("span",null,this.props.MedicalMembership.medical_from)),i.a.createElement("p",null,i.a.createElement("strong",null,"Valid Till : "),i.a.createElement("span",null,this.props.MedicalMembership.medical_to)))},i.a.createElement("div",{style:{display:"inline",maxWidth:50,fontSize:30,lineHeight:"40px"}},i.a.createElement(E.a,{type:"crown",theme:"twoTone",twoToneColor:"#FFBA3A"}))):null,i.a.createElement(Te.a,{placement:"topLeft",title:"Medical History",content:i.a.createElement("div",{style:{width:250}},e.props.currentPatient.medical_history_data?e.props.currentPatient.medical_history_data.map((e,t)=>i.a.createElement(O.a,{color:"#".concat(Object(le.b)(Object(le.a)(e.name)))},e.name)):null)},e.props.currentPatient.medical_history_data?e.props.currentPatient.medical_history_data.map((t,a)=>a>0?1==a&&i.a.createElement(O.a,null,"+",e.props.currentPatient.medical_history_data.length-1):i.a.createElement(O.a,{color:"#".concat(Object(le.b)(Object(le.a)(t.name)))},t.name)):null),i.a.createElement(ba.a,{style:{marginLeft:20},checked:this.props.showAllClinic,onChange:e=>this.props.toggleShowAllClinic(e),checkedChildren:"All Clinics",unCheckedChildren:"Current Clinic"}),this.props.pendingAmount?i.a.createElement(i.a.Fragment,null,i.a.createElement(o.a,{style:{marginLeft:"20px"},type:"primary",size:"small"},i.a.createElement(d.b,{to:"/patient/".concat(this.props.currentPatient.id,"/billing/payments/add")},"Pay!")),i.a.createElement(Te.a,{placement:"rightTop",content:i.a.createElement(re.a,{size:"small",dataSource:this.props.pendingAmount.practice_data,renderItem:e=>i.a.createElement(re.a.Item,null,i.a.createElement(re.a.Item.Meta,{title:e.name,description:"Rs. ".concat(e.total<0?"".concat(-1*e.total," (Advance)"):e.total)}))}),title:"Pending Payments"},i.a.createElement("div",{style:{display:"inline",float:"left",maxWidth:200,position:"absolute",margin:"5px 15px",zIndex:5}},i.a.createElement(v.a,{title:"Amount Due",value:this.props.pendingAmount.grand_total,valueStyle:{color:this.props.pendingAmount.grand_total>0?"#cf1322":"initial",fontWeight:500,fontSize:20},precision:2})))):null,this.props.walletAmount&&this.props.walletAmount.length?i.a.createElement(Te.a,{placement:"rightTop",title:"Agent Wallet Amount",content:i.a.createElement("p",null,"Non-Refundable : ",this.props.walletAmount[0].non_refundable)},i.a.createElement("div",{style:{display:"inline",float:"left",maxWidth:400,position:"absolute",paddingLeft:150,margin:"20px 15px"}},i.a.createElement(v.a,{tile:"wallet",value:this.props.walletAmount[0].refundable_amount+this.props.walletAmount[0].non_refundable,precision:2,valueStyle:{fontSize:20},prefix:i.a.createElement(E.a,{type:"wallet",twoToneColor:"#a2711c"})}))):null):i.a.createElement("div",{style:{display:"inline"}},i.a.createElement("a",{style:{padding:"8px",fontSize:"20px"},onClick:()=>this.props.togglePatientListModal(!0)},i.a.createElement("div",{style:{display:"inline"}},i.a.createElement(E.a,{type:"solution"}),"   All Patient")),this.props.activePracticePermissions.ViewAllClinics?i.a.createElement(ba.a,{style:{marginLeft:20},checked:this.props.showAllClinic,onChange:e=>this.props.toggleShowAllClinic(e),checkedChildren:"All Clinics",unCheckedChildren:"Current Clinic"}):null),i.a.createElement(_.a,{overlay:le.h},i.a.createElement(o.a,{style:{float:"right",margin:"15px"}},i.a.createElement(E.a,{type:"setting"})," Settings ",i.a.createElement(E.a,{type:"down"}))),e.props.activePracticePermissions.AddPatient||e.props.allowAllPermissions?i.a.createElement(d.b,{to:"/patients/profile/add"},i.a.createElement(o.a,{type:"primary",style:{float:"right",margin:"15px"}},i.a.createElement(E.a,{type:"plus"})," Add Patient")):null),i.a.createElement(C.a,{width:1300,maskClosable:!1,centered:!0,footer:null,closable:!1,visible:this.props.listModalVisible,style:{height:"calc(100vh - 120px)"}},i.a.createElement(o.a,{icon:"close",type:"danger",shape:"circle",style:{position:"absolute",top:"-50px",right:0},onClick:()=>this.props.togglePatientListModal(!1)}),i.a.createElement(te,this.props))))}}var _a=va;function Pa(){return(Pa=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function ka(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Oa(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ka(Object(a),!0).forEach((function(t){Ca(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ka(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ca(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Sa extends i.a.Component{constructor(e){super(e),Ca(this,"onChanged",(e,t)=>{this.setState({[e]:t})}),Ca(this,"handleSubmit",e=>{const t=this;e.preventDefault(),this.props.form.validateFields((e,a)=>{if(!e){const e=Oa(Oa({},a),{},{medicine_till:x()(a.medicine_till).format("YYYY-MM-DD"),follow_up_date:x()(a.follow_up_date).format("YYYY-MM-DD")});t.setState({saving:!0});const n=function(e){Object(N.a)(B.sc,"Communication Settings Saved Successfully!!"),t.setState({saving:!1})},i=function(){t.setState({saving:!1})};Object(N.m)(Object(N.g)(V.td,[this.props.currentPatient.id]),e,n,i)}})}),this.state={parient_communication_history:null,patientProfile:null,saving:!1},this.loadCommunication=this.loadCommunication.bind(this),this.loadProfile=this.loadProfile.bind(this)}componentDidMount(){this.props.currentPatient&&(this.loadCommunication(),this.loadProfile())}loadProfile(){const e=this;Object(N.c)(Object(N.g)(V.td,[e.props.match.params.id]),(function(t){e.setState({patientProfile:t,loading:!1})}),(function(){e.setState({loading:!1})}))}loadCommunication(){const e=this;Object(N.c)(Object(N.g)(V.kd,[this.props.currentPatient.user.id]),(function(t){e.setState({parient_communication_history:t.user_sms,loading:!1})}),(function(){e.setState({loading:!1})}))}changeRedirect(){const e=this.state.redirect;this.setState({redirect:!e})}render(){const e=this.props.form.getFieldDecorator,t={labelCol:{xs:{span:8},sm:{span:8},md:{span:8},lg:{span:8}},wrapperCol:{xs:{span:16},sm:{span:16},md:{span:16},lg:{span:16}}},a=[{title:"SENT TIME",dataIndex:"created_at",key:"created_at",render:e=>i.a.createElement("span",null,x()(e).format("LLL"))},{title:"MESSAGE",dataIndex:"body",key:"body"},{title:"TYPE",dataIndex:"sms_type",key:"sms_type"},{title:"MESSAGE STATUS",dataIndex:"status",key:"status"}],n=W.Ub.map(e=>i.a.createElement(j.a,{value:e.value},e.title)),r=W.Q.map(e=>i.a.createElement(j.a,{value:e.value},e.title)),l=W.p.map(e=>i.a.createElement(j.a,{value:e.value},e.title));return i.a.createElement(m.a,{onSubmit:this.handleSubmit},i.a.createElement(u.a,{title:this.props.currentPatient?"".concat(this.props.currentPatient.user.first_name," Communication"):"Patient Communication",extra:i.a.createElement(o.a,{type:"primary",htmlType:"submit",loading:this.state.saving},i.a.createElement(E.a,{type:"save"})," Save Communication Setting")},i.a.createElement(m.a.Item,Pa({},t,{key:"sms_enable"})," ",i.a.createElement("label",null,i.a.createElement("span",{className:"ant-form-text"},"Enable SMS the patient : "),e("sms_enable",{initialValue:!!this.state.patientProfile&&this.state.patientProfile.sms_enable})(i.a.createElement(j.a.Group,{onChange:e=>this.onChanged("sms_enable",e.target.value)},n)))),i.a.createElement(m.a.Item,Pa({},t,{key:"email_enable"})," ",i.a.createElement("label",null," ",i.a.createElement("span",{className:"ant-form-text"},"Enable Email the patient :"),e("email_enable",{initialValue:!!this.state.patientProfile&&this.state.patientProfile.email_enable})(i.a.createElement(j.a.Group,{onChange:e=>this.onChanged("email_enable",e.target.value)},r)))),i.a.createElement(m.a.Item,Pa({},t,{key:"birthday_sms_email"})," ",i.a.createElement("label",null," ",i.a.createElement("span",{className:"ant-form-text"}," Send Birthday wish SMS & Email :"),e("birthday_sms_email",{initialValue:!!this.state.patientProfile&&this.state.patientProfile.birthday_sms_email})(i.a.createElement(j.a.Group,{onChange:e=>this.onChanged("birthday_sms_email",e.target.value)},l)))),i.a.createElement(m.a.Item,Pa({},t,{key:"medicine_from"})," ",i.a.createElement("label",null,i.a.createElement("span",{className:"ant-form-text"}," Medicine From :"),e("medicine_from",{initialValue:this.state.patientProfile&&this.state.patientProfile.medicine_from?x()(this.state.patientProfile.medicine_from):null})(i.a.createElement(D.a,{allowClear:!1,format:"DD-MM-YYYY"})))),i.a.createElement(m.a.Item,Pa({},t,{key:"medicine_till"})," ",i.a.createElement("label",null,i.a.createElement("span",{className:"ant-form-text"}," Medicine Till Date :"),e("medicine_till",{initialValue:this.state.patientProfile&&this.state.patientProfile.medicine_till?x()(this.state.patientProfile.medicine_till):null})(i.a.createElement(D.a,{allowClear:!1,format:"DD-MM-YYYY"})))),i.a.createElement(m.a.Item,Pa({},t,{key:"medicine_till"})," ",i.a.createElement("label",null,i.a.createElement("span",{className:"ant-form-text"}," Next follow-up To :"),e("follow_up_date",{initialValue:this.state.patientProfile&&this.state.patientProfile.follow_up_date?x()(this.state.patientProfile.follow_up_date):null})(i.a.createElement(D.a,{allowClear:!1,format:"DD-MM-YYYY"})))),i.a.createElement("div",null,i.a.createElement(P.a,{dashed:!0}),i.a.createElement("h2",null,"Past Communication"),i.a.createElement(R.a,{loading:this.state.loading,columns:a,dataSource:this.state.parient_communication_history}))))}}var Ia=m.a.create()(Sa);function xa(){return(xa=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}class Da extends i.a.Component{constructor(e){super(e),this.state={}}render(){return i.a.createElement(i.a.Fragment,null,i.a.createElement(Ia,xa({},this.state,this.props)),this.props.currentPatient?i.a.createElement(u.a,null,i.a.createElement(ye,xa({},this.props,{patientId:this.props.currentPatient.id}))," "):null)}}var ja=Da,wa=a(447);class Ma extends i.a.Component{constructor(e){super(e),this.state={redirect:!1,vitalSign:null,editVitalSign:this.props.editVitalSign?this.props.editVitalSign:null},this.changeRedirect=this.changeRedirect.bind(this)}changeRedirect(){const e=this.state.redirect;this.setState({redirect:!e})}render(){const e=[{label:"Pulse",key:"pulse",initialValue:this.props.editVitalSign?this.props.editVitalSign.pulse:null,type:B.Bb,follow:"BPM"},{label:"Temperature",key:"temperature",initialValue:this.props.editVitalSign?this.props.editVitalSign.temperature:null,type:B.Bb,follow:"Fahrenheit"},{label:"Temperature Part",key:"temperature_part",type:B.mc,initialValue:this.props.editVitalSign?this.props.editVitalSign.temperature_part:null,options:[{label:"forehead",value:"forehead"},{label:"armpit",value:"armpit"},{label:"oral ",value:"oral"}]},{label:"Blood Pressure Up",key:"blood_pressure_up",initialValue:this.props.editVitalSign?this.props.editVitalSign.blood_pressure_up:null,type:B.Bb,follow:"mmhg"},{label:"Blood Pressure Down",key:"blood_pressure_down",initialValue:this.props.editVitalSign?this.props.editVitalSign.blood_pressure_down:null,type:B.Bb,follow:"mmhg"},{label:"Position",key:"position",type:B.mc,initialValue:this.props.editVitalSign?this.props.editVitalSign.position:null,options:[{label:"standing",value:"standing"},{label:"sitting",value:"sitting"}]},{label:"Weight",key:"weight",initialValue:this.props.editVitalSign?this.props.editVitalSign.weight:null,type:B.Bb,follow:"kg."},{label:"Resp Rate",key:"resp_rate",initialValue:this.props.editVitalSign?this.props.editVitalSign.resp_rate:null,type:B.Bb,follow:"breaths/min"},{label:"Creatinine Level",key:"creatinine",initialValue:this.props.editVitalSign?this.props.editVitalSign.creatinine:null,type:B.Bb},{label:"Haemoglobin Level",key:"haemoglobin",initialValue:this.props.editVitalSign?this.props.editVitalSign.haemoglobin:null,type:B.Bb},{label:"Urea Level",key:"urea",initialValue:this.props.editVitalSign?this.props.editVitalSign.urea:null,type:B.Bb},{label:"Uric Acid Level",key:"uric_acid",initialValue:this.props.editVitalSign?this.props.editVitalSign.uric_acid:null,type:B.Bb},{label:"Remarks",key:"remarks",initialValue:this.props.editVitalSign?this.props.editVitalSign.remarks:null,type:B.vc},{label:"Date",key:"date",initialValue:this.props.editVitalSign&&this.props.editVitalSign.date?this.props.editVitalSign.date:x()(),type:B.N,required:!0}];let t;const a=[{key:"patient",value:this.props.match.params.id},{key:"practice",value:this.props.active_practiceId}],n=this,r=m.a.create()(z.a);this.state.editVitalSign&&(t={successFn(e){Object(N.a)(B.sc,"success"),n.props.loadData&&n.props.loadData(),n.props.history&&n.props.history.replace("/patient/".concat(n.props.match.params.id,"/emr/vitalsigns"))},errorFn(){},action:Object(N.g)(V.pf,[this.props.match.params.id]),method:"post"},a.push({key:"id",value:this.state.editVitalSign.id}));const l={successFn(e){Object(N.a)(B.sc,"success"),n.props.loadData&&n.props.loadData(),n.props.history&&n.props.history.replace("/patient/".concat(n.props.match.params.id,"/emr/vitalsigns"))},errorFn(){},action:Object(N.g)(V.pf,[this.props.match.params.id]),method:"post"};return(i.a.createElement(y.a,null,i.a.createElement(u.a,null,i.a.createElement(c.b,{exact:!0,path:"/patient/:id/emr/vitalsigns/edit",render:()=>this.state.editVitalSign?i.a.createElement(r,{defaultValues:a,title:"Edit Report Manual",changeRedirect:this.changeRedirect,formProp:t,fields:e}):i.a.createElement(c.a,{to:"/patients/profile"})}),i.a.createElement(c.b,{exact:!0,path:"/patient/:id/emr/vitalsigns/add",render:()=>i.a.createElement(r,{title:"Add Report Manual",defaultValues:a,changeRedirect:this.changeRedirect,formProp:l,fields:e})})),this.state.redirect&&i.a.createElement(c.a,{to:"/patient/".concat(this.props.match.params.id,"/emr/vitalsigns")})))}}var Ta=Ma;function Fa(){return(Fa=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Aa(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Na(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Aa(Object(a),!0).forEach((function(t){Va(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Aa(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Va(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const La=C.a.confirm;class Ra extends i.a.Component{constructor(e){super(e),Va(this,"deleteVitalSign",e=>{const t=this;La({title:"Are you sure to delete this item?",okText:"Yes",okType:"danger",cancelText:"No",onOk(){const a=Na(Na({},e),{},{is_active:!1});Object(N.k)(Object(N.g)(V.pf,[e.patient]),a,(function(e){t.loadVitalsigns(),Object(N.a)(B.sc,"Deleted Successfully!!")}),(function(){}))},onCancel(){console.log("Cancel")}})}),Va(this,"editObject",e=>{if(this.setState({editVitalSign:e,loading:!1}),this.props.match.params.id){const e=this.props.match.params.id;this.props.history.push("/patient/".concat(e,"/emr/vitalsigns/edit"))}else this.props.history.push("/patient/".concat(e.patient,"/emr/vitalsigns"))}),Va(this,"updateFormValue",(e,t)=>{this.setState({[e]:t})}),Va(this,"mailModalOpen",()=>{this.setState({visibleMail:!0})}),Va(this,"mailModalClose",()=>{this.setState({visibleMail:!1})}),Va(this,"sendPatientMail",e=>{this.mailModalOpen(),this.setState({patientName:zt.get(e,"patient_data.user.first_name"),reportManualId:zt.get(e,"id"),mail_to:zt.get(e,"patient_data.user.email")})}),Va(this,"sendMailToPatient",()=>{const e=this.state,t=e.mail_to,a=e.reportManualId,n={mail_to:t};Object(le.i)(Object(N.g)(V.qf,[a]),n),this.mailModalClose()}),this.state={currentPatient:this.props.currentPatient,vitalsign:[],loading:!0},this.loadVitalsigns=this.loadVitalsigns.bind(this)}componentDidMount(){this.loadVitalsigns()}loadVitalsigns(e=1){const t=this,a={page:e,practice:this.props.active_practiceId};this.props.match.params.id&&(a.patient=this.props.match.params.id),this.props.showAllClinic&&this.props.match.params.id&&delete a.practice,Object(N.c)(V.pf,(function(e){t.setState((function(t){return 1==e.current?{vitalsign:[...e.results],next:e.next,loading:!1}:{vitalsign:[...t.vitalsign,...e.results],next:e.next,loading:!1}}))}),(function(){}),a)}loadPDF(e){Object(N.c)(Object(N.g)(V.qf,[e]),(function(e){e.report&&window.open(Oe.a+e.report)}),(function(){}))}render(){const e=this,t=(this.state.vitalsign,[{title:"Date",dataIndex:"date",key:"date",render:(e,t)=>i.a.createElement("span",null,t.date?x()(t.date).format("LL"):"")},{title:"Temp(F)",key:"temperature",render:(e,t)=>i.a.createElement("span",null," ",t.temperature,i.a.createElement("br",null),",",t.temperature_part)},{title:"Pulse (BPM)",dataIndex:"pulse",key:"pulse"},{title:"RR breaths/min",dataIndex:"resp_rate",key:"resp_rate"},{title:"SYS/DIA mmhg",key:"address",render:(e,t)=>i.a.createElement("span",null," ",t.blood_pressure_up,"/",t.blood_pressure_down,i.a.createElement("br",null),",",t.position)},{title:"WEIGHT kg",dataIndex:"weight",key:"weight"},{title:"Creatinine Level",key:"creatinine",dataIndex:"creatinine"},{title:"Haemoglobin Level",key:"haemoglobin",dataIndex:"haemoglobin"},{title:"Urea Level",key:"urea",dataIndex:"urea"},{title:"Uric Acid Level",key:"uric_acid",dataIndex:"uric_acid"},{title:"Remarks",key:"remarks",dataIndex:"remarks"},{title:"Action",key:"action",render:(t,a)=>i.a.createElement("span",null,i.a.createElement("a",{onClick:()=>this.loadPDF(a.id)},"Print"),i.a.createElement(P.a,{type:"vertical"}),i.a.createElement("a",{onClick:()=>this.editObject(a),disabled:a.practice!=e.props.active_practiceId},"Edit"),i.a.createElement(P.a,{type:"vertical"}),i.a.createElement("a",{onClick:()=>e.deleteVitalSign(a),disabled:a.practice!=e.props.active_practiceId},"Delete"),i.a.createElement(P.a,{type:"vertical"}),i.a.createElement("a",{onClick:()=>e.sendPatientMail(a)},"Send to patient"))}]);return this.props.match.params.id?i.a.createElement(c.d,null,i.a.createElement(c.b,{path:"/patient/:id/emr/vitalsigns/add",render:e=>i.a.createElement(Ta,Fa({},this.props,{key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,e,{loadData:this.loadVitalsigns}))}),i.a.createElement(c.b,{path:"/patient/:id/emr/vitalsigns/edit",render:e=>i.a.createElement(Ta,Fa({},this.props,{key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,e,{loadData:this.loadVitalsigns}))}),i.a.createElement(c.b,null,i.a.createElement(u.a,{title:this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," Report Manual"):"Patient Report Manual",extra:i.a.createElement(o.a.Group,null,i.a.createElement(d.b,{to:"/patient/".concat(this.props.match.params.id,"/emr/vitalsigns/add")},i.a.createElement(o.a,{type:"primary"},i.a.createElement(E.a,{type:"plus"}),"Add")))},i.a.createElement(aa.a,null,i.a.createElement(aa.a.TabPane,{tab:"Charts",key:1,style:{margin:"auto"}},i.a.createElement(P.a,null,"Pulse Chart (bpm)"),i.a.createElement("div",{style:{height:200}},i.a.createElement(wa.k,null,i.a.createElement(wa.d,{width:700,height:200,data:this.state.vitalsign.reverse(),margin:{top:10,right:30,left:0,bottom:0}},i.a.createElement(wa.n,{dataKey:"date",tickFormatter:e=>x()(e).format("LL"),tickCount:e.state.vitalsign.length}),i.a.createElement(wa.o,{domain:[e=>Math.abs(e),e=>(1.1*e).toFixed(0)]}),i.a.createElement(wa.b,{strokeDasharray:"3 3"}),i.a.createElement(wa.m,{labelFormatter:e=>e&&x()(e).isValid()?x()(e).format("LL"):"--"}),i.a.createElement(wa.g,{type:"monotone",dataKey:"pulse",stroke:"#8884d8",fillOpacity:1,strokeWidth:4,fill:"url(#colorUv)"})))),i.a.createElement(P.a,null,"Temperature (F)"),i.a.createElement("div",{style:{height:200}},i.a.createElement(wa.k,null,i.a.createElement(wa.d,{width:700,height:200,data:this.state.vitalsign.reverse(),margin:{top:10,right:30,left:0,bottom:0}},i.a.createElement(wa.f,{verticalAlign:"top",height:36}),i.a.createElement("defs",null,i.a.createElement("linearGradient",{id:"colorUv",x1:"0",y1:"0",x2:"0",y2:"1"},i.a.createElement("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),i.a.createElement("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0}))),i.a.createElement(wa.n,{dataKey:"date",tickFormatter:e=>x()(e).format("LL"),tickCount:this.state.vitalsign.length}),i.a.createElement(wa.o,{domain:[e=>Math.abs(e),e=>(1.1*e).toFixed(0)]}),i.a.createElement(wa.b,{strokeDasharray:"3 3"}),i.a.createElement(wa.m,{labelFormatter:e=>e&&x()(e).isValid()?x()(e).format("LL"):"--"}),i.a.createElement(wa.g,{type:"monotone",dataKey:"temperature",stroke:"#82ca9d",fillOpacity:1,strokeWidth:4,fill:"url(#colorUv)"})))),i.a.createElement(P.a,null,"Blood Pressure (mmhg)"),i.a.createElement("div",{style:{height:200}},i.a.createElement(wa.k,null,i.a.createElement(wa.d,{width:700,height:200,data:this.state.vitalsign.reverse(),margin:{top:10,right:30,left:0,bottom:0}},i.a.createElement("defs",null,i.a.createElement("linearGradient",{id:"colorUv",x1:"0",y1:"0",x2:"0",y2:"1"},i.a.createElement("stop",{offset:"5%",stopColor:"#ffc658",stopOpacity:.8}),i.a.createElement("stop",{offset:"95%",stopColor:"#ffc658",stopOpacity:0}))),i.a.createElement(wa.n,{dataKey:"date",tickFormatter:e=>x()(e).format("LL"),tickCount:this.state.vitalsign.length}),i.a.createElement(wa.o,{domain:[e=>Math.abs(e),e=>(1.1*e).toFixed(0)]}),i.a.createElement(wa.b,{strokeDasharray:"3 3"}),i.a.createElement(wa.m,{labelFormatter:e=>e&&x()(e).isValid()?x()(e).format("LL"):"--"}),i.a.createElement(wa.g,{type:"monotone",dataKey:"blood_pressure_up",stroke:"#ffc658",fillOpacity:1,strokeWidth:4,fill:"url(#colorUv)"}),i.a.createElement(wa.g,{type:"monotone",dataKey:"blood_pressure_down",stroke:"#82ca9d",fillOpacity:1,strokeWidth:4,fill:"url(#colorUv)"})))),i.a.createElement(P.a,null,"Weight (kg)"),i.a.createElement("div",{style:{height:200}},i.a.createElement(wa.k,null,i.a.createElement(wa.d,{width:700,height:200,data:this.state.vitalsign.reverse(),margin:{top:10,right:30,left:0,bottom:0}},i.a.createElement("defs",null,i.a.createElement("linearGradient",{id:"colorUv",x1:"0",y1:"0",x2:"0",y2:"1"},i.a.createElement("stop",{offset:"5%",stopColor:"#8884d8",stopOpacity:.8}),i.a.createElement("stop",{offset:"95%",stopColor:"#8884d8",stopOpacity:0})),i.a.createElement("linearGradient",{id:"colorPv",x1:"0",y1:"0",x2:"0",y2:"1"},i.a.createElement("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),i.a.createElement("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0}))),i.a.createElement(wa.n,{dataKey:"date",tickFormatter:e=>x()(e).format("LL"),tickCount:this.state.vitalsign.length}),i.a.createElement(wa.o,{domain:[e=>Math.abs(e),e=>(1.1*e).toFixed(0)]}),i.a.createElement(wa.b,{strokeDasharray:"3 3"}),i.a.createElement(wa.m,{labelFormatter:e=>e&&x()(e).isValid()?x()(e).format("LL"):"--"}),i.a.createElement(wa.g,{type:"monotone",dataKey:"weight",stroke:"#8884d8",fillOpacity:1,strokeWidth:4,fill:"url(#colorUv)"})))),i.a.createElement(P.a,null,"Respiratory Rate (breaths/min)"),i.a.createElement("div",{style:{height:200}},i.a.createElement(wa.k,null,i.a.createElement(wa.d,{width:700,height:200,data:this.state.vitalsign.reverse(),margin:{top:10,right:30,left:0,bottom:0}},i.a.createElement("defs",null,i.a.createElement("linearGradient",{id:"colorUv",x1:"0",y1:"0",x2:"0",y2:"1"},i.a.createElement("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),i.a.createElement("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0})),i.a.createElement("linearGradient",{id:"colorPv",x1:"0",y1:"0",x2:"0",y2:"1"},i.a.createElement("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),i.a.createElement("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0}))),i.a.createElement(wa.n,{dataKey:"date",tickFormatter:e=>x()(e).format("LL"),tickCount:this.state.vitalsign.length}),i.a.createElement(wa.o,{domain:[e=>Math.abs(e),e=>(1.1*e).toFixed(0)]}),i.a.createElement(wa.b,{strokeDasharray:"3 3"}),i.a.createElement(wa.m,{labelFormatter:e=>e&&x()(e).isValid()?x()(e).format("LL"):"--"}),i.a.createElement(wa.g,{type:"monotone",dataKey:"resp_rate",stroke:"#82ca9d",fillOpacity:1,strokeWidth:4,fill:"url(#colorUv)"})))),i.a.createElement(P.a,null,"Creatinine Level"),i.a.createElement("div",{style:{height:200}},i.a.createElement(wa.k,null,i.a.createElement(wa.d,{width:700,height:200,data:this.state.vitalsign.reverse(),margin:{top:10,right:30,left:0,bottom:0}},i.a.createElement("defs",null,i.a.createElement("linearGradient",{id:"colorUv",x1:"0",y1:"0",x2:"0",y2:"1"},i.a.createElement("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),i.a.createElement("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0})),i.a.createElement("linearGradient",{id:"colorPv",x1:"0",y1:"0",x2:"0",y2:"1"},i.a.createElement("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),i.a.createElement("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0}))),i.a.createElement(wa.n,{dataKey:"date",tickFormatter:e=>x()(e).format("LL"),tickCount:this.state.vitalsign.length}),i.a.createElement(wa.o,{domain:[e=>Math.abs(e),e=>(1.1*e).toFixed(0)]}),i.a.createElement(wa.b,{strokeDasharray:"3 3"}),i.a.createElement(wa.m,{labelFormatter:e=>e&&x()(e).isValid()?x()(e).format("LL"):"--"}),i.a.createElement(wa.g,{type:"monotone",dataKey:"creatinine",stroke:"#82ca9d",fillOpacity:1,strokeWidth:4,fill:"url(#colorUv)"})))),i.a.createElement(P.a,null,"Haemoglobin Level"),i.a.createElement("div",{style:{height:200}},i.a.createElement(wa.k,null,i.a.createElement(wa.d,{width:700,height:200,data:this.state.vitalsign.reverse(),margin:{top:10,right:30,left:0,bottom:0}},i.a.createElement("defs",null,i.a.createElement("linearGradient",{id:"colorUv",x1:"0",y1:"0",x2:"0",y2:"1"},i.a.createElement("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),i.a.createElement("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0})),i.a.createElement("linearGradient",{id:"colorPv",x1:"0",y1:"0",x2:"0",y2:"1"},i.a.createElement("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),i.a.createElement("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0}))),i.a.createElement(wa.n,{dataKey:"date",tickFormatter:e=>x()(e).format("LL"),tickCount:this.state.vitalsign.length}),i.a.createElement(wa.o,{domain:[e=>Math.abs(e),e=>(1.1*e).toFixed(0)]}),i.a.createElement(wa.b,{strokeDasharray:"3 3"}),i.a.createElement(wa.m,{labelFormatter:e=>e&&x()(e).isValid()?x()(e).format("LL"):"--"}),i.a.createElement(wa.g,{type:"monotone",dataKey:"haemoglobin",stroke:"#82ca9d",fillOpacity:1,strokeWidth:4,fill:"url(#colorUv)"})))),i.a.createElement(P.a,null,"Urea Level"),i.a.createElement("div",{style:{height:200}},i.a.createElement(wa.k,null,i.a.createElement(wa.d,{width:700,height:200,data:this.state.vitalsign.reverse(),margin:{top:10,right:30,left:0,bottom:0}},i.a.createElement("defs",null,i.a.createElement("linearGradient",{id:"colorUv",x1:"0",y1:"0",x2:"0",y2:"1"},i.a.createElement("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),i.a.createElement("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0})),i.a.createElement("linearGradient",{id:"colorPv",x1:"0",y1:"0",x2:"0",y2:"1"},i.a.createElement("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),i.a.createElement("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0}))),i.a.createElement(wa.n,{dataKey:"date",tickFormatter:e=>x()(e).format("LL"),tickCount:this.state.vitalsign.length}),i.a.createElement(wa.o,{domain:[e=>Math.abs(e),e=>(1.1*e).toFixed(0)]}),i.a.createElement(wa.b,{strokeDasharray:"3 3"}),i.a.createElement(wa.m,{labelFormatter:e=>e&&x()(e).isValid()?x()(e).format("LL"):"--"}),i.a.createElement(wa.g,{type:"monotone",dataKey:"urea",stroke:"#82ca9d",fillOpacity:1,strokeWidth:4,fill:"url(#colorUv)"})))),i.a.createElement(P.a,null,"Uric Acid Level"),i.a.createElement("div",{style:{height:200}},i.a.createElement(wa.k,null,i.a.createElement(wa.d,{width:700,height:200,data:this.state.vitalsign.reverse(),margin:{top:10,right:30,left:0,bottom:0}},i.a.createElement("defs",null,i.a.createElement("linearGradient",{id:"colorUv",x1:"0",y1:"0",x2:"0",y2:"1"},i.a.createElement("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),i.a.createElement("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0})),i.a.createElement("linearGradient",{id:"colorPv",x1:"0",y1:"0",x2:"0",y2:"1"},i.a.createElement("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),i.a.createElement("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0}))),i.a.createElement(wa.n,{dataKey:"date",tickFormatter:e=>x()(e).format("LL"),tickCount:this.state.vitalsign.length}),i.a.createElement(wa.o,{domain:[e=>Math.abs(e),e=>(1.1*e).toFixed(0)]}),i.a.createElement(wa.b,{strokeDasharray:"3 3"}),i.a.createElement(wa.m,{labelFormatter:e=>e&&x()(e).isValid()?x()(e).format("LL"):"--"}),i.a.createElement(wa.g,{type:"monotone",dataKey:"uric_acid",stroke:"#82ca9d",fillOpacity:1,strokeWidth:4,fill:"url(#colorUv)"}))))),i.a.createElement(aa.a.TabPane,{tab:"Details",key:2},i.a.createElement(R.a,{columns:t,pagination:!1,dataSource:this.state.vitalsign}),i.a.createElement(L.a,{loaderFunction:()=>this.loadInvoices(e.state.next),loading:this.state.loading,hidden:!this.state.next}),i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send Report Manual To ",this.state.patientName," ?"),i.a.createElement(S.a,{value:this.state.mail_to,placeholder:"Email",onChange:t=>e.updateFormValue("mail_to",t.target.value)}))))))):i.a.createElement("div",null,i.a.createElement(u.a,{bodyStyle:{padding:0},title:this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," Report Manual"):"Patients Report Manual",extra:i.a.createElement(o.a.Group,null,i.a.createElement(o.a,{type:"primary",onClick:()=>e.props.togglePatientListModal(!0)},i.a.createElement(E.a,{type:"plus"}),"Add"))}),this.state.vitalsign.map(e=>i.a.createElement("div",null,i.a.createElement(u.a,{style:{marginTop:10},title:i.a.createElement("small",null,e.date?x()(e.date).format("ll"):null,i.a.createElement(d.b,{to:"/patient/".concat(e.patient_data.id,"/emr/vitalsigns")},"   ",e.patient_data.user?e.patient_data.user.first_name:null," (ID: ",e.patient_data.custom_id?e.patient_data.custom_id:e.patient_data.id,") "),i.a.createElement("span",null,", ",e.patient_data.gender)),bodyStyle:{padding:0}},i.a.createElement(Ge.a,{columns:t,pagination:!1,dataSource:[e],footer:()=>function(e){if(e)return console.log(e),i.a.createElement("div",null,e.doctor?i.a.createElement(O.a,{color:e.doctor?e.doctor.calendar_colour:null},i.a.createElement("b",null,"prescribed by  ".concat(e.doctor.user.first_name)," ")):null,e.practice_data?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,e.practice_data.name," "))):null);return null}(e)})))),i.a.createElement(L.a,{loaderFunction:()=>this.loadVitalsigns(e.state.next),loading:this.state.loading,hidden:!this.state.next}),i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send Report Manual  To ",this.state.patientName," ?"),i.a.createElement(S.a,{value:this.state.mail_to,placeholder:"Email",onChange:t=>e.updateFormValue("mail_to",t.target.value)})))}}var Ba=Ra;function za(){return(za=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Ya(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function qa(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ya(Object(a),!0).forEach((function(t){Wa(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ya(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Wa(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Ga extends i.a.Component{constructor(e){super(e),Wa(this,"calculateItem",e=>{this.props.form.getFieldsValue;this.setState((function(e){[...e.tableFormValues].forEach((function(e){}))}))}),Wa(this,"addNotes",(e,t)=>{this.setState((function(a){return{addNotes:qa(qa({},a.addNotes),{},{[e]:!!t})}}))}),Wa(this,"removeTreatment",e=>{this.setState((function(t){return{tableFormValues:[...Object(zt.remove)(t.tableFormValues,(function(t){return t._id!=e}))]}}))}),Wa(this,"add",e=>{const t=this;this.setState((function(t){const a=Math.random().toFixed(7);return{addNotes:qa(qa({},t.addNotes),{},{[a]:!!e.default_notes}),tableFormValues:[qa(qa({},e),{},{_id:a,children:void 0}),...t.tableFormValues]}}),(function(){e.children.length&&e.children.forEach((function(e){t.add(e)}))}))}),Wa(this,"selectDoctor",e=>{this.setState({selectedDoctor:e})}),Wa(this,"selectedDate",e=>{this.setState({selectedDate:e})}),Wa(this,"handleSubmit",e=>{const t=this;e.preventDefault(),this.props.form.validateFields((e,a)=>{if(!e){const e={treatment_plans:[],patient:t.props.match.params.id,doctor:t.state.selectedDoctor.id,date:t.state.selectedDate&&x()(t.state.selectedDate).isValid()?t.state.selectedDate.format("YYYY-MM-DD"):null,practice:t.props.active_practiceId};t.props.editId&&(e.id=t.props.editTreatmentPlan.id),t.state.tableFormValues.forEach((function(t){t.quantity=a.quantity[t._id],t.cost=a.cost[t._id],t.discount=a.discount[t._id],a.notes&&(t.notes=a.notes[t._id]);const n={procedure:t.id,cost:t.cost,quantity:t.quantity,margin:t.margin,default_notes:t.notes,is_active:!0,is_completed:!0,discount:t.discount,discount_type:"%"};e.treatment_plans.push(n)}));const n=function(e){Object(N.a)("Inventory updated successfully"),t.props.loadData&&t.props.loadData();const a="/patient/".concat(t.props.match.params.id,"/emr/workdone");t.props.history.replace(a)},i=function(){};Object(N.k)(Object(N.g)(V.ff,[t.props.match.params.id]),e,n,i)}})}),Wa(this,"searchValues",e=>{const t=this;return this.setState((function(t){return{searchString:e}}),(function(){t.loadProcedures()})),!1}),this.state={loadingProcedures:!0,procedure_category:[],tableFormValues:[],addNotes:{},practiceDoctors:[],selectedDoctor:{},selectedDate:x()()}}componentDidMount(){this.props.editId&&this.setState((function(e){const t=[];return this.props.editTreatmentPlan.treatment_plans.forEach((function(e){const a=Math.random().toFixed(7);t.push(qa(qa(qa({},e),e.procedure),{},{_id:a}))})),qa(qa({},this.props.editTreatmentPlan),{},{tableFormValues:t,selectedDate:x()(this.props.editTreatmentPlan.date),selectedDoctor:this.props.editTreatmentPlan.doctor})})),this.loadProcedures(),Object(le.e)(this)}loadProcedures(){const e=this,t={};this.state.searchString&&(t.name=this.state.searchString),e.setState({loadingProcedures:!0});Object(N.c)(Object(N.g)(V.Kd,[this.props.active_practiceId]),(function(a){t.name&&e.state.searchString!=t.name||e.setState({loadingProcedures:!1,filteredItems:a.results})}),(function(){e.setState({loadingProcedures:!1})}),t)}render(){const e=this,t=this.props.form,a=t.getFieldDecorator,n=(t.getFieldValue,t.getFieldsValue,{labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}}),r=[{title:"Treatments",dataIndex:"name",key:"name",render:(e,t)=>i.a.createElement("span",null,i.a.createElement("b",null,e),i.a.createElement("br",null),this.state.addNotes[t._id]||this.props.editId?i.a.createElement(m.a.Item,za({key:"default_notes[".concat(t._id,"]")},n),a("notes[".concat(t._id,"]"),{validateTrigger:["onChange","onBlur"],rules:[{message:"This field is required."}],initialValue:t.default_notes})(i.a.createElement(S.a.TextArea,{min:0,placeholder:"Notes..."}))):i.a.createElement("a",{onClick:()=>this.addNotes(t._id,!0)},"+ Add Note"))},{title:"Quantity",dataIndex:"quantity",key:"quantity",render:(e,t)=>i.a.createElement(m.a.Item,za({key:"quantity[".concat(t._id,"]")},n),a("quantity[".concat(t._id,"]"),{validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"This field is required."}],initialValue:t.quantity})(i.a.createElement(w.a,{min:0,placeholder:"Quantity",size:"small",onChange:()=>this.calculateItem(t._id)})))},{title:"Cost",dataIndex:"cost",key:"cost",render:(e,t)=>i.a.createElement(m.a.Item,za({key:"cost[".concat(t._id,"]")},n),a("cost[".concat(t._id,"]"),{validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"This field is required."}],initialValue:t.cost})(i.a.createElement(w.a,{min:0,placeholder:"Cost",size:"small",onChange:()=>this.calculateItem(t._id)})))},{title:"Discount",dataIndex:"discount",key:"discount",render:(e,t)=>i.a.createElement(m.a.Item,za({key:"discount[".concat(t._id,"]")},n),a("discount[".concat(t._id,"]"),{validateTrigger:["onChange","onBlur"],rules:[{message:"This field is required."}]})(i.a.createElement(w.a,{min:0,placeholder:"Discount",size:"small",onChange:()=>this.calculateItem(t._id)}))," %")},{title:"Total",dataIndex:"total",key:"total",render:(e,t)=>i.a.createElement("span",null,e,i.a.createElement(o.a,{icon:"close",onClick:()=>this.removeTreatment(t._id),type:"danger",shape:"circle",size:"small"}))}];return i.a.createElement("div",null,i.a.createElement(u.a,{title:"Completed Procedures"},i.a.createElement(y.a,null,i.a.createElement(g.a,{span:17},i.a.createElement(m.a,{onSubmit:this.handleSubmit},i.a.createElement(Ge.a,{pagination:!1,bordered:!0,dataSource:this.state.tableFormValues,columns:r}),i.a.createElement(Lt.a,{offsetBottom:0},i.a.createElement(u.a,null,i.a.createElement("span",null,"by   "),i.a.createElement(_.a,{placement:"topCenter",overlay:i.a.createElement(h.a,null,this.state.practiceDoctors.map(e=>i.a.createElement(h.a.Item,{key:"0"},i.a.createElement("a",{onClick:()=>this.selectDoctor(e)},e.user.first_name)))),trigger:["click"]},i.a.createElement("a",{className:"ant-dropdown-link",href:"#"},i.a.createElement("b",null,this.state.selectedDoctor.user?this.state.selectedDoctor.user.first_name:"No DOCTORS Found"))),i.a.createElement("span",null,"   on  "),i.a.createElement(D.a,{value:this.state.selectedDate,onChange:e=>this.selectedDate(e),format:"DD-MM-YYYY",allowClear:!1}),i.a.createElement(m.a.Item,za({},{labelCol:{xs:{span:24},sm:{span:24}},wrapperCol:{xs:{span:24},sm:{span:24}}},{style:{marginBottom:0,float:"right"}}),i.a.createElement(o.a,{type:"primary",htmlType:"submit",style:{margin:5}},"Save Treatment Plan"),e.props.history?i.a.createElement(o.a,{style:{margin:5,float:"right"},onClick:()=>e.props.history.goBack()},"Cancel"):null))),i.a.createElement("div",{ref:t=>{e.bottomPoint=t}}))),i.a.createElement(g.a,{span:7},i.a.createElement(Lt.a,{offsetTop:0},i.a.createElement("div",{style:{backgroundColor:"#ddd",padding:8}},i.a.createElement(S.a.Search,{placeholder:"Search in plans ...",onChange:e=>this.searchValues(e.target.value)})),i.a.createElement(re.a,{size:"small",loading:this.state.loadingProcedures,style:{maxHeight:"100vh",overflowX:"scroll"},itemLayout:"horizontal",dataSource:this.state.filteredItems,renderItem:e=>i.a.createElement(re.a.Item,{onClick:()=>this.add(e)},i.a.createElement(re.a.Item.Meta,{title:e.name}))}))))))}}var Ha=m.a.create()(Ga);function Ua(){return(Ua=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Ka(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Qa=C.a.confirm;class Za extends i.a.Component{constructor(e){super(e),Ka(this,"updateFormValue",(e,t)=>{this.setState({[e]:t})}),Ka(this,"mailModalOpen",()=>{this.setState({visibleMail:!0})}),Ka(this,"mailModalClose",()=>{this.setState({visibleMail:!1})}),Ka(this,"sendPatientMail",e=>{this.mailModalOpen(),this.setState({patientName:zt.get(e,"patient.user.first_name"),treatmentId:zt.get(e,"id"),mail_to:zt.get(e,"patient.user.email")})}),Ka(this,"sendMailToPatient",()=>{const e=this.state,t=e.mail_to,a=e.treatmentId,n={mail_to:t};Object(le.i)(Object(N.g)(V.hf,[a]),n),this.mailModalClose()}),this.state={currentPatient:this.props.currentPatient,active_practiceId:this.props.active_practiceId,treatmentPlans:[],procedure_category:null,completedTreatmentPlans:[],incompletedTreatmentPlans:[],productMargin:[],loading:!0},this.loadTreatmentPlans=this.loadTreatmentPlans.bind(this),this.editTreatmentPlanData=this.editTreatmentPlanData.bind(this)}componentDidMount(){this.loadTreatmentPlans(),this.loadProductMargin()}loadProductMargin(){const e=this;Object(N.c)(V.Md,(function(t){e.setState({productMargin:t,loading:!1})}),(function(){e.setState({loading:!1})}))}loadTreatmentPlans(e=1){const t=[],a=this,n={page:e,practice:this.props.active_practiceId,complete:!0};this.props.match.params.id&&(n.patient=this.props.match.params.id),this.props.showAllClinic&&this.props.match.params.id&&delete n.practice,Object(N.c)(V.ff,(function(e){a.setState((function(t){return 1==e.current?{treatmentPlans:[...e.results],next:e.next,loading:!1}:{treatmentPlans:[...t.treatmentPlans,...e.results],next:e.next,loading:!1}})),e.results.forEach((function(e){e.is_completed||t.push(e)})),a.setState((function(e){return{incompletedTreatmentPlans:[...e.incompletedTreatmentPlans,...t],loading:!1}}))}),(function(){a.setState({loading:!1})}),n)}editTreatmentPlanData(e){this.setState({editTreatmentPlan:e});const t=this.props.match.params.id;this.props.history.push("/patient/".concat(t,"/emr/workdone/edit"))}deleteTreatmentPlans(e){const t=this;Qa({title:"Are you sure to delete this item?",okText:"Yes",okType:"danger",cancelText:"No",onOk(){const a={id:e.id,patient:e.patient.id,is_active:!1};Object(N.k)(Object(N.g)(V.ff,[t.props.match.params.id],null),a,(function(e){Object(N.a)(B.sc,"Completed Procedure Deleted Successfully!"),t.loadTreatmentPlans()}),(function(){}))},onCancel(){console.log("Cancel")}})}loadPDF(e){Object(N.c)(Object(N.g)(V.hf,[e]),(function(e){e.report&&window.open(Oe.a+e.report)}),(function(){}))}render(){const e=this,t=[{title:"",key:"is_completed",render:(e,t)=>t.is_completed?i.a.createElement(E.a,{type:"check-circle",theme:"twoTone",style:{marginLeft:"8px",fontSize:"20px"}}):null},{title:"Procedure",key:"procedure.name",dataIndex:"procedure.name"},{title:"Quantity",dataIndex:"quantity",initialValue:this.state.editFields?this.state.editFields.quantity:null,key:"quantity"},{title:"Discount",dataIndex:"discount",key:"discount"},{title:"Cost per  Unit",dataIndex:"cost",key:"cost"},{title:"Notes",dataIndex:"default_notes",key:"default_notes"}];return this.props.match.params.id?i.a.createElement("div",null,i.a.createElement(c.d,null,i.a.createElement(c.b,{exact:!0,path:"/patient/:id/emr/workdone/add",render:t=>i.a.createElement(Ha,Ua({},this.state,e.props,t,{loadData:this.loadTreatmentPlans}))}),i.a.createElement(c.b,{exact:!0,path:"/patient/:id/emr/workdone/edit",render:t=>this.state.editTreatmentPlan?i.a.createElement(Ha,Ua({},this.state,t,e.props,{editId:this.state.editTreatmentPlan.id,loadData:this.loadTreatmentPlans})):i.a.createElement(c.a,{to:"/patient/".concat(this.props.match.params.id,"/emr/workdone")})}),i.a.createElement(c.b,null,i.a.createElement("div",null,i.a.createElement(u.a,{bodyStyle:{padding:0},title:this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," Completed Procedures"):"Completed Procedures ",extra:i.a.createElement(o.a.Group,null,i.a.createElement(d.b,{to:"/patient/".concat(this.props.match.params.id,"/emr/workdone/add")},i.a.createElement(o.a,null,i.a.createElement(E.a,{type:"plus"}),"Add")))}),this.state.treatmentPlans.map(a=>i.a.createElement(u.a,{bodyStyle:{padding:0},style:{marginTop:15}},i.a.createElement("div",{style:{padding:16}},i.a.createElement("h4",null,a.date?x()(a.date).format("ll"):null,i.a.createElement(_.a.Button,{size:"small",style:{float:"right"},overlay:i.a.createElement(h.a,null,i.a.createElement(h.a.Item,{key:"1",onClick:()=>e.editTreatmentPlanData(a),disabled:a.practice&&a.practice.id!=this.props.active_practiceId},i.a.createElement(E.a,{type:"edit"}),"Edit"),i.a.createElement(h.a.Item,{key:"2",onClick:()=>e.deleteTreatmentPlans(a),disabled:a.practice&&a.practice.id!=this.props.active_practiceId},i.a.createElement(E.a,{type:"delete"}),"Delete"),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"3"},i.a.createElement(d.b,{to:"/patient/".concat(a.patient,"/emr/timeline")},i.a.createElement(E.a,{type:"clock-circle"}),"  Patient Timeline")),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"4"},i.a.createElement("a",{onClick:()=>this.sendPatientMail(a)},i.a.createElement(E.a,{type:"mail"})," Send mail to patient")))},i.a.createElement("a",{onClick:()=>this.loadPDF(a.id)},i.a.createElement(E.a,{type:"printer"}))))),i.a.createElement(Ge.a,{loading:this.state.loading,columns:t,dataSource:a.treatment_plans,footer:()=>Ja(a),pagination:!1,key:a.id}))),i.a.createElement(L.a,{loaderFunction:()=>this.loadTreatmentPlans(e.state.next),loading:this.state.loading,hidden:!this.state.next}),i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send complete procedure To ",this.state.patientName," ?"),i.a.createElement(S.a,{value:this.state.mail_to,placeholder:"Email",onChange:t=>e.updateFormValue("mail_to",t.target.value)})))))):i.a.createElement("div",null,i.a.createElement(u.a,{bodyStyle:{padding:0},title:this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," Completed Procedures"):"Completed Procedures ",extra:i.a.createElement(o.a.Group,null,i.a.createElement(o.a,{onClick:()=>this.props.togglePatientListModal(!0)},i.a.createElement(E.a,{type:"plus"}),"Add"))}),this.state.treatmentPlans.map(a=>i.a.createElement(u.a,{bodyStyle:{padding:0},key:a.id,style:{marginTop:15}},i.a.createElement("div",{style:{padding:16}},i.a.createElement("h4",null,a.date?x()(a.date).format("ll"):null,i.a.createElement(d.b,{to:"/patient/".concat(a.patient.id,"/emr/workdone")},"   ",a.patient.user?a.patient.user.first_name:null," (ID: ",a.patient.custom_id?a.patient.custom_id:a.patient.id,") "),i.a.createElement("span",null,", ",a.patient.gender),i.a.createElement(_.a.Button,{size:"small",style:{float:"right"},overlay:i.a.createElement(h.a,null,i.a.createElement(h.a.Item,{key:"1",disabled:a.practice&&a.practice.id!=this.props.active_practiceId},i.a.createElement(d.b,{to:"/patient/".concat(a.patient.id,"/emr/workdone/edit")},i.a.createElement(E.a,{type:"edit"}),"  Edit")),i.a.createElement(h.a.Item,{key:"2",onClick:()=>e.deleteTreatmentPlans(a),disabled:a.practice&&a.practice.id!=this.props.active_practiceId},i.a.createElement(E.a,{type:"delete"}),"Delete"),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"3"},i.a.createElement(d.b,{to:"/patient/".concat(a.patient.id,"/emr/timeline")},i.a.createElement(E.a,{type:"clock-circle"}),"  Patient Timeline")),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"4"},i.a.createElement("a",{onClick:()=>this.sendPatientMail(a)},i.a.createElement(E.a,{type:"mail"})," Send mail to patient")))},i.a.createElement("a",{onClick:()=>this.loadPDF(a.id)},i.a.createElement(E.a,{type:"printer"}))))),i.a.createElement(Ge.a,{loading:this.state.loading,columns:t,dataSource:a.treatment_plans,footer:()=>Ja(a),pagination:!1,key:a.id}))),i.a.createElement(L.a,{loaderFunction:()=>this.loadTreatmentPlans(e.state.next),loading:this.state.loading,hidden:!this.state.next}),i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send Treatment Notes To ",this.state.patientName," ?"),i.a.createElement(S.a,{value:this.state.mail_to,placeholder:"Email",onChange:t=>e.updateFormValue("mail_to",t.target.value)})))}}var Xa=Za;function Ja(e){return e?i.a.createElement("div",null,e.doctor?i.a.createElement(O.a,{color:e.doctor?e.doctor.calendar_colour:null},i.a.createElement("b",null,"Completed by  ".concat(e.doctor.user.first_name)," ")):null,e.practice?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,e.practice.name," "))):null):null}function $a(){return($a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function en(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function tn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?en(Object(a),!0).forEach((function(t){an(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):en(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function an(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const nn=aa.a.TabPane;let rn=0;class ln extends i.a.Component{constructor(e){super(e),an(this,"addInstructions",(e,t)=>{this.setState((function(a){return{addInstructions:tn(tn({},a.addInstructions),{},{[e]:!!t})}}))}),an(this,"changeDurationUnits",(e,t)=>{this.setState((function(a){return{changeDurationUnits:tn(tn({},a.changeDurationUnits),{},{[e]:!!t})}}))}),an(this,"removeDrug",e=>{this.setState((function(t){return{formDrugList:[...Object(zt.remove)(t.formDrugList,(function(t){return t._id!=e}))]}}))}),an(this,"removeLabs",(e,t)=>{this.setState((function(a){return{addedLabs:tn(tn({},a.addedLabs),{},{[t.id]:!1}),formLabList:[...Object(zt.remove)(a.formLabList,(function(t){return t._id!=e}))]}}))}),an(this,"addLabs",e=>{this.setState((function(t){const a=Math.random().toFixed(7);return console.log("LAb state",t),t.addedLabs[e.id]?(Object(N.a)(B.Dc,"Item Already Added"),!1):{addedLabs:tn(tn({},t.addedLabs),{},{[e.id]:!0}),formLabList:[...t.formLabList,tn(tn({},e),{},{_id:a})]}}))}),an(this,"addTemplate",e=>{this.setState((function(t){Math.random().toFixed(7);if(t.addTemplate[e.id])return Object(N.a)(B.Dc,"Item Already Added"),!1;const a=[...t.formLabList];let n=tn({},t.addedLabs);e.labs&&e.labs.forEach((function(e){const t=Math.random().toFixed(7);a.push(tn(tn({},e),{},{_id:t})),n=tn(tn({},n),{},{[e.id]:!0})}));const i=[...t.formDrugList];let r=tn({},t.addedDrugs);return e.drugs&&e.drugs.forEach((function(t){const a=Math.random().toFixed(7);i.push(tn(tn({},t),{},{_id:a,advice_data:e.advice_data})),r=tn(tn({},r),{},{[t.id]:!0})})),{addedLabs:n,formLabList:a,addedDrugs:r,formDrugList:i}}))}),an(this,"removeTemplates",(e,t)=>{this.setState((function(a){return{addTemplate:tn(tn({},a.addTemplate),{},{[t.id]:!1}),formTemplateList:[...Object(zt.remove)(a.formTemplateList,(function(t){return t._id!=e}))]}}))}),an(this,"handleSubmit",e=>{const t=this;e.preventDefault(),this.props.form.validateFields((e,a)=>{if(console.log("value form",a),!e){const e=tn(tn({},a),{},{drug:[],labs:[],advice_data:[],patient:t.props.match.params.id,practice:t.props.active_practiceId});t.state.formDrugList.forEach((function(n){console.log("advice search",n),n.dosage=a.does[n._id],n.duration_type=a.duration_unit[n._id],n.duration=a.duration[n._id],n.frequency=a.does_frequency[n._id],a.instruction&&(n.instruction=a.instruction[n._id]),a.food_time[n._id]?(n.after_food=!0,n.before_food=!1):(n.before_food=!0,n.after_food=!1),n.advice_data&&n.advice_data.map((function(t){e.advice_data.push(t.id)}));const i={inventory:n.id,name:n.name,dosage:n.dosage,frequency:n.frequency,duration:n.duration,duration_type:n.duration_type,instruction:n.instruction,before_food:n.before_food,after_food:n.after_food,advice_data:t.state.prescriptionTemplate.advice_data,is_active:!0};e.drug.push(i)})),t.state.formLabList.forEach((function(t){e.labs.push(t.id)}));const n=function(e){t.props.history.goBack()},i=function(){};console.log("final",e),Object(N.k)(Object(N.g)(V.Id,[t.props.active_practiceId]),e,n,i)}})}),an(this,"handleAddFields",()=>{const e=this.props.form,t=e.getFieldValue("keys").concat(rn++);e.setFieldsValue({keys:t})}),an(this,"remove",e=>{const t=this.props.form,a=t.getFieldValue("keys");1!==a.length&&t.setFieldsValue({keys:a.filter(t=>t!==e)})}),an(this,"onChange",e=>{this.setState({})}),an(this,"searchValues",(e,t)=>{const a=this;this.setState((function(a){const n=tn({},a.searchStrings);return n[e]=t,{searchStrings:n}}),(function(){"Drugs"==e?a.loadDrugList():a.filterValues(e)}))}),an(this,"filterValues",e=>{this.setState((function(t){let a=[];return t.items[e]&&(t.searchStrings[e]?t.items[e].forEach((function(n){n.name&&n.name.toString().toLowerCase().includes(t.searchStrings[e].toLowerCase())&&a.push(n)})):a=t.items[e]),{filteredItems:tn(tn({},t.filteredItems),{},{[e]:a})}}))}),this.state={items:{},filteredItems:{},drugList:[],labList:[],formDrugList:[],formLabList:[],addInstructions:{},changeDurationUnits:{},addedDrugs:{},addedLabs:{},addTemplate:{},formTemplateList:[],searchStrings:{}},this.loadPrescriptionTemplate=this.loadPrescriptionTemplate.bind(this),this.deletePrescriptionTemplate=this.deletePrescriptionTemplate.bind(this)}componentDidMount(){this.loadDrugList(),this.loadLabList(),this.loadPrescriptionTemplate()}loadPrescriptionTemplate(){const e=this;console.log("template",e.state.prescriptionTemplate),Object(N.c)(Object(N.g)(V.Id,[e.props.active_practiceId]),(function(t){e.setState({prescriptionTemplate:t.results})}),(function(){}))}loadLabList(){const e=this;Object(N.c)(Object(N.g)(V.fc,[e.props.active_practiceId]),(function(t){e.setState({labList:t.results})}),(function(){}))}loadDrugList(e=1){const t=this,a={practice:this.props.active_practiceId,item_type:W.L,page:e};t.state.searchStrings.Drugs&&(a.item_name=t.state.searchStrings.Drugs),Object(N.c)(V.Wb,(function(e){t.setState((function(t){const a=tn({},t.items);return{items:tn(tn({},a),{},{Drugs:e.results}),filteredItems:tn(tn({},t.filteredItems),{},{Drugs:e.results})}}))}),(function(){}),a)}addDrug(e){this.setState((function(t){const a=Math.random().toFixed(7);return t.addedDrugs[e.id]?(Object(N.a)(B.Dc,"Item Already Added"),!1):{addedDrugs:tn(tn({},t.addedDrugs),{},{[e.id]:!0}),formDrugList:[...t.formDrugList,tn(tn({},e),{},{_id:a})]}}))}deletePrescriptionTemplate(e){const t=this,a={id:e,is_active:!1};Object(N.k)(Object(N.g)(V.Id,[t.props.active_practiceId]),a,(function(e){t.loadPrescriptionTemplate()}),(function(){}))}render(){const e=this,t={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:12}}},a={wrapperCol:{xs:{span:24,offset:0},sm:{span:12,offset:4}}},n=this.props.form,r=n.getFieldDecorator,l=n.getFieldValue;n.getFieldsValue;r("keys",{initialValue:[]});const s=l("keys"),d=s.map((e,n)=>i.a.createElement(m.a.Item,$a({},0===n?t:a,{label:0===n?"Advice":"",required:!1,key:e}),r("advice_data[".concat(e,"]"),{validateTrigger:["onChange","onBlur"]})(i.a.createElement(S.a,{style:{width:"60%",marginRight:8}})),s.length>1?i.a.createElement(E.a,{className:"dynamic-delete-button",type:"minus-circle-o",onClick:()=>this.remove(e)}):null)),h=[{title:"Drug Name",dataIndex:"name",key:"name",render:e=>i.a.createElement("h2",null,e)},{title:"Dosage & Frequency",dataIndex:"dosage",key:"dosage",render:(e,t)=>i.a.createElement("div",null,i.a.createElement(m.a.Item,{extra:i.a.createElement("span",null,"does(s)"),key:"does[".concat(t._id,"]")},r("does[".concat(t._id,"]"),{validateTrigger:["onChange","onBlur"]},{rules:[{message:"This field is required."}]})(i.a.createElement(w.a,{min:0,size:"small"}))),i.a.createElement(m.a.Item,{key:"does_frequency[".concat(t._id,"]")},r("does_frequency[".concat(t._id,"]"),{validateTrigger:["onChange","onBlur"],rules:[{message:"This field is required."}],initialValue:"twice daily"})(i.a.createElement(p.a,{size:"small",onChange:()=>this.changeDurationUnits(t._id,!1)},W.K.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label))))))},{title:"Duration",dataIndex:"duration",key:"duration",render:(e,t)=>i.a.createElement("div",null,i.a.createElement(m.a.Item,{key:"duration[".concat(t._id,"]")},r("duration[".concat(t._id,"]"),{validateTrigger:["onChange","onBlur"]},{rules:[{message:"This field is required."}]})(i.a.createElement(w.a,{min:0,size:"small"}))),i.a.createElement(m.a.Item,{key:"duration_unit[".concat(t._id,"]")},r("duration_unit[".concat(t._id,"]"),{validateTrigger:["onChange","onBlur"],rules:[{message:"This field is required."}],initialValue:"day(s)"})(i.a.createElement(p.a,{size:"small",onChange:()=>this.changeDurationUnits(t._id,!1)},W.M.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label))))))},{title:"Instructions",dataIndex:"instruction",key:"instruction",render:(e,t)=>i.a.createElement("div",null,this.state.addInstructions[t._id]?i.a.createElement(m.a.Item,{extra:i.a.createElement("a",{onClick:()=>this.addInstructions(t._id,!1)},"Remove Instructions"),key:"instruction[".concat(t._id,"]")},r("instruction[".concat(t._id,"]"),{validateTrigger:["onChange","onBlur"],rules:[{message:"This field is required."}]})(i.a.createElement(S.a.TextArea,{min:0,placeholder:"Instructions...",size:"small"}))):i.a.createElement("a",{onClick:()=>this.addInstructions(t._id,!0)},"+ Add Instructions"))},{title:"Timing",dataIndex:"food_time",key:"food_time",render:(e,t)=>i.a.createElement("div",null,i.a.createElement(m.a.Item,{key:"food_time[".concat(t._id,"]")},r("food_time[".concat(t._id,"]"))(i.a.createElement(j.a.Group,{onChange:this.onChange},i.a.createElement(j.a,{value:1},"After Food"),i.a.createElement(j.a,{value:0},"Before Food")))))},{title:"",dataIndex:"action",key:"action",render:(e,t)=>i.a.createElement(m.a.Item,null,i.a.createElement(o.a,{icon:"close",onClick:()=>this.removeDrug(t._id),type:"danger",shape:"circle",size:"small"}))}],f=[{title:"Name",dataIndex:"name",key:"name",render:(e,t)=>i.a.createElement("span",null,i.a.createElement("b",null,e))},{title:"Cost",dataIndex:"cost",key:"cost",render:(e,t)=>i.a.createElement("span",null,t.cost)},{title:"Total",dataIndex:"total",key:"total",render:(e,t)=>i.a.createElement("span",null,e,i.a.createElement(o.a,{icon:"close",onClick:()=>this.removeLabs(t._id,t),type:"danger",shape:"circle",size:"small"}))}];return i.a.createElement(u.a,{title:"Prescriptions Template"},i.a.createElement(y.a,null,i.a.createElement(g.a,{span:18},i.a.createElement(m.a,{onSubmit:this.handleSubmit},i.a.createElement(m.a.Item,$a({},t,{label:"Template Name"}),r("name",{})(i.a.createElement(S.a,null))),i.a.createElement(m.a.Item,$a({},t,{label:"Schedule"}),r("schedule",{})(i.a.createElement(w.a,{min:1}))),i.a.createElement(Ge.a,{pagination:!1,bordered:!1,columns:h,dataSource:this.state.formDrugList}),i.a.createElement(P.a,null," Lab Test"),i.a.createElement(Ge.a,{pagination:!1,bordered:!1,columns:f,dataSource:this.state.formLabList}),i.a.createElement(P.a,null),d,i.a.createElement(m.a.Item,a,i.a.createElement(o.a,{type:"dashed",onClick:this.handleAddFields,style:{width:"60%"}},i.a.createElement(E.a,{type:"plus"})," Add advice field")),i.a.createElement(Lt.a,{target:()=>this.container},i.a.createElement(o.a,{type:"primary",htmlType:"submit"},"Save")))),i.a.createElement(g.a,{span:6},i.a.createElement(aa.a,{type:"card"},i.a.createElement(nn,{tab:"Drugs",key:"1"},i.a.createElement("div",{style:{backgroundColor:"#ddd",padding:8}},i.a.createElement(S.a.Search,{key:"Drugs",placeholder:"Search in Medicine...",onChange:e=>this.searchValues("Drugs",e.target.value)})),i.a.createElement(re.a,{size:"small",itemLayout:"horizontal",dataSource:this.state.filteredItems.Drugs,renderItem:e=>i.a.createElement(re.a.Item,{onClick:()=>this.addDrug(e),actions:e.maintain_inventory?null:[i.a.createElement(O.a,null,"Not Sold")]},i.a.createElement(re.a.Item.Meta,{title:e.name}))})),i.a.createElement(nn,{tab:"Template",key:"3"},i.a.createElement(re.a,{size:"small",itemLayout:"horizontal",dataSource:this.state.prescriptionTemplate,renderItem:t=>i.a.createElement(re.a.Item,{onConfirm:()=>e.deletePrescriptionTemplate(t.id)},i.a.createElement(re.a.Item.Meta,{onClick:()=>this.addTemplate(t),title:t.name}),i.a.createElement(k.a,{title:"Are you sure delete this item?",onConfirm:()=>e.deletePrescriptionTemplate(t.id),okText:"Yes",cancelText:"No"},i.a.createElement("a",null,"Delete")))})))),i.a.createElement(c.d,null,i.a.createElement(c.b,{exact:!0,path:"/patient/:id/prescriptions/template/add",renderRoute:e=>i.a.createElement(ln,$a({},this.state,e))}))))}}var sn=m.a.create()(ln);function on(){return(on=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function cn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function dn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?cn(Object(a),!0).forEach((function(t){pn(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):cn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function pn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const mn=aa.a.TabPane;class un extends i.a.Component{constructor(e){super(e),pn(this,"selectDoctor",e=>{this.setState({selectedDoctor:e})}),pn(this,"selectedDate",e=>{this.setState({selectedDate:e})}),pn(this,"addInstructions",(e,t)=>{this.setState((function(a){return{addInstructions:dn(dn({},a.addInstructions),{},{[e]:!!t})}}))}),pn(this,"changeDurationUnits",(e,t)=>{this.setState((function(a){return{changeDurationUnits:dn(dn({},a.changeDurationUnits),{},{[e]:!!t})}}))}),pn(this,"removeDrug",e=>{this.setState((function(t){return{formDrugList:[...Object(zt.remove)(t.formDrugList,(function(t){return t._id!=e}))]}}))}),pn(this,"removeLabs",(e,t)=>{this.setState((function(a){return{addedLabs:dn(dn({},a.addedLabs),{},{[t.id]:!1}),formLabList:[...Object(zt.remove)(a.formLabList,(function(t){return t._id!=e}))]}}))}),pn(this,"addLabs",e=>{this.setState((function(t){const a=Math.random().toFixed(7);return t.addedLabs[e.id]?(Object(N.a)(B.Dc,"Item Already Added"),!1):{addedLabs:dn(dn({},t.addedLabs),{},{[e.id]:!0}),formLabList:[...t.formLabList,dn(dn({},e),{},{_id:a})]}}))}),pn(this,"addTemplate",e=>{this.setState((function(t){if(t.addTemplate[e.id])return Object(N.a)(B.Dc,"Item Already Added"),!1;const a=[...t.formLabList];let n=dn({},t.addedLabs);e.labs.forEach((function(e){const t=Math.random().toFixed(7);a.push(dn(dn({},e),{},{_id:t})),n=dn(dn({},n),{},{[e.id]:!0})}));const i=[...t.formDrugList],r=dn({},t.addedDrugs);return e.drugs.forEach((function(t){const a=Math.random().toFixed(7);i.push(dn(dn({},t),{},{_id:a,advice_data:e.advice_data})),n=dn(dn({},r),{},{[t.id]:!0})})),{addedLabs:n,formLabList:a,addedDrugs:r,formDrugList:i}}))}),pn(this,"removeTemplates",(e,t)=>{this.setState((function(a){return{addTemplate:dn(dn({},a.addTemplate),{},{[t.id]:!1}),formTemplateList:[...Object(zt.remove)(a.formTemplateList,(function(t){return t._id!=e}))]}}))}),pn(this,"handleSubmit",e=>{const t=this;e.preventDefault(),this.props.form.validateFields((e,a)=>{if(!e){const e={drugs:[],labs:[],patient:parseInt(t.props.match.params.id),practice:t.props.active_practiceId,doctor:t.state.selectedDoctor?t.state.selectedDoctor.id:null,date:t.state.selectedDate?t.state.selectedDate.format("YYYY-MM-DD"):null,advice_data:[]};t.props.editId&&!t.props.copy&&(e.id=t.props.editId),t.state.formDrugList.forEach((function(t){t.dosage=a.dosage[t._id],t.duration_type=a.duration_type[t._id],t.duration=a.duration[t._id],t.frequency=a.frequency[t._id],a.instruction&&(t.instruction=a.instruction[t._id]),a.food_time[t._id]?(t.after_food=!0,t.before_food=!1):(t.before_food=!0,t.after_food=!1);const n={inventory:t.id,name:t.name,dosage:t.dosage,frequency:t.frequency,duration_type:t.duration_type,duration:t.duration,instruction:t.instruction,before_food:t.before_food,after_food:t.after_food,is_active:!0};e.drugs.push(n)})),t.state.formLabList.forEach((function(t){e.labs.push(t.id)}));const n=function(e){t.props.loadData&&t.props.loadData();const a="/patient/".concat(t.props.match.params.id,"/emr/prescriptions");t.props.history.replace(a)},i=function(){};Object(N.k)(Object(N.g)(V.Gd,[t.props.match.params.id]),e,n,i)}})}),pn(this,"onChange",e=>{this.setState({})}),pn(this,"searchValues",(e,t)=>{const a=this;this.setState((function(a){const n=dn({},a.searchStrings);return n[e]=t,{searchStrings:n}}),(function(){"Drugs"==e?a.loadDrugList():a.filterValues(e)}))}),pn(this,"filterValues",e=>{this.setState((function(t){let a=[];return t.items[e]&&(t.searchStrings[e]?t.items[e].forEach((function(n){n.name&&n.name.toString().toLowerCase().includes(t.searchStrings[e].toLowerCase())&&a.push(n)})):a=t.items[e]),{filteredItems:dn(dn({},t.filteredItems),{},{[e]:a})}}))}),this.state={items:{},filteredItems:{},formDrugList:[],formLabList:[],addInstructions:{},changeDurationUnits:{},addedDrugs:{},addedLabs:{},addTemplate:{},formTemplateList:[],practiceDoctors:[],selectedDoctor:{},selectedDate:x()(),searchStrings:{}},this.loadPrescriptionTemplate=this.loadPrescriptionTemplate.bind(this),this.deletePrescriptionTemplate=this.deletePrescriptionTemplate.bind(this)}componentDidMount(){const e=this;this.loadDrugList(),this.loadPrescriptionTemplate(),Object(le.e)(this),this.props.editId&&this.setState((function(t){const a=[],n={},i={};e.props.editPrescription.drugs.forEach((function(e){const t=Math.random();a.push(dn(dn({},e),{},{_id:t,food_time:e.after_food?1:0,id:e.inventory.id})),n[t]=!!e.instruction}));const r=[];return e.props.editPrescription.labs.forEach(e=>{r.push(dn(dn({},e),{},{_id:Math.random()})),i[e.id]=!0}),dn(dn({},e.props.editPrescription),{},{formDrugList:[...a],formLabList:[...r],addInstructions:dn({},n),addedLabs:dn({},i),selectedDoctor:e.props.editPrescription.doctor,selectedDate:x()(e.props.editPrescription.date).isValid()?x()(e.props.editPrescription.date):x()()})}))}loadPrescriptionTemplate(){const e=this;Object(N.c)(Object(N.g)(V.Id,[e.props.active_practiceId]),(function(t){e.setState((function(e){const a=dn({},e.items);return{items:dn(dn({},a),{},{Template:t.results}),filteredItems:dn(dn({},e.filteredItems),{},{Template:t.results})}}))}),(function(){}))}loadLabList(){const e=this;Object(N.c)(Object(N.g)(V.fc,[e.props.active_practiceId]),(function(t){e.setState((function(e){const a=dn({},e.items);return{items:dn(dn({},a),{},{Labs:t.results}),filteredItems:dn(dn({},e.filteredItems),{},{Labs:t.results})}}))}),(function(){}))}loadDrugList(e=1){const t=this,a=t.state.searchStrings.Drugs,n={practice:this.props.active_practiceId,item_type:W.L,page:e};a&&(n.item_name=a),Object(N.c)(V.Wb,(function(e){a==t.state.searchStrings.Drugs&&t.setState((function(t){const a=dn({},t.items);return{items:dn(dn({},a),{},{Drugs:e.results}),filteredItems:dn(dn({},t.filteredItems),{},{Drugs:e.results})}}))}),(function(){}),n)}addDrug(e){const t=this,a=Math.random().toFixed(7);this.setState((function(t){return{addedDrugs:dn(dn({},t.addedDrugs),{},{[e.id]:!0}),formDrugList:[dn(dn({},e),{},{_id:a,instruction:e.instructions}),...t.formDrugList]}}),(function(){e.instructions&&t.addInstructions(a,!0)}))}deletePrescriptionTemplate(e){const t=this,a={id:e,is_active:!1};Object(N.k)(Object(N.g)(V.Id,[t.props.active_practiceId]),a,(function(e){t.loadPrescriptionTemplate()}),(function(){}))}render(){const e=this,t=this.props.form,a=t.getFieldDecorator,n=(t.getFieldValue,t.getFieldsValue,[{title:"Medicine Name",dataIndex:"name",key:"name",render:e=>i.a.createElement("h2",null,e)},{title:"Dosage & Frequency",dataIndex:"dosage",key:"dosage",render:(e,t)=>i.a.createElement("div",null,i.a.createElement(m.a.Item,{extra:i.a.createElement("span",null,"does(s)"),key:"dosage[".concat(t._id,"]")},a("dosage[".concat(t._id,"]"),{rules:[{required:!0,message:"This field is required."}],initialValue:t.dosage,min:0})(i.a.createElement(w.a,{size:"small"}))),i.a.createElement(m.a.Item,{key:"frequency[".concat(t._id,"]")},a("frequency[".concat(t._id,"]"),{rules:[{required:!0,message:"This field is required."}],initialValue:t.frequency||W.K[0].value})(i.a.createElement(p.a,{size:"small",onChange:()=>this.changeDurationUnits(t._id,!1)},W.K.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label))))))},{title:"Duration",dataIndex:"duration",key:"duration",render:(e,t)=>i.a.createElement("div",null,i.a.createElement(m.a.Item,{key:"duration[".concat(t._id,"]")},a("duration[".concat(t._id,"]"),{rules:[{required:!0,message:"This field is required."}],initialValue:t.duration})(i.a.createElement(w.a,{size:"small",min:1}))),i.a.createElement(m.a.Item,{key:"duration_type[".concat(t._id,"]")},a("duration_type[".concat(t._id,"]"),{rules:[{required:!0,message:"This field is required."}],initialValue:t.duration_type||W.M[0].value})(i.a.createElement(p.a,{size:"small",onChange:()=>this.changeDurationUnits(t._id,!1)},W.M.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label))))))},{title:"Instructions",dataIndex:"instruction",key:"instruction",render:(e,t)=>i.a.createElement("div",null,this.state.addInstructions[t._id]?i.a.createElement(m.a.Item,{extra:i.a.createElement("a",{onClick:()=>this.addInstructions(t._id,!1)},"Remove Instructions"),key:"instruction[".concat(t._id,"]")},a("instruction[".concat(t._id,"]"),{validateTrigger:["onChange","onBlur"],rules:[{message:"This field is required."}],initialValue:t.instruction})(i.a.createElement(S.a.TextArea,{placeholder:"Instructions...",size:"small"}))):i.a.createElement("a",{onClick:()=>this.addInstructions(t._id,!0)},"+ Add Instructions"))},{title:"Timing",dataIndex:"food_time",key:"food_time",render:(e,t)=>i.a.createElement("div",null,i.a.createElement(m.a.Item,{key:"food_time[".concat(t._id,"]")},a("food_time[".concat(t._id,"]"),{initialValue:t.food_time||0})(i.a.createElement(j.a.Group,{onChange:this.onChange},i.a.createElement(j.a,{value:1},"after"),i.a.createElement(j.a,{value:0},"before")))))},{title:"",dataIndex:"action",key:"action",render:(e,t)=>i.a.createElement(m.a.Item,null,i.a.createElement(o.a,{icon:"close",onClick:()=>this.removeDrug(t._id),type:"danger",shape:"circle",size:"small"}))}]);return i.a.createElement(u.a,{title:this.props.copy?"Copying Prescriptions":"Prescriptions"},i.a.createElement(y.a,null,i.a.createElement(g.a,{span:18},i.a.createElement(m.a,{onSubmit:this.handleSubmit},i.a.createElement(Ge.a,{pagination:!1,bordered:!1,columns:n,dataSource:this.state.formDrugList}),i.a.createElement(Lt.a,{offsetBottom:0},i.a.createElement(u.a,null,i.a.createElement("span",null,"by   "),i.a.createElement(_.a,{placement:"topCenter",overlay:i.a.createElement(h.a,null,this.state.practiceDoctors.map(e=>i.a.createElement(h.a.Item,{key:"0"},i.a.createElement("a",{onClick:()=>this.selectDoctor(e)},e.user.first_name)))),trigger:["click"]},i.a.createElement("a",{className:"ant-dropdown-link",href:"#"},i.a.createElement("b",null,this.state.selectedDoctor.user?this.state.selectedDoctor.user.first_name:"No DOCTORS Found"))),i.a.createElement("span",null,"   on  "),i.a.createElement(D.a,{value:this.state.selectedDate,onChange:e=>this.selectedDate(e),format:"DD-MM-YYYY",allowClear:!1}),i.a.createElement(o.a,{type:"primary",htmlType:"submit",style:{margin:5,float:"right"}},"Save"),e.props.history?i.a.createElement(o.a,{style:{margin:5,float:"right"},onClick:()=>e.props.history.goBack()},"Cancel"):null)))),i.a.createElement(g.a,{span:6},i.a.createElement(aa.a,{type:"card"},i.a.createElement(mn,{tab:"Medicine",key:"1"},i.a.createElement("div",{style:{backgroundColor:"#ddd",padding:8}},i.a.createElement(S.a.Search,{key:"Drugs",placeholder:"Search in Medicine...",onChange:e=>this.searchValues("Drugs",e.target.value)})),i.a.createElement(re.a,{size:"small",itemLayout:"horizontal",dataSource:this.state.filteredItems.Drugs,renderItem:e=>i.a.createElement(re.a.Item,{onClick:()=>this.addDrug(e),actions:e.maintain_inventory?null:[i.a.createElement(O.a,null,"Not Sold")]},i.a.createElement(re.a.Item.Meta,{title:e.name}))})),i.a.createElement(mn,{tab:"Template",key:"3"},i.a.createElement("div",null,i.a.createElement(d.b,{to:"/patient/".concat(this.props.match.params.id,"/prescriptions/template/add")},i.a.createElement(o.a,{type:"primary",block:!0,size:"small"},i.a.createElement(E.a,{type:"plus"})," Add Template"))),i.a.createElement(P.a,{style:{margin:0}}),i.a.createElement("div",{style:{backgroundColor:"#ddd",padding:8}},i.a.createElement(S.a.Search,{key:"Template",placeholder:"Search in Template...",onChange:e=>this.searchValues("Template",e.target.value)})),i.a.createElement(re.a,{size:"small",itemLayout:"horizontal",dataSource:this.state.filteredItems.Template,renderItem:t=>i.a.createElement(re.a.Item,{onConfirm:()=>e.deletePrescriptionTemplate(t.id)},i.a.createElement(re.a.Item.Meta,{onClick:()=>this.addTemplate(t),title:t.name}),i.a.createElement(k.a,{title:"Are you sure delete this item?",onConfirm:()=>e.deletePrescriptionTemplate(t.id),okText:"Yes",cancelText:"No"},i.a.createElement("a",null,"Delete")))})))),i.a.createElement(c.d,null,i.a.createElement(c.b,{exact:!0,path:"/patient/:id/prescriptions/template/add",render:e=>i.a.createElement(sn,on({},this.state,e))}))))}}var hn=m.a.create()(un);function fn(){return(fn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function yn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const gn=C.a.confirm;class bn extends i.a.Component{constructor(e){super(e),yn(this,"updateFormValue",(e,t)=>{this.setState({[e]:t})}),yn(this,"mailModalOpen",()=>{this.setState({visibleMail:!0})}),yn(this,"mailModalClose",()=>{this.setState({visibleMail:!1})}),yn(this,"sendPatientMail",e=>{this.mailModalOpen(),this.setState({patientName:zt.get(e,"patient.user.first_name"),prescriptionId:zt.get(e,"id"),mail_to:zt.get(e,"patient.user.email")})}),yn(this,"sendMailToPatient",()=>{const e=this.state,t=e.mail_to,a=e.prescriptionId,n={mail_to:t};Object(le.i)(Object(N.g)(V.Hd,[a]),n),this.mailModalClose()}),this.state={currentPatient:this.props.currentPatient,active_practiceId:this.props.active_practiceId,prescription:[],drug_catalog:null,editPrescription:null,loading:!0,copy:!1},this.loadPrescriptions=this.loadPrescriptions.bind(this),this.loadDrugCatalog=this.loadDrugCatalog.bind(this),this.editPrescriptionData=this.editPrescriptionData.bind(this),this.deletePrescriptions=this.deletePrescriptions.bind(this)}componentDidMount(){this.loadPrescriptions(),this.loadDrugCatalog()}loadPrescriptions(e=1){const t=this;this.setState({loading:!0});const a={page:e,practice:this.props.active_practiceId};this.props.match.params.id&&(a.patient=this.props.match.params.id),this.props.showAllClinic&&this.props.match.params.id&&delete a.practice,Object(N.c)(V.Gd,(function(e){t.setState({prescription:e.results,nextPrescriptionPage:e.next,loading:!1})}),(function(){t.setState({loading:!1})}),a)}loadPDF(e){Object(N.c)(Object(N.g)(V.Hd,[e]),(function(e){e.report&&window.open(Oe.a+e.report)}),(function(){}))}loadDrugCatalog(){const e=this;Object(N.c)(Object(N.g)(V.qb,[this.props.active_practiceId]),(function(t){e.setState({drug_catalog:t})}),(function(){e.setState({})}))}editPrescriptionData(e){console.log("logURL",e);const t=this;this.setState({editPrescription:e,copy:!1},(function(){t.props.history.push("/patient/".concat(e.patient.id,"/emr/prescriptions/edit"))}))}copyPrescriptionData(e){console.log("logURL",e);const t=this;this.setState({editPrescription:e,copy:!0},(function(){t.props.history.push("/patient/".concat(e.patient.id,"/emr/prescriptions/edit"))}))}deletePrescriptions(e){const t=this;gn({title:"Are you sure to delete this item?",okText:"Yes",okType:"danger",cancelText:"No",onOk(){const a={id:e.id,patient:e.patient.id,is_active:!1};Object(N.k)(Object(N.g)(V.Gd,[t.props.match.params.id]),a,(function(e){t.loadPrescriptions()}),(function(){}))},onCancel(){console.log("Cancel")}})}render(){const e={};this.state.drug_catalog&&this.state.drug_catalog.forEach((function(t){e[t.id]="".concat(t.name,",").concat(t.strength)}));const t=this,a=[{title:"Drug",key:"name",dataIndex:"name"},{title:"Frequency",dataIndex:"frequency",key:"frequency",render:(e,t)=>i.a.createElement("span",null,t.dosage," ",t.frequency)},{title:"Duration",dataIndex:"duration",key:"duration",render:(e,t)=>i.a.createElement("span",null,e," ",t.duration_type)},{title:"Instruction",dataIndex:"instruction",key:"instruction",render:(e,t)=>i.a.createElement("span",null,t.before_food?i.a.createElement(O.a,null,"before food "):null,t.after_food?i.a.createElement(O.a,null,"after food"):null,e)}];return this.props.match.params.id?i.a.createElement("div",null,i.a.createElement(c.d,null,i.a.createElement(c.b,{exact:!0,path:"/patient/:id/emr/prescriptions/add",render:e=>i.a.createElement(hn,fn({},this.state,this.props,{loadData:this.loadPrescriptions},e))}),i.a.createElement(c.b,{exact:!0,path:"/patient/:id/emr/prescriptions/edit",render:e=>t.state.editPrescription?i.a.createElement(hn,fn({},this.state,e,this.props,{loadData:this.loadPrescriptions,editId:t.state.editPrescription.id})):i.a.createElement(c.a,{to:"/patient/".concat(t.props.match.params.id,"/emr/prescriptions")})}),i.a.createElement(c.b,null,i.a.createElement("div",null,i.a.createElement(u.a,{bodyStyle:{padding:0},title:this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," Prescriptions"):"Prescriptions",extra:i.a.createElement(o.a.Group,{style:{float:"right"}},i.a.createElement(d.b,{to:"/patient/".concat(this.props.match.params.id,"/emr/prescriptions/add")},i.a.createElement(o.a,{type:"primary"},i.a.createElement(E.a,{type:"plus"}),"Add")))}),this.state.prescription.map(e=>i.a.createElement("div",null,i.a.createElement(u.a,{style:{marginTop:10},bodyStyle:{padding:0},title:i.a.createElement("small",null,e.date?x()(e.date).format("ll"):null),extra:i.a.createElement(_.a.Button,{size:"small",style:{float:"right"},overlay:i.a.createElement(h.a,null,i.a.createElement(h.a.Item,{key:"1",onClick:()=>t.copyPrescriptionData(e),disabled:e.practice&&e.practice.id!=t.props.active_practiceId},i.a.createElement(E.a,{type:"copy"}),"Copy"),i.a.createElement(h.a.Item,{key:"1",onClick:()=>t.editPrescriptionData(e),disabled:e.practice&&e.practice.id!=t.props.active_practiceId},i.a.createElement(E.a,{type:"edit"}),"Edit"),i.a.createElement(h.a.Item,{key:"2",onClick:()=>t.deletePrescriptions(e),disabled:e.practice&&e.practice.id!=t.props.active_practiceId},i.a.createElement(E.a,{type:"delete"}),"Delete"),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"3"},i.a.createElement(d.b,{to:"/patient/".concat(e.patient,"/emr/timeline")},i.a.createElement(E.a,{type:"clock-circle"}),"  Patient Timeline")),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"4"},i.a.createElement("a",{onClick:()=>this.sendPatientMail(e)},i.a.createElement(E.a,{type:"mail"})," Send mail to patient")))},i.a.createElement("a",{onClick:()=>this.loadPDF(e.id)},i.a.createElement(E.a,{type:"printer"})))},i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send Prescription  To ",this.state.patientName," ?"),i.a.createElement(S.a,{value:this.state.mail_to,placeholder:"Email",onChange:e=>t.updateFormValue("mail_to",e.target.value)})),i.a.createElement(Ge.a,{columns:a,dataSource:e.drugs,pagination:!1,footer:()=>vn(e),key:e.id})))),i.a.createElement(l.a,{spinning:this.state.loading},i.a.createElement(y.a,null)),i.a.createElement(L.a,{loading:this.state.loading,loaderFunction:()=>this.loadPrescriptions(this.state.nextPrescriptionPage),hidden:!this.state.nextPrescriptionPage}))))):i.a.createElement("div",null,i.a.createElement(u.a,{bodyStyle:{padding:0},title:this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," Prescriptions"):"Prescriptions",extra:i.a.createElement(o.a.Group,{style:{float:"right"}},i.a.createElement(o.a,{type:"primary",onClick:()=>this.props.togglePatientListModal(!0)},i.a.createElement(E.a,{type:"plus"}),"Add"))}),this.state.prescription.map(e=>i.a.createElement("div",{key:e.id},i.a.createElement(u.a,{style:{marginTop:10},bodyStyle:{padding:0},title:i.a.createElement("small",null,e.date?x()(e.date).format("ll"):null,i.a.createElement(d.b,{to:"/patient/".concat(e.patient.id,"/emr/prescriptions")},"   ",e.patient.user?e.patient.user.first_name:null," (ID: ",e.patient.custom_id?e.patient.custom_id:e.patient.id,") "),i.a.createElement("span",null,", ",e.patient.gender)),extra:i.a.createElement(_.a.Button,{size:"small",style:{float:"right"},overlay:i.a.createElement(h.a,null,i.a.createElement(h.a.Item,{key:"1",onClick:()=>t.copyPrescriptionData(e),disabled:e.practice&&e.practice.id!=t.props.active_practiceId},i.a.createElement(E.a,{type:"copy"}),"Copy"),i.a.createElement(h.a.Item,{key:"2",onClick:()=>t.editPrescriptionData(e),disabled:e.practice&&e.practice.id!=t.props.active_practiceId},i.a.createElement(E.a,{type:"edit"}),"Edit"),i.a.createElement(h.a.Item,{key:"3",onClick:()=>t.deletePrescriptions(e),disabled:e.practice&&e.practice.id!=t.props.active_practiceId},i.a.createElement(E.a,{type:"delete"}),"Delete"),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"4"},i.a.createElement(d.b,{to:"/patient/".concat(e.patient,"/emr/timeline")},i.a.createElement(E.a,{type:"clock-circle"}),"  Patient Timeline")),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"5"},i.a.createElement("a",{onClick:()=>this.sendPatientMail(e)},i.a.createElement(E.a,{type:"mail"})," Send mail to patient")))},i.a.createElement("a",{onClick:()=>this.loadPDF(e.id)},i.a.createElement(E.a,{type:"printer"})))},i.a.createElement(Ge.a,{columns:a,dataSource:e.drugs,pagination:!1,footer:()=>vn(e),key:e.id})))),i.a.createElement(l.a,{spinning:this.state.loading},i.a.createElement(y.a,null)),i.a.createElement(L.a,{loading:this.state.loading,loaderFunction:()=>this.loadPrescriptions(this.state.nextPrescriptionPage),hidden:!this.state.nextPrescriptionPage}),i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send Prescription To ",this.state.patientName," ?"),i.a.createElement(S.a,{value:this.state.mail_to,placeholder:"Email",onChange:e=>t.updateFormValue("mail_to",e.target.value)})))}}var En=bn;function vn(e){return e?i.a.createElement("div",null,e.doctor?i.a.createElement(Bt.a,{title:"Doctor"},i.a.createElement(O.a,{color:e.doctor?e.doctor.calendar_colour:null},i.a.createElement("b",null,"prescribed by  ".concat(e.doctor.user.first_name)," "))):null,e.practice?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,e.practice.name," "))):null,e.labs.length?i.a.createElement("div",null,"+",e.labs.length," Lab Orders"):null):null}function _n(){return(_n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Pn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function kn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Pn(Object(a),!0).forEach((function(t){On(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Pn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function On(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Cn extends i.a.Component{constructor(e){super(e),On(this,"calculateItem",e=>{this.props.form.getFieldsValue;this.setState((function(e){[...e.tableFormValues].forEach((function(e){}))}))}),On(this,"addNotes",(e,t)=>{this.setState((function(a){return{addNotes:kn(kn({},a.addNotes),{},{[e]:!!t})}}))}),On(this,"removeTreatment",e=>{this.setState((function(t){return{tableFormValues:[...Object(zt.remove)(t.tableFormValues,(function(t){return t._id!=e}))]}}))}),On(this,"add",e=>{const t=this;this.setState((function(t){const a=Math.random().toFixed(7);return{addNotes:kn(kn({},t.addNotes),{},{[a]:!!e.default_notes}),tableFormValues:[kn(kn({},e),{},{_id:a,children:void 0}),...t.tableFormValues]}}),(function(){e.children.length&&e.children.forEach((function(e){t.add(e)}))}))}),On(this,"selectDoctor",e=>{this.setState({selectedDoctor:e})}),On(this,"selectedDate",e=>{this.setState({selectedDate:e})}),On(this,"handleSubmit",e=>{const t=this;e.preventDefault(),this.props.form.validateFields((e,a)=>{if(!e){const e={treatment_plans:[],patient:t.props.match.params.id,doctor:t.state.selectedDoctor.id,date:t.state.selectedDate&&x()(t.state.selectedDate).isValid()?t.state.selectedDate.format("YYYY-MM-DD"):null,practice:t.props.active_practiceId};t.props.editId&&(e.id=t.props.editTreatmentPlan.id),t.state.tableFormValues.forEach((function(t){t.quantity=a.quantity[t._id],t.cost=a.cost[t._id],t.discount=a.discount[t._id],a.notes&&(t.notes=a.notes[t._id]);const n={procedure:t.id,cost:t.cost,quantity:t.quantity,margin:t.margin,default_notes:t.default_notes,is_active:!0,is_completed:t.is_completed||!1,discount:t.discount,discount_type:"%"};e.treatment_plans.push(n)}));const n=function(e){Object(N.a)("Inventory updated successfully"),t.props.loadData&&t.props.loadData();const a="/patient/".concat(t.props.match.params.id,"/emr/plans");t.props.history.replace(a)},i=function(){};Object(N.k)(Object(N.g)(V.ff,[t.props.match.params.id]),e,n,i)}})}),On(this,"searchValues",e=>{const t=this;return this.setState((function(t){return{searchString:e}}),(function(){t.loadProcedures()})),!1}),this.state={loadingProcedures:!0,procedure_category:[],tableFormValues:[],addNotes:{},practiceDoctors:[],selectedDoctor:{},selectedDate:x()()}}componentDidMount(){this.props.editId&&this.setState((function(e){const t=[];return this.props.editTreatmentPlan.treatment_plans.forEach((function(e){const a=Math.random().toFixed(7);t.push(kn(kn(kn({},e),e.procedure),{},{_id:a}))})),kn(kn({},this.props.editTreatmentPlan),{},{tableFormValues:t,selectedDate:x()(this.props.editTreatmentPlan.date),selectedDoctor:this.props.editTreatmentPlan.doctor})})),this.loadProcedures(),Object(le.e)(this)}loadProcedures(){const e=this,t={};this.state.searchString&&(t.name=this.state.searchString),e.setState({loadingProcedures:!0});Object(N.c)(Object(N.g)(V.Kd,[this.props.active_practiceId]),(function(a){t.name&&e.state.searchString!=t.name||e.setState({loadingProcedures:!1,filteredItems:a.results})}),(function(){e.setState({loadingProcedures:!1})}),t)}render(){const e=this,t=this.props.form,a=t.getFieldDecorator,n=(t.getFieldValue,t.getFieldsValue,{labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}}),r=[{title:"Treatments",dataIndex:"name",key:"name",render:(e,t)=>i.a.createElement("span",null,i.a.createElement("b",null,e),i.a.createElement("br",null),this.state.addNotes[t._id]?i.a.createElement(m.a.Item,_n({key:"default_notes[".concat(t._id,"]")},n),a("default_notes[".concat(t._id,"]"),{validateTrigger:["onChange","onBlur"],rules:[{message:"This field is required."}],initialValue:t.default_notes})(i.a.createElement(S.a.TextArea,{min:0,placeholder:"Notes..."}))):i.a.createElement("a",{onClick:()=>this.addNotes(t._id,!0)},"+ Add Note"))},{title:"Quantity",dataIndex:"quantity",key:"quantity",render:(e,t)=>i.a.createElement(m.a.Item,_n({key:"quantity[".concat(t._id,"]")},n),a("quantity[".concat(t._id,"]"),{validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"This field is required."}],initialValue:1})(i.a.createElement(w.a,{min:0,placeholder:"Quantity",size:"small",onChange:()=>this.calculateItem(t._id)})))},{title:"Cost",dataIndex:"cost",key:"cost",render:(e,t)=>i.a.createElement(m.a.Item,_n({key:"cost[".concat(t._id,"]")},n),a("cost[".concat(t._id,"]"),{validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"This field is required."}],initialValue:t.cost})(i.a.createElement(w.a,{min:0,placeholder:"Cost",size:"small",onChange:()=>this.calculateItem(t._id)})))},{title:"Discount",dataIndex:"discount",key:"discount",render:(e,t)=>i.a.createElement(m.a.Item,_n({key:"discount[".concat(t._id,"]")},n),a("discount[".concat(t._id,"]"),{validateTrigger:["onChange","onBlur"],rules:[{message:"This field is required."}]})(i.a.createElement(w.a,{min:0,placeholder:"Discount",size:"small",onChange:()=>this.calculateItem(t._id)}))," %")},{title:"Total",dataIndex:"total",key:"total",render:(e,t)=>i.a.createElement("span",null,e,i.a.createElement(o.a,{icon:"close",onClick:()=>this.removeTreatment(t._id),type:"danger",shape:"circle",size:"small"}))}];return i.a.createElement("div",null,i.a.createElement(u.a,{title:"Treatment Plans"},i.a.createElement(y.a,null,i.a.createElement(g.a,{span:17},i.a.createElement(m.a,{onSubmit:this.handleSubmit},i.a.createElement(Ge.a,{pagination:!1,bordered:!0,dataSource:this.state.tableFormValues,columns:r}),i.a.createElement(Lt.a,{offsetBottom:0},i.a.createElement(u.a,null,i.a.createElement("span",null,"by   "),i.a.createElement(_.a,{placement:"topCenter",overlay:i.a.createElement(h.a,null,this.state.practiceDoctors.map(e=>i.a.createElement(h.a.Item,{key:"0"},i.a.createElement("a",{onClick:()=>this.selectDoctor(e)},e.user.first_name)))),trigger:["click"]},i.a.createElement("a",{className:"ant-dropdown-link",href:"#"},i.a.createElement("b",null,this.state.selectedDoctor.user?this.state.selectedDoctor.user.first_name:"No DOCTORS Found"))),i.a.createElement("span",null,"   on  "),i.a.createElement(D.a,{value:this.state.selectedDate,onChange:e=>this.selectedDate(e),format:"DD-MM-YYYY",allowClear:!1}),i.a.createElement(m.a.Item,_n({},{labelCol:{xs:{span:24},sm:{span:24}},wrapperCol:{xs:{span:24},sm:{span:24}}},{style:{marginBottom:0,float:"right"}}),i.a.createElement(o.a,{type:"primary",htmlType:"submit",style:{margin:5}},"Save Treatment Plan"),e.props.history?i.a.createElement(o.a,{style:{margin:5,float:"right"},onClick:()=>e.props.history.goBack()},"Cancel"):null))),i.a.createElement("div",{ref:t=>{e.bottomPoint=t}}))),i.a.createElement(g.a,{span:7},i.a.createElement(Lt.a,{offsetTop:0},i.a.createElement("div",{style:{backgroundColor:"#ddd",padding:8}},i.a.createElement(S.a.Search,{placeholder:"Search in plans ...",onChange:e=>this.searchValues(e.target.value)})),i.a.createElement(re.a,{size:"small",style:{maxHeight:"100vh",overflowX:"scroll"},itemLayout:"horizontal",dataSource:this.state.filteredItems,loading:this.state.loadingProcedures,renderItem:e=>i.a.createElement(re.a.Item,{onClick:()=>this.add(e)},i.a.createElement(re.a.Item.Meta,{title:e.name}))}))))))}}var Sn=m.a.create()(Cn);function In(){return(In=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function xn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Dn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?xn(Object(a),!0).forEach((function(t){jn(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):xn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function jn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const wn=C.a.confirm;class Mn extends i.a.Component{constructor(e){super(e),jn(this,"updateFormValue",(e,t)=>{this.setState({[e]:t})}),jn(this,"mailModalOpen",()=>{this.setState({visibleMail:!0})}),jn(this,"mailModalClose",()=>{this.setState({visibleMail:!1})}),jn(this,"sendPatientMail",e=>{this.mailModalOpen(),this.setState({patientName:zt.get(e,"patient.user.first_name"),treatmentId:zt.get(e,"id"),mail_to:zt.get(e,"patient.user.email")})}),jn(this,"sendMailToPatient",()=>{const e=this.state,t=e.mail_to,a=e.treatmentId,n={mail_to:t};Object(le.i)(Object(N.g)(V.hf,[a]),n),this.mailModalClose()}),this.state={currentPatient:this.props.currentPatient,active_practiceId:this.props.active_practiceId,treatmentPlans:[],procedure_category:null,incompletedTreatmentPlans:[],loading:!0,selectedTreatments:{}},this.loadTreatmentPlans=this.loadTreatmentPlans.bind(this),this.editTreatmentPlanData=this.editTreatmentPlanData.bind(this),this.submitCompleteTreatment=this.submitCompleteTreatment.bind(this)}componentDidMount(){this.loadTreatmentPlans()}loadTreatmentPlans(e=1){const t=[],a=this;this.setState({loading:!0});const n={page:e,practice:this.props.active_practiceId};this.props.match.params.id&&(n.patient=this.props.match.params.id),this.props.showAllClinic&&this.props.match.params.id&&delete n.practice,Object(N.c)(V.ff,(function(e){a.setState((function(t){return 1==e.current?{treatmentPlans:[...e.results],next:e.next,loading:!1}:{treatmentPlans:[...t.treatmentPlans,...e.results],next:e.next,loading:!1}})),e.results.forEach((function(e){e.is_completed||t.push(e)})),a.setState((function(a){return 1==e.current?{incompletedTreatmentPlans:[...t],loading:!1}:{incompletedTreatmentPlans:[...a.incompletedTreatmentPlans,...t],loading:!1}}))}),(function(){a.setState({loading:!1})}),n)}editTreatmentPlanData(e){console.log("record",e.id),this.setState({editTreatmentPlan:e,loading:!1});e.patient;this.props.history.push("/patient/".concat(e.id,"/emr/plans/edit"))}deleteTreatmentPlans(e){const t=this;wn({title:"Are you sure to delete this item?",okText:"Yes",okType:"danger",cancelText:"No",onOk(){const a={id:e.id,patient:e.patient.id,is_active:!1};Object(N.k)(Object(N.g)(V.ff,[t.props.match.params.id],null),a,(function(e){t.loadTreatmentPlans(),Object(N.a)(B.sc,"Treatment Plan Deleted Successfully!")}),(function(){}))},onCancel(){console.log("Cancel")}})}treatmentCompleteToggle(e,t){this.setState((function(a){return{selectedTreatments:Dn(Dn({},a.selectedTreatments),{},{[e]:!!t})}}))}submitCompleteTreatment(){const e=this,t=this.state.selectedTreatments,a=Object.keys(t),n={treatment:[],patient:e.props.match.params.id};a.forEach((function(e){const a={id:e,is_completed:t[e]};n.treatment.push(a)}));Object(N.k)(Object(N.g)(V.gf,[this.props.match.params.id]),n,(function(t){e.loadTreatmentPlans(),e.setState({selectedTreatments:{}})}),(function(){}))}loadPDF(e){Object(N.c)(Object(N.g)(V.hf,[e]),(function(e){e.report&&window.open(Oe.a+e.report)}),(function(){}))}render(){const e=this,t=[{title:"",key:"is_completed",render:(e,t)=>t.is_completed?i.a.createElement(E.a,{type:"check-circle",theme:"twoTone",style:{marginLeft:"8px",fontSize:"20px"}}):i.a.createElement(ve.a,{key:t.id,onChange:e=>this.treatmentCompleteToggle(t.id,e.target.checked),value:this.state.selectedTreatments[t.id]})},{title:"Procedure",dataIndex:"procedure",key:"procedure",render:(e,t)=>i.a.createElement("span",null," ",e.name)},{title:"Quantity",dataIndex:"quantity",key:"quantity"},{title:"Discount",dataIndex:"discount",key:"discount"},{title:"Cost per  Unit",dataIndex:"cost",key:"cost"},{title:"Notes",dataIndex:"default_notes",key:"default_notes"}];return this.props.match.params.id?i.a.createElement("div",null,i.a.createElement(c.d,null,i.a.createElement(c.b,{exact:!0,path:"/patient/:id/emr/plans/add",render:t=>i.a.createElement(Sn,In({},this.state,t,e.props,{loadData:this.loadTreatmentPlans}))}),i.a.createElement(c.b,{exact:!0,path:"/patient/:id/emr/plans/edit",render:t=>this.state.editTreatmentPlan?i.a.createElement(Sn,In({},this.state,t,e.props,{loadData:this.loadTreatmentPlans,editId:this.state.editTreatmentPlan.id})):i.a.createElement(c.a,{to:"/patient/".concat(this.props.match.params.id,"/emr/plans")})}),i.a.createElement("div",null,i.a.createElement(u.a,{bodyStyle:{padding:0},title:this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," TreatmentPlans"):"TreatmentPlans",extra:i.a.createElement(o.a.Group,null,i.a.createElement(o.a,{onClick:this.submitCompleteTreatment},i.a.createElement(E.a,{type:"save"}),"Save"),i.a.createElement(d.b,{to:"/patient/".concat(this.props.match.params.id,"/emr/plans/add")},i.a.createElement(o.a,{type:"primary"},i.a.createElement(E.a,{type:"plus"}),"Add")))}),i.a.createElement(l.a,{spinning:this.state.loading},this.state.treatmentPlans.map(a=>i.a.createElement(u.a,{bodyStyle:{padding:0},style:{marginTop:15}},i.a.createElement("div",{style:{padding:16}},i.a.createElement("h4",null,a.date?x()(a.date).format("ll"):null,i.a.createElement(_.a.Button,{size:"small",style:{float:"right"},overlay:i.a.createElement(h.a,null,i.a.createElement(h.a.Item,{key:"1",onClick:()=>e.editTreatmentPlanData(a),disabled:a.practice&&a.practice.id!=this.props.active_practiceId},i.a.createElement(E.a,{type:"edit"}),"Edit"),i.a.createElement(h.a.Item,{key:"2",onClick:()=>e.deleteTreatmentPlans(a),disabled:a.practice&&a.practice.id!=this.props.active_practiceId},i.a.createElement(E.a,{type:"delete"}),"Delete"),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"3"},i.a.createElement(d.b,{to:"/patient/".concat(a.patient,"/emr/timeline")},i.a.createElement(E.a,{type:"clock-circle"}),"  Patient Timeline")),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"4"},i.a.createElement("a",{onClick:()=>this.sendPatientMail(a)},i.a.createElement(E.a,{type:"mail"})," Send mail to patient")))},i.a.createElement("a",{onClick:()=>this.loadPDF(a.id)},i.a.createElement(E.a,{type:"printer"}))))),i.a.createElement(Ge.a,{loading:this.state.loading,columns:t,dataSource:a.treatment_plans,footer:()=>Fn(a),pagination:!1,key:a.id})))),i.a.createElement(L.a,{loaderFunction:()=>this.loadTreatmentPlans(e.state.next),loading:this.state.loading,hidden:!this.state.next}),i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send Treatment  To ",this.state.patientName," ?"),i.a.createElement(S.a,{value:this.state.mail_to,placeholder:"Email",onChange:t=>e.updateFormValue("mail_to",t.target.value)}))))):i.a.createElement("div",null,i.a.createElement(u.a,{bodyStyle:{padding:0},title:this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," TreatmentPlans"):"TreatmentPlans",extra:i.a.createElement(o.a.Group,null,i.a.createElement(o.a,{onClick:this.submitCompleteTreatment},i.a.createElement(E.a,{type:"save"}),"Save"),i.a.createElement(o.a,{type:"primary",onClick:()=>this.props.togglePatientListModal(!0)},i.a.createElement(E.a,{type:"plus"}),"Add"))}),i.a.createElement(l.a,{spinning:this.state.loading},this.state.treatmentPlans.map(a=>i.a.createElement(u.a,{bodyStyle:{padding:0},key:a.id,style:{marginTop:15}},i.a.createElement("div",{style:{padding:16}},i.a.createElement("h4",null,a.date?x()(a.date).format("ll"):null,i.a.createElement(d.b,{to:"/patient/".concat(a.patient.id,"/emr/plans")},"   ",a.patient.user?a.patient.user.first_name:null," (ID: ",a.patient.custom_id?a.patient.custom_id:a.patient.id,") "),i.a.createElement("span",null,", ",a.patient.gender),i.a.createElement(_.a.Button,{size:"small",style:{float:"right"},overlay:i.a.createElement(h.a,null,i.a.createElement(h.a.Item,{key:"1",disabled:a.practice&&a.practice.id!=this.props.active_practiceId},i.a.createElement(d.b,{to:"/patient/".concat(a.patient.id,"/emr/plans/edit")},i.a.createElement(E.a,{type:"edit"}),"  Edit")),i.a.createElement(h.a.Item,{key:"2",onClick:()=>e.deleteTreatmentPlans(a),disabled:a.practice&&a.practice.id!=this.props.active_practiceId},i.a.createElement(E.a,{type:"delete"}),"Delete"),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"3"},i.a.createElement(d.b,{to:"/patient/".concat(a.patient,"/emr/timeline")},i.a.createElement(E.a,{type:"clock-circle"}),"  Patient Timeline")),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"4"},i.a.createElement("a",{onClick:()=>this.sendPatientMail(a)},i.a.createElement(E.a,{type:"mail"})," Send mail to patient")))},i.a.createElement("a",{onClick:()=>this.loadPDF(a.id)},i.a.createElement(E.a,{type:"printer"}))))),i.a.createElement(Ge.a,{loading:this.state.loading,columns:t,dataSource:a.treatment_plans,footer:()=>Fn(a),pagination:!1,key:a.id})))),i.a.createElement(L.a,{loaderFunction:()=>this.loadTreatmentPlans(e.state.next),loading:this.state.loading,hidden:!this.state.next}),i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send Treatment To ",this.state.patientName," ?"),i.a.createElement(S.a,{value:this.state.mail_to,placeholder:"Email",onChange:t=>e.updateFormValue("mail_to",t.target.value)})))}}var Tn=Mn;function Fn(e){return e?i.a.createElement("div",null,e.doctor?i.a.createElement(O.a,{color:e.doctor?e.doctor.calendar_colour:null},i.a.createElement("b",null,"prescribed by  ".concat(e.doctor.user.first_name)," ")):null,e.practice?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,e.practice.name," "))):null):null}function An(){return(An=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Nn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Vn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Nn(Object(a),!0).forEach((function(t){Ln(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Nn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ln(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Rn extends i.a.Component{constructor(e){super(e),Ln(this,"calculateItem",e=>{const t=this.props.form.getFieldsValue;console.log(t()),this.setState((function(e){[...e.tableFormValues].forEach((function(e){}))}))}),Ln(this,"removeTests",(e,t)=>{this.setState((function(a){return{addedLabs:Vn(Vn({},a.addedLabs),{},{[t.id]:!1}),tableFormValues:[...Object(zt.remove)(a.tableFormValues,(function(t){return t._id!=e}))]}}))}),Ln(this,"add",e=>{console.log("item",e),this.setState((function(t){console.log("preview",t);const a=Math.random().toFixed(7);return t.addedLabs[e.id]?(Object(N.a)(B.Dc,"Item Already Added"),!1):{addedLabs:Vn(Vn({},t.addedLabs),{},{[e.id]:!0}),tableFormValues:[...t.tableFormValues,Vn(Vn({},e),{},{_id:a})]}}))}),Ln(this,"handleSubmit",e=>{const t=this;e.preventDefault(),this.props.form.validateFields((e,a)=>{if(!e){const e={treatment:[],patient:t.props.match.params.id};t.state.tableFormValues.forEach((function(t){t.cost=a.cost[t._id];const n={name:t.id,cost:t.cost,instruction:t.instruction,is_active:!0,practice:t.practice,margin:t.margin};e.treatment.push(n)}));console.log("DataSet",e)}})}),this.state={lab_test:[],tableFormValues:[],addedLabs:{}},console.log("urgent",this.props.active_practiceId)}componentDidMount(){this.loadLabs()}loadLabs(){const e=this;Object(N.c)(Object(N.g)(V.fc,[e.props.active_practiceId]),(function(t){e.setState({lab_test:t})}),(function(){}))}render(){const e=this.props.form,t=e.getFieldDecorator,a=(e.getFieldValue,e.getFieldsValue,{labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:20}}}),n=[{title:"Name",dataIndex:"name",key:"name",render:(e,t)=>i.a.createElement("span",null,i.a.createElement("b",null,e))},{title:"Cost",dataIndex:"cost",key:"cost",render:(e,n)=>i.a.createElement("span",null,i.a.createElement(m.a.Item,An({key:"cost[".concat(n._id,"]")},a),t("cost[".concat(n._id,"]"),{validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"This field is required."}],initialValue:n.cost})))},{title:"Total",dataIndex:"total",key:"total",render:(e,t)=>i.a.createElement("span",null,e,i.a.createElement("a",{onClick:()=>this.removeTests(t._id,t)},i.a.createElement(E.a,{type:"close-circle",theme:"twoTone",twoToneColor:"#f00"})))}];return i.a.createElement("div",null,i.a.createElement(m.a,{onSubmit:this.handleSubmit},i.a.createElement(u.a,{title:"Patient Lab Orders",bodyStyle:{padding:0},extra:i.a.createElement(m.a.Item,An({},{labelCol:{xs:{span:24},sm:{span:24}},wrapperCol:{xs:{span:24},sm:{span:24}}},{style:{marginBottom:0}}),i.a.createElement(o.a,{type:"primary",htmlType:"submit"},"Save Lab Orders"))},i.a.createElement(y.a,{gutter:16},i.a.createElement(g.a,{span:7},i.a.createElement(re.a,{size:"small",itemLayout:"horizontal",dataSource:this.state.lab_test,renderItem:e=>i.a.createElement(re.a.Item,null,i.a.createElement(re.a.Item.Meta,{title:e.name}),i.a.createElement(o.a,{type:"primary",size:"small",shape:"circle",onClick:()=>this.add(e),icon:"arrow-right"}))})),i.a.createElement(g.a,{span:17},i.a.createElement(Ge.a,{pagination:!1,bordered:!0,dataSource:this.state.tableFormValues,columns:n}))))))}}var Bn=m.a.create()(Rn);function zn(){return(zn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}class Yn extends i.a.Component{constructor(e){super(e),this.state={currentPatient:this.props.currentPatient,active_practiceId:this.props.active_practiceId,loading:!1}}render(){const e=[{title:"Time",dataIndex:"created_at",key:"name",render:e=>i.a.createElement("span",null,x()(e).format("LLL"))},{title:"Drug",key:"drug"},{title:"Quantity",dataIndex:"qunatity",key:"quantity"},{title:"Cost Per  Unit",dataIndex:"cost",key:"cost"},{title:"Completed",key:"is_completed",render:(e,t)=>i.a.createElement(ve.a,{checked:t.is_completed})},{title:"Action",key:"action",render:(e,t)=>i.a.createElement("span",null,i.a.createElement("a",{onClick:()=>this.editPrescriptionData(t)},"Edit"),i.a.createElement(P.a,{type:"vertical"}),i.a.createElement("a",{href:"javascript:;"},"Delete"))}];return(i.a.createElement("div",null,i.a.createElement(c.d,null,i.a.createElement(c.b,{exact:!0,path:"/patient/:id/emr/labtrackings/add",render:e=>i.a.createElement(Bn,zn({},this.state,e))}),i.a.createElement(u.a,{title:this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," Lab Order"):"Patients Lab Order",extra:i.a.createElement(o.a.Group,null,i.a.createElement(d.b,{to:"/patient/".concat(this.props.match.params.id,"/emr/labtrackings/add")},i.a.createElement(o.a,null,i.a.createElement(E.a,{type:"plus"}),"Add")))},i.a.createElement(Ge.a,{loading:this.state.loading,columns:e,dataSource:this.state.payments})))))}}var qn=Yn,Wn=a(1594),Gn=(a(834),a(464)),Hn=a.n(Gn);function Un(){return(Un=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Kn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Qn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Kn(Object(a),!0).forEach((function(t){Zn(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Kn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Zn(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Xn=S.a.Search,Jn=aa.a.TabPane,$n=Wn.a.Text,ei={_id:null,quantity:0,batch:null};class ti extends i.a.Component{constructor(e){super(e),Zn(this,"selectedDefaultDate",e=>{this.setState({selectedDate:e})}),Zn(this,"loadProformaToInvoice",()=>{const e=this;Object(N.c)(Object(N.g)(V.Od,[e.props.proformaId]),(function(t){const a=t;e.setState((function(e){const t=[];a.procedure.forEach((function(e){t.push(Qn(Qn(Qn({},e.procedure_data),e),{},{selectedDoctor:e.doctor_data,selectedDate:x()(e.date).isValid()?x()(e.date):null,_id:Math.random().toFixed(7),item_type:W.Nb}))}));const n=Qn({},e.stocks),i=Qn({},e.itemBatches);return a.inventory.forEach((function(e){if(i[e.inventory]=e.inventory_item_data.item_type_stock.item_stock||[],n[e.inventory]){const t=n[e.inventory];e.inventory_item_data.item_type_stock&&e.inventory_item_data.item_type_stock.item_stock&&e.inventory_item_data.item_type_stock.item_stock.forEach((function(e){t[e.batch_number]?t[e.batch_number]+=e.quantity:t[e.batch_number]=e.quantity}))}else{const t={};e.inventory_item_data.item_type_stock&&e.inventory_item_data.item_type_stock.item_stock&&e.inventory_item_data.item_type_stock.item_stock.forEach((function(e){t[e.batch_number]=e.quantity})),n[e.inventory_item_data.id]=t}if(n[e.inventory]){const t=n[e.inventory];t[e.batch_number]?t[e.batch_number]+=e.unit:t[e.batch_number]=e.unit}else{const t={};t[e.batch_number]=e.unit,n[e.inventory]=t}i[e.inventory]&&i[e.inventory].forEach((function(t){t.batch_number==e.batch_number&&(e.selectedBatch=t)})),t.push(Qn(Qn(Qn({},e.inventory_item_data),e),{},{selectedDoctor:e.doctor_data,_id:Math.random().toFixed(7),item_type:W.nb}))})),{tableFormValues:t,selectedDate:x()(a.date).isValid()?x()(a.date):null,notes:a.notes,courier_charge:a.courier_charge,stocks:n,itemBatches:i}}))}),(function(){}))}),Zn(this,"loadEditInvoiceData",()=>{const e=this;Object(N.c)(Object(N.g)(V.qe,[this.props.editId]),(function(t){const a=t;e.setState((function(e){const t=[];a.procedure.forEach((function(e){t.push(Qn(Qn(Qn({},e.procedure_data),e),{},{selectedDoctor:e.doctor_data,selectedDate:x()(e.date).isValid()?x()(e.date):null,_id:Math.random().toFixed(7),item_type:W.Nb}))}));const n=Qn({},e.stocks),i=Qn({},e.itemBatches);return a.inventory.forEach((function(e){if(i[e.inventory]=e.inventory_item_data.item_type_stock.item_stock||[],n[e.inventory]){const t=n[e.inventory];e.inventory_item_data.item_type_stock&&e.inventory_item_data.item_type_stock.item_stock&&e.inventory_item_data.item_type_stock.item_stock.forEach((function(e){t[e.batch_number]?t[e.batch_number]+=e.quantity:t[e.batch_number]=e.quantity}))}else{const t={};e.inventory_item_data.item_type_stock&&e.inventory_item_data.item_type_stock.item_stock&&e.inventory_item_data.item_type_stock.item_stock.forEach((function(e){t[e.batch_number]=e.quantity})),n[e.inventory_item_data.id]=t}if(n[e.inventory]){const t=n[e.inventory];t[e.batch_number]?t[e.batch_number]+=e.unit:t[e.batch_number]=e.unit}else{const t={};t[e.batch_number]=e.unit,n[e.inventory]=t}i[e.inventory]&&i[e.inventory].forEach((function(t){t.batch_number==e.batch_number&&(e.selectedBatch=t)})),t.push(Qn(Qn(Qn({},e.inventory_item_data),e),{},{selectedDoctor:e.doctor_data,_id:Math.random().toFixed(7),item_type:W.nb}))})),{tableFormValues:t,selectedDate:x()(a.date).isValid()?x()(a.date):null,notes:a.notes,courier_charge:a.courier_charge,stocks:n,itemBatches:i}}))}),(function(){}))}),Zn(this,"remove",e=>{this.setState((function(t){const a=[];return t.tableFormValues.forEach((function(t){t._id!=e&&a.push(t)})),{tableFormValues:a}}))}),Zn(this,"add",(e,t=Math.random().toFixed(7))=>{const a=this;let n=Qn({},e);this.setState((function(e){n.item_type==W.Nb?n=Qn(Qn({},n),{},{id:void 0,unit:0,unit_cost:n.cost,procedure:n.id,selectedDoctor:e.selectedDoctor?e.selectedDoctor:null,selectedDate:x()(),taxes:a.state.patientBelongToOtherState?n.state_taxes:n.taxes.map(e=>e.id),children:void 0}):n.item_type==W.nb&&(n=Qn(Qn({},n),{},{id:void 0,unit:0,inventory:n.id,unit_cost:n.retail_without_tax,selectedDoctor:e.selectedDoctor?e.selectedDoctor:null}),n.hsn_data?n.taxes=a.state.patientBelongToOtherState?n.hsn_data.state_taxes:n.hsn_data.taxes:n.taxes=[]);let i=0;return this.props.MedicalMembership&&(i=this.props.MedicalMembership.medical_membership.benefit),{tableFormValues:[Qn(Qn(Qn({},ei),n),{},{id:void 0,_id:t,discount:i}),...e.tableFormValues]}})),e.item_type==W.Nb&&e.children&&e.children.length&&e.children.forEach((function(e){a.add(Qn(Qn({},e),{},{item_type:W.Nb}))}))}),Zn(this,"selectDoctor",(e,t,a)=>{this.setState((function(n){const i=[];return n.tableFormValues.forEach((function(n){n._id==t&&n.item_type==a?i.push(Qn(Qn({},n),{},{selectedDoctor:e})):i.push(n)})),{tableFormValues:i}}))}),Zn(this,"selectedDate",(e,t,a)=>{this.setState((function(n){const i=[];return n.tableFormValues.forEach((function(n){n._id==t&&n.item_type==a?i.push(Qn(Qn({},n),{},{selectedDate:e})):i.push(n)})),{tableFormValues:i}}))}),Zn(this,"selectBatch",(e,t,a)=>{this.setState((function(n){const i=[];return n.tableFormValues.forEach((function(n){n._id==t&&n.item_type==a?i.push(Qn(Qn({},n),{},{selectedBatch:e})):i.push(n)})),{tableFormValues:i}}))}),Zn(this,"addPrescription",e=>{const t=this;t.setState((function(a){const n=Qn({},a.stocks),i=Qn({},a.itemBatches);return e.drugs.forEach((function(e){e.inventory.maintain_inventory&&t.add(Qn(Qn({},e.inventory),{},{item_type:W.nb,inventory:e.inventory.id,id:e.inventory.id}));const a={},r=e.inventory;r.item_type_stock&&r.item_type_stock.item_stock&&r.item_type_stock.item_stock.forEach((function(e){a[e.batch_number]=e.quantity})),n[r.id]=a,r.item_type_stock.item_stock&&(i[r.id]=[...r.item_type_stock.item_stock])})),{selectedPrescriptions:[...a.selectedPrescriptions,e.id],stocks:Qn(Qn({},a.stocks),n),itemBatches:Qn(Qn({},a.itemBatches),i)}}))}),Zn(this,"handleSubmit",e=>{const t=this;this.props.form.validateFields((a,n)=>{if(!a){t.setState({saveLoading:!0});const a={promo_code:t.state.promoCode,practice:t.props.active_practiceId,patient:t.props.match.params.id,unit:null,cost:null,discount:null,taxes:0,total:null,procedure:[],inventory:[],prescription:t.state.selectedPrescriptions,notes:n.notes,courier_charge:n.courier_charge,date:t.state.selectedDate&&x()(t.state.selectedDate).isValid()?t.state.selectedDate.format("YYYY-MM-DD"):null};t.state.tableFormValues.forEach((function(e){switch(e.unit=n.unit[e._id],e.taxes=n.taxes[e._id],e.item_type){case W.Nb:a.procedure.push({name:e.name,unit:e.unit,procedure:e.procedure,default_notes:null,is_active:!0,margin:e.margin,taxes:e.taxes,unit_cost:e.unit_cost,discount:e.discount,discount_type:e.discount_type,offers:e.offers,doctor:e.selectedDoctor?e.selectedDoctor.id:null,id:t.props.editId?e.id:void 0});break;case W.nb:a.inventory.push({inventory:e.inventory,name:e.name,unit:e.unit,taxes:e.taxes,unit_cost:e.unit_cost,discount:e.discount,discount_type:e.discount_type,offers:e.offers,doctor:e.selectedDoctor?e.selectedDoctor.id:null,instruction:e.instruction,is_active:!0,batch_number:e.selectedBatch?e.selectedBatch.batch_number:null,id:t.props.editId?e.id:void 0});break;default:return null}}));const i=function(a){if(t.setState({saveLoading:!1}),Object(N.a)("Inventory updated successfully"),t.props.loadData(),e)t.props.history.goBack();else{const e="/patient/".concat(t.props.match.params.id,"/billing/payments/add?invoices=").concat(a.id);t.props.history.replace(e)}},r=function(){t.setState({saveLoading:!1})};t.props.editId?Object(N.m)(Object(N.g)(V.qe,[t.props.editId]),a,i,r):Object(N.k)(V.mb,a,i,r)}})}),Zn(this,"addItemThroughQR",e=>{const t=this;t.setState({loadingQr:!0});const a=e.split("*");Object(N.c)(V.de,(function(e){const n=t.props.form,i=n.setFieldsValue,r=(n.getFieldsValue,n.getFieldValue),l=Math.random().toFixed(7);let s=!0;if(t.state.tableFormValues.forEach((function(e){if(e.name==a[0]){const t=e._id,n=e.selectedBatch.batch_number,l=r("unit[".concat(t,"]"));n==a[1]&&(s=!1,i({["unit[".concat(t,"]")]:l+1}))}})),s){let n=null;e.item_type_stock&&e.item_type_stock.item_stock&&e.item_type_stock.item_stock.forEach((function(t){t.batch_number==a[1]&&(e.selectedBatch=t,n=t.unit_cost)})),t.add(Qn(Qn({},e),{},{item_type:W.nb}),l),i({["unit_cost[".concat(l,"]")]:n})}t.setState((function(e){return{loadingQr:!1,qrValue:""}}))}),(function(){}),{qr:e,form:"Invoice"})}),Zn(this,"setQrValue",e=>{const t=e.target.value;this.setState({qrValue:t})}),Zn(this,"searchValues",(e,t)=>{const a=this,n=e.target.value;this.setState({searchItem:n},(function(){t==W.nb?a.loadInventoryItemList():t==W.Lb?a.loadPrescriptions():t==W.Nb&&a.loadProcedures()}))}),Zn(this,"changeNetPrice",(e,t)=>{const a=this,n=this.props.form,i=n.getFieldsValue;n.setFields;setTimeout((function(){const n=i();n.unit_cost[e]||n.unit[e]||n.discount[e]||n.discount_type[e]?a.setState((function(a){const i=[];return a.tableFormValues.forEach((function(r){if(r._id==e){let l=0,s=0,o="%",c=null,d=!(!r.selectOption&&0!=r.selectOption)&&r.selectOption;n.taxes[e].forEach((function(e){a.taxes_list.forEach((function(t){t.id==e&&(l+=t.tax_value)}))})),t&&"0"==t&&(d=!1),n.discount_type&&n.discount_type[e]?(s=n.discount[e],o=n.discount_type[e],c=null):(s=n.discount[e]?n.discount[e].toString().split("#")[0]:"",o=n.discount[e]?n.discount[e].toString().split("#")[1]:"",c=n.discount[e]?n.discount[e].toString().split("#")[2]:null);let p=n.unit[e]*(n.unit_cost[e]?n.unit_cost[e]:0);"%"==o&&s?(s>100&&(s=100),p*=1-.01*s):"INR"==o&&s&&(p>s?p-=s:p=0),p*=1+.01*l;const m=p/n.unit[e];i.push(Qn(Qn({},r),{},{total_unit_cost:m,total:p,selectOption:d,discount:s,discount_type:o,offers:c}))}else i.push(r)})),{tableFormValues:i}})):a.setState({retail_price:0}),a.checkPromoCode()}),1e3)}),Zn(this,"applyPromoCodeDiscounts",e=>{const t=this,a=t.props.form,n=a.setFieldsValue,i=a.getFieldsValue,r=[],l=i();let s=e;const o={};t.state.tableFormValues.forEach((function(e){let a=0;let n=0;const i=!(!e.selectOption&&0!=e.selectOption)&&e.selectOption;l.taxes[e._id].forEach((function(e){t.state.taxes_list.forEach((function(t){t.id==e&&(a+=t.tax_value)}))}));let c=l.unit[e._id]*(l.unit_cost[e._id]?l.unit_cost[e._id]:0),d=0;s&&(c>s?(c-=s,d=s,n=s,s=0):(s-=c,d=c,n=c,c=0)),c*=1+.01*a;const p=c/l.unit[e._id];r.push(Qn(Qn({},e),{},{total_unit_cost:p,total:c,selectOption:i,discount:d,discount_type:"INR",offers:null})),o["discount[".concat(e._id,"]")]=n.toFixed(2),o["discount_type[".concat(e._id,"]")]="INR"})),t.setState({tableFormValues:r}),n(o)}),Zn(this,"loadLoyaltyDiscount",()=>{const e=this;Object(N.c)(Object(N.g)(V.ad,[this.props.active_practiceId]),(function(t){e.setState({offers:t})}),(function(){e.setState({})}))}),Zn(this,"onChangeOption",(e,t)=>{this.setState((function(e){const a=[];return e.tableFormValues.forEach((function(e){e._id==t?a.push(Qn(Qn({},e),{},{selectOption:!0})):a.push(e)})),{tableFormValues:a}}))}),Zn(this,"onChangeOffer",(e,t)=>{this.setState((function(a){const n=[];return a.tableFormValues.forEach((function(i){i._id==t?("none"==e&&n.push(Qn(Qn({},i),{},{loyaltyDiscount:null})),"0"==e?n.push(Qn(Qn({},i),{},{selectOption:!1})):a.offers.forEach((function(t){t.id==e&&n.push(Qn(Qn({},i),{},{loyaltyDiscount:t.discount}))}))):n.push(i)})),{tableFormValues:n}}))}),Zn(this,"onchangeDiscountSimple",(e,t)=>{console.log(e,t);this.setState((function(a){const n=[];return a.tableFormValues.forEach((function(a){if(a._id==t){const t=a.unit_cost/(1+.01*e);console.log(t),n.push(Qn(Qn({},a),{},{loyaltyDiscount:e}))}else n.push(a)})),{tableFormValues:n}}))}),Zn(this,"enterPromoCode",e=>{this.setState({promoCode:e.target.value})}),Zn(this,"calculateGrandTotalWithoutDiscount",()=>{let e=0;const t=this,a=(0,this.props.form.getFieldsValue)();return this.state.tableFormValues.forEach((function(n){let i=0;a.taxes[n._id].forEach((function(e){t.state.taxes_list.forEach((function(t){t.id==e&&(i+=t.tax_value)}))}));let r=a.unit[n._id]*(a.unit_cost[n._id]?a.unit_cost[n._id]:0);r*=1+.01*i,e+=r})),e}),Zn(this,"checkPromoCode",e=>{const t=this;t.setState({promoCodeCheckLoading:!0});const a={promo_code:this.state.promoCode,practice:this.props.active_practiceId,patient:t.props.match.params.id,amount:this.calculateGrandTotalWithoutDiscount()};a.promo_code?Object(N.c)(V.X,(function(e){t.setState({appliedPromoCodeDiscount:e.discount,promoCodeCheckLoading:!1}),t.applyPromoCodeDiscounts(e.discount)}),(function(){t.setState({promoCodeCheckLoading:!1,appliedPromoCodeDiscount:null,promoCode:""})}),a):t.setState({promoCodeCheckLoading:!1})}),Zn(this,"removePromoCode",()=>{this.setState({appliedPromoCodeDiscount:0,promoCodeCheckLoading:!1,promoCode:""}),this.applyPromoCodeDiscounts(0)}),this.state={classType:e.type,tableFormValues:[],maxQuantityforConsume:{},items:{},practiceDoctors:[],selectedPrescriptions:[],selectedDate:x()(),stocks:{},itemBatches:{},saveLoading:!1,qrValue:"",searchItem:"",selectedDoctor:{},tempValues:{},offers:[],loading:!1,taxes_list:[],promoCode:"",appliedPromoCodeDiscount:null,promoCodeCheckLoading:!1,patientBelongToOtherState:Hn()(e,"activePracticeData.reg_state")!=Hn()(e,"currentPatient.state")},this.loadInventoryItemList=it()(this.loadInventoryItemList,500),this.loadPrescriptions=it()(this.loadPrescriptions,500),this.loadProcedures=it()(this.loadProcedures,500)}componentDidMount(){const e=this;Object(le.e)(this),this.loadInventoryItemList(),this.loadProcedures(),this.loadPrescriptions(),this.loadTaxes(),this.loadLoyaltyDiscount(),this.props.editId&&setTimeout((function(){e.setState({loading:!1}),e.loadEditInvoiceData()}),2e3),e.props.proformaId&&setTimeout((function(){e.setState({loading:!1}),e.loadProformaToInvoice()}),2e3)}loadInventoryItemList(e=1){const t=this,a=this.state.searchItem;t.setState({loadingInventory:!0});const n={practice:this.props.active_practiceId,maintain_inventory:!0,page:e};this.state.searchItem&&(n.item_name=a),Object(N.c)(V.Wb,(function(e){const n=e.results,i=[];t.state.searchItem==a&&t.setState((function(t){const a=Qn({},t.stocks),r=Qn({},t.itemBatches);n.forEach((function(e){if(i.push(e),a[e.id]){const t=a[e.id];e.item_type_stock&&e.item_type_stock.item_stock&&e.item_type_stock.item_stock.forEach((function(e){t[e.batch_number]?t[e.batch_number]+=e.quantity:t[e.batch_number]=e.quantity}))}else{const t={};e.item_type_stock&&e.item_type_stock.item_stock&&e.item_type_stock.item_stock.forEach((function(e){t[e.batch_number]=e.quantity})),a[e.id]=t}e.item_type_stock.item_stock&&(r[e.id]?r[e.id]=[...r[e.id],...e.item_type_stock.item_stock]:r[e.id]=[...e.item_type_stock.item_stock])}));const l=t.items;return l[W.nb]=Qn(Qn({},e),{},{results:i}),{items:l,stocks:Qn(Qn({},t.stocks),a),itemBatches:Qn(Qn({},t.itemBatches),r),loadingInventory:!1}}),(function(){t.props.editId&&t.loadEditInvoiceData()}))}),(function(){t.setState({loadingInventory:!1})}),n)}loadProcedures(e=1){const t=this,a=this.state.searchItem,n={practice:this.props.active_practiceId,page:e};this.state.searchItem&&(n.name=a),Object(N.c)(Object(N.g)(V.Kd,[this.props.active_practiceId]),(function(e){const n=t.state.items;n[W.Nb]=e,t.state.searchItem==a&&t.setState({items:n})}),(function(){}),n)}loadPrescriptions(){const e=this,t=this.state.searchItem,a={practice:this.props.active_practiceId};this.state.searchItem&&(a.item_name=t),Object(N.c)(Object(N.g)(V.jf,[e.props.match.params.id]),(function(a){e.state.searchItem==t&&e.setState((function(e){return{items:Qn(Qn({},e.items),{},{[W.Lb]:a})}}))}),(function(){}),a)}loadTaxes(){const e=this;Object(N.c)(Object(N.g)(V.df,[this.props.active_practiceId]),(function(t){e.setState({taxes_list:t})}),(function(){}))}render(){const e=this,t=this.props.form.getFieldDecorator,a={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:24},md:{span:24},lg:{span:24},xl:{span:24}}};t("keys",{initialValue:[]});let n=[{title:"Item Name",key:"item_name",dataIndex:"name",width:180,render(n,r){switch(r.item_type){case W.Nb:return i.a.createElement(m.a.Item,Un({key:"name[".concat(r._id,"]")},a),t("name[".concat(r._id,"]"),{validateTrigger:["onChange","onBlur"],initialValue:n,rules:[{required:!0,message:"This field is required."}]})(i.a.createElement(S.a,{min:0,placeholder:"Item name",size:"small"})),i.a.createElement("span",null,"by   "),i.a.createElement(_.a,{placement:"topCenter",overlay:i.a.createElement(h.a,null,e.state.practiceDoctors.map(t=>i.a.createElement(h.a.Item,{key:"0"},i.a.createElement("a",{onClick:()=>e.selectDoctor(t,r._id,W.Nb)},t.user.first_name)))),trigger:["click"]},i.a.createElement("a",{className:"ant-dropdown-link",href:"#"},i.a.createElement("b",null,r.selectedDoctor.user?r.selectedDoctor.user.first_name:"No DOCTORS Found"))),i.a.createElement("span",null,"   on  "),i.a.createElement(D.a,{value:r.selectedDate,size:"small",onChange:t=>e.selectedDate(t,r._id,W.Nb),format:"DD-MM-YYYY"}));case W.Lb:return i.a.createElement("b",null,r.name);case W.nb:return i.a.createElement("div",null,i.a.createElement("span",null,r.name),i.a.createElement("span",null,i.a.createElement("br",null),"by   "),i.a.createElement(_.a,{placement:"topCenter",overlay:i.a.createElement(h.a,null,e.state.practiceDoctors.map(t=>i.a.createElement(h.a.Item,{key:t.id},i.a.createElement("a",{onClick:()=>e.selectDoctor(t,r._id,W.nb)},t.user.first_name)))),trigger:["click"]},i.a.createElement("a",{className:"ant-dropdown-link",href:"#"},i.a.createElement("b",null,r.selectedDoctor.user?r.selectedDoctor.user.first_name:"No DOCTORS Found"))),i.a.createElement("span",null,i.a.createElement("br",null),"from batch   "),i.a.createElement(_.a,{placement:"topCenter",overlay:i.a.createElement(h.a,null,e.state.itemBatches[r.inventory]&&e.state.itemBatches[r.inventory].map((t,a)=>x()()>=x()(t.expiry_date)?i.a.createElement(h.a.Item,{key:a,disabled:!0},t.batch_number," (",t.quantity,")   ",t.expiry_date):i.a.createElement(h.a.Item,{key:a},i.a.createElement("a",{onClick:()=>e.selectBatch(t,r._id,W.nb)},t.batch_number," (",t.quantity,")   ",t.expiry_date)))),trigger:["click"]},i.a.createElement("a",{className:"ant-dropdown-link",href:"#"},i.a.createElement("b",null,r.selectedBatch?r.selectedBatch.batch_number:"Select Batch"))));default:return null}}}];return n=n.concat([{title:"Unit",key:"unit",width:100,dataIndex:"unit",render:(n,r)=>r.item_type==W.nb?i.a.createElement(m.a.Item,Un({key:"unit[".concat(r._id,"]")},a),t("unit[".concat(r._id,"]"),{validateTrigger:["onChange","onBlur"],initialValue:r.unit||0,rules:[{required:!0,message:"This field is required."}]})(i.a.createElement(w.a,{min:0,max:r.selectedBatch&&e.state.stocks[r.inventory]&&e.state.stocks[r.inventory][r.selectedBatch.batch_number]?e.state.stocks[r.inventory][r.selectedBatch.batch_number]:0,placeholder:"units",size:"small",onChange:e=>this.changeNetPrice(r._id,r.discount),disabled:!(r.selectedBatch&&e.state.stocks[r.inventory]&&e.state.stocks[r.inventory][r.selectedBatch.batch_number])}))):i.a.createElement(m.a.Item,Un({key:"unit[".concat(r._id,"]")},a),t("unit[".concat(r._id,"]"),{initialValue:r.unit||0,validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"This field is required."}]})(i.a.createElement(w.a,{min:0,max:100,placeholder:"unit",size:"small",onChange:e=>this.changeNetPrice(r._id,r.discount)})))},{title:"Unit Cost",key:"unit_cost",width:100,dataIndex:"unit_cost",render:(n,r)=>i.a.createElement(m.a.Item,Un({key:"unit_cost[".concat(r._id,"]")},a),t("unit_cost[".concat(r._id,"]"),{validateTrigger:["onChange","onBlur"],initialValue:r.item_type==W.nb?r.retail_without_tax:r.cost,rules:[{required:!0,message:"This field is required."}]})(i.a.createElement(w.a,{min:1,placeholder:"Unit Cost",size:"small",onChange:()=>e.changeNetPrice(r._id,r.discount)})))},{title:"Discount",key:"discount",dataIndex:"discount",render:(n,r)=>r.selectOption?i.a.createElement(m.a.Item,{key:"discount[".concat(r._id,"]"),extra:i.a.createElement("span",null,r&&r.discount?"".concat(r.discount," ").concat(r.discount_type," Discount"):null," ")},t("discount[".concat(r._id,"]"),{initialValue:r.offers,validateTrigger:["onChange","onBlur"]})(i.a.createElement(p.a,{style:{width:150},onChange:t=>e.changeNetPrice(r._id,t),size:"small",disabled:this.state.appliedPromoCodeDiscount},i.a.createElement(p.a.Option,{value:"0"},"Custom Offer"),e.state.offers.map(e=>i.a.createElement(p.a.Option,{value:"".concat(e.discount,"#").concat(e.unit,"#").concat(e.id)},e.code))))):i.a.createElement(m.a.Item,Un({extra:i.a.createElement("a",{onClick:()=>e.onChangeOption("selectOption",r._id),disabled:this.state.appliedPromoCodeDiscount},"Choose Offer"),key:"discount[".concat(r._id,"]")},a),t("discount[".concat(r._id,"]"),{initialValue:r.discount?r.discount:0,validateTrigger:["onChange","onBlur"]})(i.a.createElement(S.a,{placeholder:"discount",disabled:this.state.appliedPromoCodeDiscount,addonAfter:t("discount_type[".concat(r._id,"]"),{initialValue:r.discount_type||"%"})(i.a.createElement(p.a,{onChange:t=>e.changeNetPrice(r._id,t),disabled:this.state.appliedPromoCodeDiscount},W.A.map(e=>i.a.createElement(p.a.Option,{value:e.value}," ",e.value)))),size:"small",style:{width:150},onChange:e=>this.changeNetPrice(r._id,e.target.value)})))},{title:"Taxes",key:"taxes",dataIndex:"taxes",render:(n,r)=>i.a.createElement(m.a.Item,Un({key:"taxes[".concat(r._id,"]")},a),t("taxes[".concat(r._id,"]"),{initialValue:r.taxes||[],validateTrigger:["onChange","onBlur"]})(i.a.createElement(p.a,{placeholder:"Taxes",size:"small",mode:"multiple",style:{width:150},onChange:()=>e.changeNetPrice(r._id,r.discount)},this.state.taxes_list&&this.state.taxes_list.map(e=>i.a.createElement(p.a.Option,{value:e.id},e.name,"@",e.tax_value,"%")))))},{title:"Total Unit Cost",key:"total_unit_cost",width:80,align:"right",dataIndex:"total_unit_cost",render:(e,t)=>i.a.createElement("span",null,e?e.toFixed(2):"0.00")},{title:"Total",key:"total",width:80,align:"right",dataIndex:"total",render:(e,t)=>e?e.toFixed(2):"0.00"}]),n=n.concat([{key:"_id",dataIndex:"_id",render:(t,a)=>i.a.createElement(o.a,{icon:"close",onClick:()=>e.remove(a._id),type:"danger",shape:"circle",size:"small"})}]),i.a.createElement("div",null,i.a.createElement(l.a,{spinning:this.state.saveLoading,tip:"Saving Invoice..."},i.a.createElement(l.a,{spinning:this.state.promoCodeCheckLoading,tip:"Checking Promo Code and Discounts..."},i.a.createElement(u.a,{title:this.props.editId?"Edit Invoice ":"Add Invoice",extra:i.a.createElement(Xn,{loading:this.state.loadingQr,value:this.state.qrValue,onChange:this.setQrValue,placeholder:"Search QR Code",onSearch:this.addItemThroughQR,style:{width:200}}),bodyStyle:{padding:0}},i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement(aa.a,{size:"small",type:"card"},i.a.createElement(Jn,{tab:W.nb,key:W.nb},i.a.createElement("div",{style:{backgroundColor:"#ddd",padding:8}},i.a.createElement(S.a.Search,{placeholder:"Search in ".concat(W.nb),onChange:e=>this.searchValues(e,W.nb)})),i.a.createElement(re.a,{size:"small",itemLayout:"horizontal",loading:this.state.loadingInventory,dataSource:this.state.items&&this.state.items[W.nb]?this.state.items[W.nb].results:[],renderItem:e=>i.a.createElement(re.a.Item,null,i.a.createElement(re.a.Item.Meta,{title:"".concat(e.name," (").concat(e.total_quantity,")")}),i.a.createElement(o.a,{type:"primary",size:"small",shape:"circle",onClick:()=>this.add(Qn(Qn({},e),{},{item_type:W.nb})),icon:"arrow-right"}))}),this.state.items&&this.state.items[W.nb]?i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement("a",{style:{margin:5},disabled:!this.state.items[W.nb].previous,onClick:()=>this.loadInventoryItemList(this.state.items[W.nb].previous)},i.a.createElement(E.a,{type:"left"}),"Previous"),i.a.createElement(P.a,{type:"vertical"}),i.a.createElement("a",{style:{margin:5},disabled:!this.state.items[W.nb].next,onClick:()=>this.loadInventoryItemList(this.state.items[W.nb].next)},"Next",i.a.createElement(E.a,{type:"right"}))):null),i.a.createElement(Jn,{tab:W.Lb,key:W.Lb},i.a.createElement(re.a,{size:"small",itemLayout:"horizontal",dataSource:this.state.items?this.state.items[W.Lb]:[],renderItem:e=>i.a.createElement(re.a.Item,null,i.a.createElement(re.a.Item.Meta,{title:e.drugs.map(e=>i.a.createElement("div",null,i.a.createElement("span",null,e.name)," ",e.inventory.maintain_inventory?null:i.a.createElement(O.a,{color:"red",style:{float:"right",lineHeight:"18px"}},"Not Sold"),i.a.createElement("br",null))),description:i.a.createElement("div",null,"  ",e.doctor?i.a.createElement(O.a,{color:e.doctor?e.doctor.calendar_colour:null},i.a.createElement("b",null,"prescribed by  ".concat(e.doctor.user.first_name)," ")):null," ",i.a.createElement("span",{style:{float:"right"}},x()(e.date).format("LL")))}),i.a.createElement(o.a,{type:"primary",size:"small",shape:"circle",onClick:()=>this.addPrescription(Qn({},e)),icon:"arrow-right"}))})),i.a.createElement(Jn,{tab:W.Nb,key:W.Nb},i.a.createElement("div",{style:{backgroundColor:"#ddd",padding:8}},i.a.createElement(S.a.Search,{placeholder:"Search in ".concat(W.Nb),onChange:e=>this.searchValues(e,W.Nb)})),i.a.createElement(re.a,{size:"small",itemLayout:"horizontal",dataSource:this.state.items&&this.state.items[W.Nb]?this.state.items[W.Nb].results:[],renderItem:e=>i.a.createElement(re.a.Item,null,i.a.createElement(re.a.Item.Meta,{title:e.name}),i.a.createElement(o.a,{type:"primary",size:"small",shape:"circle",onClick:()=>this.add(Qn(Qn({},e),{},{item_type:W.Nb})),icon:"arrow-right"}))}),this.state.items&&this.state.items[W.Nb]?i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement("a",{style:{margin:5},disabled:!this.state.items[W.Nb].previous,onClick:()=>this.loadProcedures(this.state.items[W.Nb].previous)},i.a.createElement(E.a,{type:"left"}),"Previous"),i.a.createElement(P.a,{type:"vertical"}),i.a.createElement("a",{style:{margin:5},disabled:!this.state.items[W.Nb].next,onClick:()=>this.loadProcedures(this.state.items[W.Nb].next)},"Next",i.a.createElement(E.a,{type:"right"}))):null))),i.a.createElement(g.a,{span:18},i.a.createElement(m.a,null,i.a.createElement(Ge.a,{pagination:!1,loading:e.state.loading,bordered:!0,dataSource:this.state.tableFormValues,columns:n}),i.a.createElement(Lt.a,{offsetBottom:0},i.a.createElement(u.a,null,i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement(m.a.Item,{label:"Notes",key:"notes"},t("notes",{initialValue:this.state.notes,validateTrigger:["onChange","onBlur"]})(i.a.createElement(S.a.TextArea,{placeholder:"Notes...",size:"small"}))),i.a.createElement(m.a.Item,{label:"Packing & Delivery Charges",key:"courier_charge"},t("courier_charge",{initialValue:this.state.courier_charge?this.state.courier_charge:0,validateTrigger:["onChange","onBlur"]})(i.a.createElement(w.a,{style:{width:"100%"},placeholder:"Packing & Delivery Charges",size:"large"})))),i.a.createElement(g.a,{span:6,offset:1},i.a.createElement(m.a.Item,{label:"On "},i.a.createElement(D.a,{value:this.state.selectedDate,onChange:e=>this.selectedDefaultDate(e),format:"DD-MM-YYYY",allowClear:!1})),i.a.createElement("h3",null,"Grand Total: ",i.a.createElement("b",null,this.state.tableFormValues.reduce((function(e,t){return(parseFloat(e)+(t&&t.total?t.total:0)).toFixed(2)}),0)))),i.a.createElement(g.a,{span:9},i.a.createElement(m.a.Item,{style:{paddingTop:"30px"}},i.a.createElement(o.a,{type:"primary",htmlType:"submit",onClick:()=>this.handleSubmit(!0),style:{margin:5}},"Save Invoice"),i.a.createElement(o.a,{type:"primary",htmlType:"submit",onClick:()=>this.handleSubmit(!1),style:{margin:5}},"Save & Create Payment"),e.props.history?i.a.createElement(o.a,{style:{margin:5},onClick:()=>e.props.history.goBack()},"Cancel"):null)))))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:12,style:{padding:10}},i.a.createElement("div",null,this.state.appliedPromoCodeDiscount?i.a.createElement("div",null,i.a.createElement(O.a,null,"'",this.state.promoCode,"' Applied ",i.a.createElement(E.a,{onClick:()=>this.removePromoCode(),theme:"twoTone",twoToneColor:"#f00",type:"close-circle"})),i.a.createElement($n,{type:"success"},i.a.createElement("br",null),"Discount INR ",this.state.appliedPromoCodeDiscount)):i.a.createElement("div",null,i.a.createElement(Xn,{enterButton:"Apply",value:this.state.promoCode,placeholder:"Promo Code",onChange:this.enterPromoCode,onSearch:this.checkPromoCode,style:{width:200}})))))))))))}}var ai=m.a.create()(ti);function ni(){return(ni=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function ii(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ri(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ii(Object(a),!0).forEach((function(t){li(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ii(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function li(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}S.a.Search,D.a.MonthPicker,aa.a.TabPane;const si={_id:null,quantity:0,batch:null};class oi extends i.a.Component{constructor(e){super(e),li(this,"selectedDefaultDate",e=>{this.setState({selectedDate:e})}),li(this,"loadEditInvoiceData",()=>{const e=this;Object(N.c)(Object(N.g)(V.qe,[this.props.editId]),(function(t){const a=t;e.setState((function(e){const t=[];a.procedure.forEach((function(e){t.push(ri(ri(ri({},e.procedure_data),e),{},{selectedDoctor:e.doctor_data,selectedDate:x()(e.date).isValid()?x()(e.date):null,_id:Math.random().toFixed(7),item_type:W.Nb}))}));const n=ri({},e.stocks),i=ri({},e.itemBatches);return a.inventory.forEach((function(e){if(i[e.inventory]||(i[e.inventory]=e.inventory_item_data.item_type_stock.item_stock),n[e.inventory]){const t=n[e.inventory];e.inventory_item_data.item_type_stock&&e.inventory_item_data.item_type_stock.item_stock&&e.inventory_item_data.item_type_stock.item_stock.forEach((function(e){t[e.batch_number]?t[e.batch_number]+=e.quantity:t[e.batch_number]=e.quantity}))}else{const t={};e.inventory_item_data.item_type_stock&&e.inventory_item_data.item_type_stock.item_stock&&e.inventory_item_data.item_type_stock.item_stock.forEach((function(e){t[e.batch_number]=e.quantity})),n[e.inventory_item_data.id]=t}if(n[e.inventory]){const t=n[e.inventory];t[e.batch_number]?t[e.batch_number]+=e.unit:t[e.batch_number]=e.unit}else{const t={};t[e.batch_number]=e.unit,n[e.inventory]=t}i[e.inventory]&&i[e.inventory].forEach((function(t){t.batch_number==e.batch_number&&(e.selectedBatch=t)})),t.push(ri(ri(ri({},e.inventory_item_data),e),{},{selectedDoctor:e.doctor_data,_id:Math.random().toFixed(7),item_type:W.nb}))})),{tableFormValues:t,selectedDate:x()(a.date).isValid()?x()(a.date):null,stocks:n,itemBatches:i}}))}),(function(){}))}),li(this,"remove",e=>{this.setState((function(t){const a=[];return t.tableFormValues.forEach((function(t){t._id!=e&&a.push(t)})),{tableFormValues:a}}))}),li(this,"add",(e,t=Math.random().toFixed(7))=>{this.setState((function(a){return e.item_type==W.Nb?e=ri(ri({},e),{},{id:void 0,unit_cost:e.cost,procedure:e.id,selectedDoctor:a.selectedDoctor?a.selectedDoctor:null,selectedDate:x()(),taxes:e.taxes.map(e=>e.id)}):e.item_type==W.nb&&(e=ri(ri({},e),{},{id:void 0,inventory:e.id,unit_cost:e.retail_without_tax,selectedDoctor:a.selectedDoctor?a.selectedDoctor:null})),{tableFormValues:[...a.tableFormValues,ri(ri(ri({},si),e),{},{id:void 0,_id:t})]}}))}),li(this,"selectDoctor",(e,t,a)=>{this.setState((function(n){const i=[];return n.tableFormValues.forEach((function(n){n._id==t&&n.item_type==a?i.push(ri(ri({},n),{},{selectedDoctor:e})):i.push(n)})),{tableFormValues:i}}))}),li(this,"selectedDate",(e,t,a)=>{this.setState((function(n){const i=[];return n.tableFormValues.forEach((function(n){n._id==t&&n.item_type==a?i.push(ri(ri({},n),{},{selectedDate:e})):i.push(n)})),{tableFormValues:i}}))}),li(this,"selectBatch",(e,t,a)=>{this.setState((function(n){const i=[];return n.tableFormValues.forEach((function(n){n._id==t&&n.item_type==a?i.push(ri(ri({},n),{},{selectedBatch:e})):i.push(n)})),{tableFormValues:i}}))}),li(this,"addPrescription",e=>{const t=this;e.drugs.forEach((function(a){a.inventory.maintain_inventory&&t.add(ri(ri({},a.inventory),{},{item_type:W.nb,inventory:e.inventory.id,id:void 0}))})),t.setState((function(t){return{selectedPrescriptions:[...t.selectedPrescriptions,e.id]}}))}),li(this,"handleSubmit",e=>{const t=this;e.preventDefault(),this.props.form.validateFields((e,a)=>{if(!e){t.setState({saveLoading:!0});const e={bank:"",number:"",practice:t.props.active_practiceId,return_mode:null,invoice:this.props.editInvoice.id,procedure:[],inventory:[],notes:a.notes,patient:t.props.match.params.id,staff:this.props.editInvoice.staff_data?this.props.editInvoice.staff_data.id:null,prescription:t.state.selectedPrescriptions,date:t.state.selectedDate&&x()(t.state.selectedDate).isValid()?t.state.selectedDate.format("YYYY-MM-DD"):null,with_tax:!!this.state.return_with_tax,cash_return:a.cash_return,advance_value:this.state.returnCashAvailable-a.cash_return||0};t.state.tableFormValues.forEach((function(t){t.unit=a.unit[t._id];const n=t.id;if(delete t.id,t.unit)switch(t.item_type){case W.Nb:e.procedure.push(ri(ri({},t),{},{unit:t.unit,procedure_inv:n}));break;case W.nb:e.inventory.push(ri(ri({},t),{},{unit:t.unit,inventory_inv:n}));break;default:return null}}));const n=function(e){t.setState({saveLoading:!1}),Object(N.a)("Inventory updated successfully"),t.props.loadData();const a="/patient/".concat(t.props.match.params.id,"/billing/invoices");t.props.history.replace(a)},i=function(){t.setState({saveLoading:!1})};Object(N.k)(V.dc,e,n,i)}})}),li(this,"addItemThroughQR",e=>{const t=this;t.setState({loadingQr:!0});const a=e.split("*");Object(N.c)(V.de,(function(e){const n=t.props.form,i=n.setFieldsValue,r=(n.getFieldsValue,n.getFieldValue),l=Math.random().toFixed(7);let s=!0;if(t.state.tableFormValues.forEach((function(e){if(e.name==a[0]){const t=e._id,n=e.selectedBatch.batch_number,l=r("unit[".concat(t,"]"));n==a[1]&&(s=!1,i({["unit[".concat(t,"]")]:l+1}))}})),s){let n=null;e.item_type_stock&&e.item_type_stock.item_stock&&e.item_type_stock.item_stock.forEach((function(t){t.batch_number==a[1]&&(e.selectedBatch=t,n=t.unit_cost)})),t.add(ri(ri({},e),{},{item_type:W.nb}),l),i({["unit_cost[".concat(l,"]")]:n})}t.setState((function(e){return{loadingQr:!1,qrValue:""}}))}),(function(){}),{qr:e,form:"Invoice"})}),li(this,"setQrValue",e=>{const t=e.target.value;this.setState({qrValue:t})}),li(this,"searchValues",e=>{const t=e.target.value;this.setState({searchItem:t},(function(){this.loadInventoryItemList()}))}),li(this,"changeNetPrice",e=>{const t=this,a=this.props.form,n=a.getFieldsValue;a.setFields;setTimeout((function(){const a=n();a.total_unit_cost[e]?t.setState((function(t){const n=[];return t.tableFormValues.forEach((function(i){if(i._id==e){let r=0;a.taxes[e].forEach((function(e){t.taxes_list.forEach((function(t){t.id==e&&(r+=t.tax_value)}))}));const l=a.total_unit_cost[e]/(1+.01*r);n.push(ri(ri({},i),{},{unit_cost:l}))}else n.push(i)})),{tableFormValues:n}})):t.setState({retail_price:0})}),1e3)}),li(this,"onChangeHandle",e=>{const t=this;this.setState({return_with_tax:e.target.checked},(function(){t.calculateReturnCashAvailable()}))}),li(this,"calculateReturnCashAvailable",()=>{const e=this,t=this.state.editInvoice.payments.reduce((e,t)=>e+t.pay_amount,0),a=this.state.editInvoice.total-t;let n=0;const i=this.props.form.getFieldsValue;setTimeout((function(){const t=i(),r=e.state.return_with_tax;e.state.tableFormValues.forEach((function(e){const a=t.unit[e._id];(e.item_type==W.nb||e.item_type==W.Lb||e.item_type==W.Nb)&&(n+=a*e.unit_cost,n+=r?e.tax_value/e.unit*a:null)})),e.setState({returnCashAvailable:(n>a?n-a:0).toFixed(2)})}),500)}),this.state={editInvoice:this.props.editInvoice,classType:e.type,tableFormValues:[],maxQuantityforConsume:{},items:{},practiceDoctors:[],selectedPrescriptions:[],selectedDate:x()(),stocks:{},itemBatches:{},saveLoading:!1,qrValue:"",searchItem:"",return_with_tax:!1,returnCashAvailable:0}}componentDidMount(){Object(le.e)(this),this.loadProcedures(),this.loadPrescriptions(),this.loadTaxes(),this.props.editId&&this.loadEditInvoiceData()}loadInventoryItemList(){const e=this,t={page_size:1e3,practice:this.props.active_practiceId,maintain_inventory:!0};this.state.searchItem&&(t.item_name=this.state.searchItem),Object(N.c)(V.Wb,(function(t){const a=t.results,n=[];e.setState((function(t){const i=ri({},t.stocks),r={};a.forEach((function(e){if(e.item_type==W.L){if(n.push(e),i[e.id]){const t=i[e.id];e.item_type_stock&&e.item_type_stock.item_stock&&e.item_type_stock.item_stock.forEach((function(e){t[e.batch_number],t[e.batch_number]+=e.quantity}))}else{const t={};e.item_type_stock&&e.item_type_stock.item_stock&&e.item_type_stock.item_stock.forEach((function(e){t[e.batch_number]=e.quantity})),i[e.id]=t}r[e.id]=e.item_type_stock.item_stock}}));const l=e.state.items;return l[W.nb]=n,{items:l,stocks:ri(ri({},t.stocks),i),itemBatches:ri(ri({},t.itemBatches),r)}}),(function(){e.props.editId&&e.loadEditInvoiceData()}))}),(function(){}),t)}loadProcedures(){const e=this;Object(N.c)(Object(N.g)(V.Kd,[this.props.active_practiceId]),(function(t){const a=e.state.items;a[W.Nb]=t,e.setState({items:a})}),(function(){}))}loadPrescriptions(){const e=this;Object(N.c)(Object(N.g)(V.jf,[e.props.match.params.id]),(function(t){e.setState((function(e){return{items:ri(ri({},e.items),{},{[W.Lb]:t})}}))}),(function(){}))}loadTaxes(){const e=this;Object(N.c)(Object(N.g)(V.df,[this.props.active_practiceId]),(function(t){e.setState({taxes_list:t})}),(function(){}))}render(){const e=this,t=this.props.form,a=t.getFieldDecorator,n=(t.getFieldValue,t.getFieldsValue,{labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:24},md:{span:24},lg:{span:24},xl:{span:24}}});a("keys",{initialValue:[]});let r=[{title:"Item Name",key:"item_name",dataIndex:"name",render(t,r){switch(r.item_type){case W.Nb:return i.a.createElement(m.a.Item,ni({key:"name[".concat(r._id,"]")},n),a("name[".concat(r._id,"]"),{validateTrigger:["onChange","onBlur"],initialValue:t,rules:[{required:!0,message:"This field is required."}]})(i.a.createElement(S.a,{min:0,placeholder:"Item name",size:"small",disabled:!0})),i.a.createElement("span",null,"by   "),i.a.createElement(_.a,{placement:"topCenter",disabled:!0,overlay:i.a.createElement(h.a,null,e.state.practiceDoctors.map(t=>i.a.createElement(h.a.Item,{key:"0"},i.a.createElement("a",{onClick:()=>e.selectDoctor(t,r._id,W.Nb)},t.user.first_name)))),trigger:["click"]},i.a.createElement("a",{className:"ant-dropdown-link",href:"#"},i.a.createElement("b",null,r.selectedDoctor.user?r.selectedDoctor.user.first_name:"No DOCTORS Found"))),i.a.createElement("span",null,"   on  "),i.a.createElement(D.a,{value:r.selectedDate,disabled:!0,size:"small",onChange:t=>e.selectedDate(t,r._id,W.Nb),format:"DD-MM-YYYY"}));case W.Lb:return i.a.createElement("b",null,r.name);case W.nb:return i.a.createElement("div",null,r.name,i.a.createElement("span",null,i.a.createElement("br",null),"by   "),i.a.createElement(_.a,{placement:"topCenter",disabled:!0,overlay:i.a.createElement(h.a,null,e.state.practiceDoctors.map(t=>i.a.createElement(h.a.Item,{key:t.id},i.a.createElement("a",{onClick:()=>e.selectDoctor(t,r._id,W.Nb)},t.user.first_name)))),trigger:["click"]},i.a.createElement("a",{className:"ant-dropdown-link",href:"#"},i.a.createElement("b",null,r.selectedDoctor&&r.selectedDoctor.user?r.selectedDoctor.user.first_name:"+Add Doctor"))),i.a.createElement("span",null,i.a.createElement("br",null),"from batch   "),i.a.createElement(_.a,{placement:"topCenter",disabled:!0,overlay:i.a.createElement(h.a,null,e.state.itemBatches[r.inventory]&&e.state.itemBatches[r.inventory].map((t,a)=>x()()>=x()(t.expiry_date)?i.a.createElement(h.a.Item,{key:a,disabled:!0},t.batch_number," (",t.quantity,")   ",t.expiry_date):i.a.createElement(h.a.Item,{key:a},i.a.createElement("a",{onClick:()=>e.selectBatch(t,r._id,W.nb)},t.batch_number," (",t.quantity,")   ",t.expiry_date)))),trigger:["click"]},i.a.createElement("a",{className:"ant-dropdown-link",href:"#"},i.a.createElement("b",null,r.selectedBatch?r.selectedBatch.batch_number:"Select Batch"))),r.selectedBatch&&r.selectedBatch.expiry_date&&x()(r.selectedBatch.expiry_date)<x()()?i.a.createElement(O.a,{color:"#f50"},"Expired"):null);default:return null}}}];return r=r.concat([{title:"Returning Unit",key:"unit",width:100,dataIndex:"unit",render:(t,r)=>r.item_type==W.nb?i.a.createElement(m.a.Item,ni({key:"unit[".concat(r._id,"]")},n),a("unit[".concat(r._id,"]"),{validateTrigger:["onChange","onBlur"],initialValue:0})(i.a.createElement(w.a,{max:r.unit,onChange:this.calculateReturnCashAvailable,min:0,placeholder:"units",size:"small",disabled:!(r.selectedBatch&&e.state.stocks[r.inventory]&&e.state.stocks[r.inventory][r.selectedBatch.batch_number])})),i.a.createElement("span",{className:"ant-form-text"},"Items: ",r.unit)):i.a.createElement(m.a.Item,ni({key:"unit[".concat(r._id,"]")},n),a("unit[".concat(r._id,"]"),{initialValue:0,validateTrigger:["onChange","onBlur"]})(i.a.createElement(w.a,{min:0,max:r.unit,placeholder:"unit",size:"small",onChange:this.calculateReturnCashAvailable})),i.a.createElement("span",{className:"ant-form-text"},"Items: ",r.unit))},{title:"Unit Cost",key:"unit_cost",width:100,dataIndex:"unit_cost",render:(e,t)=>e?e.toFixed(2):null},{title:"discount %",key:"discount",width:100,dataIndex:"discount",render:(e,t)=>i.a.createElement(m.a.Item,ni({key:"discount[".concat(t._id,"]")},n),a("discount[".concat(t._id,"]"),{initialValue:t.discount,validateTrigger:["onChange","onBlur"]})(i.a.createElement(w.a,{min:0,max:100,placeholder:"discount",size:"small",disabled:!0})))},{title:"Taxes",key:"taxes",dataIndex:"taxes",render:(t,r)=>i.a.createElement(m.a.Item,ni({key:"taxes[".concat(r._id,"]")},n),a("taxes[".concat(r._id,"]"),{initialValue:r.taxes||[],validateTrigger:["onChange","onBlur"]})(i.a.createElement(p.a,{placeholder:"Taxes",size:"small",mode:"multiple",disabled:!0,style:{width:150},onChange:()=>e.changeNetPrice(r._id)},this.state.taxes_list&&this.state.taxes_list.map(e=>i.a.createElement(p.a.Option,{value:e.id},e.name,"@",e.tax_value,"%")))))},{title:"Total Unit Cost",key:"total",width:100,dataIndex:"total",render:(e,t)=>t.unit?(t.total/t.unit).toFixed(2):t.total.toFixed(2)}]),i.a.createElement("div",null,i.a.createElement(l.a,{spinning:this.state.saveLoading,tip:"Saving Invoice..."},i.a.createElement(y.a,{gutter:16},i.a.createElement(g.a,{span:20},i.a.createElement(u.a,{title:this.props.editId?"Return Invoice (INV ".concat(this.props.editId,")"):"Add Invoice",bodyStyle:{padding:0}},i.a.createElement(y.a,{gutter:16},i.a.createElement(g.a,{span:24},i.a.createElement(m.a,{onSubmit:this.handleSubmit,layout:"inline"},i.a.createElement(Ge.a,{pagination:!1,bordered:!0,dataSource:this.state.tableFormValues,columns:r}),i.a.createElement(Lt.a,{offsetBottom:0},i.a.createElement(u.a,null,i.a.createElement(y.a,{gutter:16},i.a.createElement(g.a,{span:6},i.a.createElement("span",null,"   on  "),i.a.createElement(D.a,{value:this.state.selectedDate,disabled:!0,onChange:e=>this.selectedDefaultDate(e),format:"DD-MM-YYYY",allowClear:!1}),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement(ve.a,{onChange:this.onChangeHandle,defaultChecked:this.state.return_with_tax},"Return With Tax")),i.a.createElement(g.a,{span:8},i.a.createElement(m.a.Item,{label:"Returned Cash "},a("cash_return")(i.a.createElement(w.a,{min:0,max:this.state.returnCashAvailable,placeholder:"Cash Returned"})),i.a.createElement("span",null,i.a.createElement("br",null),"Max Cash Return Allowed (INR) ",this.state.returnCashAvailable))),i.a.createElement(g.a,{span:10},i.a.createElement(m.a.Item,{label:"Notes",key:"notes"},a("notes",{initialValue:this.state.tableFormValues.notes,validateTrigger:["onChange","onBlur"]})(i.a.createElement(S.a.TextArea,{row:2,placeholder:"Notes...",size:"small",style:{width:"100%"}}))),i.a.createElement(m.a.Item,ni({},{labelCol:{xs:{span:24},sm:{span:24}},wrapperCol:{xs:{span:24},sm:{span:24}}},{style:{marginBottom:0,float:"right"}}),i.a.createElement(o.a,{type:"primary",htmlType:"submit",style:{margin:5}},"Save Return Invoice"),e.props.history?i.a.createElement(o.a,{style:{margin:5,float:"right"},onClick:()=>e.props.history.goBack()},"Cancel"):null)))))))))),i.a.createElement(g.a,{span:4},i.a.createElement(P.a,null,"Payments Done"),i.a.createElement(re.a,{dataSource:this.state.editInvoice.payments,renderItem:e=>i.a.createElement(u.a,{title:e.payment_id,style:{marginBottom:10},bodyStyle:{padding:5}},i.a.createElement("p",null,"Paid (INR)",i.a.createElement("span",{style:{float:"right",fontWeight:600}}," ",e.pay_amount.toFixed(2))))})))))}}var ci=m.a.create()(oi);function di(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function pi(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?di(Object(a),!0).forEach((function(t){mi(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):di(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function mi(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ui extends i.a.Component{constructor(e){super(e),mi(this,"handleSubmitReturnInvoice",e=>{const t=this;e.preventDefault(),this.props.form.validateFields((e,a)=>{if(!e){const e=pi(pi({},a),{},{practice:this.props.active_practiceId}),n=function(e){t.setState({returnIncoiceVisible:!1}),t.returnInvoiceData(t.props.editInvoice),t.props.returnInvoiceClose()},i=function(){};Object(N.k)(V.U,e,n,i)}})}),mi(this,"returnInvoiceData",e=>{const t=this;this.setState({editInvoice:e},(function(){t.props.history.push("/patient/".concat(e.patient_data.id,"/billing/invoices/return/"))}))}),this.state={returnIncoiceVisible:this.props.returnIncoiceVisible,otpSent:this.props.otpSent}}sendOTP(){Object(N.c)(V.T,(function(e){}),(function(){}))}render(){const e=this.props.form.getFieldDecorator;return i.a.createElement(C.a,{visible:this.state.returnIncoiceVisible&&this.props.editInvoice&&this.props.editInvoice.id==this.props.invoice.id,title:"Return Invoice",footer:null,onOk:this.props.handleSubmitReturnInvoice,onCancel:this.props.returnInvoiceClose},i.a.createElement(m.a,null,i.a.createElement(m.a.Item,null,e("otp",{rules:[{required:!0,message:"Please input Otp!"}]})(i.a.createElement(S.a,{prefix:i.a.createElement(E.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Otp"}))),i.a.createElement(m.a.Item,null,this.props.otpSent?i.a.createElement("a",{style:{float:"right"},type:"primary",onClick:this.sendOTP},"Resend Otp ?"):null,i.a.createElement(o.a,{size:"small",type:"primary",htmlType:"submit",onClick:this.handleSubmitReturnInvoice},"Submit")," ",i.a.createElement(o.a,{size:"small",onClick:this.props.returnInvoiceClose},"Close"))))}}var hi=m.a.create()(ui);function fi(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function yi(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?fi(Object(a),!0).forEach((function(t){gi(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):fi(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function gi(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class bi extends i.a.Component{constructor(e){super(e),gi(this,"handleSubmitEditInvoice",e=>{const t=this;e.preventDefault(),this.props.form.validateFields((e,a)=>{if(!e){const e=yi(yi({},a),{},{practice:this.props.active_practiceId}),n=function(e){t.setState({editIncoiceVisible:!1}),t.editInvoiceData(t.props.editInvoice),t.props.editInvoiceClose()},i=function(){};Object(N.k)(V.U,e,n,i)}})}),gi(this,"editInvoiceData",e=>{const t=this;this.setState({editInvoice:e},(function(){t.props.history.push("/patient/".concat(e.patient_data.id,"/billing/invoices/edit/"))}))}),this.state={otpSent:this.props.otpSent,returnIncoiceVisible:this.props.returnIncoiceVisible,editIncoiceVisible:this.props.editIncoiceVisible}}sendOTP(){Object(N.c)(V.T,(function(e){}),(function(){}))}render(){const e=this.props.form.getFieldDecorator;return i.a.createElement(C.a,{visible:this.state.editIncoiceVisible&&this.props.editInvoice&&this.props.editInvoice.id==this.props.invoice.id,title:"Edit Invoice",footer:null,onOk:this.handleSubmitEditInvoice,onCancel:this.props.editInvoiceClose},i.a.createElement(m.a,null,i.a.createElement(m.a.Item,null,e("otp",{rules:[{required:!0,message:"Please input Otp!"}]})(i.a.createElement(S.a,{prefix:i.a.createElement(E.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Otp"}))),i.a.createElement(m.a.Item,null,this.props.otpSent?i.a.createElement("a",{style:{float:"right"},type:"primary",onClick:this.sendOTP},"Resend Otp ?"):null,i.a.createElement(o.a,{size:"small",type:"primary",htmlType:"submit",onClick:this.handleSubmitEditInvoice},"Submit")," ",i.a.createElement(o.a,{size:"small",onClick:this.props.editInvoiceClose},"Close"))))}}var Ei=m.a.create()(bi),vi=a(461);function _i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Pi(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_i(Object(a),!0).forEach((function(t){ki(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function ki(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Oi=S.a.TextArea;class Ci extends i.a.Component{constructor(e){super(e),ki(this,"handleSubmitCancelInvoice",e=>{const t=this,a=t.state.otpField;e.preventDefault(),this.props.form.validateFields((e,n)=>{if(!e){const e=Pi(Pi({},n),{},{practice:this.props.active_practiceId}),i=function(e){t.setState({cancelIncoiceVisible:!1}),t.deleteInvoice(t.props.editInvoice.patient,t.props.editInvoice.id,n.cancel_note)},r=function(){};a?Object(N.k)(V.U,e,i,r):t.deleteInvoice(t.props.editInvoice.patient,t.props.editInvoice.id,n.cancel_note)}})}),this.state={cancelIncoiceVisible:this.props.cancelIncoiceVisible,otpSent:this.props.otpSent,otpField:!1}}componentDidMount(){const e=this;x()().diff(e.props.editInvoice.created_at,"minutes")>B.Cb&&e.setState({otpField:!0})}deleteInvoice(e,t,a){const n=this,i={patient:e,is_cancelled:!0,cancel_note:a};Object(N.m)(Object(N.g)(V.pe,[t]),i,(function(e){n.props.cancelInvoiceClose(),Object(N.a)(B.sc,"Invoice cancelled successfully"),n.props.loadInvoices()}),(function(){}))}sendOTP(){Object(N.c)(V.T,(function(e){}),(function(){}))}render(){const e=this.state.otpField,t=this.props.form.getFieldDecorator;return i.a.createElement(C.a,{visible:this.state.cancelIncoiceVisible,title:"Cancel Invoice",footer:null,onOk:this.handleSubmitCancelInvoice,onCancel:this.props.cancelInvoiceClose},i.a.createElement(m.a,null,i.a.createElement(m.a.Item,{key:"cancel_notes"},t("cancel_note",{rules:[{required:!0,message:vi.k}]})(i.a.createElement(Oi,{placeholder:"cancel notes"}))),e&&i.a.createElement(m.a.Item,{key:"cancelOtp"},t("otp",{rules:[{required:!0,message:"Please input Otp!"}]})(i.a.createElement(S.a,{prefix:i.a.createElement(E.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Otp"}))),i.a.createElement(m.a.Item,null,this.props.otpSent?i.a.createElement("a",{style:{float:"right"},type:"primary",onClick:this.sendOTP},"Resend Otp ?"):null,i.a.createElement(o.a,{size:"small",type:"primary",htmlType:"submit",onClick:this.handleSubmitCancelInvoice},"Submit")," ",i.a.createElement(o.a,{size:"small",onClick:this.cancelInvoiceClose},"Close"))))}}var Si=m.a.create()(Ci);function Ii(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function xi(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ii(Object(a),!0).forEach((function(t){ji(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ii(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Di(){return(Di=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function ji(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}C.a.confirm;class wi extends i.a.Component{constructor(e){super(e),ji(this,"loadPDF",e=>{Object(N.c)(Object(N.g)(V.cc,[e]),(function(e){e.report&&window.open(Oe.a+e.report)}),(function(){}))}),ji(this,"returnModelOpen",e=>{const t=this;t.setState({returnIncoiceVisible:!0,editIncoiceVisible:!1,cancelIncoiceVisible:!1,editInvoice:e});const a={practice:this.props.active_practiceId,type:"".concat("Invoice:").concat(e.invoice_id," ")+"Return"};Object(N.k)(V.S,a,(function(a){t.setState({otpSent:!0,patientId:e.patient,invoiceId:e.id})}),(function(){}))}),ji(this,"cancelModalOpen",e=>{const t=this,a=x()().diff(e.created_at,"minutes");t.setState({cancelIncoiceVisible:!0,editIncoiceVisible:!1,returnIncoiceVisible:!1,editInvoice:e});const n={practice:this.props.active_practiceId,type:"".concat("Invoice:").concat(e.invoice_id," ")+" Cancellation"},i=function(a){t.setState({otpSent:!0,patientId:e.patient,invoiceId:e.id})},r=function(){};a>B.Cb&&Object(N.k)(V.S,n,i,r)}),ji(this,"editInvoiceClose",()=>{this.setState({editIncoiceVisible:!1})}),ji(this,"returnInvoiceClose",()=>{this.setState({returnIncoiceVisible:!1})}),ji(this,"cancelInvoiceClose",()=>{this.setState({cancelIncoiceVisible:!1})}),ji(this,"updateFormValue",(e,t)=>{this.setState({[e]:t})}),ji(this,"mailModalOpen",()=>{this.setState({visibleMail:!0})}),ji(this,"mailModalClose",()=>{this.setState({visibleMail:!1})}),ji(this,"sendPatientMail",e=>{this.mailModalOpen(),this.setState({patientName:zt.get(e,"patient_data.user.first_name"),paymentId:zt.get(e,"id"),mail_to:zt.get(e,"patient_data.user.email")})}),ji(this,"sendMailToPatient",()=>{const e=this.state,t=e.mail_to,a=e.paymentId,n={mail_to:t};Object(le.i)(Object(N.g)(V.cc,[a]),n),this.mailModalClose()}),this.state={currentPatient:this.props.currentPatient,active_practiceId:this.props.active_practiceId,invoices:[],drug_catalog:null,procedure_category:null,taxes_list:null,editInvoice:null,loading:!0,returnIncoiceVisible:!1,editIncoiceVisible:!1,cancelIncoiceVisible:!1},this.loadInvoices=this.loadInvoices.bind(this),this.loadDrugCatalog=this.loadDrugCatalog.bind(this),this.loadProcedureCategory=this.loadProcedureCategory.bind(this),this.loadTaxes=this.loadTaxes.bind(this)}componentDidMount(){this.loadInvoices()}loadInvoices(e=1){const t=this;t.props.refreshWallet&&1==e&&t.props.refreshWallet(),t.setState({loading:!0});const a={page:e,practice:this.props.active_practiceId,summary:!0};this.props.match.params.id&&(a.patient=this.props.match.params.id),Object(N.c)(V.bc,(function(e){1==e.current?t.setState({total:e.count,invoices:e.results,loading:!1,loadMoreInvoice:e.next}):t.setState((function(t){return{total:e.count,invoices:[...t.invoices,...e.results],loading:!1,loadMoreInvoice:e.next}}))}),(function(){t.setState({loading:!1})}),a)}loadDrugCatalog(){const e=this;Object(N.c)(Object(N.g)(V.qb,[this.props.active_practiceId]),(function(t){e.setState({drug_catalog:t})}),(function(){}))}loadProcedureCategory(){const e=this;Object(N.c)(Object(N.g)(V.Kd,[this.props.active_practiceId]),(function(t){e.setState({procedure_category:t})}),(function(){}))}loadTaxes(){const e=this;Object(N.c)(Object(N.g)(V.df,[this.props.active_practiceId]),(function(t){e.setState({taxes_list:t})}),(function(){}))}editModelOpen(e){const t=this,a=x()().diff(e.created_at,"minutes");t.setState({editIncoiceVisible:!0,cancelIncoiceVisible:!1,returnIncoiceVisible:!1,editInvoice:e});const n={practice:this.props.active_practiceId,type:"".concat("Invoice:").concat(e.invoice_id," ")+"Edit"},i=function(a){t.setState({otpSent:!0,patientId:e.patient,invoiceId:e.id})},r=function(){};a>B.Cb?Object(N.k)(V.S,n,i,r):t.props.history.push("/patient/".concat(e.patient_data.id,"/billing/invoices/edit/"))}deleteInvoice(e,t){const a=this,n={patient:e,is_cancelled:!0};Object(N.m)(Object(N.g)(V.pe,[t]),n,(function(e){Object(N.a)(B.sc,"Invoice cancelled successfully"),a.loadInvoices()}),(function(){}))}render(){const e=this,t={};this.state.drug_catalog&&this.state.drug_catalog.forEach((function(e){t[e.id]="".concat(e.name,",").concat(e.strength)}));const a={};this.state.procedure_category&&this.state.procedure_category.forEach((function(e){a[e.id]=e.name}));const n={};return this.state.taxes_list&&this.state.taxes_list.forEach((function(e){n[e.id]=e.name})),this.props.match.params.id?i.a.createElement("div",null,i.a.createElement(c.d,null,i.a.createElement(c.b,{path:"/patient/:id/billing/invoices/add",render:e=>this.props.activePracticePermissions.PatientAddEditInvoices?i.a.createElement(ai,Di({},e,this.props,{loadData:this.loadInvoices})):i.a.createElement(G.a,null)}),i.a.createElement(c.b,{path:"/patient/:id/billing/invoices/edit",render:e=>this.state.editInvoice?this.props.activePracticePermissions.PatientAddEditInvoices?i.a.createElement(ai,Di({},this.state,e,this.props,{editId:this.state.editInvoice.id,loadData:this.loadInvoices})):i.a.createElement(G.a,null):i.a.createElement(c.a,{to:"/patient/".concat(this.props.match.params.id,"/billing/invoices")})}),i.a.createElement(c.b,{path:"/patient/:id/billing/invoices/return",render:e=>this.state.editInvoice?this.props.activePracticePermissions.PatientAddEditReturns?i.a.createElement(ci,Di({},this.state,e,{editId:this.state.editInvoice.id,loadData:this.loadInvoices})):i.a.createElement(G.a,null):i.a.createElement(c.a,{to:"/patient/".concat(this.props.match.params.id,"/billing/invoices")})}),i.a.createElement(c.b,null,i.a.createElement("div",null,i.a.createElement(f.a,{banner:!0,showIcon:!0,type:"info",message:"The invoices shown are only for the current selected practice!"}),i.a.createElement(Lt.a,{offsetTop:0},i.a.createElement(u.a,{bodyStyle:{padding:0},style:{boxShadow:"0 5px 8px rgba(0, 0, 0, 0.09)"},title:(this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," Invoice "):"Invoices ")+(this.state.total?"(Total:".concat(this.state.total,")"):""),extra:i.a.createElement(o.a.Group,null,i.a.createElement(d.b,{to:"/patient/".concat(this.props.match.params.id,"/billing/invoices/add")},i.a.createElement(o.a,{type:"primary",disabled:!this.props.activePracticePermissions.PatientAddEditInvoices},i.a.createElement(E.a,{type:"plus"}),"Add")))})),this.state.invoices.map(t=>Fi(t,e)),i.a.createElement(l.a,{spinning:this.state.loading},i.a.createElement(y.a,null)),i.a.createElement(L.a,{loaderFunction:()=>this.loadInvoices(this.state.loadMoreInvoice),loading:this.state.loading,hidden:!this.state.loadMoreInvoice})))),i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send Invoice To ",this.state.patientName," ?"),i.a.createElement(S.a,{value:e.state.mail_to,placeholder:"Email",onChange:t=>e.updateFormValue("mail_to",t.target.value)})),e.state.cancelIncoiceVisible?i.a.createElement(Si,Di({key:"cancelInvoice1"},e.state,{cancelInvoiceClose:e.cancelInvoiceClose,loadInvoices:e.loadInvoices})):null):i.a.createElement("div",null,i.a.createElement(Lt.a,{offsetTop:0},i.a.createElement(u.a,{bodyStyle:{padding:0},style:{boxShadow:"0 5px 8px rgba(0, 0, 0, 0.09)"},title:(this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," Invoice "):"Invoice ")+(this.state.total?"(Total:".concat(this.state.total,")"):""),extra:i.a.createElement(o.a.Group,null,i.a.createElement(o.a,{type:"primary",onClick:()=>this.props.togglePatientListModal(!0),disabled:!this.props.activePracticePermissions.PatientAddEditInvoices},i.a.createElement(E.a,{type:"plus"}),"Add"))})),this.state.invoices.map(t=>Fi(t,e)),i.a.createElement(l.a,{spinning:this.state.loading},i.a.createElement(y.a,null)),i.a.createElement(L.a,{loaderFunction:()=>this.loadInvoices(this.state.loadMoreInvoice),loading:this.state.loading,hidden:!this.state.loadMoreInvoice}),i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send invoice To ",this.state.patientName," ?"),i.a.createElement(S.a,{value:e.state.mail_to,placeholder:"Email",onChange:t=>e.updateFormValue("mail_to",t.target.value)})),e.state.cancelIncoiceVisible?i.a.createElement(Si,Di({key:"cancelInvoice2"},e.state,{cancelInvoiceClose:e.cancelInvoiceClose,loadInvoices:e.loadInvoices})):null)}}var Mi=m.a.create()(wi);function Ti(e){return e?i.a.createElement("p",null,e.doctor?i.a.createElement(Bt.a,{title:"Doctor"},i.a.createElement(O.a,{color:e.doctor?e.doctor.calendar_colour:null},i.a.createElement("b",null,"prescribed by  ".concat(e.doctor.user.first_name)," "))):null,e.practice?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,e.practice.name," "))):null,e.courier_charge?i.a.createElement("p",null,"Packing and Delivery Charges : ",e.courier_charge," INR"):null,e.notes?i.a.createElement("p",null,"Notes : ",e.notes):null,e.cancel_note?i.a.createElement("p",null,"Cancel Notes : ",e.cancel_note):null):null}function Fi(e,t){let a=[...e.procedure,...e.inventory];if(e.reservation){const t=e.reservation_data.medicines.map(t=>Object.create(xi(xi({},t),{},{unit:1,total:t.final_price,unit_cost:t.price,discount:0,courier_charge:e.courier_charge}))),n={NORMAL:{total:"final_normal_price",tax:"normal_tax_value",unit_cost:"normal_price"},TATKAL:{total:"final_tatkal_price",tax:"tatkal_tax_value",unit_cost:"tatkal_price"}};a=[...a,xi(xi({},e.reservation_data.bed_package),{},{unit:1,total:e.reservation_data.bed_package?e.reservation_data.bed_package[n[e.reservation_data.seat_type].total]:null,tax_value:e.reservation_data.bed_package?e.reservation_data.bed_package[n[e.reservation_data.seat_type].tax]:null,unit_cost:e.reservation_data.bed_package?e.reservation_data.bed_package[n[e.reservation_data.seat_type].unit_cost]:null}),...t]}return i.a.createElement(u.a,{key:e.id,style:{marginTop:10},bodyStyle:{padding:0},title:i.a.createElement("small",null,e.date?x()(e.date).format("ll"):null,t.state.currentPatient?null:i.a.createElement("span",null,i.a.createElement(d.b,{to:"/patient/".concat(e.patient_data?e.patient_data.id:null,"/billing/invoices")},"   ",e.patient_data?e.patient_data.user.first_name:null," (ID: ",e.patient_data&&e.patient_data.custom_id?e.patient_data.custom_id:e.patient_data.id,") "),", ",e.patient_data?e.patient_data.gender:null)),extra:i.a.createElement(_.a.Button,{size:"small",style:{float:"right"},overlay:i.a.createElement(h.a,null,i.a.createElement(h.a.Item,{key:"1",disabled:!t.props.activePracticePermissions.PatientAddEditPayments},i.a.createElement(d.b,{to:"/patient/".concat(e.patient_data?e.patient_data.id:null,"/billing/payments/add?invoices=").concat(e.id)},i.a.createElement(E.a,{type:"dollar"}),"  Pay")),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"2",onClick:()=>t.editModelOpen(e),disabled:e.practice!=t.props.active_practiceId||e.payments_data||e.is_cancelled||!t.props.activePracticePermissions.PatientAddEditInvoices},i.a.createElement(E.a,{type:"edit"}),"Edit"),i.a.createElement(h.a.Item,{key:"5",onClick:()=>t.returnModelOpen(e),disabled:e.practice!=t.props.active_practiceId||e.is_cancelled||!t.props.activePracticePermissions.PatientAddEditReturns},i.a.createElement(E.a,{type:"redo"}),"Return"),i.a.createElement(h.a.Item,{key:"3",onClick:()=>t.cancelModalOpen(e),disabled:e.practice!=t.props.active_practiceId||e.payments_data||e.is_cancelled||!t.props.activePracticePermissions.PatientAddEditInvoices},i.a.createElement(E.a,{type:"delete"}),"Cancel"),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"4"},i.a.createElement(d.b,{to:"/patient/".concat(e.patient,"/emr/timeline")},i.a.createElement(E.a,{type:"clock-circle"}),"Patient Timeline")),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"5"},i.a.createElement("a",{onClick:()=>t.sendPatientMail(e)},i.a.createElement(E.a,{type:"mail"})," Send mail to patient")))},i.a.createElement("a",{onClick:()=>t.loadPDF(e.id)},i.a.createElement(E.a,{type:"printer"})))},i.a.createElement(y.a,{gutter:8},i.a.createElement(g.a,{xs:24,sm:24,md:6,lg:4,xl:4,xxl:4,style:{padding:10}},e.is_cancelled?i.a.createElement(f.a,{message:"Cancelled",type:"error",showIcon:!0}):null,i.a.createElement(P.a,{style:{marginBottom:0}},e.invoice_id),i.a.createElement(v.a,{title:"Paid / Total ",value:e.payments_data?e.payments_data.toFixed(2):0,suffix:"/ ".concat(e.total?e.total.toFixed(2):0)})),i.a.createElement(g.a,{xs:24,sm:24,md:18,lg:20,xl:20,xxl:20},(e=>{switch(console.log("tableObjects",a),e.type){case B.lb:return i.a.createElement(Ge.a,{bordered:!0,pagination:!1,columns:Ai,dataSource:[{inventory:!0,name:"Membership",unit_cost:e.total,unit:1,discount_value:0,tax_value:0,total:e.total},{name:"Total",unit_cost:e.total,unit:1,discount_value:0,tax_value:0,total:e.total}],footer:()=>Ti({practice:e.practice_data,notes:e.notes,cancel_note:e.cancel_note,courier_charge:e.courier_charge})});case B.Yb:return i.a.createElement(Ge.a,{bordered:!0,pagination:!1,columns:Ai,dataSource:[{inventory:!0,name:"Registration",unit_cost:e.total,unit:1,discount_value:0,tax_value:0,total:e.total},{name:"Total",unit_cost:e.total,unit:1,discount_value:0,tax_value:0,total:+e.total}],footer:()=>Ti({practice:e.practice_data,notes:e.notes,cancel_note:e.cancel_note,courier_charge:e.courier_charge})});case B.eb:case"Bed Booking":return i.a.createElement(Ge.a,{bordered:!0,pagination:!1,columns:Ai,dataSource:[...a,{name:"Total",unit_cost:a.reduce((function(e,t){return e+t.unit_cost}),0),unit:a.reduce((function(e,t){return e+t.unit}),0),discount_value:a.reduce((function(e,t){return e+t.discount_value}),0),tax_value:a.reduce((function(e,t){return e+t.tax_value}),0),total:a.reduce((function(e,t){return e+t.total}),0)}],footer:()=>Ti({practice:e.practice_data,notes:e.notes,cancel_note:e.cancel_note,courier_charge:e.courier_charge})});default:return null}})(e))),t.state.editIncoiceVisible&&t.state.otpSent&&i.a.createElement(Ei,Di({key:"editInvoice"},t.state,{invoice:e,editInvoiceClose:t.editInvoiceClose},t.props)),t.state.returnIncoiceVisible&&t.state.otpSent&&i.a.createElement(hi,Di({key:"returnInvoice"},t.state,{invoice:e,returnInvoiceClose:t.returnInvoiceClose},t.props)))}const Ai=[{title:"S.No",key:"s_no",dataIndex:"s_no",render:(e,t,a)=>a+1},{title:"Treatment & Products",dataIndex:"drug",key:"drug",render:(e,t)=>i.a.createElement("span",null," ",i.a.createElement("b",null,t.name?t.name:null),i.a.createElement("br",null)," ",t.doctor_data?i.a.createElement(O.a,{color:t.doctor_data?t.doctor_data.calendar_colour:null},i.a.createElement("b",null,"prescribed by  ".concat(t.doctor_data.user.first_name)," ")):null)},{title:"Cost",dataIndex:"unit_cost",key:"unit_cost",render:(e,t)=>i.a.createElement("span",null,t.unit_cost?t.unit_cost.toFixed(2):0)},{title:"Unit",dataIndex:"unit",key:"unit"},{title:"Discount",dataIndex:"discount_value",key:"discount_value",render:(e,t)=>i.a.createElement("span",null,t.discount_value?t.discount_value.toFixed(2):0)},{title:"Tax",dataIndex:"tax_value",key:"tax_value",render:(e,t)=>i.a.createElement("span",null,t.tax_value?t.tax_value.toFixed(2):0)},{title:"Total",dataIndex:"total",key:"total",render:e=>e?e.toFixed(2):0}];function Ni(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Vi(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ni(Object(a),!0).forEach((function(t){Li(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ni(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Li(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Ri extends i.a.Component{constructor(e){super(e),Li(this,"loadEditPyament",e=>{const t=this,a={},n=[];let i=0;this.setState((function(r){return e.forEach((function(e){a[e.invoice]=!0,n.push(Vi(Vi({},e),e.invoice_data)),i+=e.pay_amount+e.pay_amount_wallet}),(function(){t.calculateInvoicePayments(),t.setPaymentAmount(i)})),{addedInvoice:n,addedInvoiceId:a}}))}),Li(this,"loadAvailableAdvance",()=>{const e=this;Object(N.c)(Object(N.g)(V.y,[e.props.match.params.id]),(function(t){e.setState({availableAdvance:t})}),(function(){}),{practice_id:this.props.active_practiceId})}),Li(this,"loadPaymentModes",()=>{const e=this;Object(N.c)(Object(N.g)(V.zd,[this.props.active_practiceId]),(function(t){t.length&&(t[0].mode==W.Fb&&e.setState({paymentModeOffline:!0}),e.setState({paymentModes:t,selectedPaymentMode:t[0].id}))}),(function(){}))}),Li(this,"loadInvoices",e=>{const t=this;t.setState({invoiceLoading:!0});Object(N.c)(V.bc,(function(a){t.setState((function(e){return{invoicesList:[...a.results,...e.addedInvoice],invoiceLoading:!1,loadMoreInvoice:a.next}}),(function(){e&&e.forEach((function(e){t.addInvoiceToPayments(e)})),t.calculateInvoicePayments()}))}),(function(){t.setState({invoiceLoading:!1})}),{page:t.state.loadMoreInvoice||1,is_cancelled:!1,is_pending:!0,patient:this.props.match.params.id,practice:this.props.active_practiceId})}),Li(this,"addInvoiceToPayments",e=>{const t=this;this.setState((function(t){let a=null;return t.invoicesList.forEach((function(t){t.id==e&&(a=t)})),a?{addedInvoice:[...t.addedInvoice,a],addedInvoiceId:Vi(Vi({},t.addedInvoiceId),{},{[e]:!0}),invoicePayments:Vi(Vi({},t.addedInvoiceId),{},{[e]:0})}:null}),(function(){t.calculateInvoicePayments()}))}),Li(this,"removeInvoiceToPayments",e=>{const t=this;this.setState((function(t){const a=[];return t.addedInvoice.forEach((function(t){t.id!=e&&a.push(t)})),a?{addedInvoice:a,addedInvoiceId:Vi(Vi({},t.addedInvoiceId),{},{[e]:!1})}:null}),(function(){t.calculateInvoicePayments()}))}),Li(this,"calculateInvoicePayments",()=>{this.setState((function(e){let t=0,a=e.totalPayingAmount+e.totalPayingFromAdvanceAmount;const n={};return e.addedInvoice.forEach((function(e){let i=e.total-e.payments_data;e.pay_amount&&(i+=e.pay_amount),e.pay_amount_wallet&&(i+=e.pay_amount_wallet),t+=i,a>=i?(a-=i,n[e.id]=i):(n[e.id]=a,a=0)})),{advanceToBeSent:a,totalPayableAmount:t.toFixed(2),invoicePayments:n}}))}),Li(this,"setPaymentAmount",e=>{const t=this;this.setState({totalPayingAmount:e},(function(){t.calculateInvoicePayments()}))}),Li(this,"setPaymentFromAdvanceAmount",e=>{const t=this;this.setState({totalPayingFromAdvanceAmount:e},(function(){t.calculateInvoicePayments()}))}),Li(this,"changeSelectedPaymentMode",e=>{this.state.paymentModes.forEach(t=>{t.id==e&&(t.mode==W.Fb?this.setState({paymentModeOffline:!0}):this.setState({paymentModeOffline:!1}))}),this.setState({selectedPaymentMode:e})}),Li(this,"changeNotes",e=>{this.setState({notes:e})}),Li(this,"selectedDate",e=>{this.setState({selectDate:e})}),Li(this,"handleSubmit",e=>{if(!this.state.totalPayingAmount&&!this.state.totalPayingFromAdvanceAmount)return Object(N.a)(B.Dc,"Payment Amount of O INR is not allowed."),!1;this.setState({loading:!0});const t=this,a={invoices:[],bank:"",number:0,is_active:!0,notes:t.state.notes,is_cancelled:!1,practice:t.props.active_practiceId,patient:t.props.match.params.id,payment_mode:t.state.selectedPaymentMode,advance_value:t.state.advanceToBeSent,is_advance:!!t.state.advanceToBeSent,date:x()(t.state.selectDate).format("YYYY-MM-DD")},n=[];t.state.totalPayingAmount-t.state.totalPayableAmount>1&&(n.advance_value=t.state.totalPayingAmount-t.state.totalPayableAmount,n.is_advance=!0);const i=Object.keys(t.state.invoicePayments),r=Vi({},t.state.invoicePayments);let l=t.state.totalPayingFromAdvanceAmount,s=0;for(l&&t.state.availableAdvance.data.forEach((function(e){let t=l;e.advance_value<t&&(t=e.advance_value),t<0&&(t=0);let a=0;for(;l&&i.length>s;)r[i[s]]&&t>r[i[s]]?(e.advance_value-=r[i[s]],e.invoices.push({pay_amount_advance:r[i[s]],pay_amount:r[i[s]],is_active:!0,invoice:i[s]}),s++,l-=r[i[s]],r[i[s]]-=r[i[s]]):r[i[s]]&&(e.invoices.push({pay_amount_advance:t,pay_amount:t,is_active:!0,invoice:i[s]}),r[i[s]]-=t,l-=t,e.advance_value-=t),e.advance_value||(e.is_advance=!1),console.log(a++);n.push(e)}));i.length>s;s++)a.invoices.push({pay_amount:r[i[s]],type:"Invoice",is_active:!0,invoice:i[s]});this.props.editPayment&&this.props.editPayment.id&&(a.id=this.props.editPayment.id),(a.invoices.length&&this.state.totalPayingAmount||a.id||a.is_advance)&&n.push(a),t.state.receivedPayIdFromRazorPay&&(a.bank="RazorPay",a.number=t.state.receivedPayIdFromRazorPay);Object(N.k)(V.O,n,(function(e){t.setState({loading:!1}),t.props.loadData(),t.props.history.replace("/patient/".concat(t.props.match.params.id,"/billing/payments"))}),(function(){t.setState({loading:!1})}))}),this.state={invoicesList:[],invoiceLoading:!0,addedInvoiceId:{},addedInvoice:[],paymentModes:[],totalPayableAmount:0,invoicePayments:{},totalPayingAmount:0,totalPayingFromAdvanceAmount:0,selectedPaymentMode:null,availableAdvance:null,advanceToBeSent:0,selectDate:x()(),loading:!1,paymentModeOffline:!1},this.loadEditPyament=this.loadEditPyament.bind(this)}componentWillMount(){const e=this;e.props.editPayment&&e.props.editPayment.invoices&&e.loadEditPyament(e.props.editPayment.invoices);let t=[];if(this.props.history&&this.props.history.location.search){const e=this.props.history.location.search.substr(1).split("&");e.length&&e.forEach((function(e){"invoices"==e.split("=")[0]&&(t=e.split("=")[1].split(","))}))}this.loadInvoices(t),this.loadPaymentModes(),this.loadAvailableAdvance()}paymentHandler(e,t,a){if(!a)return Object(N.a)(B.Dc,"Payment Amount of O INR is not allowed."),!1;const n=this,i={key:Oe.c,amount:100*a.toFixed(2),name:t.custom_id,description:"Payment for ".concat(e),prefill:{name:t.user.first_name,email:t.user.email,contact:t.user.mobile},handler(e){const t=e.razorpay_payment_id,i={payment_id:t,amount:a};n.setState({loading:!0});Object(N.k)(V.a,i,(function(e){Object(N.a)(B.sc,e.detail),n.setState({loading:!1,receivedPayIdFromRazorPay:t},(function(){n.handleSubmit()}))}),(function(){n.setState({loading:!1}),console.log("Request failed")}))}};new window.Razorpay(i).open()}render(){const e=this;return(i.a.createElement("div",null,i.a.createElement(l.a,{spinning:this.state.loading,size:"large"},i.a.createElement(y.a,{gutter:8},i.a.createElement(g.a,{xs:24,sm:24,md:16,lg:16,xl:18,xxl:18},i.a.createElement(u.a,null,i.a.createElement(y.a,null,i.a.createElement(g.a,{span:24},i.a.createElement("table",{style:{width:"100%"}},i.a.createElement("tbody",null,i.a.createElement("tr",{style:{borderBottom:"2px solid #ccc"}},i.a.createElement("td",{style:{width:"20%"}},i.a.createElement("small",null,"INVOICE NO")),i.a.createElement("td",{style:{width:"20%"}},i.a.createElement("small",null,"PROCEDURE")),i.a.createElement("td",{style:{width:"20%",textAlign:"right"}},i.a.createElement("small",null,"DUE(INR)")),i.a.createElement("td",{style:{width:"20%",textAlign:"right"}},i.a.createElement("small",null,"PAY NOW(INR)")),i.a.createElement("td",{style:{width:"20%",textAlign:"right"}},i.a.createElement("small",null,"DUE AFTER PAYMENT(INR)"))),this.state.addedInvoice.map(t=>i.a.createElement("tr",{style:{borderBottom:"2px solid #ccc"}},i.a.createElement("td",null,i.a.createElement(o.a,{size:"small",type:"danger",shape:"circle",icon:"close",style:{position:"absolute",right:"-35px"},onClick:()=>this.removeInvoiceToPayments(t.id)}),i.a.createElement("h3",null,t.invoice_id),t.date),i.a.createElement("td",null,t.procedure.map(e=>"".concat(e.procedure_data.name,", ")),t.inventory.map(e=>"".concat(e.inventory_item_data.name,", ")),t.reservation?"".concat(t.type,","):null,t.reservation_data&&t.reservation_data.medicines?t.reservation_data.medicines.map(e=>"".concat(e.name,",")):null),i.a.createElement("td",{style:{textAlign:"right"}},i.a.createElement("b",null,(t.total-t.payments_data+(t.pay_amount||0)+(t.pay_amount_wallet||0)).toFixed(2))),i.a.createElement("td",{style:{textAlign:"right"}},i.a.createElement("b",null,e.state.invoicePayments[t.id])),i.a.createElement("td",{style:{textAlign:"right"}},i.a.createElement("b",null,(t.total-t.payments_data+(t.pay_amount||0)+(t.pay_amount_wallet||0)-e.state.invoicePayments[t.id]).toFixed(2))))))))),i.a.createElement(y.a,{style:{borderBottom:"2px dashed #ccc",marginTop:"20px"}},i.a.createElement(g.a,{span:6},i.a.createElement("h3",null,"Total Payable :")),i.a.createElement(g.a,{span:6},i.a.createElement("h2",null,this.state.totalPayableAmount))),i.a.createElement(y.a,{gutter:16,style:{marginTop:"20px"}},i.a.createElement(g.a,{span:12},i.a.createElement(y.a,null,i.a.createElement(g.a,{span:12},i.a.createElement("h3",null,"Amount From Advance :",i.a.createElement("br",null),i.a.createElement("small",null,"Available: ",this.state.availableAdvance?this.state.availableAdvance.max_allowed:0," INR"))),i.a.createElement(g.a,{span:12},i.a.createElement(w.a,{min:0,step:1,max:this.state.availableAdvance?this.state.availableAdvance.max_allowed:0,disabled:!this.state.availableAdvance||!this.state.availableAdvance.max_allowed,value:this.state.totalPayingFromAdvanceAmount,onChange:this.setPaymentFromAdvanceAmount}))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:12},i.a.createElement("h3",null,"Pay Now:")),i.a.createElement(g.a,{span:12},i.a.createElement(w.a,{min:0,step:1,value:this.state.totalPayingAmount,onChange:this.setPaymentAmount})))),i.a.createElement(g.a,{span:12},i.a.createElement(y.a,null,i.a.createElement(g.a,{span:10},i.a.createElement("h3",null,"Payment Mode :")),i.a.createElement(g.a,{span:12},i.a.createElement(p.a,{style:{width:"100%"},value:this.state.selectedPaymentMode,onChange:this.changeSelectedPaymentMode},this.state.paymentModes.map(e=>i.a.createElement(p.a.Option,{value:e.id,key:e.id},e.mode))),i.a.createElement("br",null),i.a.createElement("br",null))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:24},i.a.createElement(S.a.TextArea,{row:2,placeholder:"Notes...",size:"small",onChange:e=>this.changeNotes(e.target.value)},this.state.notes))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement("br",null),i.a.createElement("span",null,"   on  "),i.a.createElement(D.a,{style:{width:150},defaultValue:x()(),onChange:t=>e.selectedDate(t),allowClear:!1}))))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:24,style:{align:"center"}},i.a.createElement(k.a,{title:"Are you sure to take payment of INR ".concat(this.state.totalPayingAmount,"?"),onConfirm:()=>this.paymentHandler(this.state.addedInvoice.map(e=>e.invoice_id).join(", "),this.props.currentPatient,this.state.totalPayingAmount)},i.a.createElement(o.a,{type:"primary",style:{margin:5},disabled:e.props.editPayment&&e.props.editPayment.invoices||e.state.paymentModeOffline},"Pay Online & Save Payments")),i.a.createElement(k.a,{title:"Are you sure to take payment of INR ".concat(this.state.totalPayingAmount,"?"),onConfirm:this.handleSubmit},i.a.createElement(o.a,{type:"primary",style:{margin:5}},"Only Save Payments")))))),i.a.createElement(g.a,{xs:24,sm:24,md:6,lg:8,xl:6,xxl:6},i.a.createElement(re.a,{loading:this.state.invoiceLoading,dataSource:this.state.invoicesList,renderItem:t=>e.state.addedInvoiceId[t.id]?i.a.createElement("div",null):i.a.createElement(u.a,{hoverable:!0,onClick:()=>this.addInvoiceToPayments(t.id),style:{marginBottom:"10px"}},i.a.createElement("table",{style:{width:"100%"}},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",{style:{maxWidth:"calc(100% - 60px)"}},i.a.createElement("h4",null,t.invoice_id)),i.a.createElement("td",{style:{textAlign:"right"}},i.a.createElement("b",null,t.date))))),i.a.createElement(P.a,{style:{margin:0}}),i.a.createElement("table",{style:{width:"100%"}},i.a.createElement("tbody",null,t.procedure.map(e=>i.a.createElement("tr",null,i.a.createElement("td",{style:{maxWidth:"calc(100% - 60px)"}},e.procedure_data.name),i.a.createElement("td",{style:{textAlign:"right"}},i.a.createElement("b",null,(e.unit*e.unit_cost).toFixed(2))))),t.inventory.map(e=>i.a.createElement("tr",null,i.a.createElement("td",{style:{maxWidth:"calc(100% - 60px)"}},e.inventory_item_data.name),i.a.createElement("td",{style:{textAlign:"right"}},i.a.createElement("b",null,(e.unit*e.unit_cost).toFixed(2))))),t.reservation?i.a.createElement("tr",null,i.a.createElement("td",{style:{maxWidth:"calc(100% - 60px)"}},t.type),i.a.createElement("td",{style:{textAlign:"right"}},i.a.createElement("b",null,t.reservation_data.bed_package_price?t.reservation_data.bed_package_price.toFixed(2):null))):null,t.reservation_data&&t.reservation_data.medicines?i.a.createElement(i.a.Fragment,null,t.reservation_data.medicines.map(e=>i.a.createElement("tr",null,i.a.createElement("td",{style:{maxWidth:"calc(100% - 60px)"}},e.name),i.a.createElement("td",{style:{textAlign:"right"}},i.a.createElement("b",null,e.final_price.toFixed(2)))))):null)),i.a.createElement(P.a,{style:{margin:0}}),i.a.createElement("table",{style:{width:"100%"}},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",{style:{maxWidth:"calc(100% - 60px)"}},"Invoice Amount"),i.a.createElement("td",{style:{textAlign:"right"}},i.a.createElement("b",null,t.total.toFixed(2)))),i.a.createElement("tr",null,i.a.createElement("td",{style:{maxWidth:"calc(100% - 60px)"}},"Paid Amount"),i.a.createElement("td",{style:{textAlign:"right"}},i.a.createElement("b",null,t.payments_data?t.payments_data.toFixed(2):0))),i.a.createElement("tr",null,i.a.createElement("td",{style:{maxWidth:"calc(100% - 60px)"}},i.a.createElement("b",null,"Amount Due")),i.a.createElement("td",{style:{textAlign:"right"}},i.a.createElement("b",null,(t.total-t.payments_data).toFixed(2)))))))}))))))}}var Bi=Ri;function zi(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Yi(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?zi(Object(a),!0).forEach((function(t){qi(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):zi(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function qi(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Wi extends i.a.Component{constructor(e){super(e),qi(this,"handleSubmitEditPayment",e=>{const t=this;e.preventDefault(),this.props.form.validateFields((e,a)=>{if(!e){const e=Yi(Yi({},a),{},{practice:this.props.active_practiceId}),n=function(e){t.setState({editPaymentVisible:!1}),t.editPaymentData(t.props.editPayment),t.props.editPaymentClose()},i=function(){};Object(N.k)(V.U,e,n,i)}})}),qi(this,"editPaymentData",e=>{this.props.history.push("/patient/".concat(e.patient,"/billing/payments/edit/"))}),this.state={otpSent:this.props.otpSent,editPaymentVisible:this.props.editPaymentVisible,cancelPaymentVisible:this.props.cancelPaymentVisible},this.editPaymentData=this.editPaymentData.bind(this)}sendOTP(){Object(N.c)(V.T,(function(e){}),(function(){}))}render(){const e=this.props.form.getFieldDecorator;return i.a.createElement(C.a,{visible:this.state.editPaymentVisible&&this.props.editPayment&&this.props.editPayment.id==this.props.payment.id,title:"Edit Invoice",footer:null,onOk:this.handleSubmitEditPayment,onCancel:this.props.editPaymentClose},i.a.createElement(m.a,null,i.a.createElement(m.a.Item,null,e("otp",{rules:[{required:!0,message:"Please input Otp!"}]})(i.a.createElement(S.a,{prefix:i.a.createElement(E.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Otp"}))),i.a.createElement(m.a.Item,null,this.props.otpSent?i.a.createElement("a",{style:{float:"right"},type:"primary",onClick:this.sendOTP},"Resend Otp ?"):null,i.a.createElement(o.a,{size:"small",type:"primary",htmlType:"submit",onClick:this.handleSubmitEditPayment},"Submit")," ",i.a.createElement(o.a,{size:"small",onClick:this.props.editPaymentClose},"Close"))))}}var Gi=m.a.create()(Wi);function Hi(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ui(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Hi(Object(a),!0).forEach((function(t){Ki(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Hi(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ki(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Qi=S.a;class Zi extends i.a.Component{constructor(e){super(e),Ki(this,"handleSubmitCancelPayment",e=>{const t=this;e.preventDefault(),this.props.form.validateFields((e,a)=>{if(!e){const e=Ui(Ui({},a),{},{practice:this.props.active_practiceId}),n=function(e){t.setState({cancelPaymentVisible:!1}),t.deletePayment(t.props.editPayment.patient_data,t.props.editPayment.id,a.cancel_note)},i=function(){};t.state.otpField?Object(N.k)(V.U,e,n,i):t.deletePayment(t.props.editPayment.patient_data,t.props.editPayment.id,a.cancel_note)}})}),this.state={cancelPaymentVisible:this.props.cancelPaymentVisible,otpSent:this.props.otpSent,otpField:!1}}componentDidMount(){const e=this;x()().diff(e.props.editPayment.created_at,"minutes")>B.Cb&&e.setState({otpField:!0})}deletePayment(e,t,a){const n=this;console.log("log",e,t,a);const i={patient:e.id,is_cancelled:!0,cancel_note:a};Object(N.m)(Object(N.g)(V.xe,[t]),i,(function(e){n.props.cancelPaymentClose(),Object(N.a)(B.sc,"Payment cancelled successfully"),n.props.loadPayments()}),(function(){}))}sendOTP(){Object(N.c)(V.T,(function(e){}),(function(){}))}render(){const e=this.state.otpField,t=this.props.form.getFieldDecorator;return i.a.createElement(C.a,{visible:this.state.cancelPaymentVisible,title:"Cancel Payment",footer:null,onOk:this.handleSubmitCancelPayment,onCancel:this.props.cancelPaymentClose},i.a.createElement(m.a,null,i.a.createElement(m.a.Item,{key:"text-area-note"},t("cancel_note",{rules:[{required:!0,message:vi.k}]})(i.a.createElement(Qi,{placeholder:"cancel notes"}))),e?i.a.createElement(m.a.Item,{key:"otp"},t("otp",{rules:[{required:e,message:"Please input Otp!"}]})(i.a.createElement(S.a,{prefix:i.a.createElement(E.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Otp"}))):null,i.a.createElement(m.a.Item,{key:"btn"},this.state.otpSent?i.a.createElement("a",{style:{float:"right"},type:"primary",onClick:this.sendOTP},"Resend Otp ?"):null,i.a.createElement(o.a,{size:"small",type:"primary",htmlType:"submit",onClick:this.handleSubmitCancelPayment},"Submit")," ",i.a.createElement(o.a,{size:"small",onClick:this.props.cancelPaymentClose},"Close"))))}}var Xi=m.a.create()(Zi);function Ji(){return(Ji=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function $i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}C.a.confirm;class er extends i.a.Component{constructor(e){super(e),$i(this,"loadPayments",(e=1)=>{const t=this;t.props.refreshWallet&&1==e&&t.props.refreshWallet(),this.setState({loading:!0});const a={page:e,practice:this.props.active_practiceId};this.props.match.params.id&&(a.patient=this.props.match.params.id),Object(N.c)(V.rd,(function(e){t.setState((function(t){return 1==e.current?{payments:[...e.results],next:e.next,loading:!1}:{payments:[...t.payments,...e.results],next:e.next,loading:!1}}))}),(function(){t.setState({loading:!1})}),a)}),$i(this,"loadPDF",e=>{Object(N.c)(Object(N.g)(V.Ad,[e]),(function(e){e.report&&window.open(Oe.a+e.report)}),(function(){}))}),$i(this,"updateFormValue",(e,t)=>{this.setState({[e]:t})}),$i(this,"mailModalOpen",()=>{this.setState({visibleMail:!0})}),$i(this,"mailModalClose",()=>{this.setState({visibleMail:!1})}),$i(this,"sendPatientMail",e=>{this.mailModalOpen(),this.setState({patientName:zt.get(e,"patient_data.user.first_name"),paymentId:zt.get(e,"id"),mail_to:zt.get(e,"patient_data.user.email")})}),$i(this,"sendMailToPatient",()=>{const e=this.state,t=e.mail_to,a=e.paymentId,n={mail_to:t};Object(le.i)(Object(N.g)(V.Ad,[a]),n),this.mailModalClose()}),$i(this,"editModelOpen",e=>{const t=this,a=x()().diff(e.created_at,"minutes");if(console.log("otp",a),a>B.Cb){t.setState({editPaymentVisible:!0,cancelPaymentVisible:!1,editPayment:e});const a={practice:this.props.active_practiceId,type:"".concat("Payment:").concat(e.payment_id," ")+"Edit"},n=function(a){t.setState({otpSent:!0,patientId:e.patient,paymentId:e.payment_id})},i=function(){};Object(N.k)(V.S,a,n,i)}else t.setState({editPayment:e},(function(){t.props.history.push("/patient/".concat(e.patient,"/billing/payments/edit"))}))}),$i(this,"editPaymentData",e=>{const t=this;t.setState({editPayment:e},(function(){t.props.history.push("/patient/".concat(e.patient,"/billing/payments/edit/"))}))}),$i(this,"cancelModalOpen",e=>{const t=this,a=x()().diff(e.created_at,"minutes");console.log("otp",a,B.Cb,e),console.log(a>B.Cb),t.setState({editPaymentVisible:!1,cancelPaymentVisible:!0,editPayment:e});const n={practice:this.props.active_practiceId,type:"".concat("Payment:").concat(e.payment_id," ")+" Cancellation"},i=function(a){t.setState({otpSent:!0,patientId:e.patient,paymentId:e.id})},r=function(){};a>B.Cb&&Object(N.k)(V.S,n,i,r)}),$i(this,"editPaymentClose",()=>{this.setState({editPaymentVisible:!1})}),$i(this,"cancelPaymentClose",()=>{this.setState({cancelPaymentVisible:!1})}),this.state={payments:[],active_practiceId:this.props.active_practiceId,loading:!0,otpSent:!1,editPaymentVisible:!1,editPayment:null}}componentDidMount(){this.loadPayments()}deletePayment(e,t){const a=this,n={patient:e,is_cancelled:!0};Object(N.m)(Object(N.g)(V.xe,[t]),n,(function(e){Object(N.a)(B.sc,"Payment cancelled successfully"),a.loadPayments()}),(function(){}))}render(){const e=this,t={};return this.state.paymentModes&&this.state.paymentModes.forEach((function(e){t[e.id]=e.mode})),this.props.match.params.id?i.a.createElement("div",null,i.a.createElement(c.d,null,i.a.createElement(c.b,{exact:!0,path:"/patient/:id/billing/payments/add",render:e=>this.props.activePracticePermissions.PatientAddEditPayments?i.a.createElement(Bi,Ji({},this.state,e,this.props,{loadData:this.loadPayments})):i.a.createElement(G.a,null)}),i.a.createElement(c.b,{exact:!0,path:"/patient/:id/billing/payments/edit",render:t=>e.state.editPayment?this.props.activePracticePermissions.PatientAddEditPayments?i.a.createElement(Bi,Ji({},this.state,t,this.props,{paymentId:this.state.paymentId,loadData:this.loadPayments})):i.a.createElement(G.a,null):i.a.createElement(c.a,{to:"/patient/".concat(t.match.params.id,"/billing/payments")})}),i.a.createElement(c.b,null,i.a.createElement("div",null,i.a.createElement(f.a,{banner:!0,showIcon:!0,type:"info",message:"The payments shown are only for the current selected practice!"}),i.a.createElement(u.a,{bodyStyle:{padding:0},title:this.state.currentPatient?"".concat(this.state.currentPatient.name," Payments"):"Payments",extra:i.a.createElement(o.a.Group,null,i.a.createElement(d.b,{to:"/patient/".concat(this.props.match.params.id,"/billing/payments/add")},i.a.createElement(o.a,{disabled:!this.props.activePracticePermissions.PatientAddEditPayments},i.a.createElement(E.a,{type:"plus"}),"Add")))}),this.state.payments.map(e=>nr(e,this)),i.a.createElement(l.a,{spinning:this.state.loading},i.a.createElement(y.a,null)),i.a.createElement(L.a,{loaderFunction:()=>this.loadPayments(e.state.next),loading:this.state.loading,hidden:!this.state.next})))),i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send Payment To ",this.state.patientName," ?"),i.a.createElement(S.a,{value:e.state.mail_to,placeholder:"Email",onChange:t=>e.updateFormValue("mail_to",t.target.value)})),e.state.cancelPaymentVisible?i.a.createElement(Xi,Ji({},e.state,{key:"cancel_payment",cancelPaymentClose:e.cancelPaymentClose,loadPayments:e.loadPayments})):null):i.a.createElement("div",null,i.a.createElement(u.a,{bodyStyle:{padding:0},title:this.state.currentPatient?"".concat(this.state.currentPatient.name," Payments"):"Payments",extra:i.a.createElement(o.a.Group,null,i.a.createElement(o.a,{type:"primary",onClick:()=>this.props.togglePatientListModal(!0)},i.a.createElement(E.a,{type:"plus"}),"Add"))}),this.state.payments.map(e=>nr(e,this)),i.a.createElement(l.a,{spinning:this.state.loading},i.a.createElement(y.a,null)),i.a.createElement(L.a,{loaderFunction:()=>this.loadPayments(e.state.next),loading:this.state.loading,hidden:!this.state.next}),i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send Payment To ",this.state.patientName," ?"),i.a.createElement(S.a,{value:e.state.mail_to,placeholder:"Email",onChange:t=>e.updateFormValue("mail_to",t.target.value)})),e.state.cancelPaymentVisible?i.a.createElement(Xi,Ji({},e.state,{key:"cancel_payment",cancelPaymentClose:e.cancelPaymentClose,loadPayments:e.loadPayments})):null)}}var tr=m.a.create()(er);const ar=[{title:"S.No",key:"s_no",dataIndex:"s_no",render:(e,t,a)=>a+1},{title:"INVOICE",dataIndex:"invoice_id",key:"invoice",render:e=>i.a.createElement("span",null,e)},{title:"Amount Paid",key:"pay_amount",dataIndex:"pay_amount",render:e=>e?e.toFixed(2):0}];function nr(e,t){t.props.form.getFieldDecorator;const a=[];return e.is_advance&&a.push({invoice_id:"Advance Payment",pay_amount:e.advance_value}),i.a.createElement(u.a,{style:{marginTop:10},key:e.id,bodyStyle:{padding:0},title:e.patient_data&&!t.props.currentPatient?i.a.createElement("small",null,e.date?x()(e.date).format("ll"):null,i.a.createElement(d.b,{to:"/patient/".concat(e.patient_data.id,"/billing/payments")},"   ",e.patient_data.user.first_name," (ID: ",e.patient_data.custom_id?e.patient_data.custom_id:e.patient_data.id,") "),i.a.createElement("span",null,", ",e.patient_data.gender)):i.a.createElement("small",null,e.date?x()(e.date).format("ll"):null),extra:i.a.createElement(_.a.Button,{size:"small",style:{float:"right"},overlay:i.a.createElement(h.a,null,i.a.createElement(h.a.Item,{key:"2",onClick:()=>t.editModelOpen(e),disabled:e.practice!=t.props.active_practiceId||!t.props.activePracticePermissions.PatientAddEditPayments},i.a.createElement(E.a,{type:"edit"}),"Edit"),i.a.createElement(h.a.Item,{key:"3",onClick:()=>t.cancelModalOpen(e),disabled:e.practice!=t.props.active_practiceId||e.is_cancelled||"Membership Amount."==e.type||!t.props.activePracticePermissions.PatientAddEditPayments},i.a.createElement(E.a,{type:"delete"}),"Cancel"),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"4"},i.a.createElement(d.b,{to:"/patient/".concat(e.patient,"/emr/timeline")},i.a.createElement(E.a,{type:"clock-circle"}),"Patient Timeline")),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"4"},i.a.createElement("a",{onClick:()=>t.sendPatientMail(e)},i.a.createElement(E.a,{type:"mail"})," Send mail to patient")))},i.a.createElement("a",{onClick:()=>t.loadPDF(e.id)},i.a.createElement(E.a,{type:"printer"})))},i.a.createElement(y.a,{gutter:8},i.a.createElement(g.a,{xs:24,sm:24,md:6,lg:4,xl:4,xxl:4,style:{padding:10}},e.is_cancelled?i.a.createElement(f.a,{message:"Cancelled",type:"error",showIcon:!0}):null,i.a.createElement(P.a,{style:{marginBottom:0}},e.payment_id)),i.a.createElement(g.a,{xs:24,sm:24,md:18,lg:20,xl:20,xxl:20},i.a.createElement(Ge.a,{columns:ar,pagination:!1,footer:()=>function(e){if(e)return i.a.createElement("p",null,e.doctor?i.a.createElement(Bt.a,{title:"Doctor"},i.a.createElement(O.a,{color:e.doctor?e.doctor.calendar_colour:null},i.a.createElement("b",null,"prescribed by  ".concat(e.doctor.user.first_name)," "))):null,e.practice?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,e.practice.name," "))):null,e.notes?i.a.createElement("p",null,"Notes: ",e.notes):null,e.cancel_note?i.a.createElement("p",null,"Cancel Notes: ",e.cancel_note):null);return null}({practice:e.practice_data,notes:e.notes,cancel_note:e.cancel_note}),dataSource:[...e.invoices,...a],rowKey:e.id}))),t.state.editPaymentVisible&&t.state.otpSent&&i.a.createElement(Gi,Ji({},t.state,{payment:e,editPaymentClose:t.editPaymentClose,key:e.id,editPaymentData:t.editPaymentData},t.props)))}function ir(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function rr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ir(Object(a),!0).forEach((function(t){lr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ir(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function lr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const sr=S.a.TextArea;class or extends i.a.Component{constructor(e){super(e),lr(this,"loadPDF",e=>{Object(N.c)(Object(N.g)(V.Xd,[e]),(function(e){e.report&&window.open(Oe.a+e.report)}),(function(){}))}),lr(this,"updateFormValue",(e,t)=>{this.setState({[e]:t})}),lr(this,"mailModalOpen",()=>{this.setState({visibleMail:!0})}),lr(this,"mailModalClose",()=>{this.setState({visibleMail:!1})}),lr(this,"sendPatientMail",e=>{this.mailModalOpen(),this.setState({patientName:zt.get(e,"patient_data.user.first_name"),paymentId:zt.get(e,"id"),mail_to:zt.get(e,"patient_data.user.email")})}),lr(this,"sendMailToPatient",()=>{const e=this.state,t=e.mail_to,a=e.paymentId,n={mail_to:t};Object(le.i)(Object(N.g)(V.Xd,[a]),n),this.mailModalClose()}),lr(this,"cancelModalOpen",e=>{const t=this,a=x()().diff(e.created_at,"minutes");a>B.Cb&&t.setState({otpField:!0}),t.setState({cancelReturnIncoiceVisible:!0,editReturnInvoice:e,patientId:e.patient});const n={practice:this.props.active_practiceId,type:"".concat("Return Invoice:").concat(e.return_id," ")+" Cancellation"},i=function(a){t.setState({otpSent:!0,patientId:e.patient,returnInvoiceId:e.id})},r=function(){};a>B.Cb&&Object(N.k)(V.S,n,i,r)}),lr(this,"cancelReturnInvoiceClose",()=>{this.setState({cancelReturnIncoiceVisible:!1})}),lr(this,"handleSubmitCancelReturnInvoice",e=>{const t=this,a=x()().diff(t.state.editReturnInvoice.created_at,"minutes");e.preventDefault(),this.props.form.validateFields((e,n)=>{if(!e){const e=rr(rr({},n),{},{practice:this.props.active_practiceId}),i=function(e){t.setState({cancelReturnIncoiceVisible:!1,otpField:!1}),t.deleteReturnInvoice(t.state.patientId,t.state.returnInvoiceId,n.cancel_note)},r=function(){};a>B.Cb?Object(N.k)(V.U,e,i,r):t.deleteReturnInvoice(t.state.patientId,t.state.editReturnInvoice.id,n.cancel_note)}})}),this.state={currentPatient:this.props.currentPatient,active_practiceId:this.props.active_practiceId,returnInvoices:[],drug_catalog:null,procedure_category:null,taxes_list:null,loading:!0,cancelReturnIncoiceVisible:!1,otpField:!1},this.loadReturnInvoices=this.loadReturnInvoices.bind(this),this.loadDrugCatalog=this.loadDrugCatalog.bind(this),this.loadProcedureCategory=this.loadProcedureCategory.bind(this),this.loadTaxes=this.loadTaxes.bind(this)}componentDidMount(){this.loadReturnInvoices()}loadReturnInvoices(e=1){const t=this;t.props.refreshWallet&&1==e&&t.props.refreshWallet(),t.setState({loading:!0});const a={page:e,practice:this.props.active_practiceId};this.props.match.params.id&&(a.patient=this.props.match.params.id),Object(N.c)(V.dc,(function(e){1==e.current?t.setState({total:e.count,returnInvoices:e.results,loading:!1,loadMoreReturnInvoice:e.next}):t.setState((function(t){return{total:e.count,returnInvoices:[...t.returnInvoices,...e.results],loading:!1,loadMoreReturnInvoice:e.next}}))}),(function(){t.setState({loading:!1})}),a)}loadDrugCatalog(){const e=this;Object(N.c)(Object(N.g)(V.qb,[this.props.active_practiceId]),(function(t){e.setState({drug_catalog:t})}),(function(){}))}loadProcedureCategory(){const e=this;Object(N.c)(Object(N.g)(V.Kd,[this.props.active_practiceId]),(function(t){e.setState({procedure_category:t})}),(function(){}))}loadTaxes(){const e=this;Object(N.c)(Object(N.g)(V.df,[this.props.active_practiceId]),(function(t){e.setState({taxes_list:t})}),(function(){}))}sendOTP(){Object(N.c)(V.T,(function(e){}),(function(){}))}deleteReturnInvoice(e,t,a){const n=this,i={patient:e,is_cancelled:!0,cancel_note:a};Object(N.m)(Object(N.g)(V.Ce,[t]),i,(function(e){Object(N.a)(B.sc,"Return Invoice cancelled successfully"),n.loadReturnInvoices(),n.cancelReturnInvoiceClose()}),(function(){}))}render(){const e=this,t={};this.state.drug_catalog&&this.state.drug_catalog.forEach((function(e){t[e.id]="".concat(e.name,",").concat(e.strength)}));const a={};this.state.procedure_category&&this.state.procedure_category.forEach((function(e){a[e.id]=e.name}));const n={};this.state.taxes_list&&this.state.taxes_list.forEach((function(e){n[e.id]=e.name}));const r=e.props.form.getFieldDecorator;return this.props.match.params.id?i.a.createElement("div",null,i.a.createElement(c.d,null,i.a.createElement(c.b,null,i.a.createElement("div",null,i.a.createElement(f.a,{banner:!0,showIcon:!0,type:"info",message:"The invoices return shown are only for the current selected practice!"}),i.a.createElement(Lt.a,{offsetTop:0},i.a.createElement(u.a,{bodyStyle:{padding:0},style:{boxShadow:"0 5px 8px rgba(0, 0, 0, 0.09)"},title:(this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," Invoice Return"):"Invoices Return ")+(this.state.total?"(Total:".concat(this.state.total,")"):"")})),this.state.returnInvoices.map(t=>dr(t,e)),i.a.createElement(l.a,{spinning:this.state.loading},i.a.createElement(y.a,null)),i.a.createElement(L.a,{loaderFunction:()=>this.loadInvoices(this.state.loadMoreInvoice),loading:this.state.loading,hidden:!this.state.loadMoreInvoice})))),i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send invoice To ",this.state.patientName," ?"),i.a.createElement(S.a,{value:e.state.mail_to,placeholder:"Email",onChange:t=>e.updateFormValue("mail_to",t.target.value)})),i.a.createElement(C.a,{visible:e.state.cancelReturnIncoiceVisible,title:"Cancel Return Invoice",footer:null,onOk:e.handleSubmitCancelReturnInvoice,onCancel:e.cancelReturnInvoiceClose},i.a.createElement(m.a,null,i.a.createElement(m.a.Item,{key:"cancel_notes"},r("cancel_note",{rules:[{required:!0,message:vi.k}]})(i.a.createElement(sr,{placeholder:"cancel notes"}))),e.state.otpField&&i.a.createElement(m.a.Item,null,r("otp",{rules:[{required:!0,message:"Please input Otp!"}]})(i.a.createElement(S.a,{prefix:i.a.createElement(E.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Otp"}))),i.a.createElement(m.a.Item,null,e.state.otpSent?i.a.createElement("a",{style:{float:"right"},type:"primary",onClick:e.sendOTP},"Resend Otp ?"):null,i.a.createElement(o.a,{size:"small",type:"primary",htmlType:"submit",onClick:e.handleSubmitCancelReturnInvoice},"Submit")," ",i.a.createElement(o.a,{size:"small",onClick:e.cancelReturnInvoiceClose},"Close"))))):i.a.createElement("div",null,i.a.createElement(Lt.a,{offsetTop:0},i.a.createElement(u.a,{bodyStyle:{padding:0},style:{boxShadow:"0 5px 8px rgba(0, 0, 0, 0.09)"},title:(this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," Invoice Return"):"Invoice Return ")+(this.state.total?"(Total:".concat(this.state.total,")"):"")})),this.state.returnInvoices.map(t=>dr(t,e)),i.a.createElement(l.a,{spinning:this.state.loading},i.a.createElement(y.a,null)),i.a.createElement(L.a,{loaderFunction:()=>this.loadInvoices(this.state.loadMoreInvoice),loading:this.state.loading,hidden:!this.state.loadMoreInvoice}),i.a.createElement(C.a,{title:null,visible:this.state.visibleMail,onOk:this.sendMailToPatient,onCancel:this.mailModalClose,footer:[i.a.createElement(o.a,{key:"back",onClick:this.mailModalClose},"Cancel"),i.a.createElement(o.a,{key:"submit",type:"primary",onClick:this.sendMailToPatient},"Send")]},i.a.createElement("p",null,"Send invoice To ",this.state.patientName," ?"),i.a.createElement(S.a,{value:e.state.mail_to,placeholder:"Email",onChange:t=>e.updateFormValue("mail_to",t.target.value)})),i.a.createElement(C.a,{visible:e.state.cancelReturnIncoiceVisible,title:"Cancel Return Invoice",footer:null,onOk:e.handleSubmitCancelReturnInvoice,onCancel:e.cancelReturnInvoiceClose},i.a.createElement(m.a,null,i.a.createElement(m.a.Item,{key:"cancel_notes"},r("cancel_note",{rules:[{required:!0,message:vi.k}]})(i.a.createElement(sr,{placeholder:"cancel notes"}))),e.state.otpField&&i.a.createElement(m.a.Item,null,r("otp",{rules:[{required:!0,message:"Please input Otp!"}]})(i.a.createElement(S.a,{prefix:i.a.createElement(E.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Otp"}))),i.a.createElement(m.a.Item,null,e.state.otpSent?i.a.createElement("a",{style:{float:"right"},type:"primary",onClick:e.sendOTP},"Resend Otp ?"):null,i.a.createElement(o.a,{size:"small",type:"primary",htmlType:"submit",onClick:e.handleSubmitCancelReturnInvoice},"Submit")," ",i.a.createElement(o.a,{size:"small",onClick:e.cancelReturnInvoiceClose},"Close")))))}}var cr=m.a.create()(or);function dr(e,t){let a=[...e.procedure,...e.inventory];return(i.a.createElement(u.a,{key:e.id,style:{marginTop:10},bodyStyle:{padding:0},title:i.a.createElement("small",null,e.date?x()(e.date).format("ll"):null,t.state.currentPatient?null:i.a.createElement("span",null,i.a.createElement(d.b,{to:"/patient/".concat(e.patient_data?e.patient_data.id:null,"/billing/return/invoices")},"   ",e.patient_data?e.patient_data.user.first_name:null," (ID: ",e.patient_data.custom_id?e.patient_data.custom_id:e.patient_data.id,") "),", ",e.patient_data?e.patient_data.gender:null)),extra:i.a.createElement(_.a.Button,{size:"small",style:{float:"right"},overlay:i.a.createElement(h.a,null,i.a.createElement(h.a.Item,{key:"1",onClick:()=>t.cancelModalOpen(e),disabled:e.practice!=t.props.active_practiceId||e.payments_data||e.is_cancelled},i.a.createElement(E.a,{type:"delete"}),"Cancel"),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"2"},i.a.createElement("a",{onClick:()=>t.sendPatientMail(e)},i.a.createElement(E.a,{type:"mail"})," Send mail to patient")))},i.a.createElement("a",{onClick:()=>t.loadPDF(e.id)},i.a.createElement(E.a,{type:"printer"})))},i.a.createElement(y.a,{gutter:8},i.a.createElement(g.a,{xs:24,sm:24,md:6,lg:4,xl:4,xxl:4,style:{padding:10}},e.is_cancelled?i.a.createElement(f.a,{message:"Cancelled",type:"error",showIcon:!0}):null,i.a.createElement(P.a,{style:{marginBottom:0}},e.return_id),i.a.createElement(v.a,{title:"Cash / Return ",value:e.cash_return?e.cash_return.toFixed(2):0,suffix:"/ ".concat(e.return_value?e.return_value.toFixed(2):0)})),i.a.createElement(g.a,{xs:24,sm:24,md:18,lg:20,xl:20,xxl:20},i.a.createElement(Ge.a,{bordered:!0,pagination:!1,columns:pr,dataSource:[...a,{name:"Total",unit_cost:a.reduce((function(e,t){return e+t.unit_cost}),0),unit:a.reduce((function(e,t){return e+t.unit}),0),discount_value:a.reduce((function(e,t){return e+t.discount_value}),0),tax_value:a.reduce((function(e,t){return e+t.tax_value}),0),total:a.reduce((function(e,t){return e+t.total}),0)}],footer:()=>{return(t=rr({},e))?i.a.createElement("p",null,t.staff?i.a.createElement(Bt.a,{title:"Staff"},i.a.createElement(O.a,{color:t.staff?t.staff_data.calendar_colour:null},i.a.createElement("b",null,"Return by  ".concat(t.staff_data.user.first_name)," "))):null,t.practice?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,t.practice_data.name," "))):null,t.notes?i.a.createElement("p",null,"Notes: ",t.notes):null,t.cancel_note?i.a.createElement("p",null,"Cancel Notes: ",t.cancel_note):null):null;var t}})))))}const pr=[{title:"S.No",key:"s_no",dataIndex:"s_no",render:(e,t,a)=>a+1},{title:"Treatment & Products",dataIndex:"drug",key:"drug",render:(e,t)=>i.a.createElement("span",null," ",i.a.createElement("b",null,t.name?t.name:null))},{title:"Cost",dataIndex:"unit_cost",key:"unit_cost",render:(e,t)=>i.a.createElement("span",null,t.unit_cost?t.unit_cost.toFixed(2):null)},{title:"Unit",dataIndex:"unit",key:"unit"},{title:"Discount",dataIndex:"discount_value",key:"discount_value",render:(e,t)=>i.a.createElement("span",null,t.discount_value?t.discount_value.toFixed(2):null)},{title:"Tax",dataIndex:"tax_value",key:"tax_value",render:(e,t)=>i.a.createElement("span",null,t.tax_value?t.tax_value.toFixed(2):null)},{title:"Total",dataIndex:"total",key:"total",render:e=>e?e.toFixed(2):null}];function mr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ur(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?mr(Object(a),!0).forEach((function(t){hr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):mr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function hr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class fr extends i.a.Component{constructor(e){super(e),hr(this,"loadPatientLedger",()=>{const e=this;e.props.refreshWallet&&e.props.refreshWallet(),this.setState({loadingLedger:!0});const t={practice_id:this.props.active_practiceId};this.props.showAllClinic&&this.props.match.params.id&&delete t.practice,Object(N.c)(Object(N.g)(V.nd,[e.props.currentPatient.id]),(function(t){const a=[];let n=0,i=0,r=0;t.forEach((function(e){const t={date:e.date,type:e.ledger_type};"Invoice"==e.ledger_type?(t.type_id=e.invoice_id,t.details=function(e){let t="";return"Invoice"!=e.type&&(t+="".concat(e.type,", ")),e.procedure&&e.procedure.forEach((function(e){e.procedure_data&&(t+="".concat(e.procedure_data.name,", "))})),e.inventory&&e.inventory.forEach((function(e){e.inventory_item_data&&(t+="".concat(e.inventory_item_data.name,", "))})),e.reservation&&(t+="".concat(e.type,",")),e.reservation_data&&e.reservation_data.medicines&&e.reservation_data.medicines.forEach((function(e){t+="".concat(e.name,",")})),t.trim(",")}(e),t.credit=e.total,t.debit=0,t.return=0,t.cash_return=0):"Payment"==e.ledger_type?(t.type_id=e.payment_id,t.details=function(e){let t="";return e.invoices&&e.invoices.forEach((function(e){e.invoice&&(t+="".concat(e.invoice.invoice_id,", "))})),t}(e),e.return_pay?(t.credit=0,t.debit=0,t.return=-1*(e.total+e.advance_value)):(t.credit=0,t.debit=e.total+e.advance_value,t.return=0),t.cash_return=0):"Return"==e.ledger_type&&(t.type_id=e.return_id,t.details=function(e){let t="";return e.procedure&&e.procedure.forEach((function(e){e.procedure_data&&(t+="".concat(e.procedure_data.name,", "))})),e.inventory&&e.inventory.forEach((function(e){t+="".concat(e.name,", ")})),e.reservation&&(t+="".concat(e.type,",")),e.reservation_data&&e.reservation_data.medicines&&e.reservation_data.medicines.forEach((function(e){t+="".concat(e.name,",")})),t.trim(",")}(e),t.credit=e.cash_return,t.debit=0,t.return=e.return_value,0==e.with_tax&&(t.credit+=e.taxes),t.cash_return=e.cash_return),n+=t.credit,n-=t.debit,r+=t.debit,i+=t.credit,t.balance=n,a.push(t)})),e.setState({loadingLedger:!1,credit:i,debit:r,balance:n,ledger:a})}),(function(){e.setState({loadingLedger:!1})}),t)}),hr(this,"loadPDF",e=>{}),this.state={loading:!1,ledger:[],loadingLedger:!1,selectedList:{},credit:0,debit:0,balance:0}}componentDidMount(){this.loadPatientLedger()}ledgerCompleteToggle(e,t){this.setState((function(a){return{selectedList:ur(ur({},a.selectedList),{},{[e]:!!t})}}))}render(){return i.a.createElement(y.a,null,i.a.createElement(u.a,{title:this.state.currentPatient?"".concat(this.state.currentPatient.name," Payment Ledger"):"Patient Ledgers",extra:i.a.createElement(o.a.Group,null,i.a.createElement(d.b,{to:"/patient/".concat(this.props.match.params.id,"/billing/payments")}," ",i.a.createElement(o.a,{type:"primary"},i.a.createElement(E.a,{type:"plus"})," Add Payment")),i.a.createElement(d.b,{to:"/patient/".concat(this.props.match.params.id,"/billing/invoices")}," ",i.a.createElement(o.a,{type:"primary"},i.a.createElement(E.a,{type:"plus"})," Add Invoice"))," ")},i.a.createElement(Ge.a,{loading:this.state.loadingLedger,columns:[{title:"Date",key:"date",dataIndex:"date",width:120},{title:"Invoice/ Receipt/ Return No",key:"type_id",dataIndex:"type_id"},{title:"Details",key:"details",dataIndex:"details"},{title:"Type",key:"type",dataIndex:"type"},{title:"Return(INR)",key:"return",dataIndex:"return",align:"right",render:e=>e.toFixed(2)},{title:"Cash Return(INR)",key:"cash_return",dataIndex:"cash_return",align:"right",render:e=>e.toFixed(2)},{title:"Credit(INR)",key:"credit",dataIndex:"credit",align:"right",render:e=>e.toFixed(2)},{title:"Debit(INR)",key:"debit",dataIndex:"debit",align:"right",render:e=>e.toFixed(2)},{title:"Balance(INR)",key:"balance",dataIndex:"balance",align:"right",render:e=>e.toFixed(2)}],dataSource:this.state.ledger,pagination:!1}),i.a.createElement(y.a,{style:{marginTop:20,textAlign:"center"}},i.a.createElement(g.a,{span:8},i.a.createElement("h3",null,"Total Credit: ",this.state.credit.toFixed(2))),i.a.createElement(g.a,{span:8},i.a.createElement("h3",null,"Total Debit: ",this.state.debit.toFixed(2))),i.a.createElement(g.a,{span:8},i.a.createElement("h3",null,"Total Balance: ",this.state.balance<0?"".concat((-1*this.state.balance).toFixed(2)," (Advance)"):this.state.balance.toFixed(2))))))}}var yr=fr,gr=a(1609);function br(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Er extends i.a.Component{constructor(e){super(e),br(this,"searchPatient",e=>{this.setState({searchPatientString:e});const t=this,a=function(e){e&&t.setState({patientListData:e.results})},n=function(){};e&&Object(N.c)(Object(N.g)(V.ce,[e]),a,n)}),br(this,"removePatient",e=>{this.setState({[e]:null})}),br(this,"handlePatientSelect",(e,t)=>{if(console.log(e),e){const a=this,n=function(e){a.setState({[t]:e})},i=function(){};Object(N.c)(Object(N.g)(V.td,[e]),n,i)}}),br(this,"mergePatient",()=>{this.setState({loading:!0});const e=this,t={patient_from:this.state.patient_from.id,patient_to:this.state.patient_to.id};Object(N.k)(V.Hc,t,(function(t){Object(N.a)(B.sc,"Patients Merged Successfully!!"),e.setState({loading:!1,patient_from:null,patient_to:null})}),(function(){Object(N.a)(B.T,"Patients Merging Failed!!"),e.setState({loading:!1})}))}),this.state={patient_from:null,patient_to:null,loading:!1,patientListData:[]}}render(){return i.a.createElement("div",null,i.a.createElement("h2",null,"Merge Patients"),i.a.createElement(u.a,null,i.a.createElement(f.a,{message:"Profile details and records of Patient 1 will be moved to Patient 2. You cannot undo this action once done.",type:"warning"}),i.a.createElement(l.a,{spinning:this.state.loading},i.a.createElement(y.a,{gutter:16,style:{marginTop:10}},i.a.createElement(g.a,{span:12,style:{textAlign:"center"}},i.a.createElement("h3",null,"Patient 1"),this.state.patient_from?i.a.createElement(u.a,{bordered:!1,style:{background:"#ECECEC",textAlign:"left"}},i.a.createElement(u.a.Meta,{avatar:this.state.patient_from.image?i.a.createElement(b.a,{src:Object(N.h)(this.state.patient_from.image)}):i.a.createElement(b.a,{style:{backgroundColor:"#87d068"}},this.state.patient_from.user.first_name?this.state.patient_from.user.first_name.charAt(0):i.a.createElement(E.a,{type:"user"})),title:this.state.patient_from.user.first_name,description:this.state.patient_from.user.mobile}),i.a.createElement(o.a,{type:"primary",style:{float:"right"},onClick:()=>this.removePatient("patient_from")},"Select Different Patient")):i.a.createElement(gr.a,{placeholder:"Patient Name",showSearch:!0,onSearch:this.searchPatient,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onChange:this.handleChange,onSelect:e=>this.handlePatientSelect(e,"patient_from")},this.state.patientListData.map(e=>i.a.createElement(gr.a.Option,{value:e.id.toString()},i.a.createElement(re.a.Item,{style:{padding:0}},i.a.createElement(re.a.Item.Meta,{avatar:e.image?i.a.createElement(b.a,{src:Object(N.h)(e.image)}):i.a.createElement(b.a,{style:{backgroundColor:"#87d068"}},e.user.first_name?e.user.first_name.charAt(0):i.a.createElement(E.a,{type:"user"})),title:"".concat(e.user.first_name," (").concat(e.user.id,")"),description:i.a.createElement("small",null,e.user.mobile)})))))),i.a.createElement(g.a,{span:12,style:{textAlign:"center"}},i.a.createElement("h3",null,"Patient 2"),this.state.patient_to?i.a.createElement(u.a,{bordered:!1,style:{background:"#ECECEC",textAlign:"left"}},i.a.createElement(u.a.Meta,{avatar:this.state.patient_to.image?i.a.createElement(b.a,{src:Object(N.h)(this.state.patient_to.image)}):i.a.createElement(b.a,{style:{backgroundColor:"#87d068"}},this.state.patient_to.user.first_name?this.state.patient_to.user.first_name.charAt(0):i.a.createElement(E.a,{type:"user"})),title:this.state.patient_to.user.first_name,description:this.state.patient_to.user.mobile}),i.a.createElement(o.a,{type:"primary",style:{float:"right"},onClick:()=>this.removePatient("patient_to")},"Select Different Patient")):i.a.createElement(gr.a,{placeholder:"Patient Name",showSearch:!0,onSearch:this.searchPatient,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onChange:this.handleChange,onSelect:e=>this.handlePatientSelect(e,"patient_to")},this.state.patientListData.map(e=>i.a.createElement(gr.a.Option,{value:e.id.toString()},i.a.createElement(re.a.Item,{style:{padding:0}},i.a.createElement(re.a.Item.Meta,{avatar:e.image?i.a.createElement(b.a,{src:Object(N.h)(e.image)}):i.a.createElement(b.a,{style:{backgroundColor:"#87d068"}},e.user.first_name?e.user.first_name.charAt(0):i.a.createElement(E.a,{type:"user"})),title:"".concat(e.user.first_name," (").concat(e.user.id,")"),description:i.a.createElement("small",null,e.user.mobile)})))))),i.a.createElement(g.a,{span:24,style:{textAlign:"center",marginTop:30}},i.a.createElement(o.a,{disabled:this.state.loading||!this.state.patient_from||!this.state.patient_to,type:"primary",onClick:this.mergePatient},i.a.createElement(E.a,{type:"plus"}),"Merge Patients"))))))}}class vr extends i.a.Component{constructor(e){super(e)}render(){const e=this;return(i.a.createElement(u.a,{style:{textAlign:"center"}},i.a.createElement("h2",null," Please select patient to further continue !!"),this.props.togglePatientListModal?i.a.createElement(o.a,{type:"primary",onClick:()=>e.props.togglePatientListModal(!0)},i.a.createElement(E.a,{type:"user"})," Select Patient"):null))}}var _r=a(1570);function Pr(){return(Pr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function kr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Or(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?kr(Object(a),!0).forEach((function(t){Cr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):kr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Cr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Sr=S.a.TextArea,Ir=p.a.Option;class xr extends i.a.Component{constructor(e){super(e),Cr(this,"handleCheck",e=>{this.setState({excused_duty_checked:!this.state.excused_duty_checked})}),Cr(this,"handleLighDutyCheck",e=>{this.setState({fit_light_duty_checked:!this.state.fit_light_duty_checked})}),Cr(this,"onChangeHandle",e=>{this.setState({value:e.target.value})}),Cr(this,"handleAttendanceCheck",e=>{this.setState({attendance_checked:!this.state.attendance_checked})}),Cr(this,"handleChangeStart",e=>{this.setState({startDate:e})}),Cr(this,"onChange",e=>{this.setState({proof_attendance_from:e})}),Cr(this,"selectedDate",e=>{this.setState({selectedDate:e})}),Cr(this,"selectDoctor",e=>{this.setState({selectedDoctor:e})}),Cr(this,"handleSubmit",e=>{const t=this;e.preventDefault(),this.props.form.validateFields((e,a)=>{if(a.excused_duty||a.fit_light_duty||a.proof_attendance){if(!e){const e=Or(Or({},a),{},{doctor:t.state.selectedDoctor.id,practice:t.props.active_practiceId,date:t.state.selectedDate&&x()(t.state.selectedDate).isValid()?t.state.selectedDate.format("YYYY-MM-DD"):null,excused_duty_from:x()(a.excused_duty_from).format("YYYY-MM-DD"),excused_duty_to:x()(a.excused_duty_to).format("YYYY-MM-DD"),fit_light_duty_from:x()(a.fit_light_duty_from).format("YYYY-MM-DD"),fit_light_duty_to:x()(a.fit_light_duty_to).format("YYYY-MM-DD"),proof_attendance_date:x()(a.proof_attendance_date).format("YYYY-MM-DD"),proof_attendance_from:x()(a.proof_attendance_from).format("LT"),proof_attendance_to:x()(a.proof_attendance_to).format("LT"),patient:t.props.match.params.id,is_active:!0,valid_court:!1,invalid_court:!1,no_mention:!1});a.group&&(e[a.group]=!0),delete e.group;const n=function(e){Object(N.a)(B.sc,"Medical Certificate Generated."),t.props.history.replace("/patient/".concat(t.props.match.params.id,"/emr/files"))},i=function(){t.setState({})};Object(N.k)(Object(N.g)(V.uc,[this.props.currentPatient.id]),e,n,i)}}else Object(N.a)(B.T,"Please select at least one of the above options")})}),this.state={redirect:!1,excused_duty_checked:!1,fit_light_duty_checked:!1,attendance_checked:!1,startDate:this.props.value,endDate:new Date,proof_attendance_from:null,days:0,practiceDoctors:[],selectedDoctor:{},selectedDate:x()(),value:""},this.handleChangeStart=this.handleChangeStart.bind(this),this.handleChangeEnd=this.handleChangeEnd.bind(this)}componentDidMount(){Object(le.e)(this)}changeRedirect(){const e=this.state.redirect;this.setState({redirect:!e})}handleChangeEnd(e){this.setState({endDate:e})}render(){const e=this.props.form.getFieldDecorator,t=W.wb.map(e=>i.a.createElement(j.a,{value:e.value},e.label));return i.a.createElement(m.a,Pr({onSubmit:this.handleSubmit},{labelCol:{xs:{span:24},sm:{span:8},md:{span:8},lg:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16},md:{span:16},lg:{span:16}}}),i.a.createElement(u.a,{title:"ADD MEDICAL LEAVE CERTIFICATE",extra:i.a.createElement(o.a.Group,null,i.a.createElement(o.a,{type:"primary",htmlType:"submit"},"Save Certificate"))},i.a.createElement(m.a.Item,null,e("excused_duty",{})(i.a.createElement(ve.a,{onClick:this.handleCheck,defaultChecked:this.state.excused_duty_checked},"Excused from duty"))),this.state.excused_duty_checked?i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6,offset:6},i.a.createElement(m.a.Item,{label:"From"},e("excused_duty_from",{})(i.a.createElement(D.a,null))),i.a.createElement(m.a.Item,{label:"till"},e("excused_duty_to",{})(i.a.createElement(D.a,null)))),i.a.createElement(g.a,{span:6},i.a.createElement(m.a.Item,null,e("excused_duty_from_session",{initialValue:"Morning"})(i.a.createElement(p.a,null,i.a.createElement(Ir,{value:"Morning"},"Morning Session"),i.a.createElement(Ir,{value:"Morning"},"Evening Session")))),i.a.createElement(m.a.Item,null,e("excused_duty_to_session",{initialValue:"Morning"})(i.a.createElement(p.a,null,i.a.createElement(Ir,{value:"Morning"},"Morning Session"),i.a.createElement(Ir,{value:"Morning"},"Evening Session")))))):null,i.a.createElement(m.a.Item,null,e("fit_light_duty",{})(i.a.createElement(ve.a,{onClick:this.handleLighDutyCheck,defaultChecked:this.state.fit_light_duty_checked},"Fit for light duty"))),this.state.fit_light_duty_checked?i.a.createElement(y.a,null,i.a.createElement(g.a,null,i.a.createElement(m.a.Item,{label:"From"},e("fit_light_duty_from",{})(i.a.createElement(D.a,null))),i.a.createElement(m.a.Item,{label:"till"},e("fit_light_duty_to",{})(i.a.createElement(D.a,null))))):null,i.a.createElement(m.a.Item,null,e("proof_attendance",{})(i.a.createElement(ve.a,{onClick:this.handleAttendanceCheck,defaultChecked:this.state.attendance_checked},"Proof of attendance at practice"))),this.state.attendance_checked?i.a.createElement(y.a,null,i.a.createElement(m.a.Item,{label:"on"},e("proof_attendance_date",{})(i.a.createElement(D.a,null))),i.a.createElement(g.a,{span:6,offset:6},i.a.createElement(m.a.Item,{label:"From"},e("proof_attendance_from",{})(i.a.createElement(_r.a,{use12Hours:!0,format:"h:mm A"}))),i.a.createElement(m.a.Item,{label:"till"},e("proof_attendance_to",{})(i.a.createElement(_r.a,{use12Hours:!0,format:"h:mm A"}))))):null,i.a.createElement(m.a.Item,{label:"Notes"},e("notes",{})(i.a.createElement(Sr,null))),i.a.createElement(m.a.Item,null,e("group",{initialValue:"no_mention"})(i.a.createElement(j.a.Group,null,t))),i.a.createElement(Lt.a,{offsetBottom:0},i.a.createElement(u.a,null,i.a.createElement("span",null,"Issued by   "),i.a.createElement(_.a,{placement:"topCenter",overlay:i.a.createElement(h.a,null,this.state.practiceDoctors.map(e=>i.a.createElement(h.a.Item,{key:"0"},i.a.createElement("a",{onClick:()=>this.selectDoctor(e)},e.user.first_name)))),trigger:["click"]},i.a.createElement("a",{className:"ant-dropdown-link",href:"#"},i.a.createElement("b",null,this.state.selectedDoctor.user?this.state.selectedDoctor.user.first_name:"No DOCTORS Found"))),i.a.createElement("span",null,"   on  "),i.a.createElement(D.a,{value:this.state.selectedDate,onChange:e=>this.selectedDate(e),format:"DD-MM-YYYY",allowClear:!1})))))}}var Dr=m.a.create()(xr);function jr(){return(jr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function wr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Mr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?wr(Object(a),!0).forEach((function(t){Tr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):wr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Tr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Fr=u.a.Meta;S.a.Group;let Ar=1;class Nr extends i.a.Component{constructor(e){super(e),Tr(this,"loadPackages",()=>{const e=this;Object(N.c)(Object(N.g)(V.B,[this.props.active_practiceId]),(function(t){e.setState({packages:t})}),(function(){}))}),Tr(this,"loadDiseases",()=>{const e=this;Object(N.c)(Object(N.g)(V.ob,[this.props.active_practiceId]),(function(t){e.setState({diseases:t})}),(function(){}))}),Tr(this,"searchPatient",e=>{const t=this;Object(N.c)(Object(N.g)(V.ce,[e]),(function(e){e&&t.setState({patientList:e,ptr:e})}),(function(){}))}),Tr(this,"handlePatientSelect",e=>{if(e){const t=this,a=function(e){t.setState({patientDetails:e})},n=function(){};Object(N.c)(Object(N.g)(V.td,[e]),a,n)}}),Tr(this,"checkBedStatus",(e,t)=>{const a=this;a.handleRoomType(),this.setState({[e]:t},(function(){const e=function(e){a.setState({availabilitySeatTatkal:e.TATKAL,availabilitySeatNormal:e.NORMAL}),e[a.props.form.getFieldValue("seat_type")]||(a.props.form.setFieldsValue({seat_type:null}),a.calculateTotalAmount())};a.calculateTotalAmount();const t=function(){},n=a.state,i=n.from_date,r=n.bed_package;if(i&&r){let n=null;if(a.state.packages.forEach((function(e){r==e.id&&(n=x()(i).add(e.no_of_days-1,"day"))})),i&&n&&r){(0,a.props.form.setFieldsValue)({to_date:n}),Object(N.c)(Object(N.g)(V.Y,[a.props.active_practiceId]),e,t,{start:x()(i).format("YYYY-MM-DD"),end:x()(n).format("YYYY-MM-DD"),bed_package:r})}}}))}),Tr(this,"handleSubmit",e=>{this.setState({loading:!0});const t=this;e.preventDefault(),this.props.form.validateFields((e,a)=>{if(!e){a.label,a.value;const e=Mr(Mr({},a),{},{to_date:x()(a.to_date).format("YYYY-MM-DD"),from_date:x()(a.from_date).format("YYYY-MM-DD"),paid:!1,total_price:this.state.totalPayableAmount,date:x()().format("YYYY-MM-DD"),total_tax:this.state.tax,patient:this.state.patientDetails.id,rest_diseases:a.rest_diseases?a.rest_diseases.join(","):null,report_upload:a.file&&a.file.file.response?a.file.file.response.image_path:null});let n=[];t.state.choosePkg.forEach((function(a){"MEDICINE"==a.type?n.push({medicine:a.id,quantity:a.quantity,unit_cost:a.price,total_price:a.price_with_tax,taxes:t.state.patientBelongToOtherState?a.state_taxes.map(e=>e.id):a.taxes.map(e=>e.id)}):e.taxes=t.state.patientBelongToOtherState?a.state_taxes.map(e=>e.id):a.taxes.map(e=>e.id)})),e.medicines=n,delete e.label,delete e.value,delete e.keys;const i=function(e){Object(N.a)(B.sc,"Saved Successfully!!"),t.props.history&&t.props.history.replace("/patient/".concat(t.props.match.params.id,"/booking")),t.props.loadData&&t.props.loadData()},r=function(){Object(N.a)(B.T,"Something went wrong!!")};Object(N.k)(Object(N.g)(V.N,[this.props.active_practiceId]),e,i,r)}})}),Tr(this,"handleClick",e=>{this.setState({patientDetails:null})}),Tr(this,"handleRoomType",(e,t)=>{const a=this;this.setState({[e]:t},(function(){a.calculateTotalAmount()}))}),Tr(this,"calculateTotalAmount",()=>{this.setState((function(e){let t=0,a=0,n={},i=[],r=0;e.packages.forEach((function(r){e.bed_package==r.id&&("NORMAL"==e.seat_type&&(t=r.normal_price+r.normal_tax_value,a+=r.normal_tax_value,n=Mr(Mr({},r),{},{type:"BED",price_with_tax:t,tax:r.normal_tax_value,price:r.normal_price,_id:Math.random().toFixed(7)}),i=[n]),"TATKAL"==e.seat_type&&(t=r.tatkal_price+r.tatkal_tax_value,a+=r.tatkal_tax_value,n=Mr(Mr({},r),{},{type:"BED",price_with_tax:t,tax:r.tatkal_tax_value,price:r.tatkal_price,_id:Math.random().toFixed(7)}),i=[n]))}));let l={};return e.medicinePackage.forEach((function(t){e.medicineItem.forEach((function(e){if(t.id==e&&!l[t.id]){let e=t.quantity||1;r+=t.final_price*e,a+=t.tax_value*e,i=[...i,Mr(Mr({},t),{},{medicine:t.id,quantity:e,type:"MEDICINE",price_with_tax:t.final_price*e,tax:t.tax_value*e,_id:Math.random().toFixed(7),children:null})],l[t.id]=!0,t.children&&t.children.forEach((function(t){l[t.id]||(i=[...i,Mr(Mr({},t),{},{medicine:t.id,quantity:e,type:"MEDICINE",price_with_tax:0,tax:0,price:0,_id:Math.random().toFixed(7),children:null,disabled:!0})],l[t.id]=!0)}))}}))})),{totalPayableAmount:t+r,tax:a,choosePkg:[...i]}}))}),Tr(this,"setPaymentAmount",e=>{const t=this;this.setState({totalPayingAmount:e},(function(){t.calculateTotalAmount()}))}),Tr(this,"handleMedicineSelect",e=>{const t=e;this.setState({medicineItem:t},(function(){this.calculateTotalAmount()}))}),Tr(this,"changeDiscount",(e,t)=>{const a=this;a.setState((function(a){const n=[];return a.medicinePackage.forEach((function(a){a.id==e?n.push(Mr(Mr({},a),{},{discount:t})):n.push(a)})),{medicinePackage:n}}),(function(){a.calculateTotalAmount()}))}),Tr(this,"changeQuantity",(e,t)=>{const a=this;a.setState((function(a){const n=[];return a.medicinePackage.forEach((function(a){a.id==e?n.push(Mr(Mr({},a),{},{quantity:t})):n.push(a)})),{medicinePackage:n}}),(function(){a.calculateTotalAmount()}))}),Tr(this,"addNewFields",()=>{const e=this.props.form,t=e.getFieldValue("keys").concat(Ar++);e.setFieldsValue({keys:t})}),Tr(this,"removeNewOptionField",e=>{const t=this.props.form,a=t.getFieldValue("keys");1!==a.length&&t.setFieldsValue({keys:a.filter(t=>t!==e)})}),this.state={packages:[],totalPayableAmount:0,totalPayingAmount:0,patientList:[],paymentModes:[],medicinePackage:[],medicineItem:[],diseases:[],patientBelongToOtherState:Hn()(e,"activePracticeData.reg_state")!=Hn()(e,"currentPatient.state")}}componentDidMount(){this.props.currentPatient&&this.handlePatientSelect(this.props.currentPatient.id),this.loadPackages(),this.loadPaymentModes(),this.loadMedicinePackages(),this.loadDiseases()}loadMedicinePackages(){const e=this;Object(N.c)(Object(N.g)(V.zc,[this.props.active_practiceId]),(function(t){e.setState({medicinePackage:t})}),(function(){}))}loadPaymentModes(){const e=this;Object(N.c)(Object(N.g)(V.zd,[this.props.active_practiceId]),(function(t){e.setState({paymentModes:t})}),(function(){}))}render(){const e=[{value:"NORMAL",is_or_not:!(!this.state.availabilitySeatNormal||!this.state.availabilitySeatNormal.available)},{value:"TATKAL",is_or_not:!(!this.state.availabilitySeatTatkal||!this.state.availabilitySeatTatkal.available)}],t=this,a=this.props.form,n=a.getFieldDecorator,r=a.getFieldValue,l={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:14}}},s=[{title:"Item",key:"name",dataIndex:"name"},{title:"Normal Price",key:"normal_price",dataIndex:"normal_price",render:(e,t)=>i.a.createElement("p",null,e?e.toFixed(2):"--")},{title:"Tatkal Price",key:"tatkal_price",dataIndex:"tatkal_price",render:(e,t)=>i.a.createElement("p",null,e?e.toFixed(2):"--")},{title:"Quantity",key:"quantity",width:100,dataIndex:"quantity",render:(e,a)=>"BED"==a.type?1:i.a.createElement(m.a.Item,jr({key:"quantity[".concat(a.id,"]")},l),n("quantity[".concat(a.id,"]"),{initialValue:a.quantity,validateTrigger:["onChange","onBlur"]})(i.a.createElement(w.a,{min:1,max:100,placeholder:"quantity",size:"small",value:a.quantity,onChange:e=>t.changeQuantity(a.id,e),disabled:a.disabled})))},{title:"Discount",key:"discount",width:100,dataIndex:"discount",render:(e,a)=>i.a.createElement(m.a.Item,jr({key:"discount[".concat(a.id,"]")},l),n("discount[".concat(a.id,"]"),{initialValue:a.discount,validateTrigger:["onChange","onBlur"]})(i.a.createElement(w.a,{min:1,max:100,placeholder:"discount",size:"small",value:a.quantity,onChange:e=>t.changeDiscount(a.id,e),disabled:a.disabled})))},{title:"Price",key:"price",dataIndex:"price",render:(e,t)=>i.a.createElement("p",null,e?e.toFixed(2):"--")},{title:"Tax",key:"tax",dataIndex:"tax",render:(e,t)=>i.a.createElement("p",null,e?e.toFixed(2):"--")},{title:"Total Amount",key:"price_with_tax",dataIndex:"price_with_tax",render:(e,t)=>i.a.createElement("p",null,e?e.toFixed(2):"--")}],c={name:"image",data:{name:"hello"},action:Object(N.i)(V.Lb),headers:{authorization:"authorization-text"},onChange(e){e.file.status,"done"===e.file.status?Me.a.success("".concat(e.file.name," file uploaded successfully")):"error"===e.file.status&&Me.a.error("".concat(e.file.name," file upload failed."))}};n("keys",{initialValue:[0]});const d=r("keys"),h=d.map((e,t)=>i.a.createElement(y.a,{key:e},i.a.createElement(g.a,{span:8},i.a.createElement(m.a.Item,{label:""},n("label[".concat(e,"]"))(i.a.createElement(S.a,{placeholder:"name"})))),i.a.createElement(g.a,{span:8},i.a.createElement(m.a.Item,{label:""},n("value[".concat(e,"]"))(i.a.createElement(S.a,{placeholder:"value"})))),i.a.createElement(g.a,{span:8},t?i.a.createElement(o.a,{onClick:()=>this.removeNewOptionField(e),size:"small",type:"danger",style:{margin:5},icon:"close",shape:"circle"}):null,t==d.length-1?i.a.createElement(o.a,{type:"dashed",style:{marginTop:"3px"},onClick:this.addNewFields},i.a.createElement(E.a,{type:"plus"})," Add field"):null)));return i.a.createElement("div",null,i.a.createElement(u.a,{title:"Book a Seat/Bed"},i.a.createElement(m.a,null,i.a.createElement(y.a,null,i.a.createElement(g.a,{xs:24,sm:24,md:12,lg:12,xl:12},i.a.createElement("div",{style:{paddingRight:"10px"}},this.state.patientDetails?i.a.createElement(m.a.Item,jr({key:"id",value:this.state.patientDetails?this.state.patientDetails.id:""},{wrapperCol:{xs:{offset:6,span:24},sm:{offset:6,span:14}}}),i.a.createElement(u.a,{bordered:!1,style:{background:"#ECECEC"}},i.a.createElement(Fr,{avatar:this.state.patientDetails.image?i.a.createElement(b.a,{src:Object(N.h)(this.state.patientDetails.image)}):i.a.createElement(b.a,{style:{backgroundColor:"#87d068"}},this.state.patientDetails.user.first_name?this.state.patientDetails.user.first_name.charAt(0):i.a.createElement(E.a,{type:"user"})),title:this.state.patientDetails.user.first_name,description:this.state.patientDetails.user.mobile}))):i.a.createElement("div",null,i.a.createElement(m.a.Item,jr({label:"Patient"},l),n("patient",{rules:[{required:!0,message:"this field required"}]})(i.a.createElement(gr.a,{placeholder:"Patient Name",showSearch:!0,onSearch:this.searchPatient,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onSelect:this.handlePatientSelect},this.state.patientList.map(e=>i.a.createElement(gr.a.Option,{value:e?e.id.toString():""},i.a.createElement(re.a.Item,{style:{padding:0}},i.a.createElement(re.a.Item.Meta,{avatar:e.image?i.a.createElement(b.a,{style:{backgroundColor:"#ffff"},src:Object(N.h)(e.image)}):i.a.createElement(E.a,{type:"user"}),title:"".concat(e.user.first_name," (").concat(e.user.id,")"),description:i.a.createElement("small",null,e.user.mobile)})))))),this.state.ptr?i.a.createElement(f.a,{message:"Patient Not Found !!",description:"Please Search another patient or create new patient.",type:"error"}):null)),i.a.createElement(m.a.Item,jr({label:"Bed Package"},l),n("bed_package",{rules:[{required:!0,message:"this field required!"}]})(i.a.createElement(p.a,{onChange:e=>t.checkBedStatus("bed_package",e)},t.state.packages.map(e=>i.a.createElement(p.a.Option,{value:e.id},e.name))))),i.a.createElement(m.a.Item,jr({label:"Book From"},l),n("from_date",{rules:[{required:!0,message:"Input From Date!"}]})(i.a.createElement(D.a,{onChange:e=>t.checkBedStatus("from_date",e),format:"DD-MM-YYYY",allowClear:!1}))),i.a.createElement(m.a.Item,jr({label:"Book To"},l),n("to_date",{rules:[{required:!0,message:"Input To Date!"}]})(i.a.createElement(D.a,{disabled:!0,format:"DD-MM-YYYY"}))),i.a.createElement(m.a.Item,jr({label:"Booking Type"},l),n("seat_type",{rules:[{required:!0,message:"this field required"}]})(i.a.createElement(j.a.Group,{onChange:e=>this.handleRoomType("seat_type",e.target.value)},e.map(e=>i.a.createElement(j.a,{value:e.is_or_not?e.value:"",disabled:!e.is_or_not},e.value))))),i.a.createElement(m.a.Item,jr({label:"Medicine  Package"},l),n("medicines",{})(i.a.createElement(p.a,{mode:"multiple",onChange:this.handleMedicineSelect},t.state.medicinePackage.map(e=>i.a.createElement(p.a.Option,{value:e.id},e.name))))),i.a.createElement(m.a.Item,jr({label:"Pay Now : "},l),n("pay_value",{rules:[{required:!0,message:"this field is required"}],initialValue:this.state.totalPayingAmount?this.state.totalPayingAmount:null})(i.a.createElement(w.a,{min:0,step:1,max:this.state.totalPayableAmount,onChange:this.setPaymentAmount}))),i.a.createElement(m.a.Item,jr({label:"Payment Mode"},l),n("payment_mode",{rules:[{required:!0,message:"this field required"}]})(i.a.createElement(p.a,{showSearch:!0,filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.paymentModes.map(e=>i.a.createElement(p.a.Option,{value:e.id},e.mode))))),i.a.createElement(P.a,null,"Patient Details"),i.a.createElement(m.a.Item,jr({label:"Creatinine Level"},l),n("creatinine",{})(i.a.createElement(S.a,null))),i.a.createElement(m.a.Item,jr({label:"Urea Level"},l),n("urea_level",{})(i.a.createElement(S.a,null))),i.a.createElement(m.a.Item,jr({label:"Currently on Dialysis?"},l),n("dialysis",{})(i.a.createElement(p.a,{showSearch:!0,filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},i.a.createElement(p.a.Option,{value:!0},"YES"),i.a.createElement(p.a.Option,{value:!1},"NO")))),i.a.createElement(m.a.Item,jr({label:"Diseases"},l),n("other_diseases",{})(i.a.createElement(p.a,{showSearch:!0,mode:"multiple",filterOption:(e,t)=>t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},this.state.diseases.map(e=>i.a.createElement(p.a.Option,{value:e.id},e.name))))),i.a.createElement(m.a.Item,jr({label:"Other Diseases"},l),n("rest_diseases",{})(i.a.createElement(p.a,{mode:"tags"}))),i.a.createElement(m.a.Item,jr({label:"Upload Report"},l),n("file",{})(i.a.createElement(Fe.a,c,i.a.createElement(o.a,null,i.a.createElement(E.a,{type:"upload"})," Select File")))))),i.a.createElement(g.a,{xs:24,sm:24,md:12,lg:12,xl:12},i.a.createElement(P.a,null,"Item Details"),i.a.createElement(Ge.a,{pagination:!1,columns:s,size:"small",dataSource:this.state.choosePkg}),i.a.createElement(P.a,null,"Extra Details"),i.a.createElement(u.a,null,h)),i.a.createElement(g.a,{span:24},i.a.createElement("h3",null,"Grand Total: ",i.a.createElement("b",null,this.state.totalPayableAmount.toFixed(2))),i.a.createElement(m.a.Item,null,i.a.createElement(k.a,{title:"Are you sure to take payment of INR ".concat(this.state.totalPayingAmount,"?"),onConfirm:this.handleSubmit},i.a.createElement(o.a,{type:"primary"},"Submit")),t.props.history?i.a.createElement(o.a,{style:{margin:5},onClick:()=>t.props.history.goBack()},"Cancel"):null))))))}}var Vr=m.a.create()(Nr);function Lr(){return(Lr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Rr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Br=r.a.Content;class zr extends i.a.Component{constructor(e){super(e),Rr(this,"loadPDF",e=>{Object(N.c)(Object(N.g)(V.M,[e.practice.id,e.id]),(function(e){e.report&&window.open(Oe.a+e.report)}),(function(){}))}),Rr(this,"loadBedBookingReport",(e=1)=>{const t=this;this.setState({loading:!0});Object(N.c)(Object(N.g)(V.A,[this.props.active_practiceId]),(function(e){1==e.current?t.setState({bedBookingReports:e.results,loading:!1,nextReport:e.next}):t.setState((function(t){return{bedBookingReports:[...t.bedBookingReports,...e.results],loading:!1,nextReport:e.next}}))}),(function(){t.setState({loading:!1})}),{patients:this.state.patient.id,page:e})}),this.state={loading:!0,bedBookingReports:[],patient:this.props.currentPatient||{}},this.loadBedBookingReport=this.loadBedBookingReport.bind(this)}componentDidMount(){this.loadBedBookingReport()}render(){const e=this,t=[{title:"Bed Package",key:"name",dataIndex:"bed_package.name"},{title:"Medicine Package",key:"medicine",dataIndex:"medicines",render:(e,t)=>i.a.createElement("span",null,e.map(e=>i.a.createElement(O.a,null,e.name)))},{title:"From ",key:"from_date",render:(e,t)=>i.a.createElement("span",null,x()(t.from_date).format("LL"))},{title:"To ",key:"to_date",render:(e,t)=>i.a.createElement("span",null,x()(t.to_date).format("LL"))},{title:"Seat/Bed Type",key:"seat_type",dataIndex:"seat_type"},{title:"Seat Number",key:"seat_no",dataIndex:"seat_no"},{title:"Total price",key:"total_price",dataIndex:"total_price",render:e=>i.a.createElement("p",null,e.toFixed(2))},{title:"Payment Status",key:"payment_status",dataIndex:"payment_status"},{title:"Created By",key:"created",dataIndex:"created"},{title:"Report",key:"report_upload",dataIndex:"report_upload",render:e=>e?i.a.createElement("a",{href:Object(N.h)(e),target:"_blank"},"File"):null},{title:"Action",render:(t,a)=>i.a.createElement("span",null,a.practice?i.a.createElement("a",{onClick:()=>e.loadPDF(a)},"Print"):null)}];return i.a.createElement(Br,{className:"main-container",style:{minHeight:280}},i.a.createElement(r.a,null,i.a.createElement(c.d,null,i.a.createElement(c.b,{path:"/patient/:patient/booking/bed-booking",render:()=>e.props.activePracticePermissions.PatientBookings||e.props.allowAllPermissions?i.a.createElement(Vr,Lr({},this.props,{bedBooking:!0,loadData:this.loadBedBookingReport})):i.a.createElement(G.a,null)}),i.a.createElement(c.b,null,i.a.createElement("div",null,i.a.createElement("h2",null),i.a.createElement(u.a,{title:"Bed Bookings",extra:i.a.createElement(d.b,{to:"/patient/".concat(this.state.patient.id,"/booking/bed-booking")},i.a.createElement(o.a,{type:"primary",style:{float:"right"}},i.a.createElement(E.a,{type:"plus"})," Book A Seat"))},i.a.createElement(R.a,{pagination:!1,hideReport:!0,loading:this.state.loading,columns:t,dataSource:this.state.bedBookingReports}),i.a.createElement(L.a,{loaderFunction:()=>this.loadBedBookingReport(this.state.nextReport),loading:this.state.loading,hidden:!this.state.nextReport})))))))}}var Yr=a(810);a(803);function qr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Wr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?qr(Object(a),!0).forEach((function(t){Gr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):qr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Gr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Hr extends i.a.PureComponent{constructor(e){super(e),Gr(this,"loadData",(e=1)=>{let t=this;this.setState({loading:!0});let a={page:e,page_size:2e3,patient:this.props.currentPatient.id};Object(N.c)(V.fd,(function(e){1==e.current?t.setState({history:e.results,nextPage:e.next,loading:!1}):t.setState((function(t){return{history:[...t.history,...e.results],loading:!1,nextPage:e.next}}))}),(function(){}),a)}),Gr(this,"deleteRecord",e=>{let t=[Wr(Wr({},e),{},{is_active:!1})],a=this;Object(N.k)(V.fd,t,(function(){Object(N.a)(B.sc,"Record Deleted successfully!!"),a.loadData()}),(function(){}))}),Gr(this,"handleCancel",()=>{this.setState({visible:!1})}),this.state={loading:!1,history:[]}}componentDidMount(){this.props.currentPatient&&this.props.currentPatient.id&&this.loadData()}editRecord(e){this.setState({editingId:e.id,editingValues:e,visible:!0})}render(){if(this.props.currentPatient&&this.props.currentPatient.id){const e=this.state,t=e.loading,a=e.history,n=e.nextPage;let r=this;const l=[{title:"Medicine Name",dataIndex:"name",key:"name"},{title:"Medicine Formula",dataIndex:"formula",key:"formula"},{title:"Medicine Dosage",dataIndex:"dosage_details",key:"dosage_details"},{title:"Start Date",dataIndex:"start",key:"start",render:(e,t)=>i.a.createElement("span",null,e?x()(e).format("LL"):"--"),export:(e,t)=>e?x()(e).format("LL"):"--"},{title:"End Date",dataIndex:"end",key:"end",render:(e,t)=>i.a.createElement("span",null,e?x()(e).format("LL"):"--"),export:(e,t)=>e?x()(e).format("LL"):"--"},{title:"Remarks",dataIndex:"remarks",key:"remarks"},{title:"Action",dataIndex:"action",key:"action",render:(e,t)=>i.a.createElement(o.a.Group,{size:"small"},i.a.createElement(o.a,{type:"link",onClick:()=>this.editRecord(t)},"Edit"),i.a.createElement(k.a,{onConfirm:()=>this.deleteRecord(t),title:"Are you to delete this record?"},i.a.createElement(o.a,{type:"link"},"Delete")))}],s=[{label:"Medicine Name",key:"name",placeholder:"Medicine Name",initialValue:this.state.editingValues?this.state.editingValues.name:null,required:!0,type:B.db},{label:"Medicine Formula",key:"formula",placeholder:"Medicine Formula",initialValue:this.state.editingValues?this.state.editingValues.formula:null,required:!0,type:B.db},{label:"Medicine Dosage",key:"dosage_details",initialValue:this.state.editingValues?this.state.editingValues.dosage_details:null,required:!0,type:B.mc,options:W.K},{label:"Medicine Start Date",key:"start",initialValue:this.state.editingValues&&this.state.editingValues.start?x()(this.state.editingValues.start):null,format:"YYYY-MM-DD",type:B.N},{label:"Medicine End Date",key:"end",initialValue:this.state.editingValues&&this.state.editingValues.end?x()(this.state.editingValues.end):null,format:"YYYY-MM-DD",type:B.N},{label:"Remarks",key:"remarks",initialValue:this.state.editingValues?this.state.editingValues.remarks:null,type:B.vc}],c={beforeSend:e=>[Wr({},e)],successFn(e){r.handleCancel(),r.loadData(),Object(N.a)(B.sc,"Record Updated successfully!!")},errorFn(){},action:V.fd,method:"post"},p=[{key:"id",value:this.state.editingId}],h=m.a.create()(z.a);return i.a.createElement("div",null,i.a.createElement(u.a,{title:"Allopath History",extra:i.a.createElement(d.b,{to:"/patient/".concat(this.props.currentPatient.id,"/allopath/addbulk")},i.a.createElement(o.a,{type:"primary",icon:"plus"},"Add"))},i.a.createElement(R.a,{columns:l,dataSource:a,pagination:!1}),i.a.createElement(L.a,{loading:t,loaderFn:()=>this.loadData(n),hidden:!n})),i.a.createElement(C.a,{title:"Edit Allopath Medicine Record",visible:this.state.visible,footer:null,onCancel:this.handleCancel},i.a.createElement(h,{defaultValues:p,formProp:c,fields:s}),i.a.createElement(o.a,{key:"back",onClick:this.handleCancel},"Return"),","))}return(i.a.createElement(l.a,null,i.a.createElement(u.a,null)))}}function Ur(){return(Ur=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Kr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Qr(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Zr extends i.a.PureComponent{constructor(e){super(e),Qr(this,"handleSubmit",e=>{e.preventDefault();let t=this;this.props.form.validateFieldsAndScroll((function(e,a){if(!e){let e=[];t.state.tableFormData.forEach((function(n){e.push({name:a.name[n._id],formula:a.formula[n._id],dosage_details:a.dosage_details[n._id],start:a.start[n._id]?a.start[n._id].format("YYYY-MM-DD"):null,end:a.end[n._id]?a.end[n._id].format("YYYY-MM-DD"):null,remarks:a.remarks[n._id],patient:t.props.currentPatient.id})}));let n=function(e){Object(N.a)(B.sc,"Allopath Medicine Recorded successfully!!"),t.props.history.push("/patient/".concat(t.props.currentPatient.id,"/allopath"))},i=function(){};Object(N.k)(V.fd,e,n,i)}}))}),Qr(this,"addRow",()=>{this.setState((function(e){return{tableFormData:[...e.tableFormData,{_id:Math.random().toFixed(7)}]}}))}),Qr(this,"removeRow",e=>{this.setState((function(t){let a=[];return t.tableFormData.forEach((function(t){t._id!=e&&a.push(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Kr(Object(a),!0).forEach((function(t){Qr(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Kr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},t))})),{tableFormData:a}}))}),this.state={tableFormData:[]}}render(){const e=this,t=this.props.form.getFieldDecorator,a={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:24},md:{span:24},lg:{span:24},xl:{span:24}}};if(this.props.currentPatient&&this.props.currentPatient.id){const n=this.state.tableFormData,r=[{title:"Medicine Name",dataIndex:"name",key:"name",render:(e,n)=>i.a.createElement(m.a.Item,Ur({key:"name[".concat(n._id,"]")},a),t("name[".concat(n._id,"]"),{validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"This field is required."}]})(i.a.createElement(S.a,null)))},{title:"Medicine Formula",dataIndex:"formula",key:"formula",render:(e,n)=>i.a.createElement(m.a.Item,Ur({key:"formula[".concat(n._id,"]")},a),t("formula[".concat(n._id,"]"),{validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"This field is required."}]})(i.a.createElement(S.a,null)))},{title:"Medicine Dosage",dataIndex:"dosage_details",key:"dosage_details",render:(e,n)=>i.a.createElement(m.a.Item,Ur({key:"dosage_details[".concat(n._id,"]")},a),t("dosage_details[".concat(n._id,"]"),{validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"This field is required."}]})(i.a.createElement(p.a,null,W.K.map(e=>i.a.createElement(p.a.Option,{value:e.value},e.label)))))},{title:"Start Date",dataIndex:"start",key:"start",render:(e,n)=>i.a.createElement(m.a.Item,Ur({key:"start[".concat(n._id,"]")},a),t("start[".concat(n._id,"]"))(i.a.createElement(D.a,null)))},{title:"End Date",dataIndex:"end",key:"end",render:(e,n)=>i.a.createElement(m.a.Item,Ur({key:"end[".concat(n._id,"]")},a),t("end[".concat(n._id,"]"))(i.a.createElement(D.a,null)))},{title:"Remarks",dataIndex:"remarks",key:"remarks",render:(e,n)=>i.a.createElement(m.a.Item,Ur({key:"remarks[".concat(n._id,"]")},a),t("remarks[".concat(n._id,"]"))(i.a.createElement(S.a.TextArea,null)))},{title:"",dataIndex:"action",key:"action",render:(e,t)=>i.a.createElement(o.a,{size:"small",shape:"circle",icon:"close",type:"danger",onClick:()=>this.removeRow(t._id)})}];return i.a.createElement("div",null,i.a.createElement(u.a,{title:"Add Allopath History",extra:i.a.createElement(o.a,{icon:"plus",onClick:this.addRow},"Add Row")},i.a.createElement(m.a,{onSubmit:this.handleSubmit},i.a.createElement(Ge.a,{dataSource:n,bordered:!0,pagination:!1,columns:r}),i.a.createElement(m.a.Item,{style:{paddingTop:"30px"}},i.a.createElement(o.a,{type:"primary",htmlType:"submit",style:{margin:5}},"Save Medicines"),e.props.history?i.a.createElement(o.a,{style:{margin:5},onClick:()=>e.props.history.goBack()},"Cancel"):null))))}return(i.a.createElement(l.a,null,i.a.createElement(u.a,null)))}}var Xr=m.a.create()(Zr);function Jr(){return(Jr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function $r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function el(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?$r(Object(a),!0).forEach((function(t){tl(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):$r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function tl(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const al=S.a.Search,nl=aa.a.TabPane,il=Wn.a.Text,rl={_id:null,quantity:0,batch:null};class ll extends i.a.Component{constructor(e){super(e),tl(this,"selectedDefaultDate",e=>{this.setState({selectedDate:e})}),tl(this,"loadEditInvoiceData",()=>{const e=this;console.log("props===========================",e.props);Object(N.c)(Object(N.g)(V.Od,[e.props.editId]),(function(t){const a=t;e.setState((function(e){const t=[];a.procedure.forEach((function(e){t.push(el(el(el({},e.procedure_data),e),{},{selectedDoctor:e.doctor_data,selectedDate:x()(e.date).isValid()?x()(e.date):null,_id:Math.random().toFixed(7),item_type:W.Nb}))}));const n=el({},e.stocks),i=el({},e.itemBatches);return a.inventory.forEach((function(e){if(i[e.inventory]=e.inventory_item_data.item_type_stock.item_stock||[],n[e.inventory]){const t=n[e.inventory];e.inventory_item_data.item_type_stock&&e.inventory_item_data.item_type_stock.item_stock&&e.inventory_item_data.item_type_stock.item_stock.forEach((function(e){t[e.batch_number]?t[e.batch_number]+=e.quantity:t[e.batch_number]=e.quantity}))}else{const t={};e.inventory_item_data.item_type_stock&&e.inventory_item_data.item_type_stock.item_stock&&e.inventory_item_data.item_type_stock.item_stock.forEach((function(e){t[e.batch_number]=e.quantity})),n[e.inventory_item_data.id]=t}if(n[e.inventory]){const t=n[e.inventory];t[e.batch_number]?t[e.batch_number]+=e.unit:t[e.batch_number]=e.unit}else{const t={};t[e.batch_number]=e.unit,n[e.inventory]=t}i[e.inventory]&&i[e.inventory].forEach((function(t){t.batch_number==e.batch_number&&(e.selectedBatch=t)})),t.push(el(el(el({},e.inventory_item_data),e),{},{selectedDoctor:e.doctor_data,_id:Math.random().toFixed(7),item_type:W.nb}))})),{tableFormValues:t,selectedDate:x()(a.date).isValid()?x()(a.date):null,notes:a.notes,courier_charge:a.courier_charge,stocks:n,itemBatches:i}}))}),(function(){}))}),tl(this,"remove",e=>{this.setState((function(t){const a=[];return t.tableFormValues.forEach((function(t){t._id!=e&&a.push(t)})),{tableFormValues:a}}))}),tl(this,"add",(e,t=Math.random().toFixed(7))=>{const a=this;let n=el({},e);this.setState((function(e){n.item_type==W.Nb?n=el(el({},n),{},{id:void 0,unit:0,unit_cost:n.cost,procedure:n.id,selectedDoctor:e.selectedDoctor?e.selectedDoctor:null,selectedDate:x()(),taxes:a.state.patientBelongToOtherState?n.state_taxes:n.taxes.map(e=>e.id),children:void 0}):n.item_type==W.nb&&(n=el(el({},n),{},{id:void 0,unit:0,inventory:n.id,unit_cost:n.retail_without_tax,selectedDoctor:e.selectedDoctor?e.selectedDoctor:null}),n.hsn_data?n.taxes=a.state.patientBelongToOtherState?n.hsn_data.state_taxes:n.hsn_data.taxes:n.taxes=[]);let i=0;return this.props.MedicalMembership&&(i=this.props.MedicalMembership.medical_membership.benefit),{tableFormValues:[el(el(el({},rl),n),{},{id:void 0,_id:t,discount:i}),...e.tableFormValues]}})),e.item_type==W.Nb&&e.children&&e.children.length&&e.children.forEach((function(e){a.add(el(el({},e),{},{item_type:W.Nb}))}))}),tl(this,"selectDoctor",(e,t,a)=>{this.setState((function(n){const i=[];return n.tableFormValues.forEach((function(n){n._id==t&&n.item_type==a?i.push(el(el({},n),{},{selectedDoctor:e})):i.push(n)})),{tableFormValues:i}}))}),tl(this,"selectedDate",(e,t,a)=>{this.setState((function(n){const i=[];return n.tableFormValues.forEach((function(n){n._id==t&&n.item_type==a?i.push(el(el({},n),{},{selectedDate:e})):i.push(n)})),{tableFormValues:i}}))}),tl(this,"selectBatch",(e,t,a)=>{this.setState((function(n){const i=[];return n.tableFormValues.forEach((function(n){n._id==t&&n.item_type==a?i.push(el(el({},n),{},{selectedBatch:e})):i.push(n)})),{tableFormValues:i}}))}),tl(this,"addPrescription",e=>{const t=this;t.setState((function(a){const n=el({},a.stocks),i=el({},a.itemBatches);return e.drugs.forEach((function(e){e.inventory.maintain_inventory&&t.add(el(el({},e.inventory),{},{item_type:W.nb,inventory:e.inventory.id,id:e.inventory.id}));const a={},r=e.inventory;r.item_type_stock&&r.item_type_stock.item_stock&&r.item_type_stock.item_stock.forEach((function(e){a[e.batch_number]=e.quantity})),n[r.id]=a,r.item_type_stock.item_stock&&(i[r.id]=[...r.item_type_stock.item_stock])})),{selectedPrescriptions:[...a.selectedPrescriptions,e.id],stocks:el(el({},a.stocks),n),itemBatches:el(el({},a.itemBatches),i)}}))}),tl(this,"handleSubmit",e=>{const t=this;t.props.form.validateFields((e,a)=>{if(!e){t.setState({saveLoading:!0});const e={promo_code:t.state.promoCode,practice:t.props.active_practiceId,patient:t.props.match.params.id,unit:null,cost:null,discount:null,taxes:0,total:null,procedure:[],inventory:[],prescription:t.state.selectedPrescriptions,notes:a.notes,courier_charge:a.courier_charge,date:t.state.selectedDate&&x()(t.state.selectedDate).isValid()?t.state.selectedDate.format("YYYY-MM-DD"):null};t.state.tableFormValues.forEach((function(n){switch(n.unit=a.unit[n._id],n.taxes=a.taxes[n._id],n.item_type){case W.Nb:e.procedure.push({name:n.name,unit:n.unit,procedure:n.procedure,default_notes:null,is_active:!0,margin:n.margin,taxes:n.taxes,unit_cost:n.unit_cost,discount:n.discount,discount_type:n.discount_type,offers:n.offers,doctor:n.selectedDoctor?n.selectedDoctor.id:null,id:t.props.editId?n.id:void 0});break;case W.nb:e.inventory.push({inventory:n.inventory,name:n.name,unit:n.unit,taxes:n.taxes,unit_cost:n.unit_cost,discount:n.discount,discount_type:n.discount_type,offers:n.offers,doctor:n.selectedDoctor?n.selectedDoctor.id:null,instruction:n.instruction,is_active:!0,batch_number:n.selectedBatch?n.selectedBatch.batch_number:null,id:t.props.editId?n.id:void 0});break;default:return null}}));const n=function(e){t.setState({saveLoading:!1}),Object(N.a)("Inventory updated successfully"),t.props.loadData(),t.props.history.goBack()},i=function(){t.setState({saveLoading:!1})};t.props.editId?Object(N.m)(Object(N.g)(V.Od,[t.props.editId]),e,n,i):Object(N.k)(V.Nd,e,n,i)}})}),tl(this,"addItemThroughQR",e=>{const t=this;t.setState({loadingQr:!0});const a=e.split("*");Object(N.c)(V.de,(function(e){const n=t.props.form,i=n.setFieldsValue,r=(n.getFieldsValue,n.getFieldValue),l=Math.random().toFixed(7);let s=!0;if(t.state.tableFormValues.forEach((function(e){if(e.name==a[0]){const t=e._id,n=e.selectedBatch.batch_number,l=r("unit[".concat(t,"]"));n==a[1]&&(s=!1,i({["unit[".concat(t,"]")]:l+1}))}})),s){let n=null;e.item_type_stock&&e.item_type_stock.item_stock&&e.item_type_stock.item_stock.forEach((function(t){t.batch_number==a[1]&&(e.selectedBatch=t,n=t.unit_cost)})),t.add(el(el({},e),{},{item_type:W.nb}),l),i({["unit_cost[".concat(l,"]")]:n})}t.setState((function(e){return{loadingQr:!1,qrValue:""}}))}),(function(){}),{qr:e,form:"Invoice"})}),tl(this,"setQrValue",e=>{const t=e.target.value;this.setState({qrValue:t})}),tl(this,"searchValues",(e,t)=>{const a=this,n=e.target.value;this.setState({searchItem:n},(function(){t==W.nb?a.loadInventoryItemList():t==W.Lb?a.loadPrescriptions():t==W.Nb&&a.loadProcedures()}))}),tl(this,"changeNetPrice",(e,t)=>{const a=this,n=this.props.form,i=n.getFieldsValue;n.setFields;setTimeout((function(){const n=i();n.unit_cost[e]||n.unit[e]||n.discount[e]||n.discount_type[e]?a.setState((function(a){const i=[];return a.tableFormValues.forEach((function(r){if(r._id==e){let l=0,s=0,o="%",c=null,d=!(!r.selectOption&&0!=r.selectOption)&&r.selectOption;n.taxes[e].forEach((function(e){a.taxes_list.forEach((function(t){t.id==e&&(l+=t.tax_value)}))})),t&&"0"==t&&(d=!1),n.discount_type&&n.discount_type[e]?(s=n.discount[e],o=n.discount_type[e],c=null):(s=n.discount[e]?n.discount[e].toString().split("#")[0]:"",o=n.discount[e]?n.discount[e].toString().split("#")[1]:"",c=n.discount[e]?n.discount[e].toString().split("#")[2]:null);let p=n.unit[e]*(n.unit_cost[e]?n.unit_cost[e]:0);"%"==o&&s?(s>100&&(s=100),p*=1-.01*s):"INR"==o&&s&&(p>s?p-=s:p=0),p*=1+.01*l;const m=p/n.unit[e];i.push(el(el({},r),{},{total_unit_cost:m,total:p,selectOption:d,discount:s,discount_type:o,offers:c}))}else i.push(r)})),{tableFormValues:i}})):a.setState({retail_price:0}),a.checkPromoCode()}),1e3)}),tl(this,"applyPromoCodeDiscounts",e=>{const t=this,a=t.props.form,n=a.setFieldsValue,i=a.getFieldsValue,r=[],l=i();let s=e;const o={};t.state.tableFormValues.forEach((function(e){let a=0;let n=0;const i=!(!e.selectOption&&0!=e.selectOption)&&e.selectOption;l.taxes[e._id].forEach((function(e){t.state.taxes_list.forEach((function(t){t.id==e&&(a+=t.tax_value)}))}));let c=l.unit[e._id]*(l.unit_cost[e._id]?l.unit_cost[e._id]:0),d=0;s&&(c>s?(c-=s,d=s,n=s,s=0):(s-=c,d=c,n=c,c=0)),c*=1+.01*a;const p=c/l.unit[e._id];r.push(el(el({},e),{},{total_unit_cost:p,total:c,selectOption:i,discount:d,discount_type:"INR",offers:null})),o["discount[".concat(e._id,"]")]=n.toFixed(2),o["discount_type[".concat(e._id,"]")]="INR"})),t.setState({tableFormValues:r}),n(o)}),tl(this,"loadLoyaltyDiscount",()=>{const e=this;Object(N.c)(Object(N.g)(V.ad,[this.props.active_practiceId]),(function(t){e.setState({offers:t})}),(function(){e.setState({})}))}),tl(this,"onChangeOption",(e,t)=>{this.setState((function(e){const a=[];return e.tableFormValues.forEach((function(e){e._id==t?a.push(el(el({},e),{},{selectOption:!0})):a.push(e)})),{tableFormValues:a}}))}),tl(this,"onChangeOffer",(e,t)=>{this.setState((function(a){const n=[];return a.tableFormValues.forEach((function(i){i._id==t?("none"==e&&n.push(el(el({},i),{},{loyaltyDiscount:null})),"0"==e?n.push(el(el({},i),{},{selectOption:!1})):a.offers.forEach((function(t){t.id==e&&n.push(el(el({},i),{},{loyaltyDiscount:t.discount}))}))):n.push(i)})),{tableFormValues:n}}))}),tl(this,"onchangeDiscountSimple",(e,t)=>{console.log(e,t);this.setState((function(a){const n=[];return a.tableFormValues.forEach((function(a){if(a._id==t){const t=a.unit_cost/(1+.01*e);console.log(t),n.push(el(el({},a),{},{loyaltyDiscount:e}))}else n.push(a)})),{tableFormValues:n}}))}),tl(this,"enterPromoCode",e=>{this.setState({promoCode:e.target.value})}),tl(this,"calculateGrandTotalWithoutDiscount",()=>{let e=0;const t=this,a=(0,this.props.form.getFieldsValue)();return this.state.tableFormValues.forEach((function(n){let i=0;a.taxes[n._id].forEach((function(e){t.state.taxes_list.forEach((function(t){t.id==e&&(i+=t.tax_value)}))}));let r=a.unit[n._id]*(a.unit_cost[n._id]?a.unit_cost[n._id]:0);r*=1+.01*i,e+=r})),e}),tl(this,"checkPromoCode",e=>{const t=this;t.setState({promoCodeCheckLoading:!0});const a={promo_code:this.state.promoCode,practice:this.props.active_practiceId,patient:t.props.match.params.id,amount:this.calculateGrandTotalWithoutDiscount()};a.promo_code?Object(N.c)(V.X,(function(e){t.setState({appliedPromoCodeDiscount:e.discount,promoCodeCheckLoading:!1}),t.applyPromoCodeDiscounts(e.discount)}),(function(){t.setState({promoCodeCheckLoading:!1,appliedPromoCodeDiscount:null,promoCode:""})}),a):t.setState({promoCodeCheckLoading:!1})}),tl(this,"removePromoCode",()=>{this.setState({appliedPromoCodeDiscount:0,promoCodeCheckLoading:!1,promoCode:""}),this.applyPromoCodeDiscounts(0)}),this.state={classType:e.type,tableFormValues:[],maxQuantityforConsume:{},items:{},practiceDoctors:[],selectedPrescriptions:[],selectedDate:x()(),stocks:{},itemBatches:{},saveLoading:!1,qrValue:"",searchItem:"",selectedDoctor:{},tempValues:{},offers:[],loading:!1,taxes_list:[],promoCode:"",appliedPromoCodeDiscount:null,promoCodeCheckLoading:!1,patientBelongToOtherState:Hn()(e,"activePracticeData.reg_state")!=Hn()(e,"currentPatient.state")}}componentDidMount(){const e=this;Object(le.e)(this),this.loadInventoryItemList(),this.loadProcedures(),this.loadPrescriptions(),this.loadTaxes(),this.loadLoyaltyDiscount(),this.props.editId&&setTimeout((function(){e.setState({loading:!1}),e.loadEditInvoiceData()}),2e3)}loadInventoryItemList(e=1){const t=this,a=this.state.searchItem;t.setState({loadingInventory:!0});const n={practice:this.props.active_practiceId,maintain_inventory:!0,page:e};this.state.searchItem&&(n.item_name=a),Object(N.c)(V.Wb,(function(e){const n=e.results,i=[];t.state.searchItem==a&&t.setState((function(t){const a=el({},t.stocks),r=el({},t.itemBatches);n.forEach((function(e){if(i.push(e),a[e.id]){const t=a[e.id];e.item_type_stock&&e.item_type_stock.item_stock&&e.item_type_stock.item_stock.forEach((function(e){t[e.batch_number]?t[e.batch_number]+=e.quantity:t[e.batch_number]=e.quantity}))}else{const t={};e.item_type_stock&&e.item_type_stock.item_stock&&e.item_type_stock.item_stock.forEach((function(e){t[e.batch_number]=e.quantity})),a[e.id]=t}e.item_type_stock.item_stock&&(r[e.id]?r[e.id]=[...r[e.id],...e.item_type_stock.item_stock]:r[e.id]=[...e.item_type_stock.item_stock])}));const l=t.items;return l[W.nb]=el(el({},e),{},{results:i}),{items:l,stocks:el(el({},t.stocks),a),itemBatches:el(el({},t.itemBatches),r),loadingInventory:!1}}),(function(){t.props.editId&&t.loadEditInvoiceData()}))}),(function(){t.setState({loadingInventory:!1})}),n)}loadProcedures(e=1){const t=this,a=this.state.searchItem,n={practice:this.props.active_practiceId,page:e};this.state.searchItem&&(n.name=a),Object(N.c)(Object(N.g)(V.Kd,[this.props.active_practiceId]),(function(e){const n=t.state.items;n[W.Nb]=e,t.state.searchItem==a&&t.setState({items:n})}),(function(){}),n)}loadPrescriptions(){const e=this,t=this.state.searchItem,a={practice:this.props.active_practiceId};this.state.searchItem&&(a.item_name=t),Object(N.c)(Object(N.g)(V.jf,[e.props.match.params.id]),(function(a){e.state.searchItem==t&&e.setState((function(e){return{items:el(el({},e.items),{},{[W.Lb]:a})}}))}),(function(){}),a)}loadTaxes(){const e=this;Object(N.c)(Object(N.g)(V.df,[this.props.active_practiceId]),(function(t){e.setState({taxes_list:t})}),(function(){}))}render(){const e=this,t=this.props.form.getFieldDecorator,a={labelCol:{xs:{span:24},sm:{span:4}},wrapperCol:{xs:{span:24},sm:{span:24},md:{span:24},lg:{span:24},xl:{span:24}}};t("keys",{initialValue:[]});let n=[{title:"Item Name",key:"item_name",dataIndex:"name",width:180,render(n,r){switch(r.item_type){case W.Nb:return i.a.createElement(m.a.Item,Jr({key:"name[".concat(r._id,"]")},a),t("name[".concat(r._id,"]"),{validateTrigger:["onChange","onBlur"],initialValue:n,rules:[{required:!0,message:"This field is required."}]})(i.a.createElement(S.a,{min:0,placeholder:"Item name",size:"small"})),i.a.createElement("span",null,"by   "),i.a.createElement(_.a,{placement:"topCenter",overlay:i.a.createElement(h.a,null,e.state.practiceDoctors.map(t=>i.a.createElement(h.a.Item,{key:"0"},i.a.createElement("a",{onClick:()=>e.selectDoctor(t,r._id,W.Nb)},t.user.first_name)))),trigger:["click"]},i.a.createElement("a",{className:"ant-dropdown-link",href:"#"},i.a.createElement("b",null,r.selectedDoctor.user?r.selectedDoctor.user.first_name:"No DOCTORS Found"))),i.a.createElement("span",null,"   on  "),i.a.createElement(D.a,{value:r.selectedDate,size:"small",onChange:t=>e.selectedDate(t,r._id,W.Nb),format:"DD-MM-YYYY"}));case W.Lb:return i.a.createElement("b",null,r.name);case W.nb:return i.a.createElement("div",null,i.a.createElement("span",null,r.name),i.a.createElement("span",null,i.a.createElement("br",null),"by   "),i.a.createElement(_.a,{placement:"topCenter",overlay:i.a.createElement(h.a,null,e.state.practiceDoctors.map(t=>i.a.createElement(h.a.Item,{key:t.id},i.a.createElement("a",{onClick:()=>e.selectDoctor(t,r._id,W.nb)},t.user.first_name)))),trigger:["click"]},i.a.createElement("a",{className:"ant-dropdown-link",href:"#"},i.a.createElement("b",null,r.selectedDoctor.user?r.selectedDoctor.user.first_name:"No DOCTORS Found"))),i.a.createElement("span",null,i.a.createElement("br",null),"from batch   "),i.a.createElement(_.a,{placement:"topCenter",overlay:i.a.createElement(h.a,null,e.state.itemBatches[r.inventory]&&e.state.itemBatches[r.inventory].map((t,a)=>x()()>=x()(t.expiry_date)?i.a.createElement(h.a.Item,{key:a,disabled:!0},t.batch_number," (",t.quantity,")   ",t.expiry_date):i.a.createElement(h.a.Item,{key:a},i.a.createElement("a",{onClick:()=>e.selectBatch(t,r._id,W.nb)},t.batch_number," (",t.quantity,")   ",t.expiry_date)))),trigger:["click"]},i.a.createElement("a",{className:"ant-dropdown-link",href:"#"},i.a.createElement("b",null,r.selectedBatch?r.selectedBatch.batch_number:"Select Batch"))));default:return null}}}];return n=n.concat([{title:"Unit",key:"unit",width:100,dataIndex:"unit",render:(n,r)=>r.item_type==W.nb?i.a.createElement(m.a.Item,Jr({key:"unit[".concat(r._id,"]")},a),t("unit[".concat(r._id,"]"),{validateTrigger:["onChange","onBlur"],initialValue:r.unit||0,rules:[{required:!0,message:"This field is required."}]})(i.a.createElement(w.a,{min:0,max:r.selectedBatch&&e.state.stocks[r.inventory]&&e.state.stocks[r.inventory][r.selectedBatch.batch_number]?e.state.stocks[r.inventory][r.selectedBatch.batch_number]:0,placeholder:"units",size:"small",onChange:e=>this.changeNetPrice(r._id,r.discount),disabled:!(r.selectedBatch&&e.state.stocks[r.inventory]&&e.state.stocks[r.inventory][r.selectedBatch.batch_number])}))):i.a.createElement(m.a.Item,Jr({key:"unit[".concat(r._id,"]")},a),t("unit[".concat(r._id,"]"),{initialValue:r.unit||0,validateTrigger:["onChange","onBlur"],rules:[{required:!0,message:"This field is required."}]})(i.a.createElement(w.a,{min:0,max:100,placeholder:"unit",size:"small",onChange:e=>this.changeNetPrice(r._id,r.discount)})))},{title:"Unit Cost",key:"unit_cost",width:100,dataIndex:"unit_cost",render:(n,r)=>i.a.createElement(m.a.Item,Jr({key:"unit_cost[".concat(r._id,"]")},a),t("unit_cost[".concat(r._id,"]"),{validateTrigger:["onChange","onBlur"],initialValue:r.item_type==W.nb?r.retail_without_tax:r.cost,rules:[{required:!0,message:"This field is required."}]})(i.a.createElement(w.a,{min:1,placeholder:"Unit Cost",size:"small",onChange:()=>e.changeNetPrice(r._id,r.discount)})))},{title:"Discount",key:"discount",dataIndex:"discount",render:(n,r)=>r.selectOption?i.a.createElement(m.a.Item,{key:"discount[".concat(r._id,"]"),extra:i.a.createElement("span",null,r&&r.discount?"".concat(r.discount," ").concat(r.discount_type," Discount"):null," ")},t("discount[".concat(r._id,"]"),{initialValue:r.offers,validateTrigger:["onChange","onBlur"]})(i.a.createElement(p.a,{style:{width:150},onChange:t=>e.changeNetPrice(r._id,t),size:"small",disabled:this.state.appliedPromoCodeDiscount},i.a.createElement(p.a.Option,{value:"0"},"Custom Offer"),e.state.offers.map(e=>i.a.createElement(p.a.Option,{value:"".concat(e.discount,"#").concat(e.unit,"#").concat(e.id)},e.code))))):i.a.createElement(m.a.Item,Jr({extra:i.a.createElement("a",{onClick:()=>e.onChangeOption("selectOption",r._id),disabled:this.state.appliedPromoCodeDiscount},"Choose Offer"),key:"discount[".concat(r._id,"]")},a),t("discount[".concat(r._id,"]"),{initialValue:r.discount?r.discount:0,validateTrigger:["onChange","onBlur"]})(i.a.createElement(S.a,{placeholder:"discount",disabled:this.state.appliedPromoCodeDiscount,addonAfter:t("discount_type[".concat(r._id,"]"),{initialValue:r.discount_type||"%"})(i.a.createElement(p.a,{onChange:t=>e.changeNetPrice(r._id,t),disabled:this.state.appliedPromoCodeDiscount},W.A.map(e=>i.a.createElement(p.a.Option,{value:e.value}," ",e.value)))),size:"small",style:{width:150},onChange:e=>this.changeNetPrice(r._id,e.target.value)})))},{title:"Taxes",key:"taxes",dataIndex:"taxes",render:(n,r)=>i.a.createElement(m.a.Item,Jr({key:"taxes[".concat(r._id,"]")},a),t("taxes[".concat(r._id,"]"),{initialValue:r.taxes||[],validateTrigger:["onChange","onBlur"]})(i.a.createElement(p.a,{placeholder:"Taxes",size:"small",mode:"multiple",style:{width:150},onChange:()=>e.changeNetPrice(r._id,r.discount)},this.state.taxes_list&&this.state.taxes_list.map(e=>i.a.createElement(p.a.Option,{value:e.id},e.name,"@",e.tax_value,"%")))))},{title:"Total Unit Cost",key:"total_unit_cost",width:80,align:"right",dataIndex:"total_unit_cost",render:(e,t)=>i.a.createElement("span",null,e?e.toFixed(2):"0.00")},{title:"Total",key:"total",width:80,align:"right",dataIndex:"total",render:(e,t)=>e?e.toFixed(2):"0.00"}]),n=n.concat([{key:"_id",dataIndex:"_id",render:(t,a)=>i.a.createElement(o.a,{icon:"close",onClick:()=>e.remove(a._id),type:"danger",shape:"circle",size:"small"})}]),i.a.createElement("div",null,i.a.createElement(l.a,{spinning:this.state.saveLoading,tip:"Saving Invoice..."},i.a.createElement(l.a,{spinning:this.state.promoCodeCheckLoading,tip:"Checking Promo Code and Discounts..."},i.a.createElement(u.a,{title:this.props.editId?"Edit Proforma Invoice ":"Add Proforma Invoice",extra:i.a.createElement(al,{loading:this.state.loadingQr,value:this.state.qrValue,onChange:this.setQrValue,placeholder:"Search QR Code",onSearch:this.addItemThroughQR,style:{width:200}}),bodyStyle:{padding:0}},i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement(aa.a,{size:"small",type:"card"},i.a.createElement(nl,{tab:W.nb,key:W.nb},i.a.createElement("div",{style:{backgroundColor:"#ddd",padding:8}},i.a.createElement(S.a.Search,{placeholder:"Search in ".concat(W.nb),onChange:e=>this.searchValues(e,W.nb)})),i.a.createElement(re.a,{size:"small",itemLayout:"horizontal",loading:this.state.loadingInventory,dataSource:this.state.items&&this.state.items[W.nb]?this.state.items[W.nb].results:[],renderItem:e=>i.a.createElement(re.a.Item,null,i.a.createElement(re.a.Item.Meta,{title:"".concat(e.name," (").concat(e.total_quantity,")")}),i.a.createElement(o.a,{type:"primary",size:"small",shape:"circle",onClick:()=>this.add(el(el({},e),{},{item_type:W.nb})),icon:"arrow-right"}))}),this.state.items&&this.state.items[W.nb]?i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement("a",{style:{margin:5},disabled:!this.state.items[W.nb].previous,onClick:()=>this.loadInventoryItemList(this.state.items[W.nb].previous)},i.a.createElement(E.a,{type:"left"}),"Previous"),i.a.createElement(P.a,{type:"vertical"}),i.a.createElement("a",{style:{margin:5},disabled:!this.state.items[W.nb].next,onClick:()=>this.loadInventoryItemList(this.state.items[W.nb].next)},"Next",i.a.createElement(E.a,{type:"right"}))):null),i.a.createElement(nl,{tab:W.Lb,key:W.Lb},i.a.createElement(re.a,{size:"small",itemLayout:"horizontal",dataSource:this.state.items?this.state.items[W.Lb]:[],renderItem:e=>i.a.createElement(re.a.Item,null,i.a.createElement(re.a.Item.Meta,{title:e.drugs.map(e=>i.a.createElement("div",null,i.a.createElement("span",null,e.name)," ",e.inventory.maintain_inventory?null:i.a.createElement(O.a,{color:"red",style:{float:"right",lineHeight:"18px"}},"Not Sold"),i.a.createElement("br",null))),description:i.a.createElement("div",null,"  ",e.doctor?i.a.createElement(O.a,{color:e.doctor?e.doctor.calendar_colour:null},i.a.createElement("b",null,"prescribed by  ".concat(e.doctor.user.first_name)," ")):null," ",i.a.createElement("span",{style:{float:"right"}},x()(e.date).format("LL")))}),i.a.createElement(o.a,{type:"primary",size:"small",shape:"circle",onClick:()=>this.addPrescription(el({},e)),icon:"arrow-right"}))})),i.a.createElement(nl,{tab:W.Nb,key:W.Nb},i.a.createElement("div",{style:{backgroundColor:"#ddd",padding:8}},i.a.createElement(S.a.Search,{placeholder:"Search in ".concat(W.Nb),onChange:e=>this.searchValues(e,W.Nb)})),i.a.createElement(re.a,{size:"small",itemLayout:"horizontal",dataSource:this.state.items&&this.state.items[W.Nb]?this.state.items[W.Nb].results:[],renderItem:e=>i.a.createElement(re.a.Item,null,i.a.createElement(re.a.Item.Meta,{title:e.name}),i.a.createElement(o.a,{type:"primary",size:"small",shape:"circle",onClick:()=>this.add(el(el({},e),{},{item_type:W.Nb})),icon:"arrow-right"}))}),this.state.items&&this.state.items[W.Nb]?i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement("a",{style:{margin:5},disabled:!this.state.items[W.Nb].previous,onClick:()=>this.loadProcedures(this.state.items[W.Nb].previous)},i.a.createElement(E.a,{type:"left"}),"Previous"),i.a.createElement(P.a,{type:"vertical"}),i.a.createElement("a",{style:{margin:5},disabled:!this.state.items[W.Nb].next,onClick:()=>this.loadProcedures(this.state.items[W.Nb].next)},"Next",i.a.createElement(E.a,{type:"right"}))):null))),i.a.createElement(g.a,{span:18},i.a.createElement(m.a,null,i.a.createElement(Ge.a,{pagination:!1,loading:e.state.loading,bordered:!0,dataSource:this.state.tableFormValues,columns:n}),i.a.createElement(Lt.a,{offsetBottom:0},i.a.createElement(u.a,null,i.a.createElement(y.a,null,i.a.createElement(g.a,{span:6},i.a.createElement(m.a.Item,{label:"Notes",key:"notes"},t("notes",{initialValue:this.state.notes,validateTrigger:["onChange","onBlur"]})(i.a.createElement(S.a.TextArea,{placeholder:"Notes...",size:"small"}))),i.a.createElement(m.a.Item,{label:"Packing & Delivery Charges",key:"courier_charge"},t("courier_charge",{initialValue:this.state.courier_charge?this.state.courier_charge:0,validateTrigger:["onChange","onBlur"]})(i.a.createElement(w.a,{style:{width:"100%"},placeholder:"Packing & Delivery Charges",size:"large"})))),i.a.createElement(g.a,{span:6,offset:1},i.a.createElement(m.a.Item,{label:"On "},i.a.createElement(D.a,{value:this.state.selectedDate,onChange:e=>this.selectedDefaultDate(e),format:"DD-MM-YYYY",allowClear:!1})),i.a.createElement("h3",null,"Grand Total: ",i.a.createElement("b",null,this.state.tableFormValues.reduce((function(e,t){return(parseFloat(e)+(t&&t.total?t.total:0)).toFixed(2)}),0)))),i.a.createElement(g.a,{span:9},i.a.createElement(m.a.Item,{style:{paddingTop:"30px"}},i.a.createElement(o.a,{type:"primary",htmlType:"submit",onClick:()=>this.handleSubmit(!0),style:{margin:5}},"Save Proforma"),e.props.history?i.a.createElement(o.a,{style:{margin:5},onClick:()=>e.props.history.goBack()},"Cancel"):null)))))),i.a.createElement(y.a,null,i.a.createElement(g.a,{span:12,style:{padding:10}},i.a.createElement("div",null,this.state.appliedPromoCodeDiscount?i.a.createElement("div",null,i.a.createElement(O.a,null,"'",this.state.promoCode,"' Applied ",i.a.createElement(E.a,{onClick:()=>this.removePromoCode(),theme:"twoTone",twoToneColor:"#f00",type:"close-circle"})),i.a.createElement(il,{type:"success"},i.a.createElement("br",null),"Discount INR ",this.state.appliedPromoCodeDiscount)):i.a.createElement("div",null,i.a.createElement(al,{enterButton:"Apply",value:this.state.promoCode,placeholder:"Promo Code",onChange:this.enterPromoCode,onSearch:this.checkPromoCode,style:{width:200}})))))))))))}}var sl=m.a.create()(ll);function ol(){return(ol=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function cl(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function dl(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?cl(Object(a),!0).forEach((function(t){pl(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):cl(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function pl(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ml extends i.a.Component{constructor(e){super(e),pl(this,"loadPDF",e=>{Object(N.c)(Object(N.g)(V.Pd,[e]),(function(e){e.report&&window.open(Oe.a+e.report)}),(function(){}))}),pl(this,"onCancelProforma",e=>{const t=this,a=dl(dl({},e),{},{is_cancelled:!0});delete a.reservation,Object(N.m)(Object(N.g)(V.Od,[e.id]),a,(function(e){t.loadInvoices()}),(function(){}))}),this.state={currentPatient:this.props.currentPatient,active_practiceId:this.props.active_practiceId,invoices:[],drug_catalog:null,procedure_category:null,taxes_list:null,editInvoice:null,loading:!0},this.loadInvoices=this.loadInvoices.bind(this),this.loadDrugCatalog=this.loadDrugCatalog.bind(this),this.loadProcedureCategory=this.loadProcedureCategory.bind(this),this.loadTaxes=this.loadTaxes.bind(this)}componentDidMount(){this.loadInvoices()}loadInvoices(e=1){const t=this;t.props.refreshWallet&&1==e&&t.props.refreshWallet(),t.setState({loading:!0});const a={page:e,practice:this.props.active_practiceId,summary:!0};this.props.match.params.id&&(a.patient=this.props.match.params.id),Object(N.c)(V.Nd,(function(e){1==e.current?t.setState({total:e.count,invoices:e.results,loading:!1,loadMoreInvoice:e.next}):t.setState((function(t){return{total:e.count,invoices:[...t.invoices,...e.results],loading:!1,loadMoreInvoice:e.next}}))}),(function(){t.setState({loading:!1})}),a)}loadDrugCatalog(){const e=this;Object(N.c)(Object(N.g)(V.qb,[this.props.active_practiceId]),(function(t){e.setState({drug_catalog:t})}),(function(){}))}loadProcedureCategory(){const e=this;Object(N.c)(Object(N.g)(V.Kd,[this.props.active_practiceId]),(function(t){e.setState({procedure_category:t})}),(function(){}))}loadTaxes(){const e=this;Object(N.c)(Object(N.g)(V.df,[this.props.active_practiceId]),(function(t){e.setState({taxes_list:t})}),(function(){}))}createInvoice(e){this.setState({editInvoice:e}),this.props.history.push("/patient/".concat(e.patient_data.id,"/proforma-invoice/convert"))}editProforma(e){this.setState({editInvoice:e}),this.props.history.push("/patient/".concat(e.patient_data.id,"/proforma-invoice/edit/"))}render(){const e=this,t={};this.state.drug_catalog&&this.state.drug_catalog.forEach((function(e){t[e.id]="".concat(e.name,",").concat(e.strength)}));const a={};this.state.procedure_category&&this.state.procedure_category.forEach((function(e){a[e.id]=e.name}));const n={};return this.state.taxes_list&&this.state.taxes_list.forEach((function(e){n[e.id]=e.name})),this.props.match.params.id?i.a.createElement("div",null,i.a.createElement(c.d,null,i.a.createElement(c.b,{path:"/patient/:id/proforma-invoice/add/",render:e=>this.props.activePracticePermissions.PatientAddEditInvoices?i.a.createElement(sl,ol({},e,this.props,{loadData:this.loadInvoices})):i.a.createElement(G.a,null)}),i.a.createElement(c.b,{path:"/patient/:id/proforma-invoice/edit",render:e=>this.state.editInvoice?this.props.activePracticePermissions.PatientAddEditInvoices?i.a.createElement(sl,ol({},this.state,e,this.props,{editId:this.state.editInvoice.id,loadData:this.loadInvoices})):i.a.createElement(G.a,null):i.a.createElement(c.a,{to:"/patient/".concat(this.props.match.params.id,"/proforma-invoice")})}),i.a.createElement(c.b,{path:"/patient/:id/proforma-invoice/convert/",render:e=>this.state.editInvoice?this.props.activePracticePermissions.PatientAddEditInvoices?i.a.createElement(ai,ol({},this.state,e,this.props,{proformaId:this.state.editInvoice.id,loadData:this.loadInvoices})):i.a.createElement(G.a,null):i.a.createElement(c.a,{to:"/patient/".concat(this.props.match.params.id,"/proforma-invoice")})}),i.a.createElement(c.b,null,i.a.createElement("div",null,i.a.createElement(f.a,{banner:!0,showIcon:!0,type:"info",message:"The invoices shown are only for the current selected practice!"}),i.a.createElement(Lt.a,{offsetTop:0},i.a.createElement(u.a,{bodyStyle:{padding:0},style:{boxShadow:"0 5px 8px rgba(0, 0, 0, 0.09)"},title:(this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," Invoice "):"Invoices ")+(this.state.total?"(Total:".concat(this.state.total,")"):""),extra:i.a.createElement(o.a.Group,null,i.a.createElement(d.b,{to:"/patient/".concat(this.props.match.params.id,"/proforma-invoice/add")},i.a.createElement(o.a,{type:"primary",disabled:!this.props.activePracticePermissions.PatientAddEditInvoices},i.a.createElement(E.a,{type:"plus"}),"Add")))})),this.state.invoices.map(t=>fl(t,e)),i.a.createElement(l.a,{spinning:this.state.loading},i.a.createElement(y.a,null)),i.a.createElement(L.a,{loaderFunction:()=>this.loadInvoices(this.state.loadMoreInvoice),loading:this.state.loading,hidden:!this.state.loadMoreInvoice}))))):i.a.createElement("div",null,i.a.createElement(Lt.a,{offsetTop:0},i.a.createElement(u.a,{bodyStyle:{padding:0},style:{boxShadow:"0 5px 8px rgba(0, 0, 0, 0.09)"},title:(this.state.currentPatient?"".concat(this.state.currentPatient.user.first_name," Invoice "):"Invoice ")+(this.state.total?"(Total:".concat(this.state.total,")"):""),extra:i.a.createElement(o.a.Group,null,i.a.createElement(o.a,{type:"primary",onClick:()=>this.props.togglePatientListModal(!0),disabled:!this.props.activePracticePermissions.PatientAddEditInvoices},i.a.createElement(E.a,{type:"plus"}),"Add"))})),this.state.invoices.map(t=>fl(t,e)),i.a.createElement(l.a,{spinning:this.state.loading},i.a.createElement(y.a,null)),i.a.createElement(L.a,{loaderFunction:()=>this.loadInvoices(this.state.loadMoreInvoice),loading:this.state.loading,hidden:!this.state.loadMoreInvoice}))}}var ul=m.a.create()(ml);function hl(e){return e?i.a.createElement("p",null,e.doctor?i.a.createElement(Bt.a,{title:"Doctor"},i.a.createElement(O.a,{color:e.doctor?e.doctor.calendar_colour:null},i.a.createElement("b",null,"prescribed by  ".concat(e.doctor.user.first_name)," "))):null,e.practice?i.a.createElement(O.a,{style:{float:"right"}},i.a.createElement(Bt.a,{title:"Practice Name"},i.a.createElement("b",null,e.practice.name," "))):null,e.courier_charge?i.a.createElement("p",null,"Packing and Delivery Charges : ",e.courier_charge," INR"):null,e.notes?i.a.createElement("p",null,"Notes : ",e.notes):null,e.cancel_note?i.a.createElement("p",null,"Cancel Notes : ",e.cancel_note):null):null}function fl(e,t){let a=[...e.procedure,...e.inventory];if(e.reservation){const t=e.reservation_data.medicines.map(t=>Object.create(dl(dl({},t),{},{unit:1,total:t.final_price,unit_cost:t.price,discount:0,courier_charge:e.courier_charge}))),n={NORMAL:{total:"final_normal_price",tax:"normal_tax_value",unit_cost:"normal_price"},TATKAL:{total:"final_tatkal_price",tax:"tatkal_tax_value",unit_cost:"tatkal_price"}};a=[...a,dl(dl({},e.reservation_data.bed_package),{},{unit:1,total:e.reservation_data.bed_package?e.reservation_data.bed_package[n[e.reservation_data.seat_type].total]:null,tax_value:e.reservation_data.bed_package?e.reservation_data.bed_package[n[e.reservation_data.seat_type].tax]:null,unit_cost:e.reservation_data.bed_package?e.reservation_data.bed_package[n[e.reservation_data.seat_type].unit_cost]:null}),...t]}return i.a.createElement(u.a,{key:e.id,style:{marginTop:10},bodyStyle:{padding:0},title:i.a.createElement("small",null,e.date?x()(e.date).format("ll"):null,t.state.currentPatient?null:i.a.createElement("span",null,i.a.createElement(d.b,{to:"/patient/".concat(e.patient_data?e.patient_data.id:null,"/proforma-invoice")},"   ",e.patient_data?e.patient_data.user.first_name:null," (ID: ",e.patient_data&&e.patient_data.custom_id?e.patient_data.custom_id:e.patient_data.id,") "),", ",e.patient_data?e.patient_data.gender:null)),extra:i.a.createElement(_.a.Button,{size:"small",style:{float:"right"},overlay:i.a.createElement(h.a,null,i.a.createElement(h.a.Item,{key:"1",onClick:()=>t.createInvoice(e),disabled:!t.props.match.params.id},i.a.createElement(E.a,{type:"dollar"}),"  Create Invoice"),i.a.createElement(h.a.Divider,null),i.a.createElement(h.a.Item,{key:"2",onClick:()=>t.editProforma(e),disabled:e.practice!=t.props.active_practiceId||e.payments_data||e.is_cancelled||!t.props.activePracticePermissions.PatientAddEditInvoices},i.a.createElement(E.a,{type:"edit"}),"Edit"),i.a.createElement(h.a.Item,{key:"3",onClick:()=>t.onCancelProforma(e),disabled:e.practice!=t.props.active_practiceId||e.payments_data||e.is_cancelled||!t.props.activePracticePermissions.PatientAddEditInvoices},i.a.createElement(E.a,{type:"delete"}),"Cancel"))},i.a.createElement("a",{onClick:()=>t.loadPDF(e.id)},i.a.createElement(E.a,{type:"printer"})))},i.a.createElement(y.a,{gutter:8},i.a.createElement(g.a,{xs:24,sm:24,md:6,lg:4,xl:4,xxl:4,style:{padding:10}},e.is_cancelled?i.a.createElement(f.a,{message:"Cancelled",type:"error",showIcon:!0}):null,i.a.createElement(P.a,{style:{marginBottom:0}},e.invoice_id),i.a.createElement(v.a,{title:"Paid / Total ",value:e.payments_data?e.payments_data.toFixed(2):0,suffix:"/ ".concat(e.total?e.total.toFixed(2):0)})),i.a.createElement(g.a,{xs:24,sm:24,md:18,lg:20,xl:20,xxl:20},(e=>{switch(e.type){case B.lb:return i.a.createElement(Ge.a,{bordered:!0,pagination:!1,columns:yl,dataSource:[{inventory:!0,name:"Membership",unit_cost:e.total,unit:1,discount_value:0,tax_value:0,total:e.total},{name:"Total",unit_cost:e.total,unit:1,discount_value:0,tax_value:0,total:e.total}],footer:()=>hl({practice:e.practice_data,notes:e.notes,cancel_note:e.cancel_note,courier_charge:e.courier_charge})});case B.Yb:return i.a.createElement(Ge.a,{bordered:!0,pagination:!1,columns:yl,dataSource:[{inventory:!0,name:"Registration",unit_cost:e.total,unit:1,discount_value:0,tax_value:0,total:e.total},{name:"Total",unit_cost:e.total,unit:1,discount_value:0,tax_value:0,total:+e.total}],footer:()=>hl({practice:e.practice_data,notes:e.notes,cancel_note:e.cancel_note,courier_charge:e.courier_charge})});case B.eb:case"Bed Booking":return i.a.createElement(Ge.a,{bordered:!0,pagination:!1,columns:yl,dataSource:[...a,{name:"Total",unit_cost:a.reduce((function(e,t){return e+t.unit_cost}),0),unit:a.reduce((function(e,t){return e+t.unit}),0),discount_value:a.reduce((function(e,t){return e+t.discount_value}),0),tax_value:a.reduce((function(e,t){return e+t.tax_value}),0),total:a.reduce((function(e,t){return e+t.total}),0)}],footer:()=>hl({practice:e.practice_data,notes:e.notes,cancel_note:e.cancel_note,courier_charge:e.courier_charge})});default:return null}})(e))))}const yl=[{title:"S.No",key:"s_no",dataIndex:"s_no",render:(e,t,a)=>a+1},{title:"Treatment & Products",dataIndex:"drug",key:"drug",render:(e,t)=>i.a.createElement("span",null," ",i.a.createElement("b",null,t.name?t.name:null),i.a.createElement("br",null)," ",t.doctor_data?i.a.createElement(O.a,{color:t.doctor_data?t.doctor_data.calendar_colour:null},i.a.createElement("b",null,"prescribed by  ".concat(t.doctor_data.user.first_name)," ")):null)},{title:"Cost",dataIndex:"unit_cost",key:"unit_cost",render:(e,t)=>i.a.createElement("span",null,t.unit_cost?t.unit_cost.toFixed(2):null)},{title:"Unit",dataIndex:"unit",key:"unit"},{title:"Discount",dataIndex:"discount_value",key:"discount_value",render:(e,t)=>i.a.createElement("span",null,t.discount_value?t.discount_value.toFixed(2):null)},{title:"Tax",dataIndex:"tax_value",key:"tax_value",render:(e,t)=>i.a.createElement("span",null,t.tax_value?t.tax_value.toFixed(2):null)},{title:"Total",dataIndex:"total",key:"total",render:e=>e?e.toFixed(2):null}];function gl(){return(gl=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function bl(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const El=r.a.Content;class vl extends i.a.Component{constructor(e){super(e),bl(this,"loadPatientPendingAmount",()=>{const e=this;if(this.state.currentPatient&&this.state.currentPatient.id){const t=function(t){e.setState({pendingAmount:t})},a=function(){};Object(N.c)(Object(N.g)(V.sd,[this.state.currentPatient.id]),t,a)}else this.setState({pendingAmount:null})}),bl(this,"loadPatientWallet",()=>{const e=this;if(this.state.currentPatient&&this.state.currentPatient.id){const t=function(t){e.setState({walletAmount:t})},a=function(){};Object(N.c)(Object(N.g)(V.h,[this.state.currentPatient.id]),t,a)}else this.setState({pendingAmount:null})}),bl(this,"loadMembership",()=>{const e=this;if(this.state.currentPatient&&this.state.currentPatient.id){const t=function(t){e.setState({MedicalMembership:t.length?t[t.length-1]:null})},a=function(){};Object(N.c)(Object(N.g)(V.dd,[e.state.currentPatient.id]),t,a)}}),bl(this,"refreshWallet",()=>{this.loadPatientWallet(),this.loadPatientPendingAmount(),this.loadMembership()}),this.state={currentPatient:null,active_practiceId:this.props.active_practiceId,medicalHistory:[],listModalVisible:!1,loading:!1,showAllClinic:Object(N.d)("showAllClinic"),pendingAmount:null,walletAmount:null,hideSidePanel:!1},this.setCurrentPatient=this.setCurrentPatient.bind(this),this.togglePatientListModal=this.togglePatientListModal.bind(this),this.toggleShowAllClinic=this.toggleShowAllClinic.bind(this),this.loadPatientPendingAmount=this.loadPatientPendingAmount.bind(this),this.loadPatientWallet=this.loadPatientWallet.bind(this)}componentDidMount(){!this.props.match.params.id||this.state.currentPatient&&this.props.match.params.id==this.state.currentPatient.id||this.getPatientListData(this.props.match.params.id),this.loadPatientPendingAmount(),this.loadPatientWallet(),this.loadMembership()}componentWillReceiveProps(e,t){const a=this;this.state.currentPathLocation!=e.location&&this.setState({currentPathLocation:e.location},(function(){let e=!1;for(let t=0;t<W.Qb.length;t++)Object(c.f)(a.state.currentPathLocation.pathname,{path:W.Qb[t],exact:!1,strict:!1})&&(e=!0,a.setState({hideSidePanel:!0}));e||a.setState({hideSidePanel:!1})}))}getPatientListData(e){const t=this;t.setState({loading:!0});const a=this.props.activePracticePermissions.ViewAllClinics?{}:{perm_practice:this.props.active_practiceId};Object(N.c)(Object(N.g)(V.td,[e]),(function(e){t.setCurrentPatient(e)}),(function(){Object(N.a)(B.T,"Patient Loading Failed"),t.setState({loading:!1})}),a)}setCurrentPatient(e,t=null){const a=this,n=this.props.location.pathname.split("/");isNaN(parseInt(n[2]))?e&&(n[1]="patient",n.splice(2,0,e.id)):e?(n[1]="patient",n[2]=e.id):(n[1]="patients",n.splice(2,1)),this.props.history.push(n.join("/")),this.setState({currentPatient:e,patientAllowed:e?!!e.is_active:null,loading:!1,listModalVisible:!1},(function(){t&&a.props.history.push(Object(N.g)(t,[e.id]))}))}togglePatientListModal(e){this.setState({listModalVisible:!!e})}toggleShowAllClinic(e){this.setState({showAllClinic:!!e},(function(){Object(N.o)("showAllClinic",!!e)}))}render(){const e=this;return(i.a.createElement(El,null,i.a.createElement(l.a,{spinning:this.state.loading,size:"large"},i.a.createElement(_a,gl({},this.state,this.props,{togglePatientListModal:this.togglePatientListModal,key:this.state.currentPatient,setCurrentPatient:this.setCurrentPatient,toggleShowAllClinic:this.toggleShowAllClinic,refreshWallet:this.refreshWallet})),this.state.currentPatient&&!this.state.patientAllowed?i.a.createElement(i.a.Fragment,null,i.a.createElement(s.a,{status:403,title:"Permission Denied",subTitle:"You don't have permission to access this patient",extra:i.a.createElement(d.b,{to:"/patients/"},i.a.createElement(o.a,{type:"primary"},"Go to All Patient"))}),i.a.createElement(Ee.a,gl({},this.props,{patientData:this.state.currentPatient,loadData:()=>this.getPatientListData(e.props.match.params.id)}))):i.a.createElement(r.a,null,i.a.createElement(Xe,gl({},this.state,this.props)),i.a.createElement(r.a,null,i.a.createElement(El,{className:"main-container",key:this.state.showAllClinic.toString(),style:{padding:"0px 5px",minHeight:280}},i.a.createElement(c.d,null,i.a.createElement(c.b,{exact:!0,path:"/patients/merge",render:t=>e.props.activePracticePermissions.MergePatients||e.props.allowAllPermissions?i.a.createElement(Er,this.state):i.a.createElement(G.a,null)}),e.props.activePracticePermissions.WebAdmin||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patients/profile",render:e=>this.state.currentPatient?i.a.createElement(c.a,{to:"/patient/".concat(this.state.currentPatient.id,"/profile")}):i.a.createElement(je,gl({},this.state,{key:this.state.currentPatient,setCurrentPatient:this.setCurrentPatient,refreshWallet:this.refreshWallet},this.props))}):null,i.a.createElement(c.b,{exact:!0,path:"/patients/profile/add",render:t=>e.props.activePracticePermissions.AddPatient||e.props.allowAllPermissions?i.a.createElement(qe,gl({key:this.state.currentPatient},this.props,t)):i.a.createElement(G.a,null)}),i.a.createElement(c.b,{exact:!0,path:"/patient/:id/profile",render:t=>e.props.activePracticePermissions.ViewPatient||e.props.allowAllPermissions?i.a.createElement(je,gl({},this.state,{key:this.state.currentPatient,refreshWallet:this.refreshWallet,setCurrentPatient:this.setCurrentPatient},this.props,t)):i.a.createElement(G.a,null)}),i.a.createElement(c.b,{exact:!0,path:"/patient/:id/profile/edit",render:t=>e.props.activePracticePermissions.EditPatient||e.props.allowAllPermissions?i.a.createElement(qe,gl({key:this.state.currentPatient},this.state,this.props,t)):i.a.createElement(G.a,null)}),e.props.activePracticePermissions.PatientAppointments||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patients/appointments",render:e=>this.state.currentPatient?i.a.createElement(c.a,{to:"/patient/".concat(this.state.currentPatient.id,"/appointments")}):i.a.createElement(Ue,gl({key:this.state.currentPatient},this.state,e,this.props))}):null,e.props.activePracticePermissions.PatientAppointments||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patient/:id/appointments",render:e=>i.a.createElement(Ue,gl({key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,e,this.props))}):null,e.props.activePracticePermissions.PatientAppointments||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patients/appointments/:appointmentid",render:e=>i.a.createElement(Ue,gl({key:this.state.currentPatient},this.state,e,this.props))}):null,e.props.activePracticePermissions.PatientCommunications||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patients/communications",render:()=>this.state.currentPatient?i.a.createElement(c.a,{to:"/patient/".concat(this.state.currentPatient.id,"/communications")}):i.a.createElement(vr,{togglePatientListModal:this.togglePatientListModal})}):null,e.props.activePracticePermissions.PatientCommunications||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patient/:id/communications",render:e=>i.a.createElement(ja,gl({key:this.state.currentPatient?this.state.currentPatient.id:null},this.props,this.state,e))}):null,e.props.activePracticePermissions.PatientCommunications||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patient/:id/allopath/addbulk",render:e=>i.a.createElement(Xr,gl({key:this.state.currentPatient?this.state.currentPatient.id:null},this.props,this.state,e))}):null,e.props.activePracticePermissions.PatientCommunications||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patients/allopath",render:()=>this.state.currentPatient?i.a.createElement(c.a,{to:"/patient/".concat(this.state.currentPatient.id,"/allopath")}):i.a.createElement(vr,{togglePatientListModal:this.togglePatientListModal})}):null,e.props.activePracticePermissions.PatientCommunications||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patient/:id/allopath",render:e=>i.a.createElement(Hr,gl({key:this.state.currentPatient?this.state.currentPatient.id:null},this.props,this.state,e))}):null,e.props.activePracticePermissions.PatientVitalSigns||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patients/emr/vitalsigns",render:e=>this.state.currentPatient?i.a.createElement(c.a,{to:"/patient/".concat(this.state.currentPatient.id,"/emr/vitalsigns")}):i.a.createElement(Ba,gl({togglePatientListModal:this.togglePatientListModal,key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,e))}):null,i.a.createElement(c.b,{path:"/patient/:id/emr/vitalsigns",render:t=>e.props.activePracticePermissions.PatientVitalSigns||e.allowAllPermissions?i.a.createElement(Ba,gl({key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,t)):i.a.createElement(G.a,null)}),i.a.createElement(c.b,{exact:!0,path:"/patient/:id/emr/vitalsigns/edit",render:t=>e.props.activePracticePermissions.PatientVitalSigns||e.allowAllPermissions?i.a.createElement(Ta,gl({key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,t)):i.a.createElement(G.a,null)}),i.a.createElement(c.b,{path:"/patients/emr/clinicnotes",render:e=>i.a.createElement(ga,gl({togglePatientListModal:this.togglePatientListModal,key:this.state.currentPatient?this.state.currentPatient.id:null},this.props,this.state,e))}),"}/>",i.a.createElement(c.b,{path:"/patient/:id/emr/clinicnotes",render:e=>i.a.createElement(ga,gl({key:this.state.currentPatient?this.state.currentPatient.id:null},this.props,this.state,e))}),e.props.activePracticePermissions.PatientCompletedProcedure||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patients/emr/workdone",render:e=>this.state.currentPatient?i.a.createElement(c.a,{to:"/patient/".concat(this.state.currentPatient.id,"/emr/workdone")}):i.a.createElement(Xa,gl({togglePatientListModal:this.togglePatientListModal,key:this.state.currentPatient?this.state.currentPatient.id:null},this.props,this.state,e))}):null,e.props.activePracticePermissions.PatientCompletedProcedure||e.allowAllPermissions?i.a.createElement(c.b,{path:"/patient/:id/emr/workdone",render:t=>i.a.createElement(Xa,gl({},e.props,{key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,t))}):null,e.props.activePracticePermissions.PatientFiles||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patients/emr/files",render:e=>this.state.currentPatient?i.a.createElement(c.a,{to:"/patient/".concat(this.state.currentPatient.id,"/emr/files")}):i.a.createElement(ta,gl({togglePatientListModal:this.togglePatientListModal,key:this.state.currentPatient?this.state.currentPatient.id:null},e,this.state))}):null,e.props.activePracticePermissions.PatientFiles||e.allowAllPermissions?i.a.createElement(c.b,{path:"/patient/:id/emr/files",render:e=>i.a.createElement(ta,gl({key:this.state.currentPatient?this.state.currentPatient.id:null},this.props,e,this.state))}):null,e.props.activePracticePermissions.PatientFiles||e.allowAllPermissions?i.a.createElement(c.b,{path:"/patient/:id/emr/create-medicalCertificate",render:e=>i.a.createElement(Dr,gl({key:this.state.currentPatient?this.state.currentPatient.id:null},this.props,e,this.state))}):null,e.props.activePracticePermissions.PatientPrescriptions||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patients/emr/prescriptions",render:e=>this.state.currentPatient?i.a.createElement(c.a,{to:"/patient/".concat(this.state.currentPatient.id,"/emr/prescriptions")}):i.a.createElement(En,gl({togglePatientListModal:this.togglePatientListModal,key:this.state.currentPatient?this.state.currentPatient.id:null},this.props,this.state,e))}):null,e.props.activePracticePermissions.PatientPrescriptions||e.allowAllPermissions?i.a.createElement(c.b,{path:"/patient/:id/emr/prescriptions",render:e=>i.a.createElement(En,gl({key:this.state.currentPatient?this.state.currentPatient.id:null},this.props,this.state,e))}):null,e.props.activePracticePermissions.PatientTreatmentPlans||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patients/emr/plans",render:e=>this.state.currentPatient?i.a.createElement(c.a,{to:"/patient/".concat(this.state.currentPatient.id,"/emr/plans")}):i.a.createElement(Tn,gl({togglePatientListModal:this.togglePatientListModal,key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,this.props,e))}):null,e.props.activePracticePermissions.PatientTreatmentPlans||e.allowAllPermissions?i.a.createElement(c.b,{path:"/patient/:id/emr/plans",render:t=>i.a.createElement(Tn,gl({key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,e.props,t))}):null,i.a.createElement(c.b,{path:"/patient/:id/emr/timeline",render:t=>e.props.activePracticePermissions.PatientTimeline||e.allowAllPermissions?i.a.createElement(Ut,gl({key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,t)):i.a.createElement(G.a,null)}),e.props.activePracticePermissions.PatientLabOrders||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patient/emr/labtrackings",render:e=>this.state.currentPatient?i.a.createElement(c.a,{to:"/patient/".concat(this.state.currentPatient.id,"/emr/labtrackings")}):i.a.createElement(qn,gl({key:this.state.currentPatient},this.state,e))}):null,i.a.createElement(c.b,{path:"/patient/:id/emr/labtrackings",render:t=>e.props.activePracticePermissions.PatientLabOrders||e.allowAllPermissions?i.a.createElement(qn,gl({key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,t)):i.a.createElement(G.a,null)}),e.props.activePracticePermissions.PatientInvoices||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patients/billing/invoices",render:e=>this.state.currentPatient?i.a.createElement(c.a,{to:"/patient/".concat(this.state.currentPatient.id,"/billing/invoices")}):i.a.createElement(Mi,gl({togglePatientListModal:this.togglePatientListModal,key:this.state.currentPatient?this.state.currentPatient.id:null},this.props,this.state,e))}):null,i.a.createElement(c.b,{path:"/patient/:id/billing/invoices",render:t=>e.props.activePracticePermissions.PatientInvoices||e.allowAllPermissions?i.a.createElement(Mi,gl({},e.state,{refreshWallet:this.refreshWallet,key:this.state.currentPatient?this.state.currentPatient.id:null},this.props,this.state,t)):i.a.createElement(G.a,null)}),e.props.activePracticePermissions.PatientReturns||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patients/billing/return/invoices",render:e=>this.state.currentPatient?i.a.createElement(c.a,{to:"/patient/".concat(this.state.currentPatient.id,"/billing/return/invoices")}):i.a.createElement(cr,gl({togglePatientListModal:this.togglePatientListModal,key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,this.props,e))}):null,i.a.createElement(c.b,{exact:!0,path:"/patient/:id/billing/return/invoices",render:t=>e.props.activePracticePermissions.PatientReturns||e.allowAllPermissions?i.a.createElement(cr,gl({refreshWallet:this.refreshWallet,key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,this.props,t)):i.a.createElement(G.a,null)}),e.props.activePracticePermissions.PatientPayments||e.allowAllPermissions?i.a.createElement(c.b,{path:"/patients/billing/payments",render:e=>this.state.currentPatient?i.a.createElement(c.a,{to:"/patient/".concat(this.state.currentPatient.id,"/billing/payments")}):i.a.createElement(tr,gl({togglePatientListModal:this.togglePatientListModal,key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,this.props,e))}):null,i.a.createElement(c.b,{path:"/patient/:id/billing/payments",render:t=>e.props.activePracticePermissions.PatientPayments||e.allowAllPermissions?i.a.createElement(tr,gl({refreshWallet:this.refreshWallet,key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,this.props,t)):i.a.createElement(G.a,null)}),this.state.currentPatient?i.a.createElement(c.b,{exact:!0,path:"/patient/:id/billing/ledger",render:t=>e.props.activePracticePermissions.PatientLedger||e.allowAllPermissions?i.a.createElement(yr,gl({refreshWallet:this.refreshWallet,key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,this.props,t)):i.a.createElement(G.a,null)}):null,i.a.createElement(c.b,{exact:!0,path:"/patient/:id/prescriptions/template/add",render:t=>e.props.activePracticePermissions.PatientPrescriptions||e.allowAllPermissions?i.a.createElement(sn,gl({key:this.state.currentPatient?this.state.currentPatient.id:null},this.state,t)):i.a.createElement(G.a,null)}),i.a.createElement(c.b,{path:"/patient/:id/booking",render:t=>e.props.activePracticePermissions.PatientBookings||e.props.allowAllPermissions?i.a.createElement(zr,gl({},this.state,this.props,t,{key:this.state.currentPatient?this.state.currentPatient.id:null})):i.a.createElement(G.a,null)}),this.state.currentPatient&&this.state.currentPatient.is_agent?i.a.createElement(c.b,{exact:!0,path:"/patient/:id/billing/wallet",render:t=>e.props.activePracticePermissions.PatientBookings||e.props.allowAllPermissions?i.a.createElement(Yr.a,gl({},this.state,this.props,t,{key:this.state.currentPatient?this.state.currentPatient.id:null})):i.a.createElement(G.a,null)}):null,e.props.activePracticePermissions.PatientInvoices||e.allowAllPermissions?i.a.createElement(c.b,{exact:!0,path:"/patients/proforma-invoice",render:e=>this.state.currentPatient?i.a.createElement(c.a,{to:"/patient/".concat(this.state.currentPatient.id,"/proforma-invoice")}):i.a.createElement(ul,gl({togglePatientListModal:this.togglePatientListModal,key:this.state.currentPatient?this.state.currentPatient.id:null},this.props,this.state,e))}):null,i.a.createElement(c.b,{path:"/patient/:id/proforma-invoice",render:t=>e.props.activePracticePermissions.PatientInvoices||e.allowAllPermissions?i.a.createElement(ul,gl({},e.state,{refreshWallet:this.refreshWallet,key:this.state.currentPatient?this.state.currentPatient.id:null},this.props,this.state,t)):i.a.createElement(G.a,null)}),i.a.createElement(c.b,{render:e=>this.state.currentPatient?i.a.createElement(c.a,{to:"/patient/".concat(this.state.currentPatient.id,"/profile")}):i.a.createElement(je,gl({},this.state,{key:this.state.currentPatient,setCurrentPatient:this.setCurrentPatient},this.props))}))))))))}}t.default=vl},439:function(e,t,a){"use strict";a.d(t,"a",(function(){return S}));var n=a(1),i=a.n(n),r=a(1568),l=a(503),s=a(448),o=a(1105),c=a(1183),d=a(1589),p=a(1572),m=a(436),u=a.n(m),h=a(517),f=a.n(h),y=a(464),g=a.n(y),b=a(508),E=a.n(b);a(518);const v=function(e,t,a=!0){let n="",i=[];return a&&(e.forEach((function(e){i.push(e)})),n+=i.join(","),n+="\r\n"),t.forEach((function(t){i=[],e.forEach((function(e){t[e]?i.push(t[e]):i.push("--")})),n+=i.join(","),n+="\r\n"})),n},_=function(e,t){const a="".concat(t,".csv");let n;const i=[];i.push(255,254);for(let t=0;t<e.length;++t)n=e.charCodeAt(t),i.push(255&n),i.push(n/256>>>0);const r=new Blob([new Uint8Array(i)],{type:"text/csv;charset=UTF-16LE;"});if(navigator.msSaveBlob)navigator.msSaveBlob(r,a);else{const e=document.createElement("a");if(void 0!==e.download){const t=window.URL.createObjectURL(r);e.setAttribute("href",t),e.setAttribute("download",a),e.style.visibility="hidden",document.body.appendChild(e),e.click(),document.body.removeChild(e),window.URL.revokeObjectURL(t)}}};a(435),a(434),a(438);function P(){return(P=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function k(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function O(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?k(Object(a),!0).forEach((function(t){C(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):k(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function C(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class S extends i.a.Component{constructor(e){super(e),C(this,"getColumnSearchProps",e=>({filterDropdown:({setSelectedKeys:t,selectedKeys:a,confirm:n,clearFilters:s})=>i.a.createElement("div",{style:{padding:8}},i.a.createElement(r.a,{ref:e=>{this.searchInput=e},placeholder:"Search ".concat(e),value:a[0],onChange:e=>t(e.target.value?[e.target.value]:[]),onPressEnter:()=>this.handleSearch(a,n),style:{width:188,marginBottom:8,display:"block"}}),i.a.createElement(l.a,{type:"primary",onClick:()=>this.handleSearch(a,n),icon:"search",size:"small",style:{width:90,marginRight:8}},"Search"),i.a.createElement(l.a,{onClick:()=>this.handleReset(s),size:"small",style:{width:90}},"Reset")),filterIcon:e=>i.a.createElement(s.a,{type:"search",style:{color:e?"#1890ff":void 0}}),onFilter:(t,a)=>null!=g()(a,e)?g()(a,e).toString().toLowerCase().includes(t.toLowerCase()):"",onFilterDropdownVisibleChange:e=>{e&&setTimeout(()=>this.searchInput.select())},render:e=>i.a.createElement(f.a,{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[this.state.searchText],autoEscape:!0,textToHighlight:e?e.toString():""})})),C(this,"handleSearch",(e,t)=>{t(),this.setState({searchText:e[0]})}),C(this,"handleReset",e=>{e(),this.setState({searchText:""})}),this.state=O(O({},e),{},{searchText:""}),this.excelExport=this.excelExport.bind(this),this.pdfExport=this.pdfExport.bind(this)}componentWillReceiveProps(e){e.columns==this.state.columns&&e.dataSource==this.state.dataSource&&e.loading==this.state.loading||this.setState(O({},e))}pdfExport(){const e=this,t=[];e.state.columns.forEach((function(e){e.hideExport||t.push({title:e.title,dataKey:e.title})}));const a=[];e.state.dataSource.forEach((function(t,n){const i={};e.state.columns.forEach((function(e){e.export?i[e.title]=e.export(g()(t,e.dataIndex),t,n):i[e.title]=g()(t,e.dataIndex)})),a.push(i)})),function(e,t,a){const n=new E.a("p","mm","a4");!function(e){e.line(10,20,200,20)}(n);const i=Object.create(t);n.autoTable(e,i,{margin:{top:35},startY:n.autoTableEndPosY()+20,headerStyle:{overflow:"linebreak"},bodyStyles:{overflow:"linebreak"}}),function(e){e.line(10,270,200,270),e.setFontSize(8),e.text(10,275,"This is a computer generated report.")}(n),n.save("".concat(a,".pdf"))}(t,a,"Export".concat(u()()))}excelExport(){const e=this,t=[];e.state.columns.forEach((function(e){e.hideExport||t.push(e.title)}));const a=[];e.state.dataSource.forEach((function(t,n){const i={};e.state.columns.forEach((function(e){e.export?i[e.title]=e.export(g()(t,e.dataIndex),t,n):i[e.title]=g()(t,e.dataIndex)})),a.push(i)})),function(e,t,a="download"){const n=v(e,t);_(n,a)}(t,a,"Export".concat(u()()))}render(){const e=this,t=this.state.columns.map(t=>t.hide?{}:t.render?O({},t):O(O({},t),e.getColumnSearchProps(t.dataIndex)));return i.a.createElement("div",null,this.props.hideReport?null:i.a.createElement(o.a,null,i.a.createElement(c.a,null,i.a.createElement(l.a.Group,{size:"small"},i.a.createElement(l.a,{disabled:this.state.loading,type:"primary",onClick:this.excelExport},i.a.createElement(s.a,{type:"file-excel"})," Excel"),i.a.createElement(l.a,{disabled:this.state.loading,type:"primary",onClick:this.pdfExport},i.a.createElement(s.a,{type:"file-pdf"})," PDF")))),i.a.createElement(o.a,null,i.a.createElement(d.a,P({pagination:{position:"both",pageSizeOptions:["10","20","30","40","50","100"],showSizeChanger:!0,showQuickJumper:!0,size:"small",showTotal:(e,t)=>i.a.createElement(p.a,null,"Showing ",i.a.createElement("b",null,t[0])," to ",i.a.createElement("b",null,t[1])," of ",i.a.createElement("b",null,e)," items")}},this.state,{columns:t}))))}}},442:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(433),i=a(1105),r=a(503),l=a(1),s=a.n(l);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class c extends s.a.Component{constructor(e){super(e),o(this,"startLoading",()=>{this.props.loaderFunction&&(this.props.loaderFunction(),this.startMakingExtraLabels())}),o(this,"startMakingExtraLabels",()=>{const e=this;this.setState((function(e){return e.extraLoadingLabel.length>2?{extraLoadingLabel:""}:{extraLoadingLabel:"".concat(e.extraLoadingLabel,".")}}),(function(){e.props.loading&&setTimeout((function(){e.startMakingExtraLabels()}),500)}))}),this.state={extraLoadingLabel:""}}render(){return this.props.loading?s.a.createElement(n.a,{spinning:this.props.loading},s.a.createElement(i.a,{style:{minHeight:200}})):this.props.hidden?s.a.createElement(i.a,null,s.a.createElement("div",{style:{textAlign:"center",margin:"15px 0px"}},s.a.createElement("small",null,"No More Data Found"))):s.a.createElement(i.a,null,s.a.createElement("div",{style:{textAlign:"center",margin:"15px 0px"}},s.a.createElement(r.a,{type:"primary",onClick:this.startLoading,loading:this.props.loading},this.props.loading?"Loading".concat(this.state.extraLoadingLabel):"Load More")))}}},810:function(e,t,a){"use strict";a.d(t,"a",(function(){return k}));var n=a(1),i=a.n(n),r=a(1594),l=a(1608),s=a(836),o=a(448),c=a(1105),d=a(1183),p=a(763),m=a(1587),u=a(503),h=a(436),f=a.n(h),y=a(439),g=a(435),b=a(434),E=a(442),v=a(456);function _(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const P=r.a.Text;class k extends i.a.Component{constructor(e){super(e),_(this,"loadPatientWallet",()=>{const e=this;if(this.props.currentPatient&&this.props.currentPatient.id){const t=function(t){t.length&&e.setState({walletAmount:t[0]})},a=function(){};Object(g.c)(Object(g.g)(b.h,[this.props.currentPatient.id]),t,a)}else this.setState({pendingAmount:null})}),_(this,"loadData",(e=1)=>{const t=this;this.setState({loading:!0});const a={page:e,start:this.state.selectedStartDate.startOf("day").format(),end:this.state.selectedEndDate.endOf("day").format(),agents:this.state.selectedAgents.join(",")};this.state.selectedAgents&&(a.agents=this.state.selectedAgents.join(",")),Object(g.c)(Object(g.g)(b.rf,[this.props.currentPatient.id]),(function(e){1==e.current?t.setState({ledger:e.results,loading:!1,nextPage:e.next}):t.setState((function(t){return{ledger:[...t.ledger,...e.results],loading:!1,nextPage:e.next}}))}),(function(){t.setState({loading:!1})}),a)}),_(this,"loadSumData",(e=1)=>{const t=this,a={page:e,start:this.state.selectedStartDate.format(),end:this.state.selectedEndDate.format(),agents:this.state.selectedAgents.join(",")};this.state.selectedAgents&&(a.agents=this.state.selectedAgents.join(",")),Object(g.c)(Object(g.g)(b.tf,[this.props.currentPatient.id]),(function(e){t.setState({ledgerDetails:e,nextPage:e.next})}),(function(){}),a)}),_(this,"changeExpenseFilters",(e,t)=>{const a=this;this.setState({[e]:t},(function(){a.loadData(1),a.loadSumData(1)}))}),this.state={ledger:[],ledgerDetails:{},loading:!1,walletAmount:null,selectedStartDate:f()().subtract(1,"month"),selectedEndDate:f()(),agents:[],selectedAgents:[],loadings:!1}}componentDidMount(){this.loadData(),this.loadPatientWallet(),this.loadAgents(),this.loadSumData()}loadAgents(){const e=this;Object(g.c)(Object(g.g)(b.Zc,[this.props.currentPatient.id]),(function(t){e.setState({agents:t})}),(function(){}),{agent:!0,pagination:!1})}loadPDF(){const e=this;e.setState({loadings:!0});const t={patient:this.props.currentPatient.id,start:this.state.selectedStartDate.startOf("day").format(),end:this.state.selectedEndDate.endOf("day").format()};Object(g.c)(b.sf,(function(t){e.setState({loadings:!1}),t.report_pdf&&window.open(v.a+t.report_pdf)}),(function(){e.setState({loadings:!1})}),t)}render(){this.state.loadings;const e=[{title:"Date",dataIndex:"created_at",key:"created_at",render:e=>f()(e).format("LLL")},{title:"Patient",dataIndex:"received_from",key:"received_from",render:(e,t)=>e?i.a.createElement(P,null,e.user.first_name," (",e.custom_id,")"):"--"},,{title:"Refered By",dataIndex:"received_from.user.referer_data",key:"received_from.user.referer_data",render:(e,t)=>e&&e.referer?i.a.createElement(P,null,e.referer.first_name," (",e.custom_id,")"):"--"},{title:"Ledger Comment",dataIndex:"comments",key:"comments",render:(e,t)=>t.is_cancelled?i.a.createElement(P,{delete:!0},e):e},{title:"Cr/Dr",dataIndex:"ledger_type",key:"ledger_type",render:(e,t)=>t.is_cancelled?i.a.createElement(P,{delete:!0},e):e},{title:"Amount",dataIndex:"amount",key:"amount",render:(e,t)=>t.is_cancelled?i.a.createElement(P,{delete:!0},e.toFixed(2)):e.toFixed(2)}];return i.a.createElement("div",null,i.a.createElement(l.a,{title:"Wallet Ledger",extra:[this.state.walletAmount?i.a.createElement(s.a,{prefix:i.a.createElement(o.a,{type:"wallet"}),value:this.state.walletAmount.non_refundable,precision:2}):null]},i.a.createElement(c.a,{gutter:16,style:{marginBottom:10}},i.a.createElement(d.a,{span:2,style:{textAlign:"right"}},i.a.createElement("b",null," Agents")),i.a.createElement(d.a,{span:4},i.a.createElement(p.a,{style:{width:"100%"},value:this.state.selectedAgents,mode:"multiple",disabled:this.state.loading,onChange:e=>this.changeExpenseFilters("selectedAgents",e)},this.state.agents.map(e=>i.a.createElement(p.a.Option,{value:e.id},e.user.first_name)))),i.a.createElement(d.a,{span:2,style:{textAlign:"right"}},i.a.createElement("b",null," From")),i.a.createElement(d.a,{span:4},i.a.createElement(m.a,{value:this.state.selectedStartDate,disabled:this.state.loading,allowClear:!1,onChange:e=>this.changeExpenseFilters("selectedStartDate",e)})),i.a.createElement(d.a,{span:2,style:{textAlign:"right"}},i.a.createElement("b",null," To")),i.a.createElement(d.a,{span:4},i.a.createElement(m.a,{value:this.state.selectedEndDate,disabled:this.state.loading,allowClear:!1,onChange:e=>this.changeExpenseFilters("selectedEndDate",e)}))),i.a.createElement(c.a,{style:{textAlign:"center",marginBottom:10}},i.a.createElement(d.a,{span:6},i.a.createElement(s.a,{title:"Credit",value:this.state.ledgerDetails.credit,precision:2})),i.a.createElement(d.a,{span:6},i.a.createElement(s.a,{title:"Debit",value:this.state.ledgerDetails.debit,precision:2})),i.a.createElement(d.a,{span:6},i.a.createElement(s.a,{title:"Payout",value:this.state.ledgerDetails.payout,precision:2})),i.a.createElement(d.a,{span:6},i.a.createElement(s.a,{title:"Profit",value:this.state.ledgerDetails.credit-this.state.ledgerDetails.debit,precision:2}))),i.a.createElement("a",{onClick:()=>this.loadPDF()},i.a.createElement(u.a,{type:"primary",size:"small",icon:"file-pdf",loading:this.state.loadings},"PDF")),i.a.createElement(y.a,{dataSource:this.state.ledger,loading:this.state.loading,columns:e,hideReport:!0,pagination:!1}),i.a.createElement(E.a,{loading:this.state.loading,hidden:!this.state.nextPage,loaderFunction:()=>this.loadData(this.state.nextPage)})))}}},832:function(e,t,a){e.exports=a(833)},833:function(e,t,a){"use strict";a.r(t);var n=a(1),i=a.n(n),r=a(12),l=a.n(r),s=a(443);function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function c(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}function d(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var f=a(34),y=function(e){function t(e){var a,n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,i=p(t).call(this,e),a=!i||"object"!=typeof i&&"function"!=typeof i?u(n):i,h(u(u(a)),"handleClick",(function(e){var t=a.state.checked,n=a.props.onClick,i=!t;a.setChecked(i,e),n&&n(i,e)})),h(u(u(a)),"handleKeyDown",(function(e){37===e.keyCode?a.setChecked(!1,e):39===e.keyCode&&a.setChecked(!0,e)})),h(u(u(a)),"handleMouseUp",(function(e){var t=a.props.onMouseUp;a.node&&a.node.blur(),t&&t(e)})),h(u(u(a)),"saveNode",(function(e){a.node=e}));var r=!1;return r="checked"in e?!!e.checked:!!e.defaultChecked,a.state={checked:r},a}var a,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,e),a=t,r=[{key:"getDerivedStateFromProps",value:function(e){var t={},a=e.checked;return"checked"in e&&(t.checked=!!a),t}}],(n=[{key:"componentDidMount",value:function(){var e=this.props,t=e.autoFocus,a=e.disabled;t&&!a&&this.focus()}},{key:"setChecked",value:function(e,t){var a=this.props,n=a.disabled,i=a.onChange;n||("checked"in this.props||this.setState({checked:e}),i&&i(e,t))}},{key:"focus",value:function(){this.node.focus()}},{key:"blur",value:function(){this.node.blur()}},{key:"render",value:function(){var e,t=this.props,a=t.className,n=t.prefixCls,r=t.disabled,l=t.loadingIcon,s=t.checkedChildren,d=t.unCheckedChildren,p=c(t,["className","prefixCls","disabled","loadingIcon","checkedChildren","unCheckedChildren"]),m=this.state.checked,u=f((h(e={},a,!!a),h(e,n,!0),h(e,"".concat(n,"-checked"),m),h(e,"".concat(n,"-disabled"),r),e));return i.a.createElement("button",o({},p,{type:"button",role:"switch","aria-checked":m,disabled:r,className:u,ref:this.saveNode,onKeyDown:this.handleKeyDown,onClick:this.handleClick,onMouseUp:this.handleMouseUp}),l,i.a.createElement("span",{className:"".concat(n,"-inner")},m?s:d))}}])&&d(a.prototype,n),r&&d(a,r),t}(n.Component);y.propTypes={className:l.a.string,prefixCls:l.a.string,disabled:l.a.bool,checkedChildren:l.a.any,unCheckedChildren:l.a.any,onChange:l.a.func,onMouseUp:l.a.func,onClick:l.a.func,tabIndex:l.a.number,checked:l.a.bool,defaultChecked:l.a.bool,autoFocus:l.a.bool,loadingIcon:l.a.node},y.defaultProps={prefixCls:"rc-switch",checkedChildren:null,unCheckedChildren:null,className:"",defaultChecked:!1},Object(s.polyfill)(y),t.default=y},835:function(e,t,a){"use strict";a.d(t,"a",(function(){return H}));var n=a(1),i=a.n(n);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=function(e){function t(){return l(this,t),o(this,c(t).apply(this,arguments))}var a,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,e),a=t,(n=[{key:"componentDidMount",value:function(){!function(e,t){if(!document.head.querySelector("#"+e)){var a=document.createElement("style");a.textContent=t,a.type="text/css",a.id=e,document.head.appendChild(a)}}(this.props.name,this.props.css)}},{key:"componentWillUnmount",value:function(){var e=document.getElementById(this.props.name);e.parentNode.removeChild(e)}},{key:"render",value:function(){return null}}])&&s(a.prototype,n),i&&s(a,i),t}(n.Component),m=function(e){var t=e.imageBackgroundColor;return"\n  body {\n    overflow: hidden;\n  }\n\n  .__react_modal_image__modal_container {\n    position: fixed;\n    z-index: 5000;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.8);\n    touch-action: none;\n    overflow: hidden;\n  }\n\n  .__react_modal_image__modal_content {\n    position: relative;\n    height: 100%;\n    width: 100%;\n  }\n\n  .__react_modal_image__modal_content img, \n  .__react_modal_image__modal_content svg {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate3d(-50%, -50%, 0);\n    -webkit-transform: translate3d(-50%, -50%, 0);\n    -ms-transform: translate3d(-50%, -50%, 0);\n    overflow: hidden;\n  }\n\n  .__react_modal_image__medium_img {\n    max-width: 98%;\n    max-height: 98%;\n    background-color: ".concat(t,";\n  }\n\n  .__react_modal_image__large_img {\n    cursor: move;\n    background-color: ").concat(t,"\n  }\n\n  .__react_modal_image__icon_menu a {\n    display: inline-block;\n    font-size: 40px;\n    cursor: pointer;\n    line-height: 40px;\n    box-sizing: border-box;\n    border: none;\n    padding: 0px 5px 0px 5px;\n    margin-left: 10px;\n    color: white;\n    background-color: rgba(0, 0, 0, 0);\n  }\n\n  .__react_modal_image__icon_menu {\n    display: inline-block;\n    float: right;\n  }\n\n  .__react_modal_image__caption {\n    display: inline-block;\n    color: white;\n    font-size: 120%;\n    padding: 10px;\n    margin: 0;\n  }\n\n  .__react_modal_image__header {\n    position: absolute;\n    top: 0;\n    width: 100%;\n    background-color: rgba(0, 0, 0, 0.7);\n    overflow: hidden;\n  }\n")},u=function(){return i.a.createElement("svg",{fill:"#ffffff",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}),i.a.createElement("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"}))},h=function(){return i.a.createElement("svg",{fill:"#ffffff",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}),i.a.createElement("path",{d:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"}))},f=function(){return i.a.createElement("svg",{fill:"#ffffff",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"}),i.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}))},y=function(){return i.a.createElement("svg",{fill:"#ffffff",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),i.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}))},g=function(){return i.a.createElement("svg",{fill:"#ffffff",height:"48",viewBox:"0 0 24 24",width:"48",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("path",{d:"M6 2v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18V2H6zm10 14.5V20H8v-3.5l4-4 4 4zm-4-5l-4-4V4h8v3.5l-4 4z"}),i.a.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}))},b=function(){return i.a.createElement("svg",{fill:"#ffffff",width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("path",{fill:"none",d:"M0 0h24v24H0V0zm0 0h24v24H0V0z"}),i.a.createElement("path",{d:"M7.47 21.49C4.2 19.93 1.86 16.76 1.5 13H0c.51 6.16 5.66 11 11.95 11 .23 0 .44-.02.66-.03L8.8 20.15l-1.33 1.34zM12.05 0c-.23 0-.44.02-.66.04l3.81 3.81 1.33-1.33C19.8 4.07 22.14 7.24 22.5 11H24c-.51-6.16-5.66-11-11.95-11zM16 14h2V8c0-1.11-.9-2-2-2h-6v2h6v6zm-8 2V4H6v2H4v2h2v8c0 1.1.89 2 2 2h8v2h2v-2h2v-2H8z"}))},E=function(e){var t=e.image,a=e.alt,n=e.zoomed,r=e.toggleZoom,l=e.toggleRotate,s=e.onClose,o=e.enableDownload,c=e.enableZoom,d=e.enableRotate;return i.a.createElement("div",{className:"__react_modal_image__header"},i.a.createElement("span",{className:"__react_modal_image__icon_menu"},o&&i.a.createElement("a",{href:t,download:!0},i.a.createElement(f,null)),c&&i.a.createElement("a",{onClick:r},n?i.a.createElement(h,null):i.a.createElement(u,null)),d&&i.a.createElement("a",{onClick:l},i.a.createElement(b,null)),i.a.createElement("a",{onClick:s},i.a.createElement(y,null))),a&&i.a.createElement("span",{className:"__react_modal_image__caption"},a))};function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function k(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?C(e):t}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var x=function(e){function t(){var e,a;_(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return I(C(a=k(this,(e=O(t)).call.apply(e,[this].concat(i)))),"state",{loading:!0}),I(C(a),"handleOnLoad",(function(){a.setState({loading:!1})})),I(C(a),"handleOnContextMenu",(function(e){!a.props.contextMenu&&e.preventDefault()})),a}var a,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,e),a=t,(n=[{key:"render",value:function(){var e=this.props,t=e.id,a=e.className,n=e.src,r=e.style,l=e.handleDoubleClick;return i.a.createElement("div",null,this.state.loading&&i.a.createElement(g,null),i.a.createElement("img",{id:t,className:a,src:n,style:r,onLoad:this.handleOnLoad,onDoubleClick:l,onContextMenu:this.handleOnContextMenu}))}}])&&P(a.prototype,n),r&&P(a,r),t}(n.Component);function D(e){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function M(e,t){return!t||"object"!==D(t)&&"function"!=typeof t?F(e):t}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var V=function(e){function t(){var e,a;j(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return N(F(a=M(this,(e=T(t)).call.apply(e,[this].concat(i)))),"state",{move:{x:0,y:0},moveStart:void 0,zoomed:!1,rotationDeg:0}),N(F(a),"handleKeyDown",(function(e){27!==e.keyCode&&13!==e.keyCode||a.props.onClose()})),N(F(a),"getCoordinatesIfOverImg",(function(e){var t=e.changedTouches?e.changedTouches[0]:e;if("react-modal-image-img"===t.target.id){var n=a.contentEl.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}})),N(F(a),"handleMouseDownOrTouchStart",(function(e){if(e.preventDefault(),!(e.touches&&e.touches.length>1)){var t=a.getCoordinatesIfOverImg(e);t||a.props.onClose(),a.state.zoomed&&a.setState((function(e){return{moveStart:{x:t.x-e.move.x,y:t.y-e.move.y}}}))}})),N(F(a),"handleMouseMoveOrTouchMove",(function(e){if(e.preventDefault(),a.state.zoomed&&a.state.moveStart&&!(e.touches&&e.touches.length>1)){var t=a.getCoordinatesIfOverImg(e);t&&a.setState((function(e){return{move:{x:t.x-e.moveStart.x,y:t.y-e.moveStart.y}}}))}})),N(F(a),"handleMouseUpOrTouchEnd",(function(e){a.setState({moveStart:void 0})})),N(F(a),"toggleZoom",(function(e){e.preventDefault(),a.setState((function(e){return{zoomed:!e.zoomed,move:e.zoomed?{x:0,y:0}:e.move}}))})),N(F(a),"toggleRotate",(function(e){e.preventDefault(),360!==a.state.rotationDeg?a.setState((function(e){return{rotationDeg:e.rotationDeg+=90}})):a.setState({rotationDeg:90})})),a}var a,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(t,e),a=t,(n=[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown,!1)}},{key:"render",value:function(){var e=this,t=this.props,a=t.medium,n=t.large,r=t.alt,l=t.onClose,s=t.hideDownload,o=t.hideZoom,c=t.showRotate,d=t.imageBackgroundColor,u=void 0===d?"black":d,h=this.state,f=h.move,y=h.zoomed,g=h.rotationDeg;return i.a.createElement("div",null,i.a.createElement(p,{name:"__react_modal_image__lightbox",css:m({imageBackgroundColor:u})}),i.a.createElement("div",{className:"__react_modal_image__modal_container"},i.a.createElement("div",{className:"__react_modal_image__modal_content",onMouseDown:this.handleMouseDownOrTouchStart,onMouseUp:this.handleMouseUpOrTouchEnd,onMouseMove:this.handleMouseMoveOrTouchMove,onTouchStart:this.handleMouseDownOrTouchStart,onTouchEnd:this.handleMouseUpOrTouchEnd,onTouchMove:this.handleMouseMoveOrTouchMove,ref:function(t){e.contentEl=t}},y&&i.a.createElement(x,{id:"react-modal-image-img",className:"__react_modal_image__large_img",src:n||a,style:{transform:"translate3d(-50%, -50%, 0) translate3d(".concat(f.x,"px, ").concat(f.y,"px, 0) rotate(").concat(g,"deg)"),WebkitTransform:"translate3d(-50%, -50%, 0) translate3d(".concat(f.x,"px, ").concat(f.y,"px, 0) rotate(").concat(g,"deg)"),MsTransform:"translate3d(-50%, -50%, 0) translate3d(".concat(f.x,"px, ").concat(f.y,"px, 0) rotate(").concat(g,"deg)")},handleDoubleClick:this.toggleZoom}),!y&&i.a.createElement(x,{id:"react-modal-image-img",className:"__react_modal_image__medium_img",src:a||n,handleDoubleClick:this.toggleZoom,contextMenu:!a,style:{transform:"translate3d(-50%, -50%, 0) rotate(".concat(g,"deg)"),WebkitTransform:"translate3d(-50%, -50%, 0) rotate(".concat(g,"deg)"),MsTransform:"translate3d(-50%, -50%, 0) rotate(".concat(g,"deg)")}})),i.a.createElement(E,{image:n||a,alt:r,zoomed:y,toggleZoom:this.toggleZoom,toggleRotate:this.toggleRotate,onClose:l,enableDownload:!s,enableZoom:!o,enableRotate:!!c})))}}])&&w(a.prototype,n),r&&w(a,r),t}(n.Component);function L(e){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function z(e,t){return!t||"object"!==L(t)&&"function"!=typeof t?q(e):t}function Y(e){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function G(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var H=function(e){function t(){var e,a;R(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return G(q(a=z(this,(e=Y(t)).call.apply(e,[this].concat(i)))),"state",{modalOpen:!1}),G(q(a),"toggleModal",(function(){a.setState((function(e){return{modalOpen:!e.modalOpen}}))})),a}var a,n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(t,e),a=t,(n=[{key:"render",value:function(){var e=this.props,t=e.className,a=e.small,n=e.smallSrcSet,r=e.medium,l=e.large,s=e.alt,o=e.hideDownload,c=e.hideZoom,d=e.showRotate,p=e.imageBackgroundColor,m=this.state.modalOpen;return i.a.createElement("div",null,i.a.createElement("img",{className:t,style:{cursor:"pointer",maxWidth:"100%",maxHeight:"100%"},onClick:this.toggleModal,src:a,srcSet:n,alt:s}),m&&i.a.createElement(V,{medium:r,large:l,alt:s,onClose:this.toggleModal,hideDownload:o,hideZoom:c,showRotate:d,imageBackgroundColor:p}))}}])&&B(a.prototype,n),r&&B(a,r),t}(n.Component)}}]);