(this["webpackJsonpbk-erp-front"]=this["webpackJsonpbk-erp-front"]||[]).push([[22],{1073:function(e,t){},1252:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return S}));n(242);var a=n(19),o=(n(226),n(227)),i=(n(229),n(228)),r=(n(236),n(237)),c=(n(231),n(232)),s=n(47),l=n(31),d=n(95),u=n(94),m=n(97),f=n(96),p=n(24),g=n(98),E=n(0),v=n.n(E),h=n(1045),_=n.n(h),b=n(34),y=n(23),C=n(2),A=null,L=null,N={},D={},S=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(m.a)(this,Object(f.a)(t).call(this,e))).setFocusedPeer=function(e){var t=n.state,a=t.DEFAULT_CHANNEL,o=t.MUTE_CHANNEL;if(!n.state.is_admin)return Object(y.a)(C.bc,"You are not allowed for this action."),!1;n.setState({focusedPeer:e}),A.send({admin:e,peer_id:"admin",channel:a,mute:o})},n.toggleChannelMute=function(e){var t=n.state,a=t.DEFAULT_CHANNEL,o=t.MUTE_CHANNEL;if(!n.state.is_admin)return Object(y.a)(C.bc,"You are not allowed for this action."),!1;A.send({admin:null,peer_id:"admin",channel:a,mute:!o})},n.loadMeeting=function(e){var t=Object(p.a)(n);Object(y.c)(Object(y.f)(b.od,[e]),(function(e){var n=!1;e.admins.forEach((function(e){t.props.user.staff&&t.props.user.staff.id==e&&(n=!0)})),t.setState({meetingDetails:e,is_admin:n}),t.changeChannel(e.meeting_id)}),(function(){}))},n.changeChannel=function(e){e=e||"default";var t=Object(p.a)(n);n.setState({DEFAULT_CHANNEL:e},(function(){t.init()}))},n.init=function(){var e=Object(p.a)(n);console.log("Connecting to signaling server");var t=n.state,a=t.SIGNALING_SERVER,o=t.DEFAULT_CHANNEL,i=t.ICE_SERVERS,r=t.MUTE_CHANNEL;(A=_()(a)).on("message",(function(t){console.log("userDetails",t),console.log("admin",t.admin),e.setState({meetingUserDetails:t,MUTE_CHANNEL:t.mute})})),A.on("connect",(function(){console.log("Connected to signaling server"),e.setupLocalMedia((function(){var e,t;e=o,t={"whatever-you-want-here":"stuff"},A.emit("join",{channel:e,userdata:t})}))})),A.on("disconnect",(function(){console.log("Disconnected from signaling server"),N={},D={}})),A.on("addPeer",(function(t){console.log("Signaling server said to add peer:",t);var n=t.peer_id;if(n in N)console.log("Already connected to peer ",n);else{var a=new RTCPeerConnection({iceServers:i},{optional:[{DtlsSrtpKeyAgreement:!0}]});console.log("New Peer Connection",a),N[n]=a,a.onicecandidate=function(e){e.candidate&&A.emit("relayICECandidate",{peer_id:n,ice_candidate:{sdpMLineIndex:e.candidate.sdpMLineIndex,candidate:e.candidate.candidate}})},a.onaddstream=function(t){console.log("onAddStream",t);var a=v.a.createElement("video",{key:n,ref:function(e){e&&(e.srcObject=t.stream)},autoPlay:!0,controls:!0,muted:r,style:{width:"100%"}});D[n]=a,e.setState((function(e){return{availablePeers:Object(l.a)({},e.availablePeers,Object(s.a)({},n,!0))}}))},a.addStream(L),t.should_create_offer&&(console.log("Creating RTC offer to ",n),a.createOffer((function(e){console.log("Local offer description is: ",e),a.setLocalDescription(e,(function(){A.emit("relaySessionDescription",{peer_id:n,session_description:e}),console.log("Offer setLocalDescription succeeded")}),(function(){Object(y.a)(C.Q,"Offer setLocalDescription failed!")}))}),(function(e){console.log("Error sending offer: ",e)})))}})),A.on("sessionDescription",(function(t){console.log("Remote description received: ",t);var n=t.peer_id,a=N[n],i=t.session_description;console.log(t.session_description);var c=Object(l.a)({},e.props.user,{peer_id:n,channel:o,mute:r});(e.state.is_admin||c.is_superuser)&&(c.admin=!0,A.send({admin:n,peer_id:"admin",channel:o,mute:r})),e.setState({myPeerId:t.peer_id}),A.send(c);var s=new RTCSessionDescription(i);a.setRemoteDescription(s,(function(){console.log("setRemoteDescription succeeded"),"offer"==i.type&&(console.log("Creating answer"),a.createAnswer((function(e){console.log("Answer description is: ",e),a.setLocalDescription(e,(function(){A.emit("relaySessionDescription",{peer_id:n,session_description:e}),console.log("Answer setLocalDescription succeeded")}),(function(){Object(y.a)(C.Q,"Answer setLocalDescription failed!")}))}),(function(e){console.log("Error creating answer: ",e),console.log(a)})))}),(function(e){console.log("setRemoteDescription error: ",e)}));console.log("Description Object: ",s)})),A.on("iceCandidate",(function(e){var t=N[e.peer_id],n=e.ice_candidate;t.addIceCandidate(new RTCIceCandidate(n))})),A.on("removePeer",(function(t){console.log("Signaling server said to remove peer:",t);var n=t.peer_id;D[n]=v.a.createElement("video",{src:""}),N[n].close(),delete N[n],delete D[t.peer_id],e.setState((function(e){var t=Object(l.a)({},e.availablePeers);return delete t[n],{availablePeers:Object(l.a)({},t)}}),(function(){}))}))},n.setupLocalMedia=function(e,t){var a=Object(p.a)(n);null==L?(console.log("Requesting access to local audio / video inputs"),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia({audio:!0,video:!0},(function(t){console.log("Access granted to audio/video"),L=t;var n=v.a.createElement("video",{key:"me",muted:!0,autoPlay:!0,style:{width:"100%"},ref:function(e){e&&(e.srcObject=t)}});a.setState({localMediaComponent:n}),e&&e()}),(function(){console.log("Access denied for audio/video"),alert("You chose not to provide access to the camera/microphone, demo will not work."),t&&t()}))):e&&e()},n.state={myPeerId:null,is_admin:!1,meetingDetails:{},SIGNALING_SERVER:"https://bk-erp.plutonic.co.in",DEFAULT_CHANNEL:"",ICE_SERVERS:[{url:"stun:bk-erp.plutonic.co.in:3478",username:"test01",credential:"testdriver"}],localMediaComponent:v.a.createElement("div",null),availablePeers:{},meetingUserDetails:{},MUTE_CHANNEL:!1},n}return Object(g.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.props.match.params&&this.props.match.params.meetingId&&this.loadMeeting(this.props.match.params.meetingId)}},{key:"render",value:function(){var e=this,t=this.state,n=t.localMediaComponent,s=t.availablePeers,l=t.meetingUserDetails,d=t.meetingDetails,u=t.myPeerId,m=t.MUTE_CHANNEL,f=Object.keys(s);return v.a.createElement("div",{style:{minHeight:"100vh",textAlign:"center"}},v.a.createElement("h3",null,d.name),v.a.createElement(o.a,{type:"flex",justify:"center",gutter:16,style:{marginTop:10}},l.me&&l.me.socket===l.admin?v.a.createElement(r.a,{xs:24,sm:12,md:12,lg:12,xl:12,key:u},v.a.createElement(c.a,{bodyStyle:{padding:0,textAlign:"center"}},n,v.a.createElement("h4",null,l[l.admin]?l[l.admin].first_name:"--"," "))):f.map((function(t){return l.admin===t?v.a.createElement(r.a,{xs:24,sm:12,md:12,lg:12,xl:12,key:t},v.a.createElement(c.a,{bodyStyle:{padding:0,textAlign:"center"}},D[t],v.a.createElement("h4",null,l[t]?l[t].first_name:"--"),v.a.createElement("h2",null,v.a.createElement(i.a.Group,null,v.a.createElement(i.a,{type:e.state.MUTE_CHANNEL?"danger":"primary",icon:"audio",onClick:e.toggleChannelMute},e.state.MUTE_CHANNEL),v.a.createElement(i.a,{type:"danger",icon:"close",onClick:function(){return e.setFocusedPeer(l.me?l.me.socket:null)}}))))):null}))),v.a.createElement(o.a,{gutter:16,style:{marginTop:10},type:"flex",justify:"center"},v.a.createElement(r.a,{xs:24,sm:12,md:4,lg:4,xl:3},v.a.createElement(c.a,{key:"me",bodyStyle:{padding:0,textAlign:"center"}},n,v.a.createElement("h4",null," ",v.a.createElement(a.a,{theme:"twoTone",type:"audio",twoToneColor:m?"#f00":"#0f0"})," ME"))),f.map((function(t){var n=D[t];return v.a.createElement(r.a,{xs:8,sm:8,md:4,lg:4,xl:3,key:t,onClick:function(){return e.setFocusedPeer(t)}},v.a.createElement(c.a,{bodyStyle:{padding:0,textAlign:"center"}},n,v.a.createElement("h4",null," ",v.a.createElement(a.a,{theme:"twoTone",type:"audio",twoToneColor:m?"#f00":"#0f0"})," ",l[t]?l[t].first_name:"--")))}))))}}]),t}(v.a.Component)}}]);
//# sourceMappingURL=22.fa480307.chunk.js.map