(this["webpackJsonpbk-erp-front"]=this["webpackJsonpbk-erp-front"]||[]).push([[22],{1073:function(e,t){},1252:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return O}));n(226);var o=n(227),a=(n(229),n(228)),i=(n(236),n(237)),r=(n(231),n(232)),s=n(47),c=n(31),l=n(95),d=n(94),u=n(97),m=n(96),f=n(24),g=n(98),p=n(0),v=n.n(p),E=n(1045),b=n.n(E),h=n(34),y=n(23),_=n(2),S=null,C=null,D={},j={},O=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(m.a)(t).call(this,e))).setFocusedPeer=function(e){if(!n.state.is_admin)return Object(y.a)(_.bc,"You are not allowed for this action."),!1;n.setState({focusedPeer:e}),S.send({admin:e,peer_id:"admin"})},n.loadMeeting=function(e){var t=Object(f.a)(n);Object(y.c)(Object(y.f)(h.od,[e]),(function(e){var n=!1;e.admins.forEach((function(e){t.props.user.staff&&t.props.user.staff.id==e&&(n=!0)})),t.setState({meetingDetails:e,is_admin:n}),t.changeChannel(e.meeting_id)}),(function(){}))},n.changeChannel=function(e){e=e||"default";var t=Object(f.a)(n);n.setState({DEFAULT_CHANNEL:e},(function(){t.init()}))},n.init=function(){var e=Object(f.a)(n);console.log("Connecting to signaling server");var t=n.state,o=t.SIGNALING_SERVER,a=t.DEFAULT_CHANNEL,i=t.ICE_SERVERS;(S=b()(o)).on("message",(function(t){console.log("userDetails",t),console.log("admin",t.admin),e.setState({meetingUserDetails:t})})),S.on("connect",(function(){console.log("Connected to signaling server"),e.setupLocalMedia((function(){var e,t;e=a,t={"whatever-you-want-here":"stuff"},S.emit("join",{channel:e,userdata:t})}))})),S.on("disconnect",(function(){console.log("Disconnected from signaling server"),D={},j={}})),S.on("addPeer",(function(t){console.log("Signaling server said to add peer:",t);var n=t.peer_id;if(n in D)console.log("Already connected to peer ",n);else{var o=new RTCPeerConnection({iceServers:i},{optional:[{DtlsSrtpKeyAgreement:!0}]});console.log("New Peer Connection",o),D[n]=o,o.onicecandidate=function(e){e.candidate&&S.emit("relayICECandidate",{peer_id:n,ice_candidate:{sdpMLineIndex:e.candidate.sdpMLineIndex,candidate:e.candidate.candidate}})},o.onaddstream=function(t){console.log("onAddStream",t);var o=v.a.createElement("video",{key:n,ref:function(e){e&&(e.srcObject=t.stream)},autoPlay:!0,style:{width:"100%"}});j[n]=o,e.setState((function(e){return{availablePeers:Object(c.a)({},e.availablePeers,Object(s.a)({},n,!0))}}))},o.addStream(C),t.should_create_offer&&(console.log("Creating RTC offer to ",n),o.createOffer((function(e){console.log("Local offer description is: ",e),o.setLocalDescription(e,(function(){S.emit("relaySessionDescription",{peer_id:n,session_description:e}),console.log("Offer setLocalDescription succeeded")}),(function(){Object(y.a)(_.Q,"Offer setLocalDescription failed!")}))}),(function(e){console.log("Error sending offer: ",e)})))}})),S.on("sessionDescription",(function(t){console.log("Remote description received: ",t);var n=t.peer_id,o=D[n],a=t.session_description;console.log(t.session_description);var i=Object(c.a)({},e.props.user,{peer_id:n});(e.state.is_admin||i.is_superuser)&&(i.admin=!0,S.send({admin:n,peer_id:"admin"})),e.setState({myPeerId:t.peer_id}),S.send(i);var r=new RTCSessionDescription(a);o.setRemoteDescription(r,(function(){console.log("setRemoteDescription succeeded"),"offer"==a.type&&(console.log("Creating answer"),o.createAnswer((function(e){console.log("Answer description is: ",e),o.setLocalDescription(e,(function(){S.emit("relaySessionDescription",{peer_id:n,session_description:e}),console.log("Answer setLocalDescription succeeded")}),(function(){Object(y.a)(_.Q,"Answer setLocalDescription failed!")}))}),(function(e){console.log("Error creating answer: ",e),console.log(o)})))}),(function(e){console.log("setRemoteDescription error: ",e)}));console.log("Description Object: ",r)})),S.on("iceCandidate",(function(e){var t=D[e.peer_id],n=e.ice_candidate;t.addIceCandidate(new RTCIceCandidate(n))})),S.on("removePeer",(function(t){console.log("Signaling server said to remove peer:",t);var n=t.peer_id;j[n]=v.a.createElement("video",{src:""}),D[n].close(),delete D[n],delete j[t.peer_id],e.setState((function(e){var t=Object(c.a)({},e.availablePeers);return delete t[n],{availablePeers:Object(c.a)({},t)}}),(function(){}))}))},n.setupLocalMedia=function(e,t){var o=Object(f.a)(n);null==C?(console.log("Requesting access to local audio / video inputs"),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia({audio:!0,video:!0},(function(t){console.log("Access granted to audio/video"),C=t;var n=v.a.createElement("video",{key:"me",muted:!0,autoPlay:!0,style:{width:"100%"},ref:function(e){e&&(e.srcObject=t)}});o.setState({localMediaComponent:n}),e&&e()}),(function(){console.log("Access denied for audio/video"),alert("You chose not to provide access to the camera/microphone, demo will not work."),t&&t()}))):e&&e()},n.state={myPeerId:null,is_admin:!1,meetingDetails:{},SIGNALING_SERVER:"https://bk-erp.plutonic.co.in",DEFAULT_CHANNEL:"",ICE_SERVERS:[{url:"stun:stun.l.google.com:19302"}],localMediaComponent:v.a.createElement("div",null),availablePeers:{},meetingUserDetails:{}},n}return Object(g.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.props.match.params&&this.props.match.params.meetingId&&this.loadMeeting(this.props.match.params.meetingId)}},{key:"render",value:function(){var e=this,t=this.state,n=t.localMediaComponent,s=t.availablePeers,c=t.meetingUserDetails,l=t.meetingDetails,d=t.myPeerId,u=Object.keys(s);return v.a.createElement("div",{style:{minHeight:"100vh",textAlign:"center"}},v.a.createElement("h3",null,l.name),v.a.createElement(o.a,{type:"flex",justify:"center",gutter:16,style:{marginTop:10}},c.me&&c.me.socket===c.admin?v.a.createElement(i.a,{xs:24,sm:12,md:12,lg:12,xl:12,key:d},v.a.createElement(r.a,{bodyStyle:{padding:0,textAlign:"center"}},n,v.a.createElement("h4",null,c[c.admin]?c[c.admin].first_name:"--"," "))):u.map((function(t){return c.admin===t?v.a.createElement(i.a,{xs:24,sm:12,md:12,lg:12,xl:12,key:t},v.a.createElement(r.a,{bodyStyle:{padding:0,textAlign:"center"}},j[t],v.a.createElement("h4",null,c[t]?c[t].first_name:"--",v.a.createElement(a.a,{type:"danger",shape:"circle",icon:"close",onClick:function(){return e.setFocusedPeer(c.me?c.me.socket:null)},style:{float:"right"}})))):null}))),v.a.createElement(o.a,{gutter:16,style:{marginTop:10},type:"flex",justify:"center"},v.a.createElement(i.a,{xs:24,sm:12,md:4,lg:4,xl:3},v.a.createElement(r.a,{key:"me",bodyStyle:{padding:0,textAlign:"center"}},n,v.a.createElement("h4",null,"ME"))),u.map((function(t){return v.a.createElement(i.a,{xs:8,sm:8,md:4,lg:4,xl:3,key:t,onClick:function(){return e.setFocusedPeer(t)}},v.a.createElement(r.a,{bodyStyle:{padding:0,textAlign:"center"}},j[t],v.a.createElement("h4",null,c[t]?c[t].first_name:"--")))}))))}}]),t}(v.a.Component)}}]);
//# sourceMappingURL=22.e4de43d9.chunk.js.map